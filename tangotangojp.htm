<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—¥æœ¬èª Vocab Builder</title>
<style>
:root {
--primary: #DA536E; /* æ¤¿(tsubaki) */
--secondary: #E6B422; /* é‡‘è‰²(kin-iro) */
--accent1: #1976D2; /* Japanese Blue */
--accent2: #86C166; /* è‹—è‰²(nae-iro) */
--accent3: #8A6BBE; /* è—¤ç´«(fuji-murasaki) */
--accent4: #51A8DD; /* ç¾¤é’(gun-jou) */
--accent5: #FFA500; /* å±±å¹è‰²(yama-buki-iro) */
--dark: #2C2C2C; /* Dark Gray */
--light: #F8F5E3; /* Ivory */
--mid: #757575; /* Mid Gray */
}

body {
font-family: 'Hiragino Sans', 'Meiryo', 'MS Gothic', sans-serif;
background-color: var(--light);
color: var(--dark);
max-width: 900px;
margin: 0 auto;
padding: 20px;
line-height: 1.5;
}

header {
text-align: center;
margin-bottom: 30px;
}

h1 {
color: var(--primary);
font-size: 2.5rem;
margin-bottom: 10px;
letter-spacing: 1px;
}

.subtitle {
color: var(--mid);
font-size: 1.1rem;
margin-bottom: 15px;
}

.tts-system-selector {
margin-top: 15px;
font-size: 16px;
color: var(--dark);
}

.tts-system-selector label {
font-weight: bold;
margin-right: 8px;
}

.tts-system-selector select {
padding: 8px 12px;
border: 2px solid var(--mid);
border-radius: 6px;
background-color: white;
color: var(--dark);
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: border-color 0.2s ease;
}

.tts-system-selector select:hover {
border-color: var(--accent1);
}

.tts-system-selector select:focus {
outline: none;
border-color: var(--primary);
}

.controls {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 30px;
position: relative;
z-index: 1;
}

.left-controls {
display: flex;
gap: 15px;
align-items: center;
}

button {
padding: 10px 16px;
border: none;
border-radius: 6px;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: all 0.2s ease;
box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
}

button:hover {
transform: translateY(-2px);
box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
}

.text-import-btn {
background-color: var(--secondary);
color: black;
padding: 12px 24px;
font-size: 18px;
}

.japanese-to-english-btn {
background-color: var(--accent3);
color: white;
padding: 16px 25px;
font-size: 20px;
}

.listen-choose-btn {
background-color: var(--accent2);
color: white;
padding: 16px 25px;
font-size: 20px;
}

.start-btn {
background-color: var(--primary);
color: white;
padding: 16px 25px;
font-size: 20px;
}

.ai-support-btn {
background-color: var(--accent1);
color: white;
padding: 12px 24px;
font-size: 18px;
}

.quiz-mode-selector {
background-color: white;
border: 2px solid var(--mid);
border-radius: 10px;
padding: 3px;
margin: 3px 0;
box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
}

.mode-options {
display: flex;
justify-content: space-around;
gap: 20px;
}

.mode-option {
display: flex;
align-items: center;
cursor: pointer;
padding: 10px 15px;
border: 2px solid transparent;
border-radius: 8px;
transition: all 0.3s ease;
flex: 1;
text-align: center;
}

.mode-option:hover {
background-color: rgba(93, 156, 236, 0.1);
border-color: var(--accent1);
}

.mode-option input[type="radio"] {
margin: 0 8px 0 0;
transform: scale(1.2);
}

.mode-option .option-text {
font-weight: bold;
font-size: 16px;
color: var(--dark);
}

.mode-option input[type="radio"]:checked + .option-text {
color: var(--primary);
}

table {
width: 100%;
border-collapse: collapse;
margin-top: 10px;
background-color: white;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
clear: both;
display: table;
}

th, td {
padding: 12px 15px;
text-align: left;
border-bottom: 1px solid #ddd;
}

th {
background-color: var(--dark);
color: var(--light);
font-weight: bold;
}

tr:nth-child(even) {
background-color: rgba(0, 0, 0, 0.03);
}

tr:hover {
background-color: rgba(0, 0, 0, 0.05);
}

.speaker-icon {
cursor: pointer;
color: var(--secondary);
margin-left: 8px;
font-size: 20px;
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.6);
z-index: 100;
justify-content: center;
align-items: center;
}

.modal-content {
background-color: var(--light);
width: 90%;
max-width: 500px;
padding: 25px;
border-radius: 10px;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
text-align: center;
}

.modal h2 {
margin-top: 0;
color: var(--primary);
font-size: 1.8rem;
}

.prompt {
font-size: 24px;
margin: 20px 0;
color: var(--dark);
font-weight: bold;
}

.answer-input {
width: 100%;
padding: 12px;
font-size: 18px;
margin-bottom: 15px;
border: 2px solid var(--mid);
border-radius: 6px;
box-sizing: border-box;
}

.feedback {
margin: 15px 0;
font-size: 25px;
font-weight: bold;
min-height: 27px;
}

.correct {
color: var(--accent2);
}

.incorrect {
color: var(--primary);
}

.hint {
color: var(--accent1);
font-style: italic;
font-size: 25px;
margin: 10px 0;
min-height: 24px;
}

.button-group {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
margin-top: 20px;
}

.submit-btn {
background-color: var(--primary);
color: white;
}

.speak-btn {
background-color: var(--accent1);
color: white;
}

.hint-btn {
background-color: var(--secondary);
color: var(--dark);
}

.answer-btn {
background-color: var(--accent3);
color: white;
}

.next-btn {
background-color: var(--accent2);
color: white;
}

.close-btn {
background-color: var(--mid);
color: white;
}

.memory-btn {
background-color: var(--accent4);
color: white;
}

.recording {
background-color: var(--primary);
animation: pulse 1.5s infinite;
}

@keyframes pulse {
0% { opacity: 1; }
50% { opacity: 0.7; }
100% { opacity: 1; }
}

.hidden {
display: none;
}

#file-input {
display: none;
}

.no-data {
text-align: center;
padding: 40px;
color: var(--mid);
}

.tts-speed-control {
display: flex;
align-items: center;
gap: 10px;
}

.tts-speed-control select {
padding: 5px;
border-radius: 4px;
border: 1px solid var(--mid);
background-color: white;
font-size: 14px;
}

.tts-speed-control label {
font-weight: bold;
color: white;
}

.reveal-answer {
color: var(--primary);
font-weight: bold;
font-size: 30px;
margin: 10px 0;
min-height: 27px;
}

.section-header {
background-color: var(--dark);
color: var(--light);
font-weight: bold;
position: relative;
}

.section-header td {
background-color: var(--dark);
color: var(--light);
padding: 10px 15px;
}

.collapse-btn {
background: none;
border: none;
color: var(--light);
font-size: 18px;
cursor: pointer;
padding: 0 8px 0 0;
margin: 0;
transition: transform 0.2s ease;
display: inline-flex;
align-items: center;
justify-content: center;
min-width: 30px;
box-shadow: none;
}

.collapse-btn:hover {
transform: scale(1.1);
box-shadow: none;
}

.section-collapsed .collapse-btn {
transform: rotate(-90deg);
}

.section-row {
display: table-row;
transition: all 0.3s ease;
}

.section-row.section-collapsed {
display: none;
}

.section-header .section-title {
display: flex;
align-items: center;
gap: 8px;
}

.progress-info {
background-color: var(--accent1);
color: white;
padding: 8px 16px;
border-radius: 20px;
font-size: 16px;
font-weight: bold;
margin-bottom: 15px;
display: inline-block;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.progress-section {
opacity: 0.8;
font-size: 14px;
}

#text-import-content {
width: 100%;
height: 100px;
padding: 12px;
margin: 15px 0;
font-size: 16px;
border: 2px solid var(--mid);
border-radius: 6px;
box-sizing: border-box;
resize: vertical;
}

#text-import-modal .modal-content {
max-width: 800px;
max-height: 90vh;
overflow-y: auto;
}

.preset-buttons {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
margin-bottom: 20px;
}

.button-set {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    background-color: rgba(0, 0, 0, 0.02);
}

.button-set h3 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 16px;
    color: var(--dark);
}

.preset-btn {
margin: 5px;
padding: 8px 12px;
border-radius: 4px;
font-size: 14px;
border: none;
cursor: pointer;
font-weight: normal;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.textbook-btn {
background-color: var(--accent1);
color: white;
}

.jlpt-btn {
background-color: var(--accent2);
color: white;
}

.core-btn {
background-color: var(--accent3);
color: white;
}

.other-btn {
background-color: var(--secondary);
color: var(--dark);
}

#ai-support-modal .modal-content {
max-width: 600px;
}

.ai-support-links {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
margin: 20px 0;
}

.ai-support-link {
background-color: var(--accent1);
color: white;
text-decoration: none;
padding: 15px;
border-radius: 8px;
font-weight: bold;
transition: all 0.2s ease;
display: flex;
align-items: center;
justify-content: center;
}

.ai-support-link:hover {
background-color: var(--primary);
transform: translateY(-2px);
box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
}

#listen-choose-modal .modal-content {
max-width: 100%;
width: 95%;
max-height: 95vh;
padding: 15px;
}

.listen-answer-section {
display: flex;
align-items: center;
justify-content: center;
margin-bottom: 20px;
gap: 15px;
}

.listen-answer-display {
font-size: 24px;
font-weight: bold;
color: var(--primary);
min-height: 30px;
padding: 10px 15px;
border: 2px solid var(--mid);
border-radius: 8px;
background-color: white;
flex-grow: 1;
text-align: center;
}

.listen-speaker {
cursor: pointer;
color: var(--secondary);
font-size: 28px;
padding: 8px;
border-radius: 50%;
background-color: rgba(248, 181, 0, 0.1);
transition: all 0.2s ease;
}

.listen-speaker:hover {
background-color: rgba(248, 181, 0, 0.2);
transform: scale(1.1);
}

.timer-feedback-section {
margin-bottom: 25px;
min-height: 40px;
display: flex;
align-items: center;
justify-content: center;
}

.timer-feedback {
font-size: 20px;
font-weight: bold;
text-align: center;
}

.choices-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 12px;
margin-bottom: 25px;
max-width: 100%;
}

.choice-button {
padding: 15px 10px;
border: 2px solid var(--mid);
border-radius: 8px;
background-color: white;
color: var(--dark);
font-size: 16px;
font-weight: 500;
cursor: pointer;
transition: all 0.2s ease;
min-height: 60px;
display: flex;
align-items: center;
justify-content: center;
text-align: center;
line-height: 1.3;
}

.choice-button:hover {
background-color: var(--accent1);
color: white;
border-color: var(--accent1);
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.choice-button.correct {
background-color: var(--accent2);
color: white;
border-color: var(--accent2);
}

.choice-button.incorrect {
background-color: var(--primary);
color: white;
border-color: var(--primary);
}

.choice-button:disabled {
cursor: not-allowed;
opacity: 0.7;
}

.listen-controls {
display: flex;
justify-content: center;
gap: 15px;
}

.listen-next-btn {
background-color: var(--accent2);
color: white;
padding: 12px 24px;
font-size: 18px;
}

.listen-close-btn {
background-color: var(--mid);
color: white;
padding: 12px 24px;
font-size: 18px;
}

.date-info {
position: absolute;
top: 20px;
right: 20px;
text-align: right;
font-size: 14px;
line-height: 1.6;
color: var(--dark);
background-color: rgba(255, 255, 255, 0.9);
padding: 10px 15px;
border-radius: 8px;
box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
display: flex;
flex-direction: column;
gap: 5px;
font-weight: bold;
max-width: 90%;
z-index: 10;
}

.date-info span {
display: flex;
align-items: center;
white-space: nowrap;
}

.date-info .emoji {
margin-right: 8px;
font-size: 16px;
}

.date-info .countdown {
color: var(--primary);
margin: 0 3px;
}

/* Monthly Learning Cycle Styles */
.week-section {
    background-color: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.week-section h3 {
    color: var(--primary);
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.item-count {
    font-size: 14px;
    color: var(--accent1);
    font-weight: normal;
}

.days-grid {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 12px;
}

.day-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    align-items: center;
}

.day-btn {
    background-color: var(--accent4);
    color: white;
    padding: 10px;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: left;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.day-btn:hover {
    background-color: var(--primary);
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

.day-btn.has-content {
    background-color: var(--accent2);
}

.edit-btn {
    background-color: var(--accent5);
    color: var(--dark);
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.edit-btn:hover {
    background-color: var(--accent3);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

.clear-week-btn {
    background-color: var(--mid);
    color: white;
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.clear-week-btn:hover {
    background-color: var(--primary);
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

@media (max-width: 768px) {
    #monthly-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 15px;
    }
    
    .week-section {
        padding: 10px;
    }
    
    .week-section h3 {
        font-size: 15px;
    }
    
    .item-count {
        font-size: 12px;
    }
    
    .day-btn {
        font-size: 13px;
        padding: 8px 6px;
    }
    
    .edit-btn {
        padding: 8px 10px;
        font-size: 12px;
    }
    
    .day-row {
        gap: 6px;
    }
}

.footer {
            margin-top: 40px;
            text-align: center;
            padding: 15px;
            color: var(--dark);
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

#footer {
            font-weight: bold;
        }

.popup-container {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.7);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
}

.popup-content {
background-color: white;
padding: 25px;
border-radius: 15px;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
width: 90%;
max-width: 500px;
text-align: center;
}

.popup-layout {
display: flex;
align-items: center;
margin-bottom: 20px;
}

.mascot-image {
width: 150px;
flex-shrink: 0;
}

.mascot-image img {
width: 100%;
height: auto;
}

.speech-bubble {
position: relative;
background-color: #FFFDE7;
border: 2px solid var(--secondary);
border-radius: 15px;
padding: 15px;
margin-left: 15px;
}

.speech-bubble:before {
content: "";
position: absolute;
left: -15px;
top: 50%;
transform: translateY(-50%);
border-width: 15px 15px 15px 0;
border-style: solid;
border-color: transparent var(--secondary) transparent transparent;
}

.speech-bubble:after {
content: "";
position: absolute;
left: -12px;
top: 50%;
transform: translateY(-50%);
border-width: 12px 12px 12px 0;
border-style: solid;
border-color: transparent #FFFDE7 transparent transparent;
}

.japanese-text {
font-size: 18px;
font-weight: bold;
color: var(--primary);
margin-bottom: 8px;
}

.english-text {
font-size: 16px;
color: var(--dark);
}

.close-reminder-btn {
background-color: var(--accent1);
color: white;
padding: 12px 24px;
font-size: 18px;
border: none;
border-radius: 8px;
cursor: pointer;
transition: all 0.2s ease;
}

.close-reminder-btn:hover {
background-color: var(--primary);
transform: translateY(-2px);
box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
}

@media (max-width: 768px) {
.date-info {
position: static;
margin: 0 auto 15px auto;
width: 100%;
max-width: 100%;
text-align: center;
right: auto;
top: auto;
}

.date-info span {
justify-content: center;
}

header {
display: flex;
flex-direction: column;
}
}

@media (max-width: 600px) {
.button-group {
flex-direction: column;
}

button {
width: 100%;
}

th, td {
padding: 8px 10px;
}

.controls {
flex-direction: column;
gap: 15px;
align-items: stretch;
}

.left-controls {
justify-content: space-between;
width: 100%;
}

.right-controls {
justify-content: space-between;
width: 100%;
}

.choices-grid {
gap: 10px;
}

.choice-button {
padding: 12px 8px;
font-size: 14px;
min-height: 50px;
}

.listen-answer-display {
font-size: 20px;
}

.listen-speaker {
font-size: 24px;
}

.timer-feedback {
font-size: 18px;
}

.mode-option {
padding: 10px;
}

.preset-buttons {
grid-template-columns: 1fr;
}

.ai-support-links {
grid-template-columns: 1fr;
}

#listen-choose-modal .modal-content {
width: 98%;
padding: 10px;
}

.popup-layout {
flex-direction: column;
}

.speech-bubble {
margin-left: 0;
margin-top: 15px;
}

.speech-bubble:before, .speech-bubble:after {
left: 50%;
top: -15px;
transform: translateX(-50%) rotate(90deg);
}

.speech-bubble:after {
top: -12px;
}
}

</style>
</head>
<body>
<header>
<div id="date-info" class="date-info"></div>
<h1>ğŸ•ºğŸ’ƒå˜èªã‚¿ãƒ³ã‚´</h1>
<p class="subtitle">N5-N4 â†’ N3 æº–å‚™ä¸­</p>
<div class="tts-system-selector">
<label for="tts-system">éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ : </label>
<select id="tts-system">
<option value="android" selected>Android</option>
<option value="ios">iOS</option>
</select>
</div>
</header>

<div class="controls">
<div class="left-controls">
<button class="text-import-btn" id="text-import-btn">ğŸ“ èªå½™ã‚’èª­ã¿è¾¼ã‚€</button>
</div>
<button class="japanese-to-english-btn" id="japanese-to-english-btn" disabled>ğŸ‘€ è¦‹ã‚‹â†’æ„å‘³</button>
<button class="listen-choose-btn" id="listen-choose-btn" disabled>ğŸ§ è´ãâ†’é¸ã¶</button>
<button class="start-btn" id="start-btn" disabled>ğŸ¤ è©±ã™</button>
<button class="ai-support-btn" id="ai-support-btn">ğŸ’¡ äººå·¥çŸ¥èƒ½</button>
</div>

<div class="quiz-mode-selector">
<div class="mode-options">
<label class="mode-option">
<input type="radio" name="quiz-mode" value="sequential" checked>
<span class="option-text">â¡ï¸ é †ç•ªã«</span>
</label>
<label class="mode-option">
<input type="radio" name="quiz-mode" value="random">
<span class="option-text">ğŸ”€ ãƒ©ãƒ³ãƒ€ãƒ ã«</span>
</label>
</div>
</div>

<table id="vocabulary-table">
<thead>
<tr>
<th>
<div class="tts-speed-control">
<label for="tts-speed">å˜èª/ãƒ•ãƒ¬ãƒ¼ã‚º</label>
<select id="tts-speed">
<option value="0.6">0.6x</option>
<option value="0.8" selected>0.8x</option>
<option value="1">1x</option>
</select>
</div>
</th>
<th>è‹±è¨³/æ„å‘³</th>
<th>
<label>
<input type="checkbox" id="select-all"> ã™ã¹ã¦é¸æŠ
</label>
</th>
</tr>
</thead>
<tbody id="vocabulary-body">
<tr>
<td colspan="3" class="no-data">èªå½™ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„</td>
</tr>
</tbody>
</table>

<div style="text-align: center; margin: 20px 0;">
    <button id="save-checked-btn" class="text-import-btn" style="display: none;">
        ğŸ™ é¸æŠã—ãŸé …ç›®ã‚’ä¿å­˜
    </button>
</div>

<!-- Text Import Modal -->
<div id="text-import-modal" class="modal">
<div class="modal-content">
<h2>ğŸ“ èªå½™ã‚’èª­ã¿è¾¼ã‚€</h2>

<div class="preset-buttons">
    <div class="button-set textbook-buttons">        
            <h3>ğŸ“— åŸºæœ¬ã®å˜èª</h3>   
        <div class="button-set-content" visible id="n5-buttons">
            <button class="preset-btn textbook-btn" data-preset="n5_1">å‹•è©(ä¸€)</button>
            <button class="preset-btn textbook-btn" data-preset="n5_2">å‹•è©(äºŒ)</button>
            <button class="preset-btn textbook-btn" data-preset="n5_3">å‹•è©(ä¸‰)</button>
        </div>
    </div>
    
    <div class="button-set jlpt-buttons">        
            <h3>ğŸ“˜ ã‚·ãƒ¼ãƒ³åˆ¥ã®å˜èª</h3>        
        <div class="button-set-content" visible id="n4-buttons">
            <button class="preset-btn jlpt-btn" data-preset="n4_1">N4 Set 1</button>
            <button class="preset-btn jlpt-btn" data-preset="n4_2">æœ</button>
            <button class="preset-btn jlpt-btn" data-preset="n4_3">å¯ã‚‹å‰</button>
        </div>
    </div>
    
    <div class="button-set core-buttons">        
            <h3>ğŸ“™ ãƒ†ãƒ¼ãƒåˆ¥ã®å˜èª</h3>
        <div class="button-set-content" visible id="n3-buttons">
            <button class="preset-btn core-btn" data-preset="n3_1">N3 Set 1</button>
            <button class="preset-btn core-btn" data-preset="n3_2">N3 Set 2</button>
            <button class="preset-btn core-btn" data-preset="n3_3">N3 Set 3</button>
        </div>
    </div>
    
    <div class="button-set other-buttons">        
            <h3>ğŸŒŸ å®Œç’§ãªä½“é¨“</h3>
        <div class="button-set-content" visible id="perfect-buttons">
            <button class="preset-btn other-btn" data-preset="perfect1">é‹å‹•</button>
            <button class="preset-btn other-btn" data-preset="perfect2">è³‡æ ¼ã‚’å–ã‚‹</button>
        </div>
    </div>
    
   </div>

<textarea id="text-import-content" placeholder="æ—¥æœ¬èª = è‹±èª/æ„å‘³ ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
<div class="button-group">
<button id="text-import-submit-btn" class="submit-btn">ğŸ“‚ èª­ã¿è¾¼ã‚€</button>
<button id="text-import-monthly-btn" class="memory-btn">ğŸ“… æœˆé–“å­¦ç¿’</button>
<button id="text-import-clear-btn" class="hint-btn">ğŸˆ³ æ¶ˆã™</button>
<button id="text-import-close-btn" class="close-btn">é–‰ã˜ã‚‹</button>
</div>
</div>
</div>

<!-- Monthly Learning Cycle Modal -->
<div id="monthly-modal" class="modal">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
        <h2>ğŸ“… ã’ã£ã‹ã‚“å­¦ç¿’ã‚µã‚¤ã‚¯ãƒ«</h2>
        
        <div id="monthly-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <!-- Week 1 -->
            <div class="week-section">
                <h3>ï¼‘é€±ç›® <span id="week1-count" class="item-count">0å€‹</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="1">ã„ã¡ã«ã¡ç›®</button><button class="edit-btn" data-week="1" data-day="1">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="2">ãµã¤ã‹ç›®</button><button class="edit-btn" data-week="1" data-day="2">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="3">ã¿ã£ã‹ç›®</button><button class="edit-btn" data-week="1" data-day="3">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="4">ã‚ˆã£ã‹ç›®</button><button class="edit-btn" data-week="1" data-day="4">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="5">ã„ã¤ã‹ç›®</button><button class="edit-btn" data-week="1" data-day="5">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="6">ã‚€ã„ã‹ç›®</button><button class="edit-btn" data-week="1" data-day="6">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="7">ãµãã—ã‚…ã†ã³ (3)</button><button class="edit-btn" data-week="1" data-day="7">ç·¨é›†</button></div>
                </div>
                <button class="clear-week-btn" data-week="1">ï¼‘é€±ç›®ã‚’æ¶ˆã™</button>
            </div>

            <!-- Week 2 -->
            <div class="week-section">
                <h3>ï¼’é€±ç›® <span id="week2-count" class="item-count">0å€‹</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="1">ï¼‘æ—¥ç›®</button><button class="edit-btn" data-week="2" data-day="1">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="2">ï¼’æ—¥ç›®</button><button class="edit-btn" data-week="2" data-day="2">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="3">ï¼“æ—¥ç›®</button><button class="edit-btn" data-week="2" data-day="3">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="4">ï¼”æ—¥ç›®</button><button class="edit-btn" data-week="2" data-day="4">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="5">ï¼•æ—¥ç›®</button><button class="edit-btn" data-week="2" data-day="5">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="6">ï¼–æ—¥ç›®</button><button class="edit-btn" data-week="2" data-day="6">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="7">å¾©ç¿’æ—¥</button><button class="edit-btn" data-week="2" data-day="7">ç·¨é›†</button></div>
                </div>
                <button class="clear-week-btn" data-week="2">ï¼’é€±ç›®ã‚’æ¶ˆã™</button>
            </div>

            <!-- Week 3 -->
            <div class="week-section">
                <h3>ï¼“é€±ç›® <span id="week3-count" class="item-count">0å€‹</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="1">ï¼‘æ—¥ç›®</button><button class="edit-btn" data-week="3" data-day="1">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="2">ï¼’æ—¥ç›®</button><button class="edit-btn" data-week="3" data-day="2">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="3">ï¼“æ—¥ç›®</button><button class="edit-btn" data-week="3" data-day="3">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="4">ï¼”æ—¥ç›®</button><button class="edit-btn" data-week="3" data-day="4">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="5">ï¼•æ—¥ç›®</button><button class="edit-btn" data-week="3" data-day="5">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="6">ï¼–æ—¥ç›®</button><button class="edit-btn" data-week="3" data-day="6">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="7">å¾©ç¿’æ—¥</button><button class="edit-btn" data-week="3" data-day="7">ç·¨é›†</button></div>
                </div>
                <button class="clear-week-btn" data-week="3">ï¼“é€±ç›®ã‚’æ¶ˆã™</button>
            </div>

            <!-- Week 4 -->
            <div class="week-section">
                <h3>ï¼”é€±ç›® <span id="week4-count" class="item-count">0å€‹</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="1">ï¼‘æ—¥ç›®</button><button class="edit-btn" data-week="4" data-day="1">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="2">ï¼’æ—¥ç›®</button><button class="edit-btn" data-week="4" data-day="2">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="3">ï¼“æ—¥ç›®</button><button class="edit-btn" data-week="4" data-day="3">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="4">ï¼”æ—¥ç›®</button><button class="edit-btn" data-week="4" data-day="4">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="5">ï¼•æ—¥ç›®</button><button class="edit-btn" data-week="4" data-day="5">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="6">ï¼–æ—¥ç›®</button><button class="edit-btn" data-week="4" data-day="6">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="7">å¾©ç¿’æ—¥</button><button class="edit-btn" data-week="4" data-day="7">ç·¨é›†</button></div>
                </div>
                <button class="clear-week-btn" data-week="4">ï¼”é€±ç›®ã‚’æ¶ˆã™</button>
            </div>

            <!-- Backup Section (Full Width) -->
            <div class="week-section" style="grid-column: span 2;">
                <h3>äºˆå‚™ <span id="backup-count" class="item-count">0å€‹</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="backup" data-day="1">äºˆå‚™ 1</button><button class="edit-btn" data-week="backup" data-day="1">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="backup" data-day="2">äºˆå‚™ 2</button><button class="edit-btn" data-week="backup" data-day="2">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="backup" data-day="3">äºˆå‚™ 3</button><button class="edit-btn" data-week="backup" data-day="3">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="backup" data-day="4">äºˆå‚™ 4</button><button class="edit-btn" data-week="backup" data-day="4">ç·¨é›†</button></div>
                    <div class="day-row"><button class="day-btn" data-week="backup" data-day="5">äºˆå‚™ 5</button><button class="edit-btn" data-week="backup" data-day="5">ç·¨é›†</button></div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
            <button id="monthly-clear-all-btn" class="hint-btn">ğŸˆ³ ã™ã¹ã¦æ¶ˆã™</button>
            <button id="monthly-close-btn" class="close-btn">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<!-- Edit Entry Modal -->
<div id="edit-entry-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <h2>âœï¸ ã“ã®é …ç›®ã‚’ç·¨é›†</h2>
        <p style="color: var(--mid); margin-bottom: 15px;">ï¼ˆå˜èª/ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ã€ä¿å­˜ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼‰</p>
        <textarea id="edit-entry-content" style="width: 100%; height: 400px; padding: 15px; font-size: 16px; border: 2px solid var(--mid); border-radius: 6px; box-sizing: border-box; resize: vertical; font-family: monospace; line-height: 1.6;" placeholder="æ—¥æœ¬èª = è‹±èªã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
        <div class="button-group" style="margin-top: 20px;">
    <button id="edit-save-btn" class="next-btn">ğŸ™ ä¿å­˜</button>
    <button id="edit-ai-link-btn" class="speak-btn">ğŸ’¡ AI (è‹± + ä¾‹)</button>
    <button id="edit-clear-btn" class="hint-btn"> ğŸˆ³ æ¶ˆã™ </button>
    <button id="edit-cancel-btn" class="close-btn">ğŸš« ä¸­æ­¢</button>
</div>
    </div>
</div>

<!-- AI Support Modal -->
<div id="ai-support-modal" class="modal">
<div class="modal-content">
<h2>ğŸ’¡ ã‚¨ãƒ¼ã‚¢ã‚¤æ”¯æ´</h2>
<div class="ai-support-links">
<a href="https://www.japandict.com/" class="ai-support-link" target="_blank">ğŸ” è¾æ›¸: JapanDict</a>
<a href="https://chatgpt.com/share/68e91bb2-c7f0-800f-b3ed-61aac70c3c16" class="ai-support-link" target="_blank">âœï¸ è‹±è¨³ã¨ä¾‹æ–‡ã‚’ä½œã‚‹</a>
<a href="https://chatgpt.com/share/68e285e1-b0c8-800f-90b4-9a90408dd2b4" class="ai-support-link" target="_blank">ğŸŒŸ è‹±è¨³ã¨ä¾‹æ–‡ã¨å®šç¾©ã¨ç©´åŸ‹ã‚ã‚’ä½œæˆã™ã‚‹</a>
<a href="https://chatgpt.com" class="ai-support-link" target="_blank">[æœªå®Œæˆ] ğŸ’¬ æ—¥æœ¬èªã§ä¼šè©±ã™ã‚‹</a>
<a href="https://chatgpt.com/share/68e91d2f-752c-800f-ad17-7eb2e8cfb89f" class="ai-support-link" target="_blank">ğŸ“š æ–‡æ³•ã‚’å­¦ã¶</a>
</div>
<div class="button-group">
<button id="ai-support-close-btn" class="close-btn">é–‰ã˜ã‚‹</button>
</div>
</div>
</div>

<!-- Japanese to English Quiz Modal -->
<div id="japanese-to-english-modal" class="modal">
<div class="modal-content">
<div id="japanese-progress-info" class="progress-info" style="display: none;">
<span id="japanese-progress-text"></span>
</div>
<div class="prompt">ã“ã®æ—¥æœ¬èªã¯ã©ã†ã„ã†æ„å‘³ã§ã™ã‹ï¼Ÿ</div>
<div style="font-size: 28px; font-weight: bold; color: var(--primary); margin: 20px 0; display: flex; align-items: center; justify-content: center; gap: 15px;">
<span id="japanese-word-display"></span>
<span class="speaker-icon" id="japanese-word-speaker" title="Listen" style="cursor: pointer; color: var(--secondary); font-size: 24px;">ğŸ”Š</span>
</div>
<div id="english-answer-display" class="reveal-answer" style="display: none; font-size: 23px;"></div>
<div id="check-question" style="display: none; font-size: 23px; color: var(--accent1); margin-top: 10px;"><b>æ­£è§£ã—ã¾ã—ãŸã‹ï¼Ÿ</b></div>
<div style="margin-top: 30px;">
<button id="check-answer-btn" class="submit-btn" style="width: 100%; margin-bottom: 15px; padding: 15px;">ç­”ãˆã‚’è¦‹ã‚‹</button>
<div class="button-group">
<button id="japanese-next-btn" class="next-btn">æ¬¡ã¸</button>
<button id="japanese-close-btn" class="close-btn">é–‰ã˜ã‚‹</button>
</div>
</div>
</div>
</div>

<!-- Listen and Choose Modal -->
<div id="listen-choose-modal" class="modal">
<div class="modal-content">
<h2>ğŸ§ è´ã„ã¦é¸ã¶</h2>
<div class="listen-answer-section">
<div id="listen-answer-display" class="listen-answer-display">ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯</div>
<div class="listen-speaker" id="listen-speaker" title="Play Audio">ğŸ”Š</div>
</div>
<div class="timer-feedback-section">
<div id="timer-feedback" class="timer-feedback"></div>
</div>
<div id="choices-grid" class="choices-grid"></div>
<div class="listen-controls">
<button id="listen-next-btn" class="listen-next-btn">æ¬¡ã¸</button>
<button id="listen-close-btn" class="listen-close-btn">é–‰ã˜ã‚‹</button>
</div>
</div>
</div>

<!-- Quiz Modal -->
<div id="quiz-modal" class="modal">
<div class="modal-content">
<div class="prompt">ã€Œ<span id="translation-prompt" style="color: var(--primary);"></span>ã€ã‚’æ—¥æœ¬èªã§è¨€ã£ã¦ãã ã•ã„ã€‚</div>
<input type="text" id="answer-input" class="answer-input" placeholder="ã“ã“ã«ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">
<div id="feedback" class="feedback"></div>
<div id="hint-text" class="hint"></div>
<div id="reveal-answer" class="reveal-answer" style="font-size: 23px;"></div>
<div class="button-group">
<button id="submit-btn" class="submit-btn">âœ… or â</button>
<button id="speak-btn" class="speak-btn">ğŸ¤ éŸ³å£°å…¥åŠ›</button>
<button id="hint-btn" class="hint-btn">â“ ãƒ’ãƒ³ãƒˆ</button>
<button id="answer-btn" class="answer-btn">ğŸ”‘ ç­”ãˆ</button>
<button id="next-btn" class="next-btn">æ¬¡ã¸</button>
<button id="close-btn" class="close-btn">é–‰ã˜ã‚‹</button>
</div>
</div>
</div>

<!-- Refresh Reminder Popup -->
<div id="refresh-reminder-popup" class="popup-container">
<div class="popup-content">
<div class="popup-layout">
<div class="mascot-image">
<div style="width: 150px; height: 150px; background: linear-gradient(45deg, #FF6B6B, #4ECDC4); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 60px;">ğŸŒ</div>
</div>
<div class="speech-bubble">
<p class="japanese-text">1. æ¯å›ä½¿ç”¨ã™ã‚‹å‰ã«ã€Œãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥(refresh)ğŸ”„ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ›´æ–°ã‚’å–å¾—ã—ã¦ãã ã•ã„ï¼</p>
<p class="english-text">2. iPhoneã¨iPadãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’iOSã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ğŸ”ŠãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã™ã€‚</p>
<p class="english-text">3. æºå¸¯é›»è©±ã¯æ™‚ã€…ã€Œãƒ†ã‚­ã‚¹ãƒˆèª­ã¿ä¸Šã’ã€æ©Ÿèƒ½ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã€ãã®çµæœğŸ”ŠãŒå‹•ä½œã—ãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å†èµ·å‹•ã™ã‚Œã°è§£æ±ºã—ã¾ã™ã€‚</p>
</div>
</div>
<button id="close-reminder-btn" class="close-reminder-btn">ã‚ã‹ã‚Šã¾ã—ãŸ</button>
</div>
</div>



 <footer class="footer">
        <div id="footer">ğŸŒ¸ æ–°ã—ã„ä¸–ç•Œã®ã‚«ã‚®ã€<br>æ—¥æœ¬èªã‚’å­¦ã¼ã†ï¼</div>
    </footer>

<script>
// ===== DOM ELEMENTS =====
const japaneseToEnglishBtn = document.getElementById('japanese-to-english-btn');
const japaneseToEnglishModal = document.getElementById('japanese-to-english-modal');
const japaneseWordDisplay = document.getElementById('japanese-word-display');
const japaneseWordSpeaker = document.getElementById('japanese-word-speaker');
const englishAnswerDisplay = document.getElementById('english-answer-display');
const checkQuestion = document.getElementById('check-question');
const checkAnswerBtn = document.getElementById('check-answer-btn');
const japaneseNextBtn = document.getElementById('japanese-next-btn');
const japaneseCloseBtn = document.getElementById('japanese-close-btn');
const japaneseProgressInfo = document.getElementById('japanese-progress-info');
const japaneseProgressText = document.getElementById('japanese-progress-text');
const listenChooseBtn = document.getElementById('listen-choose-btn');
const listenChooseModal = document.getElementById('listen-choose-modal');
const listenAnswerDisplay = document.getElementById('listen-answer-display');
const listenSpeaker = document.getElementById('listen-speaker');
const timerFeedback = document.getElementById('timer-feedback');
const choicesGrid = document.getElementById('choices-grid');
const listenNextBtn = document.getElementById('listen-next-btn');
const listenCloseBtn = document.getElementById('listen-close-btn');
const textImportBtn = document.getElementById('text-import-btn');
const startBtn = document.getElementById('start-btn');
const aiSupportBtn = document.getElementById('ai-support-btn');
const vocabularyTable = document.getElementById('vocabulary-table');
const vocabularyBody = document.getElementById('vocabulary-body');
const selectAllCheckbox = document.getElementById('select-all');
const quizModal = document.getElementById('quiz-modal');
const translationPrompt = document.getElementById('translation-prompt');
const answerInput = document.getElementById('answer-input');
const feedbackEl = document.getElementById('feedback');
const hintTextEl = document.getElementById('hint-text');
const revealAnswerEl = document.getElementById('reveal-answer');
const submitBtn = document.getElementById('submit-btn');
const speakBtn = document.getElementById('speak-btn');
const hintBtn = document.getElementById('hint-btn');
const answerBtn = document.getElementById('answer-btn');
const nextBtn = document.getElementById('next-btn');
const closeBtn = document.getElementById('close-btn');
const ttsSpeedSelect = document.getElementById('tts-speed');
const ttsSystemSelect = document.getElementById('tts-system');
const textImportModal = document.getElementById('text-import-modal');
const textImportContent = document.getElementById('text-import-content');
const textImportSubmitBtn = document.getElementById('text-import-submit-btn');
const textImportCloseBtn = document.getElementById('text-import-close-btn');
const textImportClearBtn = document.getElementById('text-import-clear-btn');
const textImportMemoryBtn = document.getElementById('text-import-memory-btn');
const aiSupportModal = document.getElementById('ai-support-modal');
const aiSupportCloseBtn = document.getElementById('ai-support-close-btn');
// Monthly button and modal
const startMonthlyBtn = document.getElementById('text-import-monthly-btn');
const monthlyModal = document.getElementById('monthly-modal');
const monthlyCloseBtn = document.getElementById('monthly-close-btn');
const monthlyClearAllBtn = document.getElementById('monthly-clear-all-btn');
const editEntryModal = document.getElementById('edit-entry-modal');
const editEntryContent = document.getElementById('edit-entry-content');
const editSaveBtn = document.getElementById('edit-save-btn');
const editCancelBtn = document.getElementById('edit-cancel-btn');
const editAiLinkBtn = document.getElementById('edit-ai-link-btn');
const editClearBtn = document.getElementById('edit-clear-btn');

// ===== VARIABLES =====
let isSpeaking = false;
let vocabularyData = [];
let currentQuizWords = [];
let currentWordIndex = -1;
let currentWord = null;
let recognition = null;
let speechRate = 0.8;
let quizMode = 'sequential';
let currentJapaneseQuizWords = [];
let currentJapaneseWordIndex = -1;
let currentJapaneseWord = null;
let sectionProgress = {};
let sectionOrder = [];
let currentListenQuizWords = [];
let currentListenWordIndex = -1;
let currentListenWord = null;
let questionStartTime = null;
let isAnswered = false;
let voices = [];
let voicesLoaded = false;
let currentTTSSystem = 'android';
let currentEditWeek = null;
let currentEditDay = null;
let monthlyDB = null;

// ===== INDEXEDDB FOR CHECKED ITEMS =====
let checkedItemsDB = null;

function initCheckedItemsDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open('CheckedItemsDB', 1);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
            checkedItemsDB = request.result;
            resolve(checkedItemsDB);
        };
        
        request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('checkedStates')) {
                db.createObjectStore('checkedStates', { keyPath: 'id' });
            }
        };
    });
}

function generateVocabSetID(vocabularyData) {
    // Create a unique ID based on the vocabulary content
    const contentString = vocabularyData
        .map(item => `${item.vocabulary}|${item.translation}`)
        .sort()
        .join('::');
    
    // Simple hash function
    let hash = 0;
    for (let i = 0; i < contentString.length; i++) {
        const char = contentString.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return 'vocab_' + Math.abs(hash).toString(36);
}

function saveCheckedStates() {
    if (!checkedItemsDB || vocabularyData.length === 0) return;
    
    const vocabSetID = generateVocabSetID(vocabularyData);
    const checkedStates = {};
    
    vocabularyData.forEach((item, index) => {
        if (item.selected) {
            checkedStates[index] = true;
        }
    });
    
    const transaction = checkedItemsDB.transaction(['checkedStates'], 'readwrite');
    const store = transaction.objectStore('checkedStates');
    
    store.put({
        id: vocabSetID,
        states: checkedStates,
        timestamp: Date.now()
    });
    
    transaction.oncomplete = () => {
        // Show success message
        const successMessage = document.createElement('div');
        successMessage.style.cssText = `
            position: fixed; top: 20px; right: 20px; background-color: var(--accent2);
            color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold;
            z-index: 1000; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        `;
        successMessage.textContent = `âœ… ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`;
        document.body.appendChild(successMessage);
        
        setTimeout(() => {
            if (document.body.contains(successMessage)) {
                document.body.removeChild(successMessage);
            }
        }, 2000);
    };
}

function loadCheckedStates() {
    return new Promise((resolve, reject) => {
        if (!checkedItemsDB || vocabularyData.length === 0) {
            resolve(null);
            return;
        }
        
        const vocabSetID = generateVocabSetID(vocabularyData);
        const transaction = checkedItemsDB.transaction(['checkedStates'], 'readonly');
        const store = transaction.objectStore('checkedStates');
        const request = store.get(vocabSetID);
        
        request.onsuccess = () => {
            resolve(request.result ? request.result.states : null);
        };
        request.onerror = () => reject(request.error);
    });
}

// ===== INDEXEDDB FOR MONTHLY CYCLE =====
function initMonthlyDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open('MonthlyLearningDBJP', 1);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
            monthlyDB = request.result;
            resolve(monthlyDB);
        };
        
        request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('entries')) {
                db.createObjectStore('entries', { keyPath: 'id' });
            }
        };
    });
}

function saveEntry(week, day, content) {
    return new Promise((resolve, reject) => {
        const transaction = monthlyDB.transaction(['entries'], 'readwrite');
        const store = transaction.objectStore('entries');
        const id = `week${week}_day${day}`;
        
        const request = store.put({ id: id, week: week, day: day, content: content });
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
    });
}

function loadEntry(week, day) {
    return new Promise((resolve, reject) => {
        const transaction = monthlyDB.transaction(['entries'], 'readonly');
        const store = transaction.objectStore('entries');
        const id = `week${week}_day${day}`;
        
        const request = store.get(id);
        
        request.onsuccess = () => {
            resolve(request.result ? request.result.content : '');
        };
        request.onerror = () => reject(request.error);
    });
}

function deleteEntry(week, day) {
    return new Promise((resolve, reject) => {
        const transaction = monthlyDB.transaction(['entries'], 'readwrite');
        const store = transaction.objectStore('entries');
        const id = `week${week}_day${day}`;
        
        const request = store.delete(id);
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
    });
}

function countItems(content) {
    if (!content || !content.trim()) return 0;
    const lines = content.split('\n').filter(line => {
        const trimmed = line.trim();
        return trimmed && trimmed.includes('=') && !trimmed.startsWith('â—') && !trimmed.startsWith('@');
    });
    return lines.length;
}

async function updateWeekCounters() {
    const weeks = ['1', '2', '3', '4', 'backup'];
    
    for (const week of weeks) {
        let totalCount = 0;
        const dayCount = week === 'backup' ? 5 : 7;
        
        for (let day = 1; day <= dayCount; day++) {
            const content = await loadEntry(week, day);
            totalCount += countItems(content);
        }
        
        const countEl = document.getElementById(`week${week}-count`);
        if (countEl) {
            countEl.textContent = `${totalCount}å€‹`;
        }
    }
}

async function updateDayButtons() {
    const allDayButtons = document.querySelectorAll('.day-btn');
    
    for (const btn of allDayButtons) {
        const week = btn.dataset.week;
        const day = btn.dataset.day;
        const content = await loadEntry(week, day);
        
        if (content && content.trim()) {
            btn.classList.add('has-content');
        } else {
            btn.classList.remove('has-content');
        }
    }
}

async function clearWeek(week) {
    const dayCount = week === 'backup' ? 5 : 7;
    
    for (let day = 1; day <= dayCount; day++) {
        await deleteEntry(week, day);
    }
    
    await updateWeekCounters();
    await updateDayButtons();
}

async function clearAllData() {
    const weeks = ['1', '2', '3', '4', 'backup'];
    
    for (const week of weeks) {
        await clearWeek(week);
    }
}

// ===== TTS FUNCTIONS =====
function loadVoices() {
return new Promise((resolve) => {
voices = speechSynthesis.getVoices();
if (voices.length > 0) {
voicesLoaded = true;
console.log('Voices loaded:', voices.length);
resolve(voices);
} else {
const utterance = new SpeechSynthesisUtterance('');
utterance.volume = 0;
speechSynthesis.speak(utterance);
setTimeout(() => {
voices = speechSynthesis.getVoices();
voicesLoaded = true;
console.log('Voices loaded after trigger:', voices.length);
resolve(voices);
}, 100);
}
});
}

function getJapaneseVoice() {
if (!voicesLoaded || voices.length === 0) return null;

if (currentTTSSystem === 'ios') {
const iosJapaneseVoices = ['Kyoko', 'Otoya'];
for (const voiceName of iosJapaneseVoices) {
const voice = voices.find(v => v.name.includes(voiceName));
if (voice) {
console.log('Using iOS Japanese voice:', voice.name);
return voice;
}
}
} else {
const androidJapaneseVoices = [
'Google æ—¥æœ¬èª',
'Japanese (Japan)',
'ja-JP-language',
'Japanese Japan'
];
for (const voiceName of androidJapaneseVoices) {
const voice = voices.find(v =>
v.name.includes(voiceName) ||
v.name.toLowerCase().includes(voiceName.toLowerCase())
);
if (voice) {
console.log('Using Android Japanese voice:', voice.name);
return voice;
}
}
}

const japaneseVoice = voices.find(v =>
v.lang === 'ja-JP' ||
v.lang.startsWith('ja-') ||
v.name.toLowerCase().includes('japanese') ||
v.name.toLowerCase().includes('japan')
);

if (japaneseVoice) {
console.log(`Using fallback Japanese voice for ${currentTTSSystem}:`, japaneseVoice.name);
return japaneseVoice;
}

console.log(`Using first available voice for ${currentTTSSystem}:`, voices[0]?.name);
return voices[0] || null;
}

function speak(text) {
console.log('Speak function called with:', text, 'System:', currentTTSSystem);
if (!('speechSynthesis' in window)) {
console.warn('Speech synthesis not supported');
return;
}

const cleanText = text.replace(/[()[\]\\*]/g, '').trim();
if (!cleanText) return;

speechSynthesis.cancel();

setTimeout(() => {
const utterance = new SpeechSynthesisUtterance(cleanText);
const preferredVoice = getJapaneseVoice();

if (preferredVoice) {
utterance.voice = preferredVoice;
}

utterance.lang = 'ja-JP';
utterance.pitch = 1.0;
utterance.volume = 1.0;

if (currentTTSSystem === 'ios') {
utterance.rate = Math.max(0.5, speechRate * 0.9);
} else {
utterance.rate = speechRate;
}

utterance.onstart = function() {
console.log('Speech started successfully');
};

utterance.onend = function() {
console.log('Speech ended normally');
isSpeaking = false;
};

utterance.onerror = function(event) {
console.error('Speech error:', event.error);
isSpeaking = false;
};

try {
speechSynthesis.speak(utterance);
} catch (error) {
console.error('Failed to start speech synthesis:', error);
}
}, 100);
}

async function initializeTTS() {
console.log('Initializing TTS...');
const testUtterance = new SpeechSynthesisUtterance('');
testUtterance.volume = 0;
speechSynthesis.speak(testUtterance);

await new Promise(resolve => setTimeout(resolve, 200));
await loadVoices();

if (voices.length === 0) {
console.log('No voices found, trying again...');
await new Promise(resolve => setTimeout(resolve, 500));
await loadVoices();
}

console.log('TTS initialization complete. Voices:', voices.length);

speechSynthesis.addEventListener('voiceschanged', () => {
console.log('Voices changed event fired');
loadVoices();
});
}

// ===== SPEECH RECOGNITION =====
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.lang = 'ja-JP';
recognition.continuous = false;
recognition.interimResults = false;

recognition.onresult = function(event) {
const transcript = event.results[0][0].transcript.trim();
answerInput.value = transcript;
speakBtn.textContent = 'ğŸ¤ éŸ³å£°å…¥åŠ›';
speakBtn.classList.remove('recording');
};

recognition.onend = function() {
speakBtn.textContent = 'ğŸ¤ éŸ³å£°å…¥åŠ›';
speakBtn.classList.remove('recording');
};

recognition.onerror = function(event) {
console.error('Speech recognition error', event.error);
speakBtn.textContent = 'ğŸ¤ éŸ³å£°å…¥åŠ›';
speakBtn.classList.remove('recording');
};
}

// ===== EVENT LISTENERS =====
ttsSpeedSelect.addEventListener('change', (e) => {
speechRate = parseFloat(e.target.value);
});

ttsSystemSelect.addEventListener('change', (e) => {
currentTTSSystem = e.target.value;
console.log(`Switched to ${currentTTSSystem} TTS system`);
loadVoices().then(() => {
console.log(`Voice loading complete for ${currentTTSSystem}`);
});
});

document.addEventListener('change', (e) => {
if (e.target.name === 'quiz-mode') {
quizMode = e.target.value;
console.log(`Quiz mode changed to: ${quizMode}`);
}
});

aiSupportBtn.addEventListener('click', () => {
aiSupportModal.style.display = 'flex';
});

aiSupportCloseBtn.addEventListener('click', () => {
aiSupportModal.style.display = 'none';
});

// Monthly Modal Event Listeners
startMonthlyBtn.addEventListener('click', async () => {
    await initMonthlyDB();
    await updateWeekCounters();
    await updateDayButtons();
    textImportModal.style.display = 'none';  // Close text import modal
    monthlyModal.style.display = 'flex';      // Open monthly modal
});

monthlyCloseBtn.addEventListener('click', () => {
    monthlyModal.style.display = 'none';
    textImportModal.style.display = 'flex';  // Reopen text import modal
});

monthlyClearAllBtn.addEventListener('click', async () => {
    if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        await clearAllData();
    }
});

// Edit button event listeners
document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        currentEditWeek = btn.dataset.week;
        currentEditDay = btn.dataset.day;
        
        const content = await loadEntry(currentEditWeek, currentEditDay);
        editEntryContent.value = content;
        
        monthlyModal.style.display = 'none';
        editEntryModal.style.display = 'flex';
    });
});

// Clear week button event listeners
document.querySelectorAll('.clear-week-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const week = btn.dataset.week;
        if (confirm(`Week ${week}ã®ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
            await clearWeek(week);
        }
    });
});

// AI Link button
editAiLinkBtn.addEventListener('click', () => {
    window.open('https://chatgpt.com/share/68e91bb2-c7f0-800f-b3ed-61aac70c3c16', '_blank');
});

// Save button
editSaveBtn.addEventListener('click', async () => {
    const content = editEntryContent.value;
    await saveEntry(currentEditWeek, currentEditDay, content);
    await updateWeekCounters();
    await updateDayButtons();
    
    editEntryModal.style.display = 'none';
    monthlyModal.style.display = 'flex';
});

// Cancel button
editCancelBtn.addEventListener('click', () => {
    editEntryModal.style.display = 'none';
    monthlyModal.style.display = 'flex';
});

// Clear button
editClearBtn.addEventListener('click', async () => {
    if (confirm('ã“ã®é …ç›®ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        await deleteEntry(currentEditWeek, currentEditDay);
        editEntryContent.value = '';
        await updateWeekCounters();
        await updateDayButtons();
        
        editEntryModal.style.display = 'none';
        monthlyModal.style.display = 'flex';
    }
});

// Day button click handlers (load content and return to main page)
document.querySelectorAll('.day-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const week = btn.dataset.week;
        const day = btn.dataset.day;
        const content = await loadEntry(week, day);
        
        if (content && content.trim()) {
            processTextImport(content);
            monthlyModal.style.display = 'none';
            textImportModal.style.display = 'none';
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.style.cssText = `
                position: fixed; top: 20px; right: 20px; background-color: var(--accent2);
                color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold;
                z-index: 1000; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            `;
            successMessage.textContent = `âœ… ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼`;
            document.body.appendChild(successMessage);
            
            setTimeout(() => {
                if (document.body.contains(successMessage)) {
                    document.body.removeChild(successMessage);
                }
            }, 2000);
        } else {
            alert('ã“ã®ã‚¨ãƒ³ãƒˆãƒªã¯ç©ºã§ã™ã€‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã«ã¾ãšç·¨é›†ã—ã¦ãã ã•ã„ã€‚');
        }
    });
});

textImportBtn.addEventListener('click', () => {
textImportModal.style.display = 'flex';
});

textImportCloseBtn.addEventListener('click', () => {
textImportModal.style.display = 'none';
});

// ===== PRESET VOCABULARY DATA =====
const presetVocabulary = {
n5_1: `
â—å˜èªã¨ãƒ•ãƒ¬ãƒ¼ã‚º
æœ¬ã‚’è²·ã† (hon o kau) = to buy a book
ãƒã‚¹ãŒæ¥ã‚‹ (basu ga kuru) = the bus comes
å‹é”ã«ä¼šã† (tomodachi ni au) = to meet a friend
ç§ã«ä¼šã„ã«æ¥ã‚‹ (watashi ni ai ni kuru) = to come to see me
æ°´ã‚’é£²ã‚€ (mizu o nomu) = to drink water
æœã”é£¯ã‚’é£Ÿã¹ã‚‹ (asagohan o taberu) = to eat breakfast
é£Ÿã¹ã™ãã‚‹ (tabesugiru) = to eat too much
æ—…è¡Œã«è¡Œã (ryokÅ ni iku) = to go on a trip
çŸ¥ã‚‹ (shiru) = to know / to learn
ã‚ãªãŸã®åå‰ã‚’çŸ¥ã£ã¦ã„ã‚‹ (anata no namae o shitte iru) = to know your name
éŸ“å›½æ–™ç†ãŒå¥½ã (kankoku ryÅri ga suki) = to like Korean food
ã“ã®é´ãŒä¸€ç•ªå¥½ã (kono kutsu ga ichiban suki) = I like these shoes the most
ä¸€äººã§ä½ã‚€ (hitori de sumu) = to live alone
æ±äº¬ã«ä½ã‚“ã§ã„ã‚‹ (TÅkyÅ ni sunde iru) = to live in Tokyo
æ™©ã”é£¯ã‚’ä½œã‚‹ (bangohan o tsukuru) = to make dinner
ãã®ãƒãƒ¼ãƒ ã¨è©¦åˆã‚’ã™ã‚‹ (sono chÄ«mu to shiai o suru) = to play a match with that team
æ–°èã‚’èª­ã‚€ (shinbun o yomu) = to read the newspaper
å¯Œå£«å±±ãŒè¦‹ãˆã‚‹ (Fujisan ga mieru) = to see Mt. Fuji
æ—¥æœ¬èªã‚’è©±ã™ (Nihongo o hanasu) = to speak Japanese
ãŠé‡‘ãŒæ¬²ã—ã„ (okane ga hoshii) = to want money
ãƒ†ãƒ¬ãƒ“ã‚’è¦‹ã‚‹ (terebi o miru) = to watch TV

â—ä¾‹æ–‡
æ˜¨æ—¥ã€æ–°ã—ã„æœ¬ã‚’è²·ã£ã¦é›»è»Šã§èª­ã¿ã¾ã—ãŸã€‚= Yesterday, I bought a new book and read it on the train.
æœæ—©ããƒã‚¹ãŒæ¥ãŸã®ã§ã€å­¦æ ¡ã«é–“ã«åˆã„ã¾ã—ãŸã€‚= The bus came early this morning, so I made it to school on time.
é€±æœ«ã«å‹é”ã«ä¼šã£ã¦ã€ä¸€ç·’ã«æ˜ ç”»ã‚’è¦‹ã¾ã—ãŸã€‚= I met my friend on the weekend and watched a movie together.
å½¼ã¯ç§ã«ä¼šã„ã«æ¥ã¦ã€è©±ã‚’ãŸãã•ã‚“ã—ã¾ã—ãŸã€‚= He came to see me and we talked a lot.
é‹å‹•ã®ã‚ã¨ã§å†·ãŸã„æ°´ã‚’é£²ã¿ã¾ã—ãŸã€‚= I drank cold water after exercising.
å®¶æ—ã¨ä¸€ç·’ã«æœã”é£¯ã‚’é£Ÿã¹ã¾ã—ãŸã€‚= I ate breakfast with my family.
ãŠè…¹ãŒã™ã„ã¦ã„ã¦ã€é£Ÿã¹ã™ãã¦ã—ã¾ã„ã¾ã—ãŸã€‚= I was hungry and ended up eating too much.
å¤ä¼‘ã¿ã«å‹é”ã¨æ—…è¡Œã«è¡Œãäºˆå®šã§ã™ã€‚= I plan to go on a trip with my friends during summer vacation.
ã“ã®ã“ã¨ã‚’åˆã‚ã¦çŸ¥ã‚Šã¾ã—ãŸã€‚= I just learned about this for the first time.
ã‚ãªãŸã®åå‰ã‚’çŸ¥ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚= I think I know your name.
ç§ã¯éŸ“å›½æ–™ç†ãŒå¥½ãã§ã€ã‚ˆãä½œã‚Šã¾ã™ã€‚= I like Korean food and often cook it.
ã“ã®é´ãŒä¸€ç•ªå¥½ãã§ã€æ¯æ—¥å±¥ã„ã¦ã„ã¾ã™ã€‚= I like these shoes the most and wear them every day.
å¤§å­¦ã‚’å‡ºã¦ã‹ã‚‰ã€ä¸€äººã§ä½ã‚“ã§ã„ã¾ã™ã€‚= Iâ€™ve been living alone since graduating from college.
ä»Šã€æ±äº¬ã«ä½ã‚“ã§ã„ã¦ã€ä»•äº‹ã‚’ã—ã¦ã„ã¾ã™ã€‚= I live in Tokyo now and work there.
æ™©ã”é£¯ã‚’ä½œã£ã¦ã€å®¶æ—ã¨ä¸€ç·’ã«é£Ÿã¹ã¾ã—ãŸã€‚= I made dinner and ate it with my family.
æ˜æ—¥ã€ãã®ãƒãƒ¼ãƒ ã¨è©¦åˆã‚’ã™ã‚‹äºˆå®šã§ã™ã€‚= Tomorrow, weâ€™re going to play a match with that team.
æœã®æ–°èã‚’èª­ã‚“ã§ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚= I read the morning newspaper and checked the news.
ãƒ›ãƒ†ãƒ«ã®çª“ã‹ã‚‰å¯Œå£«å±±ãŒè¦‹ãˆã¾ã—ãŸã€‚= I could see Mt. Fuji from the hotel window.
æ—¥æœ¬èªã‚’è©±ã™ã®ã¯å°‘ã—é›£ã—ã„ã§ã™ãŒã€æ¥½ã—ã„ã§ã™ã€‚= Speaking Japanese is a bit difficult, but itâ€™s fun.
ä»Šæœˆã¯ãŠé‡‘ãŒæ¬²ã—ã„ã®ã§ã€ã‚¢ãƒ«ãƒã‚¤ãƒˆã‚’ã—ã¾ã™ã€‚= I need money this month, so Iâ€™m going to work part-time.
å¤œã€å®¶æ—ã¨ä¸€ç·’ã«ãƒ†ãƒ¬ãƒ“ã‚’è¦‹ã¾ã—ãŸã€‚= I watched TV with my family at night.

`,
n5_2: `
â—å˜èªã¨ãƒ•ãƒ¬ãƒ¼ã‚º
ãƒ‰ã‚¢ã‚’é–‹ã‘ã‚‹ (doa o akeru) = to open the door
ãƒ‰ã‚¢ã‚’é–‰ã‚ã‚‹ (doa o shimeru) = to close the door
ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã† (purezento o morau) = to receive a present
å¤«ã‚’æ‰‹ä¼ã† (otto o tetsudau) = to help oneâ€™s husband
å†™çœŸã‚’æ’®ã‚‹ (shashin o toru) = to take a photo
åŒåƒšã«ä¼šã† (dÅryÅ ni au) = to meet a coworker
æ­©é“ã‚’èµ°ã‚‹ (hodÅ o hashiru) = to run on the sidewalk
è‹±èªã®æ­Œã‚’æ­Œã† (eigo no uta o utau) = to sing an English song
æ¤…å­ã«åº§ã‚‹ (isu ni suwaru) = to sit on a chair
ãƒ™ãƒƒãƒ‰ã§çœ ã‚‹ (beddo de nemuru) = to sleep in bed
æ—¥æœ¬èªã‚’å‹‰å¼·ã™ã‚‹ (nihongo o benkyÅ suru) = to study Japanese
ãƒ—ãƒ¼ãƒ«ã§æ³³ã (pÅ«ru de oyogu) = to swim in the pool
å‚˜ã‚’æŒã£ã¦è¡Œã (kasa o motte iku) = to take an umbrella
ã‚¨ã‚³ãƒãƒƒã‚°ã‚’ä½¿ã† (ekobaggu o tsukau) = to use an eco bag
çš¿ã‚’æ´—ã† (sara o arau) = to wash the dishes
æ‰‹ç´™ã‚’æ›¸ã (tegami o kaku) = to write a letter

â—ä¾‹æ–‡
æœã€éƒ¨å±‹ã®ç©ºæ°—ã‚’å…¥ã‚Œã‚‹ãŸã‚ã«ãƒ‰ã‚¢ã‚’é–‹ã‘ã¾ã—ãŸã€‚= I opened the door in the morning to let in some fresh air.
å¯’ã‹ã£ãŸã®ã§ã€ã™ãã«ãƒ‰ã‚¢ã‚’é–‰ã‚ã¾ã—ãŸã€‚= It was cold, so I quickly closed the door.
å‹é”ã‹ã‚‰èª•ç”Ÿæ—¥ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã£ã¦ã†ã‚Œã—ã‹ã£ãŸã§ã™ã€‚= I was happy to receive a birthday present from my friend.
å¤•é£Ÿã®ã‚ã¨ã§å¤«ã‚’æ‰‹ä¼ã£ã¦çš¿ã‚’ç‰‡ã¥ã‘ã¾ã—ãŸã€‚= I helped my husband clean up the dishes after dinner.
æ—…è¡Œã®ã¨ãã«ãã‚Œã„ãªæ™¯è‰²ã®å†™çœŸã‚’æ’®ã‚Šã¾ã—ãŸã€‚= I took photos of the beautiful scenery during my trip.
é§…ã®è¿‘ãã§åŒåƒšã«ä¼šã£ã¦å°‘ã—è©±ã—ã¾ã—ãŸã€‚= I met a coworker near the station and chatted a bit.
æœã€æ­©é“ã‚’èµ°ã£ã¦å­¦æ ¡ã¸è¡Œãã¾ã™ã€‚= I run on the sidewalk in the morning to go to school.
ã‚«ãƒ©ã‚ªã‚±ã§è‹±èªã®æ­Œã‚’æ¥½ã—ãæ­Œã„ã¾ã—ãŸã€‚= I happily sang an English song at karaoke.
ç–²ã‚ŒãŸã®ã§ã€æ¤…å­ã«åº§ã£ã¦å°‘ã—ä¼‘ã¿ã¾ã—ãŸã€‚= I was tired, so I sat on a chair and rested a bit.
å¤œã¯ãƒ™ãƒƒãƒ‰ã§ãã£ã™ã‚Šçœ ã‚Šã¾ã—ãŸã€‚= I slept soundly in my bed at night.
æ¯æ—¥ã€æ—¥æœ¬èªã‚’å‹‰å¼·ã—ã¦æ–°ã—ã„è¨€è‘‰ã‚’è¦šãˆã¦ã„ã¾ã™ã€‚= I study Japanese every day and learn new words.
æš‘ã„æ—¥ã«ãƒ—ãƒ¼ãƒ«ã§æ³³ã„ã§æ°—æŒã¡ã‚ˆã‹ã£ãŸã§ã™ã€‚= It felt great to swim in the pool on a hot day.
é›¨ãŒé™ã‚Šãã†ã ã£ãŸã®ã§å‚˜ã‚’æŒã£ã¦è¡Œãã¾ã—ãŸã€‚= I took an umbrella with me because it looked like rain.
è²·ã„ç‰©ã«è¡Œãã¨ãã¯ã‚¨ã‚³ãƒãƒƒã‚°ã‚’ä½¿ã„ã¾ã™ã€‚= I use an eco bag when I go shopping.
å¤•é£Ÿã®ã‚ã¨ã§å®¶æ—ã®çš¿ã‚’å…¨éƒ¨æ´—ã„ã¾ã—ãŸã€‚= I washed all the dishes for my family after dinner.
å‹é”ã«æ‰‹ç´™ã‚’æ›¸ã„ã¦ã€ãƒã‚¹ãƒˆã«å‡ºã—ã¾ã—ãŸã€‚= I wrote a letter to my friend and sent it by mail.

`,
n5_3: `
â—å˜èªã¨ãƒ•ãƒ¬ãƒ¼ã‚º
å½¼ã®åå‰ã‚’å°‹ã­ã‚‹ (kare no namae o tazuneru) = to ask his name
ç´™ã‚’åˆ‡ã‚‹ (kami o kiru) = to cut paper
å§‰ã¨è¸Šã‚‹ (ane to odoru) = to dance with oneâ€™s older sister
æœ¨ã‹ã‚‰è½ã¡ã‚‹ (ki kara ochiru) = to fall from a tree
æµ·ã®ä¸Šã‚’é£›ã¶ (umi no ue o tobu) = to fly over the sea
è´ˆã‚Šç‰©ã‚’æ¸¡ã™ (okurimono o watasu) = to give a present
ä¸­å›½èªã‚’å­¦ã¶ (chÅ«gokugo o manabu) = to learn Chinese
éŸ³æ¥½ã‚’èã (ongaku o kiku) = to listen to music
æœ¬ã‚’æœºã«ç½®ã (hon o tsukue ni oku) = to put a book on the desk
ã€Œã¯ã„ã€ã‹ã€Œã„ã„ãˆã€ã¨è¨€ã† ("hai" ka "iie" to iu) = to say â€œyesâ€ or â€œnoâ€
å¼Ÿã«å¾®ç¬‘ã‚€ (otÅto ni hohoemu) = to smile at oneâ€™s younger brother
æ–™ç†ã‚’å§‹ã‚ã‚‹ (ryÅri o hajimeru) = to start cooking
å…„ã¨è©±ã™ (ani to hanasu) = to talk with oneâ€™s older brother
ãƒ•ãƒ©ãƒ³ã‚¹èªã‚’æ•™ãˆã‚‹ (furansugo o oshieru) = to teach French
å¦¹ã‚’æŒã¤ (imÅto o motsu) = to have a younger sister

â—ä¾‹æ–‡
åˆã‚ã¦ä¼šã£ãŸã¨ãã€å½¼ã®åå‰ã‚’å°‹ã­ã¾ã—ãŸã€‚= When we first met, I asked for his name.
ã¯ã•ã¿ã§ç´™ã‚’åˆ‡ã£ã¦ã€ã‹ã‚ã„ã„å½¢ã‚’ä½œã‚Šã¾ã—ãŸã€‚= I cut the paper with scissors and made a cute shape.
ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã§å§‰ã¨ä¸€ç·’ã«æ¥½ã—ãè¸Šã‚Šã¾ã—ãŸã€‚= I danced happily with my older sister at the party.
å­ä¾›ã®ã“ã‚ã€æœ¨ã‹ã‚‰è½ã¡ã¦ã‘ãŒã‚’ã—ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚= When I was a child, I once fell from a tree and got hurt.
é³¥ãŒæµ·ã®ä¸Šã‚’é£›ã‚“ã§ã„ã¦ã€ã¨ã¦ã‚‚ãã‚Œã„ã§ã—ãŸã€‚= A bird was flying over the sea, and it was beautiful.
å‹é”ã«èª•ç”Ÿæ—¥ã®è´ˆã‚Šç‰©ã‚’æ¸¡ã—ã¾ã—ãŸã€‚= I gave my friend a birthday present.
å­¦æ ¡ã§ä¸­å›½èªã‚’å­¦ã‚“ã§ã€æ–°ã—ã„è¨€è‘‰ã‚’è¦šãˆã¾ã—ãŸã€‚= I learned Chinese at school and memorized new words.
æ¯æ™©ã€é™ã‹ãªéƒ¨å±‹ã§éŸ³æ¥½ã‚’èãã¾ã™ã€‚= I listen to music in a quiet room every evening.
æœ¬ã‚’æœºã«ç½®ã„ã¦ã€å‹‰å¼·ã‚’å§‹ã‚ã¾ã—ãŸã€‚= I put the book on the desk and started studying.
å…ˆç”Ÿã®è³ªå•ã«ã€Œã¯ã„ã€ã‹ã€Œã„ã„ãˆã€ã¨è¨€ã„ã¾ã—ãŸã€‚= I answered the teacherâ€™s question with â€œyesâ€ or â€œno.â€
å¼Ÿã«å„ªã—ãå¾®ç¬‘ã¿ã‹ã‘ã¾ã—ãŸã€‚= I smiled gently at my younger brother.
å¤•æ–¹ã‹ã‚‰æ–™ç†ã‚’å§‹ã‚ã¦ã€ã‚«ãƒ¬ãƒ¼ã‚’ä½œã‚Šã¾ã—ãŸã€‚= I started cooking in the evening and made curry.
æ˜¨æ—¥ã€å…„ã¨æ˜ ç”»ã®è©±ã‚’ã—ã¾ã—ãŸã€‚= Yesterday, I talked with my older brother about movies.
å­¦æ ¡ã§ãƒ•ãƒ©ãƒ³ã‚¹èªã‚’æ•™ãˆã¦ã„ã¾ã™ã€‚= I teach French at a school.
ç§ã¯å¦¹ã‚’æŒã£ã¦ã„ã¦ã€å½¼å¥³ã¯ã¨ã¦ã‚‚æ˜ã‚‹ã„ã§ã™ã€‚= I have a younger sister, and sheâ€™s very cheerful.

`,
n4_1: `

`,
n4_2: `
â—å˜èªã¨ãƒ•ãƒ¬ãƒ¼ã‚º
ç›®è¦šã¾ã—æ™‚è¨ˆãŒé³´ã‚‹ (mezamashi dokei ga naru) = the alarm clock rings
ãƒ™ãƒƒãƒ‰ã‹ã‚‰å‡ºã‚‹ (beddo kara deru) = to get out of bed
èµ·ãã‚‹ (okiru) = to get up; to wake up
ã‚«ãƒ¼ãƒ†ãƒ³ã‚’é–‹ã‘ã‚‹ (kÄten o akeru) = to open the curtains
ãƒˆã‚¤ãƒ¬ã«è¡Œã (toire ni iku) = to go to the bathroom
é«ªã‚’ã¨ã‹ã™ (kami o tokasu) = to comb oneâ€™s hair
æ­¯ã‚’ç£¨ã (ha o migaku) = to brush oneâ€™s teeth
é¡”ã‚’æ´—ã† (kao o arau) = to wash oneâ€™s face
åŒ–ç²§ã‚’ã™ã‚‹ (keshÅ o suru) = to put on makeup
çœ¼é¡ã‚’ã‹ã‘ã‚‹ (megane o kakeru) = to put on glasses
æœã‚’ç€ã‚‹ (fuku o kiru) = to put on clothes
å‚˜ã‚’æŒã£ã¦è¡Œã (kasa o motte iku) = to take an umbrella
æœã”é£¯ã‚’é£Ÿã¹ã‚‹ (asagohan o taberu) = to eat breakfast
æœé£Ÿã‚’æŠœã (chÅshoku o nuku) = to skip breakfast
å¼å½“ã‚’ä½œã‚‹ (bentÅ o tsukuru) = to make a bento (lunch box)
æ–°èã‚’èª­ã‚€ (shinbun o yomu) = to read the newspaper
æ•£æ­©ã‚’ã™ã‚‹ (sanpo o suru) = to take a walk
å…¬åœ’ã§çŠ¬ã®æ•£æ­©ã‚’ã™ã‚‹ (kÅen de inu no sanpo o suru) = to walk the dog in the park

â—ä¾‹æ–‡
ç›®è¦šã¾ã—æ™‚è¨ˆãŒé³´ã‚Šã¾ã—ãŸã€‚= The alarm clock rang.
ãƒ™ãƒƒãƒ‰ã‹ã‚‰å‡ºã¾ã—ãŸã€‚= I got out of bed.
æ¯æœ7æ™‚ã«èµ·ãã¾ã™ã€‚= I get up at 7 every morning.
ã‚«ãƒ¼ãƒ†ãƒ³ã‚’é–‹ã‘ã¦ã€å¤–ã‚’è¦‹ã¾ã—ãŸã€‚= I opened the curtains and looked outside.
ãƒˆã‚¤ãƒ¬ã«è¡Œãã¾ã—ãŸã€‚= I went to the bathroom.
é«ªã‚’ã¨ã‹ã—ã¾ã—ãŸã€‚= I combed my hair.
æ­¯ã‚’ç£¨ãã¾ã—ãŸã€‚= I brushed my teeth.
é¡”ã‚’æ´—ã„ã¾ã—ãŸã€‚= I washed my face.
å‡ºã‹ã‘ã‚‹å‰ã«åŒ–ç²§ã‚’ã—ã¾ã™ã€‚= I put on makeup before going out.
çœ¼é¡ã‚’ã‹ã‘ã¾ã—ãŸã€‚= I put on my glasses.
æœã‚’ç€ã¾ã—ãŸã€‚= I got dressed.
å‚˜ã‚’æŒã£ã¦è¡Œãã¾ã—ãŸã€‚= I took an umbrella.
æœã”é£¯ã‚’é£Ÿã¹ã¾ã—ãŸã€‚= I ate breakfast.
ä»Šæ—¥ã¯æœé£Ÿã‚’æŠœãã¾ã—ãŸã€‚= I skipped breakfast today.
å¼å½“ã‚’ä½œã‚Šã¾ã—ãŸã€‚= I made a bento.
æ–°èã‚’èª­ã¿ã¾ã—ãŸã€‚= I read the newspaper.
æœã€å…¬åœ’ã§æ•£æ­©ã‚’ã—ã¾ã™ã€‚= I take a walk in the park in the morning.
å…¬åœ’ã§çŠ¬ã®æ•£æ­©ã‚’ã—ã¾ã—ãŸã€‚= I walked my dog in the park.

`,
n4_3: `
â—å˜èªã¨ãƒ•ãƒ¬ãƒ¼ã‚º
é¢¨å‘‚ã«å…¥ã‚‹ (furo ni hairu) = to take a bath
ã‚·ãƒ£ãƒ¯ãƒ¼ã‚’æµ´ã³ã‚‹ (shawÄ o abiru) = to take a shower
æœã‚’ç€æ›¿ãˆã‚‹ (fuku o kigaeru) = to change clothes
å°‘ã—ã®é–“ä¼‘æ†©ã‚’å–ã‚‹ (sukoshi no aida kyÅ«kei o toru) = to take a short break
ã‚¹ãƒˆãƒ¬ã‚¹ã‚’è»½æ¸›ã™ã‚‹ (sutoresu o keigen suru) = to reduce stress
æ—¥è¨˜ã‚’ã¤ã‘ã‚‹ (nikki o tsukeru) = to keep a diary
è‡ªåˆ†ã®è€ƒãˆã‚’æ›¸ãç•™ã‚ã‚‹ (jibun no kangae o kakitomeru) = to write down oneâ€™s thoughts
ãƒ†ãƒ¬ãƒ“ç•ªçµ„ã‚’è¦‹ã‚‹ (terebi bangumi o miru) = to watch a TV program
æ˜ã‹ã‚Šã‚’æ¶ˆã™ (akari o kesu) = to turn off the light
éŸ³ã‚’ãŸã¦ã‚‹ (oto o tateru) = to make a sound / noise
å…ƒæ°—ã‚’å›å¾©ã™ã‚‹ (genki o kaifuku suru) = to recover energy / feel refreshed
ã‚½ãƒ•ã‚¡ãƒ¼ã§ãã¤ã‚ã (sofÄ de kutsurogu) = to relax on the sofa
å‹é”ã¨ãŠã—ã‚ƒã¹ã‚Šã™ã‚‹ (tomodachi to oshaberi suru) = to chat with friends
ç›®è¦šã¾ã—æ™‚è¨ˆã‚’ã‚»ãƒƒãƒˆã™ã‚‹ (mezamashi dokei o setto suru) = to set the alarm clock
æ·±å‘¼å¸ã™ã‚‹ (shinkokyÅ« suru) = to take a deep breath
ç©ã‚„ã‹ãªå¤¢ã‚’è¦‹ã‚‹ (odayaka na yume o miru) = to have a peaceful dream

â—ä¾‹æ–‡
æ¯æ™©é¢¨å‘‚ã«å…¥ã‚Šã¾ã™ã€‚= I take a bath every night.
æœã‚·ãƒ£ãƒ¯ãƒ¼ã‚’æµ´ã³ã¾ã™ã€‚= I take a shower in the morning.
æœã‚’ç€æ›¿ãˆã¾ã—ãŸã€‚= I changed my clothes.
å°‘ã—ã®é–“ä¼‘æ†©ã‚’å–ã‚Šã¾ã—ãŸã€‚= I took a short break.
é‹å‹•ã—ã¦ã‚¹ãƒˆãƒ¬ã‚¹ã‚’è»½æ¸›ã—ã¾ã™ã€‚= I reduce stress by exercising.
æ¯æ—¥å¤œã«æ—¥è¨˜ã‚’ã¤ã‘ã¾ã™ã€‚= I write in my diary every night.
è‡ªåˆ†ã®è€ƒãˆã‚’æ›¸ãç•™ã‚ã¾ã—ãŸã€‚= I wrote down my thoughts.
ãƒ†ãƒ¬ãƒ“ç•ªçµ„ã‚’è¦‹ã¦ã„ã¾ã™ã€‚= Iâ€™m watching a TV program.
å¯ã‚‹å‰ã«æ˜ã‹ã‚Šã‚’æ¶ˆã—ã¾ã™ã€‚= I turn off the light before going to bed.
é™ã‹ã«ã—ã¦ã€éŸ³ã‚’ãŸã¦ãªã„ã§ãã ã•ã„ã€‚= Be quiet and donâ€™t make noise.
ä¼‘ã‚“ã§å…ƒæ°—ã‚’å›å¾©ã—ã¾ã—ãŸã€‚= I rested and recovered my energy.
ã‚½ãƒ•ã‚¡ãƒ¼ã§ãã¤ã‚ãã¾ã—ãŸã€‚= I relaxed on the sofa.
å‹é”ã¨ãŠã—ã‚ƒã¹ã‚Šã—ã¾ã—ãŸã€‚= I chatted with my friends.
ç›®è¦šã¾ã—æ™‚è¨ˆã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚= I set the alarm clock.
ã‚†ã£ãã‚Šæ·±å‘¼å¸ã—ã¦ãã ã•ã„ã€‚= Please take a deep breath.
ç©ã‚„ã‹ãªå¤¢ã‚’è¦‹ã¾ã—ãŸã€‚= I had a peaceful dream.


`,
n3_1: `

`,
n3_2: `

`,
n3_3: `

`,
perfect1: `
â—ã‚¹ãƒ†ãƒƒãƒ—ï¼‘ï¼šæ–‡è„ˆã‹ã‚‰æ„å‘³ã‚’æ¨æ¸¬ã—ã‚ˆã†ï¼ˆğŸ‘€ ğŸ§ ğŸ¤ç”¨ï¼‰
é€±æœ«ã«å‹é”ã¨è©¦åˆã‚’è¦‹ã‚‹ã®ãŒæ¥½ã—ã¿ã§ã™ã€‚= I look forward to watching a game with my friends on the weekend.
é‡èœã‚’é£Ÿã¹ã‚‹ã“ã¨ã¯å¥åº·ã«ã„ã„ã§ã™ã€‚= Eating vegetables is good for your health.
éŸ³æ¥½ã‚’è´ãã¨ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆã«ãªã‚Šã¾ã™ã€‚= Listening to music helps relieve stress.
ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°ã¯è‡ªç„¶ã®ä¸­ã§æ¥½ã—ã‚ã¾ã™ã€‚= You can enjoy cycling in nature.
ä¼‘ã¿ã«å±±ç™»ã‚Šã‚’ã—ã¾ã—ãŸã€‚= I went mountain climbing on my day off.
æš‘ã„æ—¥ã«èµ°ã‚‹ã¨æ±—ã‚’ã‹ãã¾ã™ã€‚= When you run on a hot day, you sweat.
ç·´ç¿’ã™ã‚Œã°ã™ã‚‹ã»ã©ä¸Šæ‰‹ã«ãªã‚Šã¾ã™ã€‚= The more you practice, the better you get.
æ€ã„ã£ãã‚Šç¬‘ã†ã¨æ°—åˆ†ãŒã‚ˆããªã‚Šã¾ã™ã€‚= Laughing with all your energy makes you feel better.
å½¼ã¯ã†ã‚Œã—ãã¦å¤§å£°ã§å«ã³ã¾ã—ãŸã€‚= He was so happy that he shouted loudly.
æ„Ÿå‹•ã—ã¦å·æ³£ã—ã¾ã—ãŸã€‚= I was so moved that I cried hard.
ã“ã®ã‚¢ãƒ—ãƒªã§ã©ã‚“ãªã“ã¨ãŒã§ãã‚‹ã‹?= What can you do with this app?
å­¦æ ¡ã§å“çƒã®å¤§ä¼šãŒã‚ã‚Šã¾ã™ã€‚= Thereâ€™s a ping-pong tournament at school.
è‡ªè»¢è»Šã§æ¹–ã‚’å·¡ã‚‹æ—…ã‚’ã—ã¾ã—ãŸã€‚= I took a trip cycling around lakes.
æœã®é¢¨ãŒã¨ã¦ã‚‚æ°—æŒã¡ã„ã„ã§ã™ã€‚= The morning breeze feels so nice.
æœ€è¿‘ã€å†™çœŸã‚’æ’®ã‚‹ã“ã¨ã«ã¯ã¾ã£ã¦ã„ã¾ã™ã€‚= Lately, Iâ€™m hooked on taking photos.
è‡ªè»¢è»ŠãŒãƒ‘ãƒ³ã‚¯ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚= My bicycle got a flat tire.
ã‚¨ã‚¢ãƒ¼ãƒãƒ³ãƒ—ã§ã‚¿ã‚¤ãƒ¤ã«ç©ºæ°—ã‚’å…¥ã‚Œã¾ã—ãŸã€‚= I pumped air into the tire with an air pump.
å¤œã®é“ã§ã¯ãƒ©ã‚¤ãƒˆã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚= Turn on your light when riding at night.
è‡ªè»¢è»Šã«ã¯ãƒ¯ã‚¤ãƒ¤ãƒ¼éŒ ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚= I use a wire lock for my bike.
å½¼ã¯ã‚²ãƒ¼ãƒ ã«ç†±ä¸­ã—ã¦ã„ã¾ã™ã€‚= Heâ€™s absorbed in video games.
è‚¥æº€ã®äººã¯å¥åº·ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚= Overweight people need to be careful about their health.
å½¼ã¯æ±—ã‚’ã‹ãã‚„ã™ã„ã‚ˆã†ã§ã™ã€‚= He seems to sweat easily.
ç§ã¯æ±—ã‚’ã‹ãã«ãã„æ–¹ã§ã™ã€‚= Iâ€™m the type who doesnâ€™t sweat much.
ã“ã®è³ªå•ã¯å°‘ã—ç­”ãˆã«ãã„ã§ã™ã€‚= This question is a little hard to answer.
ã“ã®æœ¬ã¯ã¨ã¦ã‚‚èª­ã¿ã‚„ã™ã„ã§ã™ã€‚= This book is very easy to read.
ã“ã®èª¬æ˜ã¯ç†è§£ã—ã‚„ã™ã„ã§ã™ã€‚= This explanation is easy to understand.
æ¯æ—¥ã‚¸ãƒ ã«é€šã£ã¦ã„ã¾ã™ã€‚= I go to the gym every day.
å¥åº·ã®ãŸã‚ã«ç­‹ãƒˆãƒ¬ã‚’ã—ã¦ã„ã¾ã™ã€‚= I do strength training for my health.
ãƒ¨ã‚¬ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã—ã¾ã—ãŸã€‚= I joined a yoga program.
å¤ã¯æ°´æ³³ã‚’ã™ã‚‹ã®ãŒå¥½ãã§ã™ã€‚= I like swimming in summer.
ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã®ãŸã‚ã«é‹å‹•ã—ã¦ã„ã¾ã™ã€‚= I exercise to lose weight.
å½¼ã¯æ ¼é—˜æŠ€ãŒå¾—æ„ã§ã™ã€‚= Heâ€™s good at martial arts.
é‡çƒè©¦åˆã®ç”Ÿä¸­ç¶™ã‚’è¦‹ã¾ã—ãŸã€‚= I watched a live broadcast of a baseball game.

---

â—ã‚¹ãƒ†ãƒƒãƒ—ï¼’ï¼šèªå½™ã«æ³¨ç›®ã—ã‚ˆã†ï¼ˆğŸ‘€ ğŸ§ ğŸ¤ç”¨ï¼‰
è©¦åˆã‚’è¦‹ã‚‹ (shiai o miru) = to watch a game
å¥åº·ã«ã„ã„ (kenkÅ ni ii) = good for health
ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆ (sutoresu kaishÅ) = stress relief
ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚° (saikuringu) = cycling
å±±ç™»ã‚Š (yama-nobori) = mountain climbing
æ±—ã‚’ã‹ã (ase o kaku) = to sweat
~ã»ã© (~ hodo) = the more (you do something), the more...
æ€ã„ã£ãã‚Š (omoikkiri) = with all oneâ€™s might; fully
å«ã¶ (sakebu) = to shout
å·æ³£ã™ã‚‹ (gÅkyÅ« suru) = to cry hard
ã©ã‚“ãª~ãŒã§ãã‚‹ã‹? (donna ~ ga dekiru ka?) = what kind of ~ can you do?
å“çƒ (takkyÅ«) = table tennis, ping-pong
æ¹–ã‚’å·¡ã‚‹ (mizuumi o meguru) = to go around lakes
æ°—æŒã¡ã„ã„ (kimochi ii) = feels good
~ã«ã¯ã¾ã‚‹ (~ ni hamaru) = to be hooked on
ãƒ‘ãƒ³ã‚¯ (panku) = flat tire
ã‚¨ã‚¢ãƒ¼ãƒãƒ³ãƒ— (eÄ ponpu) = air pump
ãƒ©ã‚¤ãƒˆ (raito) = light
ãƒ¯ã‚¤ãƒ¤ãƒ¼éŒ  (waiyÄ jÅ) = wire lock
~ã«ç†±ä¸­ã™ã‚‹ (~ ni necchÅ« suru) = to be absorbed in
è‚¥æº€ã®äºº (himan no hito) = overweight person
æ±—ã‚’ã‹ãã‚„ã™ã„ã‚ˆã†ã  (ase o kaki yasui yÅ da) = seems to sweat easily
æ±—ã‚’ã‹ãã«ãã„æ–¹ã  (ase o kaki nikui hÅ da) = tends not to sweat much
ç­”ãˆã«ãã„ (kotae nikui) = hard to answer
èª­ã¿ã‚„ã™ã„ (yomi yasui) = easy to read
ç†è§£ã—ã‚„ã™ã„ (rikai shi yasui) = easy to understand
ã‚¸ãƒ ã«é€šã† (jimu ni kayou) = to go to the gym
ç­‹ãƒˆãƒ¬ã™ã‚‹ (kintore suru) = to do strength training
ãƒ¨ã‚¬ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã™ã‚‹ (yoga puroguramu ni sanka suru) = to join a yoga program
æ°´æ³³ (suiei) = swimming
ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ (daietto) = diet
æ ¼é—˜æŠ€ (kakutÅgi) = martial arts
é‡çƒè©¦åˆã®ç”Ÿä¸­ç¶™ (yakyÅ« shiai no namachÅ«kei) = live baseball broadcast

---

â—ã‚¹ãƒ†ãƒƒãƒ—ï¼“ï¼šæ—¥æœ¬èªã®å®šç¾©ï¼ˆğŸ‘€ ğŸ§ç”¨ï¼‰
ã‚¹ãƒãƒ¼ãƒ„ã®è©¦åˆã‚’è¦³ã‚‹ã“ã¨ = è©¦åˆã‚’è¦‹ã‚‹
ä½“ã«ã„ã„ã“ã¨ = å¥åº·ã«ã„ã„
ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ãªãã™ã“ã¨ = ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆ
è‡ªè»¢è»Šã§å‡ºã‹ã‘ã‚‹æ´»å‹• = ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°
å±±ã«ç™»ã‚‹ã“ã¨ = å±±ç™»ã‚Š
ä½“ã‹ã‚‰æ±—ãŒå‡ºã‚‹ã“ã¨ = æ±—ã‚’ã‹ã
ã€œã™ã‚Œã°ã™ã‚‹ã ã‘ã€ã€œã«ãªã‚‹ã“ã¨ = ~ã»ã©
åŠ›ã„ã£ã±ã„ã€æ€ã„ã®ã¾ã¾ã« = æ€ã„ã£ãã‚Š
å¤§ããªå£°ã§è¨€ã†ã“ã¨ = å«ã¶
å¤§å£°ã§ãŸãã•ã‚“æ³£ãã“ã¨ = å·æ³£ã™ã‚‹
ã©ã‚“ãªã“ã¨ãŒã§ãã‚‹ã®ã‹ãŸãšã­ã‚‹è¡¨ç¾ = ã©ã‚“ãª~ãŒã§ãã‚‹ã‹?
ãƒ”ãƒ³ãƒãƒ³ã®ã“ã¨ = å“çƒ
æ¹–ã®ã¾ã‚ã‚Šã‚’å›ã‚‹ã“ã¨ = æ¹–ã‚’å·¡ã‚‹
æ°—åˆ†ãŒã‚ˆãæ„Ÿã˜ã‚‹ã“ã¨ = æ°—æŒã¡ã„ã„
ä½•ã‹ã«å¼·ãèˆˆå‘³ã‚’æŒã¤ã“ã¨ = ~ã«ã¯ã¾ã‚‹
ã‚¿ã‚¤ãƒ¤ã®ç©ºæ°—ãŒæŠœã‘ã‚‹ã“ã¨ = ãƒ‘ãƒ³ã‚¯
ç©ºæ°—ã‚’å…¥ã‚Œã‚‹é“å…· = ã‚¨ã‚¢ãƒ¼ãƒãƒ³ãƒ—
æ˜ã‚‹ãã™ã‚‹ãŸã‚ã®å™¨å…· = ãƒ©ã‚¤ãƒˆ
è‡ªè»¢è»Šã‚’å®ˆã‚‹ãŸã‚ã®éµ = ãƒ¯ã‚¤ãƒ¤ãƒ¼éŒ 
ä½•ã‹ã«å¤¢ä¸­ã«ãªã‚‹ã“ã¨ = ~ã«ç†±ä¸­ã™ã‚‹
å¤ªã£ã¦ã„ã‚‹äºº = è‚¥æº€ã®äºº
æ±—ã‚’ã‹ãã‚„ã™ãã†ã«è¦‹ãˆã‚‹ã“ã¨ = æ±—ã‚’ã‹ãã‚„ã™ã„ã‚ˆã†ã 
æ±—ã‚’ã‹ãã«ãã„ã‚¿ã‚¤ãƒ—ã§ã‚ã‚‹ã“ã¨ = æ±—ã‚’ã‹ãã«ãã„æ–¹ã 
ç­”ãˆã‚‹ã®ãŒã‚€ãšã‹ã—ã„ã“ã¨ = ç­”ãˆã«ãã„
èª­ã¿ã‚„ã™ãã‚ã‹ã‚Šã‚„ã™ã„ã“ã¨ = èª­ã¿ã‚„ã™ã„
ç†è§£ã™ã‚‹ã®ãŒç°¡å˜ãªã“ã¨ = ç†è§£ã—ã‚„ã™ã„
é‹å‹•æ–½è¨­ã«è¡Œãã“ã¨ = ã‚¸ãƒ ã«é€šã†
ç­‹è‚‰ã‚’å¼·ãã™ã‚‹é‹å‹•ã‚’ã™ã‚‹ã“ã¨ = ç­‹ãƒˆãƒ¬ã™ã‚‹
ãƒ¨ã‚¬ã®æ´»å‹•ã«å‚åŠ ã™ã‚‹ã“ã¨ = ãƒ¨ã‚¬ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã™ã‚‹
æ³³ãã“ã¨ = æ°´æ³³
ã‚„ã›ã‚‹ãŸã‚ã®åŠªåŠ› = ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ
æˆ¦ã†ã‚¹ãƒãƒ¼ãƒ„ã®ç·ç§° = æ ¼é—˜æŠ€
é‡çƒã®è©¦åˆã‚’ç”Ÿã§æ”¾é€ã™ã‚‹ã“ã¨ = é‡çƒè©¦åˆã®ç”Ÿä¸­ç¶™

---

â—ã‚¹ãƒ†ãƒƒãƒ—ï¼”ï¼šç©´åŸ‹ã‚ã‚¯ã‚¤ã‚ºï¼ˆğŸ¤ç”¨ï¼‰
è©¦åˆã‚’è¦‹ã‚‹ = æ—¥æ›œæ—¥ã«å‹ã ã¡ã¨ã‚µãƒƒã‚«ãƒ¼ã®_____äºˆå®šã§ã™ã€‚
å¥åº·ã«ã„ã„ = é‡èœã‚’é£Ÿã¹ã‚‹ã“ã¨ã¯ã¨ã¦ã‚‚_____ã§ã™ã€‚
ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆ = éŸ³æ¥½ã‚’è´ãã¨_____ã«ãªã‚Šã¾ã™ã€‚
ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚° = ä¼‘æ—¥ã«å‹ã ã¡ã¨_____ã«è¡Œãã¾ã—ãŸã€‚
å±±ç™»ã‚Š = å¤ä¼‘ã¿ã«å®¶æ—ã§_____ã‚’ã—ã¾ã—ãŸã€‚
æ±—ã‚’ã‹ã = æš‘ã„æ—¥ã¯å°‘ã—æ­©ãã ã‘ã§_____ã€‚
~ã»ã© = ç·´ç¿’ã™ã‚‹_____ã€ä¸Šæ‰‹ã«ãªã‚Šã¾ã™ã€‚
æ€ã„ã£ãã‚Š = å­ã©ã‚‚ãŸã¡ã¯å…¬åœ’ã§_____éŠã³ã¾ã—ãŸã€‚
å«ã¶ = å½¼ã¯ã†ã‚Œã—ãã¦å¤§å£°ã§_____ã¾ã—ãŸã€‚
å·æ³£ã™ã‚‹ = æ˜ ç”»ã‚’è¦‹ã¦æ„Ÿå‹•ã—ã¦_____äººã‚‚ã„ã¾ã—ãŸã€‚
ã©ã‚“ãª~ãŒã§ãã‚‹ã‹? = ã“ã®ã‚¢ãƒ—ãƒªã§_____çŸ¥ã£ã¦ã„ã¾ã™ã‹?
å“çƒ = å­¦æ ¡ã®ã‚¯ãƒ©ãƒ–ã§_____ã‚’ã—ã¦ã„ã¾ã™ã€‚
æ¹–ã‚’å·¡ã‚‹ = æ—…è¡Œã§è‡ªè»¢è»Šã«ä¹—ã£ã¦_____ã‚³ãƒ¼ã‚¹ã‚’èµ°ã‚Šã¾ã—ãŸã€‚
æ°—æŒã¡ã„ã„ = æœã®ç©ºæ°—ãŒã¨ã¦ã‚‚_____ã§ã™ã€‚
~ã«ã¯ã¾ã‚‹ = æœ€è¿‘ã€å½¼ã¯å†™çœŸæ’®å½±_____ã‚ˆã†ã§ã™ã€‚
ãƒ‘ãƒ³ã‚¯ = è‡ªè»¢è»ŠãŒ_____ã—ã¦å›°ã‚Šã¾ã—ãŸã€‚
ã‚¨ã‚¢ãƒ¼ãƒãƒ³ãƒ— = ã‚¿ã‚¤ãƒ¤ã®ç©ºæ°—ã‚’å…¥ã‚Œã‚‹ãŸã‚ã«_____ã‚’ä½¿ã„ã¾ã—ãŸã€‚
ãƒ©ã‚¤ãƒˆ = å¤œã¯è‡ªè»¢è»Šã®_____ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚
ãƒ¯ã‚¤ãƒ¤ãƒ¼éŒ  = è‡ªè»¢è»Šã‚’å®ˆã‚‹ãŸã‚ã«_____ã‚’ã‹ã‘ã¾ã—ãŸã€‚
~ã«ç†±ä¸­ã™ã‚‹ = å½¼ã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ _____å­¦ç”Ÿã§ã™ã€‚
è‚¥æº€ã®äºº = é‹å‹•ä¸è¶³ã¯_____ã«å¤šã„å•é¡Œã§ã™ã€‚
æ±—ã‚’ã‹ãã‚„ã™ã„ã‚ˆã†ã  = å½¼ã¯å°‘ã—å‹•ãã ã‘ã§_____ã­ã€‚
æ±—ã‚’ã‹ãã«ãã„æ–¹ã  = ç§ã¯äººã‚ˆã‚Š_____ã¨æ€ã„ã¾ã™ã€‚
ç­”ãˆã«ãã„ = ãã®è³ªå•ã¯å°‘ã—_____ã§ã™ã€‚
èª­ã¿ã‚„ã™ã„ = ã“ã®æœ¬ã¯ã‚„ã•ã—ãã¦ã¨ã¦ã‚‚_____ã§ã™ã€‚
ç†è§£ã—ã‚„ã™ã„ = å…ˆç”Ÿã®èª¬æ˜ã¯ã¨ã¦ã‚‚_____ã§ã™ã€‚
ã‚¸ãƒ ã«é€šã† = å¥åº·ã®ãŸã‚ã«æ¯æ—¥_____ã“ã¨ã«ã—ã¾ã—ãŸã€‚
ç­‹ãƒˆãƒ¬ã™ã‚‹ = å½¼ã¯ç­‹è‚‰ã‚’å¼·ãã™ã‚‹ãŸã‚ã«_____ã¦ã„ã¾ã™ã€‚
ãƒ¨ã‚¬ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã™ã‚‹ = é€±æœ«ã«_____äºˆå®šã§ã™ã€‚
æ°´æ³³ = å¤ã«ãªã‚‹ã¨_____ã‚’æ¥½ã—ã‚€äººãŒå¢—ãˆã¾ã™ã€‚
ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ = å¥åº·çš„ãª_____ã‚’ã—ãŸã„ã§ã™ã€‚
æ ¼é—˜æŠ€ = å…„ã¯å­ã©ã‚‚ã®ã“ã‚ã‹ã‚‰_____ã‚’ç¿’ã£ã¦ã„ã¾ã™ã€‚
é‡çƒè©¦åˆã®ç”Ÿä¸­ç¶™ = ãƒ†ãƒ¬ãƒ“ã§_____ã‚’è¦‹ã¾ã—ãŸã€‚

 `,
perfect2: `
â—ã‚¹ãƒ†ãƒƒãƒ—ï¼‘ï¼šæ–‡è„ˆã‹ã‚‰æ„å‘³ã‚’æ¨æ¸¬ã—ã‚ˆã†ï¼ˆğŸ‘€ ğŸ§ ğŸ¤ç”¨ï¼‰
å°†æ¥ã®ãŸã‚ã«è³‡æ ¼ã‚’å–ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚= I decided to get a qualification for my future.
å¤§å­¦ã§ã¯å¥¨å­¦é‡‘ã‚’ã‚‚ã‚‰ã£ã¦å‹‰å¼·ã—ã¾ã—ãŸã€‚= I studied at university with a scholarship.
å½¼ã¯æ¯æ—¥ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚= He studies very hard every day.
æ¤œå®šè©¦é¨“ã«è½ã¡ã¦å°‘ã—è½ã¡è¾¼ã¿ã¾ã—ãŸã€‚= I failed the proficiency test and felt a bit down.
å½¼ã¯ä¸‡å¹´ä¸åˆæ ¼ã§æœ‰åã§ã™ã€‚= Heâ€™s known for always failing the exam.
ã“ã®ä»•äº‹ã«ã¯ç‰¹åˆ¥ãªè³‡æ ¼ãŒå¿…è¦ã§ã™ã€‚= This job requires a special qualification.
å½¼å¥³ã¯è‹±èªã®è³‡æ ¼ã‚’æŒã£ã¦ã„ã¾ã™ã€‚= She has an English qualification.
ãã‚Œã§ã€æ¬¡ã¯ã©ã†ã—ãŸã„ã§ã™ã‹?= So, what do you want to do next?
è³‡æ ¼ã‚’å–ã‚‹ã¨è³ƒä¸Šã’ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚= Getting a qualification can sometimes lead to a pay raise.
æ¥é€±ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ç”³ã—è¾¼ã¿ã¾ã—ãŸã€‚= I applied for next weekâ€™s event.
ãƒãƒƒãƒˆã§ç”³ã—è¾¼ã‚ã‚‹ã®ã¯ä¾¿åˆ©ã§ã™ã­ã€‚= Itâ€™s convenient that you can apply online.
å½¼ã¯è©¦é¨“ã«å—ã‹ã£ãŸã‚‰ã—ã„ã§ã™ã€‚= It seems he passed the exam.
ä»Šæ—¥ã¯ç–²ã‚Œã¦å‹‰å¼·ã§ããªã„ã€‚= Iâ€™m too tired to study today.
å½¼å¥³ã¯æ¯æ—¥å¡¾ã«é€šã£ã¦ã„ã¾ã™ã€‚= She goes to cram school every day.
æ™‚é–“ãŒãªãã¦ã‚‚ä½•ã¨ã‹ãªã‚‹ã¨æ€ã†ã€‚= Even without much time, I think itâ€™ll work out somehow.
æˆæ¥­ä¸­ç¶ºéº—ãªãƒãƒ¼ãƒˆã‚’å–ã‚‹ã®ãŒå¥½ãã§ã™ã€‚= I like taking neat notes during class.
å…ˆç”Ÿã®è©±ã‚’èããªãŒã‚‰ãƒ¡ãƒ¢ã‚’å–ã‚Šã¾ã—ãŸã€‚= I took notes while listening to the teacher.
å‹ã ã¡ã«å‚è€ƒæ›¸ã‚’è²¸ã—ã¾ã—ãŸã€‚= I lent a reference book to my friend.
è©¦é¨“å‰ã«éå»å•ã‚’è§£ãã¾ã—ãŸã€‚= I solved past exam questions before the test.
å½¼ã¯ã²ãŸã™ã‚‰å•é¡Œã‚’è§£ã„ã¦ã„ã¾ã™ã€‚= Heâ€™s solving problems tirelessly.
ä»Šã‹ã‚‰è¡Œãã®ã¯ç„¡ç†ã§ã™ã€‚= Itâ€™s impossible to go now.
å½¼å¥³ã¯å¸¸ã«ä¸Šã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚= Sheâ€™s always aiming higher.
ã‚ã¨å°‘ã—ã§åˆæ ¼ã§ãã¾ã™ã€‚= I can pass if I just push a little more.
ã“ã‚Œã¾ã§ãšã£ã¨é ‘å¼µã£ã¦ããŸã­ã€‚= Youâ€™ve really worked hard until now.

---

â—ã‚¹ãƒ†ãƒƒãƒ—ï¼’ï¼šèªå½™ã«æ³¨ç›®ã—ã‚ˆã†ï¼ˆğŸ‘€ ğŸ§ ğŸ¤ç”¨ï¼‰
è³‡æ ¼ã‚’å–ã‚‹ (shikaku o toru) = to get a qualification
å¥¨å­¦é‡‘ (shÅgakukin) = scholarship
ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã™ã‚‹ (isshÅkenmei benkyÅ suru) = to study hard
æ¤œå®šè©¦é¨“ã«è½ã¡ã‚‹ (kentei shiken ni ochiru) = to fail a certification exam
ä¸‡å¹´ä¸åˆæ ¼ (mannen fugÅkaku) = perpetual failure
ä»•äº‹ã«å¿…è¦ãªè³‡æ ¼ (shigoto ni hitsuyÅ na shikaku) = qualification needed for a job
è³‡æ ¼ã‚’æŒã£ã¦ã„ã‚‹ (shikaku o motte iru) = to have a qualification
ãã‚Œã§ã€ (sorede) = so; and then
è³ƒä¸Šã’ã«ãªã‚‹ (chinâ€™age ni naru) = to result in a pay raise
ç”³ã—è¾¼ã‚€ (mÅshikomu) = to apply
ãƒãƒƒãƒˆã§ç”³ã—è¾¼ã‚ã‚‹ (netto de mÅshikomeru) = to apply online
~ã‚‰ã—ã„ (~ rashii) = it seems; apparently
å‹‰å¼·ã§ããªã„ (benkyÅ dekinai) = canâ€™t study
å¡¾ã«é€šã† (juku ni kayou) = to go to cram school
~ä½•ã¨ã‹ãªã‚‹ (~ nantoka naru) = itâ€™ll work out somehow
æˆæ¥­ä¸­ç¶ºéº—ãªãƒãƒ¼ãƒˆã‚’å–ã‚‹ (jugyÅ-chÅ« kirei na nÅto o toru) = to take neat notes during class
ãƒ¡ãƒ¢ã‚’å–ã‚‹ (memo o toru) = to take notes
è²¸ã™ (kasu) = to lend
éå»å•ã‚’è§£ã (kakomon o toku) = to solve past exam questions
ã²ãŸã™ã‚‰ (hitasura) = earnestly; single-mindedly
ç„¡ç† (muri) = impossible
ä¸Šã‚’ç›®æŒ‡ã™ (ue o mezasu) = to aim higher
ã‚ã¨å°‘ã— (ato sukoshi) = a little more
é ‘å¼µã£ã¦ããŸ (ganbatte kita) = have worked hard

---

â—ã‚¹ãƒ†ãƒƒãƒ—ï¼“ï¼šæ—¥æœ¬èªã®å®šç¾©ï¼ˆğŸ‘€ ğŸ§ç”¨ï¼‰
ç‰¹åˆ¥ãªåŠ›ã‚’èªã‚ã‚‰ã‚Œã‚‹ãŸã‚ã®è¨¼ã‚’ã‚‚ã‚‰ã†ã“ã¨ = è³‡æ ¼ã‚’å–ã‚‹
å­¦æ ¡ã§ä½¿ãˆã‚‹ãŠé‡‘ã‚’ã‚‚ã‚‰ã†ã“ã¨ = å¥¨å­¦é‡‘
ã¨ã¦ã‚‚ç†±å¿ƒã«å‹‰å¼·ã™ã‚‹ã“ã¨ = ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã™ã‚‹
ãƒ†ã‚¹ãƒˆã§åˆæ ¼ã—ãªã„ã“ã¨ = æ¤œå®šè©¦é¨“ã«è½ã¡ã‚‹
ã„ã¤ã‚‚è©¦é¨“ã«åˆæ ¼ã§ããªã„äºº = ä¸‡å¹´ä¸åˆæ ¼
ä»•äº‹ã‚’ã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¨¼æ˜ = ä»•äº‹ã«å¿…è¦ãªè³‡æ ¼
è³‡æ ¼ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ = è³‡æ ¼ã‚’æŒã£ã¦ã„ã‚‹
è©±ã‚’ã¤ãªã’ã‚‹ã¨ãã«ä½¿ã†è¨€è‘‰ = ãã‚Œã§ã€
çµ¦æ–™ãŒä¸ŠãŒã‚‹ã“ã¨ = è³ƒä¸Šã’ã«ãªã‚‹
ã‚¤ãƒ™ãƒ³ãƒˆã‚„è©¦é¨“ã«ç”³ã—è¾¼ã‚€ã“ã¨ = ç”³ã—è¾¼ã‚€
ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ç”³ã—è¾¼ã¿ã§ãã‚‹ã“ã¨ = ãƒãƒƒãƒˆã§ç”³ã—è¾¼ã‚ã‚‹
èã„ãŸè©±ã§ã¯ãã†ã ã¨æ€ã†ã¨ãã«ä½¿ã† = ~ã‚‰ã—ã„
ä½•ã‹ã®ç†ç”±ã§å‹‰å¼·ãŒã§ããªã„ã“ã¨ = å‹‰å¼·ã§ããªã„
å…ˆç”Ÿã«æ•™ãˆã¦ã‚‚ã‚‰ã†ãŸã‚ã«å¡¾ã«è¡Œãã“ã¨ = å¡¾ã«é€šã†
å¿ƒé…ã§ã‚‚ãªã‚“ã¨ã‹ã§ãã‚‹ã¨æ€ã†æ°—æŒã¡ = ~ä½•ã¨ã‹ãªã‚‹
æˆæ¥­ã§ãã‚Œã„ã«ãƒãƒ¼ãƒˆã‚’æ›¸ãã“ã¨ = æˆæ¥­ä¸­ç¶ºéº—ãªãƒãƒ¼ãƒˆã‚’å–ã‚‹
å¤§äº‹ãªã“ã¨ã‚’çŸ­ãæ›¸ãã“ã¨ = ãƒ¡ãƒ¢ã‚’å–ã‚‹
è‡ªåˆ†ã®ç‰©ã‚’äººã«ä½¿ã‚ã›ã‚‹ã“ã¨ = è²¸ã™
æ˜”ã®è©¦é¨“å•é¡Œã‚’è§£ãã“ã¨ = éå»å•ã‚’è§£ã
ä¸€ã¤ã®ã“ã¨ã‚’ãšã£ã¨ç¶šã‘ã‚‹ã‚ˆã†ã™ = ã²ãŸã™ã‚‰
ã§ããªã„ã“ã¨ã€ç„¡ç†ãªã“ã¨ = ç„¡ç†
ã‚‚ã£ã¨ä¸Šã®ãƒ¬ãƒ™ãƒ«ã‚’ç›®æŒ‡ã™ã“ã¨ = ä¸Šã‚’ç›®æŒ‡ã™
ã‚ã¨å°‘ã—ã§çµ‚ã‚ã‚‹ã€ã§ãã‚‹ã“ã¨ = ã‚ã¨å°‘ã—
ä»Šã¾ã§ãšã£ã¨åŠªåŠ›ã—ã¦ããŸã“ã¨ = é ‘å¼µã£ã¦ããŸ

---

â—ã‚¹ãƒ†ãƒƒãƒ—ï¼”ï¼šç©´åŸ‹ã‚ã‚¯ã‚¤ã‚ºï¼ˆğŸ¤ç”¨ï¼‰
è³‡æ ¼ã‚’å–ã‚‹ = å½¼ã¯å°†æ¥ã®ãŸã‚ã«_____ã“ã¨ã«ã—ã¾ã—ãŸã€‚
å¥¨å­¦é‡‘ = å¤§å­¦ã§_____ã‚’ã‚‚ã‚‰ã£ã¦å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚
ä¸€ç”Ÿæ‡¸å‘½å‹‰å¼·ã™ã‚‹ = æ¯æ—¥_____å­¦ç”Ÿã§ã™ã€‚
æ¤œå®šè©¦é¨“ã«è½ã¡ã‚‹ = ä»Šå¹´ã‚‚ã¾ãŸ_____ã—ã¾ã„ã¾ã—ãŸã€‚
ä¸‡å¹´ä¸åˆæ ¼ = å½¼ã¯_____ã®è¨˜éŒ²ã‚’æ›´æ–°ä¸­ã§ã™ã€‚
ä»•äº‹ã«å¿…è¦ãªè³‡æ ¼ = ã“ã®ä¼šç¤¾ã§ã¯_____ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚
è³‡æ ¼ã‚’æŒã£ã¦ã„ã‚‹ = å½¼å¥³ã¯è‹±èªã®_____ãã†ã§ã™ã€‚
ãã‚Œã§ã€ = ä»Šæ—¥ã¯å¿™ã—ã‹ã£ãŸã§ã™ã­ã€‚____ã€ã©ã†ã—ã¾ã™ã‹?
è³ƒä¸Šã’ã«ãªã‚‹ = ã“ã®è³‡æ ¼ã‚’å–ã‚‹ã¨_____ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚
ç”³ã—è¾¼ã‚€ = æ˜æ—¥ã®ã‚»ãƒŸãƒŠãƒ¼ã«_____äºˆå®šã§ã™ã€‚
ãƒãƒƒãƒˆã§ç”³ã—è¾¼ã‚ã‚‹ = ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯_____ã‹ã‚‰ä¾¿åˆ©ã§ã™ã€‚
~ã‚‰ã—ã„ = å½¼ã¯æ¥å¹´æµ·å¤–ã«è¡Œãã‚‰ã—ã„ã§ã™ã€‚
å‹‰å¼·ã§ããªã„ = ç–²ã‚Œã¦ã„ã¦ä»Šæ—¥ã¯_____ã€‚
å¡¾ã«é€šã† = å­ã©ã‚‚ã¯æ¯æ—¥_____ã¦ã„ã¾ã™ã€‚
~ä½•ã¨ã‹ãªã‚‹ = é›£ã—ã„ã‘ã©ã€åŠªåŠ›ã™ã‚Œã°_____ã¨æ€ã†ã€‚
æˆæ¥­ä¸­ç¶ºéº—ãªãƒãƒ¼ãƒˆã‚’å–ã‚‹ = å½¼å¥³ã¯ã„ã¤ã‚‚_____ã‚¿ã‚¤ãƒ—ã§ã™ã€‚
ãƒ¡ãƒ¢ã‚’å–ã‚‹ = è©±ã‚’èããªãŒã‚‰å¤§äº‹ãªã¨ã“ã‚ã‚’_____ã¾ã—ãŸã€‚
è²¸ã™ = æ˜æ—¥ã¾ã§ãƒãƒ¼ãƒˆã‚’_____ã‚ˆã€‚
éå»å•ã‚’è§£ã = è©¦é¨“å‰ã«_____ã®ãŒå¤§äº‹ã§ã™ã€‚
ã²ãŸã™ã‚‰ = å½¼ã¯_____å‹‰å¼·ã‚’ç¶šã‘ã¦ã„ã¾ã™ã€‚
ç„¡ç† = ä»Šã‹ã‚‰ã‚„ã‚‹ã®ã¯_____ã ã¨æ€ã†ã€‚
ä¸Šã‚’ç›®æŒ‡ã™ = å½¼ã¯å¸¸ã«_____å§¿å‹¢ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
ã‚ã¨å°‘ã— = åˆæ ¼ã¾ã§_____ã§ã™ã€‚
é ‘å¼µã£ã¦ããŸ = ã‚ãªãŸã¯ä»Šã¾ã§æœ¬å½“ã«_____ã­ã€‚

 `
}; //End of Preset Vocabulary Data

function isContentEmpty(content) {
const cleaned = content.replace(/\s+/g, '').replace(/[â—=]/g, '');
return cleaned.length === 0;
}

function showNoContentMessage() {
const messageOverlay = document.createElement('div');
messageOverlay.style.cssText = `
position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background-color: rgba(0, 0, 0, 0.8); display: flex;
justify-content: center; align-items: center; z-index: 1000;
`;

const messageBox = document.createElement('div');
messageBox.style.cssText = `
background-color: white; padding: 30px; border-radius: 15px;
text-align: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
max-width: 400px; margin: 0 20px;
`;

messageBox.innerHTML = `
<h3 style="color: var(--primary); margin-bottom: 15px;">âš ï¸ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚Šã¾ã›ã‚“</h3>
<p style="font-size: 18px; margin-bottom: 10px;">æ›´æ–°ã‚’ãŠå¾…ã¡ãã ã•ã„</p>
<p style="font-size: 16px; color: var(--mid); margin-bottom: 20px;">Please wait for updates</p>
<button id="close-no-content-msg" style="
background-color: var(--accent1); color: white; padding: 10px 20px;
border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">OK</button>
`;

messageOverlay.appendChild(messageBox);
document.body.appendChild(messageOverlay);

document.getElementById('close-no-content-msg').addEventListener('click', () => {
document.body.removeChild(messageOverlay);
});

messageOverlay.addEventListener('click', (e) => {
if (e.target === messageOverlay) {
document.body.removeChild(messageOverlay);
}
});
}

document.querySelectorAll('.preset-btn').forEach(button => {
button.addEventListener('click', () => {
const presetKey = button.dataset.preset;
if (presetVocabulary[presetKey]) {
const content = presetVocabulary[presetKey];
if (isContentEmpty(content)) {
showNoContentMessage();
return;
}
processTextImport(content);
textImportModal.style.display = 'none';

const successMessage = document.createElement('div');
successMessage.style.cssText = `
position: fixed; top: 20px; right: 20px; background-color: var(--accent2);
color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold;
z-index: 1000; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
`;
successMessage.textContent = `âœ… ${button.textContent} èª­ã¿è¾¼ã¿å®Œäº†ï¼`;
document.body.appendChild(successMessage);

setTimeout(() => {
if (document.body.contains(successMessage)) {
document.body.removeChild(successMessage);
}
}, 3000);
}
});
});

textImportSubmitBtn.addEventListener('click', () => {
const text = textImportContent.value.trim();
if (!text) {
alert('ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã¶ã‹ã€ã€Œæ—¥æœ¬èª = Englishã€ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
return;
}
processTextImport(text);
textImportModal.style.display = 'none';
});

textImportClearBtn.addEventListener('click', () => {
textImportContent.value = '';
});

// ===== TEXT IMPORT AND TABLE RENDERING =====
async function processTextImport(text) {
vocabularyData = [];
sectionOrder = [];
const lines = text.split('\n');
let currentSection = "Default";

for (let i = 0; i < lines.length; i++) {
const line = lines[i].trim();
if (!line) continue;

if (line.includes('â—') || line.includes('@') || line.startsWith('â€»')) {
currentSection = line.replace('â—', '').replace('@', '').replace('â€»', '').trim();
if (!sectionOrder.includes(currentSection)) {
sectionOrder.push(currentSection);
}
continue;
}

const parts = line.split('=');
if (parts.length < 2) continue;

const vocabulary = parts[0].trim();
const translation = parts[1].trim();

if (vocabulary && translation) {
vocabularyData.push({
vocabulary: vocabulary,
translation: translation,
selected: false,
section: currentSection
});
}
}

// Load saved checked states
const savedStates = await loadCheckedStates();
if (savedStates) {
vocabularyData.forEach((item, index) => {
if (savedStates[index]) {
item.selected = true;
}
});
}

renderVocabularyTable();

if (vocabularyData.length > 0) {
startBtn.disabled = false;
japaneseToEnglishBtn.disabled = false;
listenChooseBtn.disabled = false;
document.getElementById('save-checked-btn').style.display = 'inline-block';
}
}

function toggleSection(sectionName) {
const sectionRows = document.querySelectorAll(`.section-row[data-section="${sectionName}"]`);
const collapseBtn = document.querySelector(`[data-section-toggle="${sectionName}"]`);

if (!collapseBtn) return;

const isCollapsed = collapseBtn.textContent === 'ğŸ”½';

if (isCollapsed) {
sectionRows.forEach(row => row.style.display = 'table-row');
collapseBtn.textContent = 'ğŸ”¼';
collapseBtn.title = 'Collapse (åèµ·)';
} else {
sectionRows.forEach(row => row.style.display = 'none');
collapseBtn.textContent = 'ğŸ”½';
collapseBtn.title = 'Expand (å±•é–‹)';
}
}

function renderVocabularyTable() {
if (vocabularyData.length === 0) {
vocabularyBody.innerHTML = '<tr><td colspan="3" class="no-data">èªå½™ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„</td></tr>';
return;
}

vocabularyBody.innerHTML = '';

const sectionMap = {};
vocabularyData.forEach(item => {
if (!sectionMap[item.section]) {
sectionMap[item.section] = [];
}
sectionMap[item.section].push(item);
});

Object.keys(sectionMap).forEach(sectionName => {
const sectionItems = sectionMap[sectionName];

const sectionRow = document.createElement('tr');
sectionRow.className = 'section-header';

const sectionCell = document.createElement('td');
sectionCell.colSpan = 2;

const sectionTitle = document.createElement('div');
sectionTitle.className = 'section-title';

const collapseBtn = document.createElement('button');
collapseBtn.className = 'collapse-btn';
collapseBtn.textContent = 'ğŸ”¼';
collapseBtn.title = 'Collapse (åèµ·)';
collapseBtn.setAttribute('data-section-toggle', sectionName);
collapseBtn.addEventListener('click', () => toggleSection(sectionName));

const titleText = document.createElement('span');
titleText.textContent = sectionName;

sectionTitle.appendChild(collapseBtn);
sectionTitle.appendChild(titleText);
sectionCell.appendChild(sectionTitle);

const sectionCheckCell = document.createElement('td');
const sectionCheckbox = document.createElement('input');
sectionCheckbox.type = 'checkbox';
sectionCheckbox.checked = sectionItems.every(item => item.selected);
sectionCheckbox.dataset.section = sectionName;

sectionCheckbox.addEventListener('change', (e) => {
const isChecked = e.target.checked;
const section = e.target.dataset.section;

vocabularyData.forEach((item, index) => {
if (item.section === section) {
item.selected = isChecked;
const checkbox = document.querySelector(`input[data-index="${index}"]`);
if (checkbox) checkbox.checked = isChecked;
}
});

updateSelectAllCheckbox();
});

sectionCheckCell.appendChild(sectionCheckbox);
sectionRow.appendChild(sectionCell);
sectionRow.appendChild(sectionCheckCell);
vocabularyBody.appendChild(sectionRow);

sectionItems.forEach((item, localIndex) => {
const index = vocabularyData.findIndex(vItem =>
vItem.vocabulary === item.vocabulary &&
vItem.translation === item.translation);

const row = document.createElement('tr');
row.className = 'section-row';
row.setAttribute('data-section', sectionName);

const wordCell = document.createElement('td');
const cleanWord = item.vocabulary.replace(/\(.*\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
wordCell.innerHTML = `
${item.vocabulary}
<span class="speaker-icon" title="Listen" data-word="${cleanWord}">ğŸ”Š</span>
`;

const translationCell = document.createElement('td');
translationCell.textContent = item.translation;

const checkboxCell = document.createElement('td');
const checkbox = document.createElement('input');
checkbox.type = 'checkbox';
checkbox.checked = item.selected;
checkbox.dataset.index = index;
checkbox.dataset.section = item.section;

checkbox.addEventListener('change', (e) => {
vocabularyData[index].selected = e.target.checked;
updateSectionCheckbox(item.section);
updateSelectAllCheckbox();
});

checkboxCell.appendChild(checkbox);
row.appendChild(wordCell);
row.appendChild(translationCell);
row.appendChild(checkboxCell);
vocabularyBody.appendChild(row);
});
});

document.querySelectorAll('.speaker-icon').forEach(icon => {
icon.addEventListener('click', (e) => {
const word = e.target.dataset.word;
speak(word);
});
});

updateSelectAllCheckbox();
}

function updateSectionCheckbox(sectionName) {
const sectionItems = vocabularyData.filter(item => item.section === sectionName);
const allSelected = sectionItems.every(item => item.selected);
const noneSelected = sectionItems.every(item => !item.selected);

const sectionCheckbox = document.querySelector(`input[data-section="${sectionName}"]`);
if (sectionCheckbox) {
sectionCheckbox.checked = allSelected;
sectionCheckbox.indeterminate = !allSelected && !noneSelected;
}
}

function updateSelectAllCheckbox() {
if (vocabularyData.length === 0) {
selectAllCheckbox.checked = false;
selectAllCheckbox.indeterminate = false;
return;
}

const selectedCount = vocabularyData.filter(item => item.selected).length;

if (selectedCount === 0) {
selectAllCheckbox.checked = false;
selectAllCheckbox.indeterminate = false;
} else if (selectedCount === vocabularyData.length) {
selectAllCheckbox.checked = true;
selectAllCheckbox.indeterminate = false;
} else {
selectAllCheckbox.checked = false;
selectAllCheckbox.indeterminate = true;
}
}

selectAllCheckbox.addEventListener('change', (e) => {
const isChecked = e.target.checked;

vocabularyData.forEach(item => {
item.selected = isChecked;
});

document.querySelectorAll('#vocabulary-body input[type="checkbox"]').forEach(checkbox => {
checkbox.checked = isChecked;
if (checkbox.dataset.section) {
checkbox.indeterminate = false;
}
});
});

// ===== PROGRESS TRACKING =====
function initializeSectionProgress() {
sectionProgress = {};
const sectionMap = {};

vocabularyData.forEach(item => {
if (!sectionMap[item.section]) {
sectionMap[item.section] = [];
}
sectionMap[item.section].push(item);
});

Object.keys(sectionMap).forEach(sectionName => {
const sectionItems = sectionMap[sectionName].filter(item => item.selected);
if (sectionItems.length > 0) {
sectionProgress[sectionName] = {
currentIndex: -1,
totalCount: sectionItems.length,
items: sectionItems
};
}
});
}

function getCurrentProgressInfo() {
if (quizMode !== 'sequential' || !currentJapaneseWord) {
return null;
}

const currentSection = currentJapaneseWord.section;

if (!sectionProgress[currentSection]) {
return null;
}

const progress = sectionProgress[currentSection];
const currentPosition = progress.currentIndex + 1;
const totalInSection = progress.totalCount;

return {
current: currentPosition,
total: totalInSection,
section: currentSection
};
}

function updateProgressDisplay() {
if (quizMode !== 'sequential') {
japaneseProgressInfo.style.display = 'none';
return;
}

const progressInfo = getCurrentProgressInfo();

if (!progressInfo) {
japaneseProgressInfo.style.display = 'none';
return;
}

japaneseProgressText.textContent = `${progressInfo.current} / ${progressInfo.total} (${progressInfo.section})`;
japaneseProgressInfo.style.display = 'block';
}

// ===== LISTEN AND CHOOSE QUIZ =====
function startListenAndChooseQuiz() {
currentListenQuizWords = vocabularyData.filter(item => item.selected);

if (currentListenQuizWords.length === 0) {
alert('æœ€ä½1ã¤ã®å˜èª/ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’é¸ã‚“ã§ãã ã•ã„ã€‚');
return;
}

if (currentListenQuizWords.length < 8) {
alert('ã“ã®ã‚¯ã‚¤ã‚ºã«ã¯æœ€ä½8ã¤ã®å˜èª/ãƒ•ãƒ¬ãƒ¼ã‚ºãŒå¿…è¦ã§ã™ã€‚');
return;
}

resetListenAndChooseQuiz();
listenChooseModal.style.display = 'flex';
nextListenQuestion();
}

function resetListenAndChooseQuiz() {
currentListenWordIndex = -1;
currentListenWord = null;
questionStartTime = null;
isAnswered = false;
listenAnswerDisplay.textContent = 'ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯';
timerFeedback.textContent = '';
}

function nextListenQuestion() {
isAnswered = false;
questionStartTime = null;
listenAnswerDisplay.textContent = 'ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯';
timerFeedback.textContent = '';

if (quizMode === 'sequential') {
currentListenWordIndex = (currentListenWordIndex + 1) % currentListenQuizWords.length;
} else {
const previousIndex = currentListenWordIndex;
if (currentListenQuizWords.length === 1) {
currentListenWordIndex = 0;
} else {
do {
currentListenWordIndex = Math.floor(Math.random() * currentListenQuizWords.length);
} while (currentListenWordIndex === previousIndex && currentListenQuizWords.length > 1);
}
}

currentListenWord = currentListenQuizWords[currentListenWordIndex];
generateChoices();
}

function generateChoices() {
if (!currentListenWord) return;

const otherTranslations = currentListenQuizWords
.filter(item => item.translation !== currentListenWord.translation)
.map(item => item.translation);

const shuffled = otherTranslations.sort(() => 0.5 - Math.random());
const selectedChoices = shuffled.slice(0, 7);
const allChoices = [...selectedChoices, currentListenWord.translation];
const finalChoices = allChoices.sort(() => 0.5 - Math.random());

choicesGrid.innerHTML = '';

finalChoices.forEach(choice => {
const button = document.createElement('button');
button.className = 'choice-button';
button.textContent = choice;
button.addEventListener('click', () => handleChoiceClick(button, choice));
choicesGrid.appendChild(button);
});
}

function handleChoiceClick(button, selectedChoice) {
if (isAnswered) return;

isAnswered = true;
const responseTime = questionStartTime ? (Date.now() - questionStartTime) / 1000 : 0;

document.querySelectorAll('.choice-button').forEach(btn => {
btn.disabled = true;
});

const isCorrect = selectedChoice === currentListenWord.translation;

if (isCorrect) {
button.classList.add('correct');
listenAnswerDisplay.textContent = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();

let feedbackMessage = '';
if (responseTime < 2) {
feedbackMessage = 'å®Œç’§ï¼ âš¡';
speak('å®Œç’§');
} else if (responseTime < 3.5) {
feedbackMessage = 'ã„ã„ã­ï¼ ğŸ‘';
speak('ã„ã„ã­!');
} else if (responseTime < 6) {
feedbackMessage = 'æ—©ãï¼ â°';
speak('æ—©ã!');
} else {
feedbackMessage = 'é…ã„ã‚ˆï¼ ğŸ˜´';
speak('é…ã„ã‚ˆï¼');
}

timerFeedback.textContent = `${feedbackMessage} (${responseTime.toFixed(1)}ç§’ã‹ã‹ã‚Šã¾ã—ãŸ)`;
timerFeedback.className = 'timer-feedback correct';
} else {
button.classList.add('incorrect');

document.querySelectorAll('.choice-button').forEach(btn => {
if (btn.textContent === currentListenWord.translation) {
btn.classList.add('correct');
}
});

timerFeedback.textContent = 'ã‚ã€é•ã†ã‚ˆï¼ğŸ˜“âŒ';
timerFeedback.className = 'timer-feedback incorrect';
speak('ã‚ã€é•ã†ã‚ˆï¼');
listenAnswerDisplay.textContent = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
}
}

listenChooseBtn.addEventListener('click', startListenAndChooseQuiz);

listenSpeaker.addEventListener('click', () => {
if (currentListenWord && !isAnswered) {
const cleanWord = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
speak(cleanWord);

if (!questionStartTime) {
questionStartTime = Date.now();
}
}
});

listenNextBtn.addEventListener('click', nextListenQuestion);

listenCloseBtn.addEventListener('click', () => {
listenChooseModal.style.display = 'none';
});

// ===== JAPANESE TO ENGLISH QUIZ =====
japaneseToEnglishBtn.addEventListener('click', () => {
currentJapaneseQuizWords = vocabularyData.filter(item => item.selected);

if (currentJapaneseQuizWords.length === 0) {
alert('æœ€ä½1ã¤ã®å˜èª/ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’é¸ã‚“ã§ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚');
return;
}

startJapaneseToEnglishQuiz();
});

checkAnswerBtn.addEventListener('click', showEnglishAnswer);
japaneseNextBtn.addEventListener('click', nextJapaneseQuestion);

japaneseCloseBtn.addEventListener('click', () => {
japaneseToEnglishModal.style.display = 'none';
});

japaneseWordSpeaker.addEventListener('click', (e) => {
e.preventDefault();
e.stopPropagation();

if (isSpeaking) {
console.log('Already speaking, ignoring click');
return;
}

if (currentJapaneseWord) {
isSpeaking = true;
const cleanWord = currentJapaneseWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
console.log('About to speak:', cleanWord);
speak(cleanWord);

setTimeout(() => {
isSpeaking = false;
}, 3000);
}
});

function startJapaneseToEnglishQuiz() {
console.log('Starting Japanese to English quiz');
console.log('Voices loaded:', voicesLoaded, 'Voice count:', voices.length);

if (!voicesLoaded || voices.length === 0) {
console.log('Loading voices before starting quiz...');
loadVoices().then(() => {
console.log('Voices loaded, starting quiz');
resetJapaneseToEnglishQuiz();
japaneseToEnglishModal.style.display = 'flex';
nextJapaneseQuestion();
});
} else {
resetJapaneseToEnglishQuiz();
japaneseToEnglishModal.style.display = 'flex';
nextJapaneseQuestion();
}
}

function resetJapaneseToEnglishQuiz() {
currentJapaneseWordIndex = -1;
currentJapaneseWord = null;
englishAnswerDisplay.style.display = 'none';
checkQuestion.style.display = 'none';
checkAnswerBtn.style.display = 'block';

if (quizMode === 'sequential') {
initializeSectionProgress();
}
}

function nextJapaneseQuestion() {
englishAnswerDisplay.style.display = 'none';
checkQuestion.style.display = 'none';
checkAnswerBtn.style.display = 'block';

if (quizMode === 'sequential') {
if (currentJapaneseWordIndex === -1) {
const firstSection = sectionOrder.find(section =>
sectionProgress[section] && sectionProgress[section].totalCount > 0
);

if (firstSection) {
sectionProgress[firstSection].currentIndex = 0;
currentJapaneseWord = sectionProgress[firstSection].items[0];
currentJapaneseWordIndex = 0;
} else {
currentJapaneseWordIndex = 0;
currentJapaneseWord = currentJapaneseQuizWords[0];
}
} else {
const currentSection = currentJapaneseWord.section;
const sectionData = sectionProgress[currentSection];

if (sectionData && sectionData.currentIndex + 1 < sectionData.totalCount) {
sectionData.currentIndex++;
currentJapaneseWord = sectionData.items[sectionData.currentIndex];
} else {
const currentSectionIndex = sectionOrder.indexOf(currentSection);
let nextSectionIndex = currentSectionIndex + 1;

while (nextSectionIndex < sectionOrder.length) {
const nextSection = sectionOrder[nextSectionIndex];
if (sectionProgress[nextSection] && sectionProgress[nextSection].totalCount > 0) {
sectionProgress[nextSection].currentIndex = 0;
currentJapaneseWord = sectionProgress[nextSection].items[0];
break;
}
nextSectionIndex++;
}

if (nextSectionIndex >= sectionOrder.length) {
const firstSection = sectionOrder.find(section =>
sectionProgress[section] && sectionProgress[section].totalCount > 0
);

if (firstSection) {
sectionProgress[firstSection].currentIndex = 0;
currentJapaneseWord = sectionProgress[firstSection].items[0];
}
}
}

currentJapaneseWordIndex = currentJapaneseQuizWords.findIndex(item =>
item.vocabulary === currentJapaneseWord.vocabulary &&
item.translation === currentJapaneseWord.translation
);
}
} else {
const previousIndex = currentJapaneseWordIndex;

if (currentJapaneseQuizWords.length === 1) {
currentJapaneseWordIndex = 0;
} else {
do {
currentJapaneseWordIndex = Math.floor(Math.random() * currentJapaneseQuizWords.length);
} while (currentJapaneseWordIndex === previousIndex && currentJapaneseQuizWords.length > 1);
}

currentJapaneseWord = currentJapaneseQuizWords[currentJapaneseWordIndex];
}

const cleanWord = currentJapaneseWord.vocabulary.replace(/\(.*?\)/g, '').trim();
japaneseWordDisplay.textContent = cleanWord;

updateProgressDisplay();
}

function showEnglishAnswer() {
if (!currentJapaneseWord) return;

englishAnswerDisplay.textContent = currentJapaneseWord.translation;
englishAnswerDisplay.style.display = 'block';
checkQuestion.style.display = 'block';
checkAnswerBtn.style.display = 'none';
}

// ===== MAIN QUIZ =====
startBtn.addEventListener('click', () => {
currentQuizWords = vocabularyData.filter(item => item.selected);

if (currentQuizWords.length === 0) {
alert('æœ€ä½1ã¤ã®å˜èª/ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’é¸ã‚“ã§ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚');
return;
}

startQuiz();
});

function startQuiz() {
resetQuiz();
quizModal.style.display = 'flex';
nextQuestion();
}

function resetQuiz() {
currentWordIndex = -1;
currentWord = null;
answerInput.value = '';
feedbackEl.textContent = '';
feedbackEl.className = 'feedback';
hintTextEl.textContent = '';
revealAnswerEl.textContent = '';
}

function nextQuestion() {
answerInput.value = '';
feedbackEl.textContent = '';
feedbackEl.className = 'feedback';
hintTextEl.textContent = '';
revealAnswerEl.textContent = '';

if (quizMode === 'sequential') {
currentWordIndex = (currentWordIndex + 1) % currentQuizWords.length;
} else {
const previousIndex = currentWordIndex;

if (currentQuizWords.length === 1) {
currentWordIndex = 0;
} else {
do {
currentWordIndex = Math.floor(Math.random() * currentQuizWords.length);
} while (currentWordIndex === previousIndex && currentQuizWords.length > 1);
}
}

currentWord = currentQuizWords[currentWordIndex];
translationPrompt.textContent = currentWord.translation;
}

function submitAnswer() {
if (!currentWord) return;

const userAnswer = answerInput.value.trim();
const correctAnswers = currentWord.vocabulary
.split('/')
.map(ans => ans.replace(/\(.*?\)/g, '').trim());

const normalizedUserAnswer = userAnswer.replace(/[.,?'''...#!ï¼Ÿï¼ï½ã€ã€‚ã€Œã€ï¼ˆï¼‰â€¦$%^&*;:{}=\-_`~()]/g, "");

const isCorrect = correctAnswers.some(answer => {
const normalizedAnswer = answer.replace(/[.,?'''...#!ï¼Ÿï¼ï½ã€ã€‚ã€Œã€ï¼ˆï¼‰â€¦$%^&*;:{}=\-_`~()]/g, "");
return normalizedUserAnswer === normalizedAnswer;
});

if (isCorrect) {
feedbackEl.textContent = 'æ­£è§£ï¼ğŸ†ğŸ˜ŠğŸ‘';
feedbackEl.className = 'feedback correct';
speak('æ­£è§£ï¼');
} else {
feedbackEl.textContent = 'ã¾ã ã¾ã ã ã­ï¼ğŸ’¥ğŸ˜ğŸ¾';
feedbackEl.className = 'feedback incorrect';
speak('ã¾ã ã¾ã ã ã­ï¼');
}
}

function showHint() {
if (!currentWord) return;

const correctAnswer = currentWord.vocabulary.replace(/\(.*?\)/g, '').trim();
const firstChar = correctAnswer.charAt(0);

hintTextEl.textContent = `ãƒ’ãƒ³ãƒˆï¼šã€Œ${firstChar}ã€ã§å§‹ã¾ã‚Šã¾ã™`;
}

function showAnswer() {
if (!currentWord) return;

const correctAnswer = currentWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
revealAnswerEl.textContent = `${correctAnswer}`;
speak(correctAnswer);
}

submitBtn.addEventListener('click', submitAnswer);

answerInput.addEventListener('keypress', (e) => {
if (e.key === 'Enter') {
submitAnswer();
}
});

speakBtn.addEventListener('click', () => {
if (!recognition) {
alert('éŸ³å£°èªè­˜ã¯ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
return;
}

try {
if (speakBtn.textContent === 'ğŸ¤ éŸ³å£°å…¥åŠ›') {
recognition.start();
speakBtn.textContent = 'éŒ²éŸ³ä¸­';
speakBtn.classList.add('recording');
} else {
recognition.stop();
speakBtn.textContent = 'ğŸ¤ éŸ³å£°å…¥åŠ›';
speakBtn.classList.remove('recording');
}
} catch (error) {
console.error('Speech recognition error:', error);
speakBtn.textContent = 'ğŸ¤ éŸ³å£°å…¥åŠ›';
speakBtn.classList.remove('recording');
}
});

hintBtn.addEventListener('click', showHint);
answerBtn.addEventListener('click', showAnswer);
nextBtn.addEventListener('click', nextQuestion);

closeBtn.addEventListener('click', () => {
quizModal.style.display = 'none';
if (recognition) {
recognition.stop();
}
});

// ===== DATE INFORMATION =====
function updateDateInfo() {
const dateInfoEl = document.getElementById('date-info');

const options = {
timeZone: 'Asia/Tokyo',
weekday: 'long',
month: 'long',
day: 'numeric',
year: 'numeric'
};

const today = new Date();
const japanDate = today.toLocaleDateString('ja-JP', options);

const examDate = new Date('July 5, 2026');
examDate.setHours(0, 0, 0, 0);

const todayNoTime = new Date(today);
todayNoTime.setHours(0, 0, 0, 0);

const daysUntilExam = Math.ceil((examDate - todayNoTime) / (1000 * 60 * 60 * 24));

const decExamDate = new Date('December 6, 2026');
decExamDate.setHours(0, 0, 0, 0);

const daysUntilDecExam = Math.ceil((decExamDate - todayNoTime) / (1000 * 60 * 60 * 24));

dateInfoEl.innerHTML = `
<span><span class="emoji">ğŸ“…</span>${japanDate}</span>
<span><span class="emoji">â°</span>JLPTã¾ã§ ã‚ã¨<span class="countdown">${daysUntilExam}</span>æ—¥ (æ¯å¹´7æœˆã®ç¬¬ä¸€æ—¥æ›œæ—¥)</span>
<span><span class="emoji">ğŸ“š</span>JLPTã¾ã§ ã‚ã¨<span class="countdown">${daysUntilDecExam}</span>æ—¥ (æ¯å¹´12æœˆã®ç¬¬ä¸€æ—¥æ›œæ—¥)</span>
`;
}

updateDateInfo();
setInterval(updateDateInfo, 60000);

// ===== SAVE CHECKED BUTTON =====
document.getElementById('save-checked-btn').addEventListener('click', () => {
    const checkedCount = vocabularyData.filter(item => item.selected).length;
    if (checkedCount === 0) {
        alert('ä¿å­˜ã™ã‚‹ãƒã‚§ãƒƒã‚¯é …ç›®ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
    }
    saveCheckedStates();
});

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', async () => {
   
    initializeTTS();
    await initMonthlyDB();
    await initCheckedItemsDB();

    const refreshReminderPopup = document.getElementById('refresh-reminder-popup');

    setTimeout(() => {
        refreshReminderPopup.style.display = 'flex';
    }, 1000);

    const closeReminderBtn = document.getElementById('close-reminder-btn');

    closeReminderBtn.addEventListener('click', () => {
        refreshReminderPopup.style.display = 'none';
    });
});

document.addEventListener('click', function initOnFirstClick() {
initializeTTS();
document.removeEventListener('click', initOnFirstClick);
}, { once: true });
</script>
</body>
</html>
