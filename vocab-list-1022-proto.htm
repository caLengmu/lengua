<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary List</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 2.5em;
        }

        .button-categories {
            margin-bottom: 30px;
        }

        .category {
            margin-bottom: 25px;
        }

        .category-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            display: inline-block;
        }

        .category-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .vocab-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .vocab-btn:hover {
            background-color: #2980b9;
        }

        .vocab-btn.active {
            background-color: #e74c3c;
        }

        /* Quiz Section */
        .quiz-section {
            margin: 30px 0;
            text-align: center;
            padding: 20px;
            background-color: #fff3cd;
            border-radius: 8px;
            border: 2px solid #ffc107;
        }

/* Section Selector */
        .section-selector-area {
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .section-selector-title {
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .section-checkboxes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .section-checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }

        .section-checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .section-checkbox-item label {
            cursor: pointer;
            font-size: 14px;
            color: #333;
            user-select: none;
            flex: 1;
        }

        .section-checkbox-item:hover {
            background-color: #f0f0f0;
        }

        @media (max-width: 768px) {
            .section-selector-area {
                padding: 15px;
                margin: 15px 0;
            }

            .section-selector-title {
                font-size: 14px;
            }

            .section-checkboxes-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .section-checkbox-item {
                padding: 10px;
            }

            .section-checkbox-item input[type="checkbox"] {
                width: 18px;
                height: 18px;
            }

            .section-checkbox-item label {
                font-size: 13px;
            }
        }

        .quiz-btn {
            background-color: #ffc107;
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .quiz-btn:hover {
            background-color: #ffb300;
        }

        .speed-control-section {
            margin: 30px 0;
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }

        .speed-label {
            font-weight: bold;
            color: #495057;
            margin-right: 15px;
            font-size: 16px;
        }

        .speed-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .speed-btn:hover {
            background-color: #5a6268;
        }

        .speed-btn.active-speed {
            background-color: #28a745;
        }

        .study-partner-section {
            margin: 30px 0;
            text-align: center;
            padding: 20px;
            background-color: #e8f4f8;
            border-radius: 8px;
        }

        .study-partner-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        .study-partner-btn:hover {
            background-color: #218838;
        }

        .vocab-table-container {
            margin-top: 30px;
            overflow-x: auto;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
        }

        .section-header {
            background-color: #ecf0f1;
            font-weight: bold;
            padding: 15px;
            text-align: left;
            font-size: 1.5em;
            color: #2c3e50;
        }

        .vocab-row {
            border-bottom: 1px solid #ddd;
        }

        .audio-controls {
            width: 80px;
            text-align: center;
            padding: 15px 10px;
            vertical-align: top;
        }

        .content-cell {
            padding: 15px;
            vertical-align: top;
        }

        .vocab-word {
            font-weight: bold;
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .example-sentence {
            font-size: 1.5em;
            color: #555;
            line-height: 1.5;
        }

        .audio-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            margin: 2px;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .audio-btn:hover {
            background-color: #f0f0f0;
        }

        .play-btn {
            color: #27ae60;
        }

        .stop-btn {
            color: #e74c3c;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 20px auto;
            padding: 25px;
            border-radius: 8px;
            width: 95%;
            max-width: 600px;
            position: relative;
        }

        .close {
            color: #aaa;
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
        }

        .close:hover {
            color: #000;
        }

        /* Listen and Choose Quiz Styles - Mobile Optimized */
        .quiz-modal-content {
            margin: 5px auto;
            padding: 15px;
            max-height: 98vh;
            display: flex;
            flex-direction: column;
        }

        .quiz-header {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            padding-right: 30px;
        }

        @media (max-width: 768px) {
            .section-selector {
                max-height: 120px;
                padding: 10px;
            }

            .section-selector-title {
                font-size: 13px;
            }

            .section-item label {
                font-size: 12px;
            }
        }

        .listen-answer-section {
            text-align: center;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }

.listen-answer-display {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .listen-speaker {
            font-size: 40px;
            cursor: pointer;
            display: inline-block;
            transition: transform 0.2s;
        }

        .listen-speaker:hover {
            transform: scale(1.1);
        }

        .listen-speaker:active {
            transform: scale(0.95);
        }

        .timer-feedback-section {
            text-align: center;
            margin: 8px 0;
            min-height: 25px;
        }

        .timer-feedback {
            font-size: 15px;
            font-weight: bold;
        }

        .timer-feedback.correct {
            color: #28a745;
        }

        .timer-feedback.incorrect {
            color: #dc3545;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 10px 0;
            flex-grow: 1;
        }

.choice-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.4;
        }

        .choice-btn:hover:not(:disabled) {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .choice-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .choice-btn.correct {
            background-color: #28a745;
            animation: pulse-correct 0.5s;
        }

        .choice-btn.incorrect {
            background-color: #dc3545;
            animation: shake 0.5s;
        }

        @keyframes pulse-correct {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .listen-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
        }

        .listen-next-btn, .listen-close-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .listen-next-btn {
            background-color: #28a745;
            color: white;
        }

        .listen-next-btn:hover:not(:disabled) {
            background-color: #218838;
        }

        .listen-next-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .listen-close-btn {
            background-color: #6c757d;
            color: white;
        }

        .listen-close-btn:hover {
            background-color: #5a6268;
        }

.quiz-complete {
            text-align: center;
            padding: 20px;
            grid-column: 1 / -1;
            width: 100%;
        }

        .quiz-complete h3 {
            color: #28a745;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .quiz-score {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .restart-quiz-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
        }

        .restart-quiz-btn:hover {
            background-color: #2980b9;
        }

        .partner-selection {
            text-align: center;
        }

        .partner-selection h2 {
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .partners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .partner-card {
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
        }

        .partner-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #e9ecef;
            overflow: hidden;
            margin: 0 auto 15px;
        }

        .partner-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .select-partner-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .select-partner-btn:hover {
            background-color: #0056b3;
        }

        .study-session {
            text-align: center;
        }

        .partner-display {
            margin-bottom: 30px;
        }

        .partner-avatar {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background-color: #e9ecef;
            overflow: hidden;
            margin: 0 auto 20px;
        }

        .partner-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .speech-bubble {
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 20px;
            border-radius: 10px;
            margin: 0 auto 20px;
            max-width: 500px;
        }

        .current-word {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .current-example {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .bubble-controls {
            margin-bottom: 15px;
        }

        .bubble-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            margin: 0 5px;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .bubble-btn:hover {
            background-color: #f0f0f0;
        }

        .bubble-btn.play-btn {
            color: #27ae60;
        }

        .bubble-btn.stop-btn {
            color: #e74c3c;
        }

        .progress-info {
            margin-bottom: 20px;
            font-size: 17px;
            color: #666;
        }

        .navigation-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 17px;
        }

        .nav-btn:hover:not(:disabled) {
            background-color: #0056b3;
        }

        .nav-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .learn-again-btn {
            background-color: #28a745 !important;
        }

        .learn-again-btn:hover {
            background-color: #218838 !important;
        }

        .congratulations {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .congratulations h3 {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }

            .category-title {
                font-size: 1.2em;
            }

            .vocab-btn {
                padding: 10px 15px;
                font-size: 13px;
            }

            .quiz-section {
                padding: 15px;
                margin: 20px 0;
            }

            .quiz-btn {
                padding: 12px 20px;
                font-size: 16px;
            }

            .speed-control-section {
                padding: 10px;
            }

            .speed-label {
                display: block;
                margin-bottom: 10px;
                margin-right: 0;
            }

            .speed-btn {
                padding: 8px 12px;
                font-size: 13px;
                margin: 2px;
            }

            .study-partner-section {
                padding: 15px;
            }

            .study-partner-btn {
                padding: 12px 20px;
                font-size: 16px;
            }

            .section-header {
                font-size: 1.2em;
                padding: 12px;
            }

            .section-checkbox {
                width: 18px;
                height: 18px;
            }

            .audio-controls {
                width: 60px;
                padding: 10px 5px;
            }

            .content-cell {
                padding: 12px;
            }

.vocab-word {
                font-size: 2.4em;
            }

            .example-sentence {
                font-size: 2.2em;
            }

            .current-word {
                font-size: 36px;
            }

            .current-example {
                font-size: 36px;
            }

            /* Quiz Modal Mobile Optimization */
            .modal-content {
                width: 98%;
                margin: 5px auto;
                padding: 12px;
            }

            .quiz-modal-content {
                max-height: 97vh;
                padding: 10px;
            }

            .quiz-header {
                font-size: 1.1em;
                margin-bottom: 10px;
            }

            .listen-answer-section {
                padding: 10px;
                margin-bottom: 8px;
            }

.listen-answer-display {
                font-size: 16px;
                min-height: 50px;
                line-height: 1.3;
            }

            .listen-speaker {
                font-size: 36px;
            }

            .timer-feedback {
                font-size: 13px;
            }

            .choices-grid {
                gap: 6px;
                margin: 8px 0;
            }

.choice-btn {
                font-size: 15px;
                padding: 10px 8px;
                min-height: 55px;
                line-height: 1.3;
            }

            .listen-controls {
                gap: 8px;
                margin-top: 8px;
                padding-top: 8px;
            }

            .listen-next-btn, .listen-close-btn {
                padding: 8px 20px;
                font-size: 14px;
            }

            .partners-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .partner-image {
                width: 60px;
                height: 60px;
            }

            .partner-avatar {
                width: 100px;
                height: 100px;
            }

            .speech-bubble {
                padding: 15px;
            }

            .current-word {
                font-size: 18px;
            }

            .current-example {
                font-size: 18px;
            }

            .navigation-controls {
                gap: 5px;
            }

            .nav-btn {
                padding: 8px 12px;
                font-size: 15px;
            }
        }

@media (max-width: 400px) {
            .quiz-header {
                font-size: 1em;
            }

            .listen-answer-display {
                font-size: 14px;
                min-height: 45px;
            }

            .choice-btn {
                font-size: 13px;
                min-height: 50px;
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Vocabulary List (10.22 proto)</h1>

        <div class="button-categories">
            <div class="category">
                <div class="category-title">Textbook</div>
                <div class="category-buttons">
                    <button class="vocab-btn" data-category="textbook" data-lesson="textbook1">B3 L4</button>
                    <button class="vocab-btn" data-category="textbook" data-lesson="textbook2">B3 L5</button>
                    <button class="vocab-btn" data-category="textbook" data-lesson="textbook3">B3 L6 (Ëá™Ë™≠)</button>
                </div>
            </div>

            <div class="category">
                <div class="category-title">Magazine</div>
                <div class="category-buttons">
                    <button class="vocab-btn" data-category="magazine" data-lesson="maga1">U2</button>
                    <button class="vocab-btn" data-category="magazine" data-lesson="maga2">U7 (Ëá™Ë™≠)</button>
                    <button class="vocab-btn" data-category="magazine" data-lesson="maga3">U12</button>
                    <button class="vocab-btn" data-category="magazine" data-lesson="maga4">U13 (Ëá™Ë™≠)</button>
                </div>
            </div>         

<div class="category">
                <div class="category-title">Ê†∏ÂøÉÂ≠óÂΩô</div>
                <div class="category-buttons">
                    <button class="vocab-btn" data-category="core" data-lesson="core1">P2 U4</button>
                    <button class="vocab-btn" data-category="core" data-lesson="core2">P2 U5</button>
                    <button class="vocab-btn" data-category="core" data-lesson="core3">P2 U6</button>
                </div>
            </div>
        </div>

        <!-- Study Partner Section -->
        <div class="study-partner-section">
            <button class="study-partner-btn" id="choosePartnerBtn">
                üë¨ Choose Your Study Partner (ÈÅ∏Â≠∏‰º¥)
            </button>
        </div>

<!-- Listen and Choose Quiz Section -->
        <div class="quiz-section">
            <button class="quiz-btn" id="listenChooseBtn">
                üéß Listen and Choose (ËÅΩÂäõÊ∏¨È©ó)
            </button>
        </div>

        <!-- Section Selector -->
        <div class="section-selector-area" id="sectionSelectorArea" style="display: none;">
            <div class="section-selector-title">üìã Select sections for quiz (ÈÅ∏ÊìáÊ∏¨È©óÁØÑÂúç):</div>
            <div class="section-checkboxes-grid" id="sectionCheckboxesGrid"></div>
        </div>

        <!-- Speed Control -->
        <div class="speed-control-section">
            <span class="speed-label">Speed:</span>
            <button class="speed-btn" data-speed="1.2">1.2x</button>
            <button class="speed-btn active-speed" data-speed="1.0">1x</button>
            <button class="speed-btn" data-speed="0.8">0.8x</button>
            <button class="speed-btn" data-speed="0.6">0.6x</button>
        </div>

        <!-- Table -->
        <div class="vocab-table-container">
            <table class="vocab-table" id="vocabTable">
                <tbody id="vocabTableBody">
                    <tr class="no-data">
                        <td colspan="2">Select a lesson to load vocabulary (ÈÅ∏ÊìáÂñÆÂÖÉ‰ª•ËºâÂÖ•Â≠óÂΩô)</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Welcome Notice Modal -->
    <div id="welcomeModal" class="modal" style="display: block;">
        <div class="modal-content" style="max-width: 500px;">
            <div style="text-align: center; padding: 10px;">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">üì¢ Important Notice</h2>
                <div style="text-align: left; font-size: 16px; line-height: 1.8; margin-bottom: 25px;">
                    <p style="margin-bottom: 15px; color: red; text-align: center;"><strong>1. ÊØèÊ¨°‰ΩøÁî®Ë´ãÈªûÊìä„ÄåÈáçÊñ∞Êï¥ÁêÜ(refresh)üîÑ„Äç‰ª•Áç≤ÂèñÊõ¥Êñ∞ÔºÅ</strong></p>
                    <p style="margin-bottom: 0; text-align: center;">2. ÊâãÊ©üÊúâÊôÇÊúÉÊõ¥Êñ∞„ÄåÊñáÂ≠óËΩâË™ûÈü≥„ÄçÂäüËÉΩÔºåÂ∞éËá¥üîäÁÑ°Ê≥ïÈÅã‰ΩúÔºåÈáçÈñãÊ©üÂç≥ÂèØËß£Ê±∫„ÄÇ</p>
                </div>
                <button id="welcomeOkBtn" style="background-color: #28a745; color: white; border: none; padding: 12px 40px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold;">
                    OK. I got it.
                </button>
            </div>
        </div>
    </div>

<!-- Listen and Choose Modal -->
    <div id="listenChooseModal" class="modal">
        <div class="modal-content quiz-modal-content">
            <span class="close" id="closeListenChoose">&times;</span>
<h2 class="quiz-header">üéß Listen and Choose</h2>
            <div class="listen-answer-section">
                <div id="listenAnswerDisplay" class="listen-answer-display">Click the speaker to hear</div>
                <div class="listen-speaker" id="listenSpeaker" title="Play Audio">üîä</div>
            </div>
            <div class="timer-feedback-section">
                <div id="timerFeedback" class="timer-feedback"></div>
            </div>
            <div id="choicesGrid" class="choices-grid"></div>
            <div class="listen-controls">
                <button id="listenNextBtn" class="listen-next-btn">Next</button>
                <button id="listenCloseBtn" class="listen-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Partner Selection Modal -->
    <div id="partnerModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closePartnerModal">&times;</span>
            <div class="partner-selection">
                <h2>Choose Your Study Partner</h2>
                <div class="partners-grid">
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner1.jpg" alt="partner 1">
                        </div>
                        <button class="select-partner-btn" data-partner="1">Shawn Mendes</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner2.jpg" alt="partner 2">
                        </div>
                        <button class="select-partner-btn" data-partner="2">Taylor Swift</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner3.jpg" alt="partner 3">
                        </div>
                        <button class="select-partner-btn" data-partner="3">Ros√©</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner4.jpg" alt="partner 4">
                        </div>
                        <button class="select-partner-btn" data-partner="4">Ï†ÑÏõêÏö∞</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner5.jpg" alt="partner 5">
                        </div>
                        <button class="select-partner-btn" data-partner="5">Í∞ïÌÉúÌòÑ</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner6.jpg" alt="partner 6">
                        </div>
                        <button class="select-partner-btn" data-partner="6">IU</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner7.jpg" alt="partner 7">
                        </div>
                        <button class="select-partner-btn" data-partner="7">Asa</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner8.jpg" alt="partner 8">
                        </div>
                        <button class="select-partner-btn" data-partner="8">ÈáëÂüéÊ≠¶</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner9.jpg" alt="partner 9">
                        </div>
                        <button class="select-partner-btn" data-partner="9">‰ΩêËó§ ÂÅ•</button>
                    </div>
                    <div class="partner-card">
                        <div class="partner-image">
                            <img src="partner10.jpg" alt="partner 10">
                        </div>
                        <button class="select-partner-btn" data-partner="10">ÂàùÈü≥„Éü„ÇØ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Study Session Modal -->
    <div id="studyModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeStudyModal">&times;</span>
            <div class="study-session">
                <div class="partner-display">
                    <div class="partner-avatar" id="currentPartnerAvatar">
                        <img src="partner1.jpg" alt="partner 1">
                    </div>
                    <div class="speech-bubble" id="speechBubble">
                        <div class="current-word" id="currentWord">Select a lesson first!</div>
                        <div class="current-example" id="currentExample">Please choose a lesson from the main page before starting your study session.</div>
                        <div class="bubble-controls">
                            <button class="bubble-btn play-btn" id="speakCurrentBtn">üîä</button>
                            <button class="bubble-btn stop-btn" id="stopCurrentBtn">‚èπ</button>
                        </div>
                    </div>
                </div>
                <div class="progress-info" id="progressInfo">
                    Ready to start!
                </div>
                <div class="navigation-controls" id="navigationControls">
                    <button class="nav-btn" id="backBtn">‚Üê Back</button>
                    <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
                    <button class="nav-btn" id="nextSectionBtn">Next Section</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Built-in database - can be expanded
        const vocabDatabase = {
            textbook1: [
  
],
            
            'textbook2': [
{
"section": "‚óéParagraph 1",
"words": [
{"word": "bright and colorful (adj phr.) (Êòé‰∫ÆÂèàÁπΩÁ¥õÁöÑ):", "example": "The festival decorations are bright and colorful. (ÁØÄÊÖ∂Ë£ùÈ£æÊòé‰∫ÆÂèàÁπΩÁ¥õ„ÄÇ)"},
{"word": "delight someone (v phr.) (‰ΩøÊüê‰∫∫ÈñãÂøÉ):", "example": "The performance delighted the audience. (ÈÄôÂ†¥Ë°®ÊºîËÆìËßÄÁúæÊÑüÂà∞ÈñãÂøÉ„ÄÇ)"},
{"word": "tourist (n) (ËßÄÂÖâÂÆ¢):", "example": "Many tourists visit Japan every spring. (ÊØèÂπ¥Êò•Â§©ÊúâË®±Â§öËßÄÂÖâÂÆ¢ÈÄ†Ë®™Êó•Êú¨„ÄÇ)"},
{"word": "throughout the year (phr.) (ÂÖ®Âπ¥):", "example": "The park is open throughout the year. (ÈÄôÂ∫ßÂÖ¨ÂúíÂÖ®Âπ¥ÈñãÊîæ„ÄÇ)"},
{"word": "romance is in the air (phr.) (Êµ™Êº´Ê∞£ÊÅØÁÄ∞Êº´):", "example": "During the cherry blossom season, romance is in the air. (Ê´ªËä±Â≠£ÊôÇÔºåÊµ™Êº´Ê∞£ÊÅØÁÄ∞Êº´„ÄÇ)"},
{"word": "be filled with‚Ä¶ (phr.) (ÂÖÖÊªø‚Ä¶):", "example": "The garden is filled with blooming flowers. (Ëä±ÂúíË£°ÈñãÊªø‰∫ÜËä±„ÄÇ)"},
{"word": "a sea of pink cherry blossoms (phr.) (‰∏ÄÁâáÁ≤âÁ¥ÖÊ´ªËä±Êµ∑):", "example": "We walked through a sea of pink cherry blossoms. (ÊàëÂÄëËµ∞Âú®Á≤âÁ¥ÖÊ´ªËä±Êµ∑‰∏≠„ÄÇ)"},
{"word": "(leaves) rustle in the wind (phr.) ((Ê®πËëâ)Âú®È¢®‰∏≠Ê≤ôÊ≤ô‰ΩúÈüø):", "example": "The leaves rustled in the wind softly. (Ê®πËëâÂú®È¢®‰∏≠ËºïËºïÊ≤ôÊ≤ô‰ΩúÈüø„ÄÇ)"},
{"word": "sparkle in the sunshine (phr.) (Âú®ÈôΩÂÖâ‰∏ãÈñÉËÄÄ):", "example": "The lake sparkled in the sunshine. (ÊπñÈù¢Âú®ÈôΩÂÖâ‰∏ãÈñÉÈñÉÁôºÂÖâ„ÄÇ)"},
{"word": "maple leaves (n) (Ê•ìËëâ):", "example": "Maple leaves turn red in autumn. (Ê•ìËëâÂú®ÁßãÂ§©ËÆäÁ¥Ö„ÄÇ)"},
{"word": "set‚Ä¶ on fire (phr.) (ÈªûÁáÉ‚Ä¶):", "example": "The sunset set the sky on fire. (Â§ïÈôΩÊääÂ§©Á©∫ÊüìÊàêÁÅ´Á¥Ö„ÄÇ)"},
{"word": "landscape (n) (È¢®ÊôØ):", "example": "The mountain landscape is stunning. (Â±±ÊôØ‰ª§‰∫∫È©öÂòÜ„ÄÇ)"},
{"word": "turn‚Ä¶ into‚Ä¶ (phr.) (Êää‚Ä¶ËÆäÊàê‚Ä¶):", "example": "Snow turns the city into a winter wonderland. (Èõ™ËÆìÂüéÂ∏ÇËÆäÊàêÂÜ¨Â≠£‰ªôÂ¢É„ÄÇ)"},
{"word": "the whole city (n phr.) (Êï¥Â∫ßÂüéÂ∏Ç):", "example": "The whole city celebrates the festival. (Êï¥Â∫ßÂüéÂ∏ÇÈÉΩÂú®ÊÖ∂Á•ùÈÄôÂÄãÁØÄÊó•„ÄÇ)"},
{"word": "silver (adj/n) (ÈäÄËâ≤ÁöÑÔºèÈäÄ):", "example": "The mountains were covered in silver snow. (Áæ§Â±±Ë¶ÜËìãËëóÈäÄÁôΩËâ≤ÁöÑÈõ™„ÄÇ)"},
{"word": "kingdom (n) (ÁéãÂúã):", "example": "The theme park is a magical kingdom. (ÈÄôÂ∫ß‰∏ªÈ°åÊ®ÇÂúíÊòØ‰∏ÄÂÄãÈ≠îÂπªÁéãÂúã„ÄÇ)"}
]
},
{
"section": "‚óéParagraph 2",
"words": [
{"word": "apart from‚Ä¶ (prep.) (Èô§‰∫Ü‚Ä¶‰πãÂ§ñ):", "example": "Apart from Tokyo, I‚Äôve also been to Osaka. (Èô§‰∫ÜÊù±‰∫¨‰πãÂ§ñÔºåÊàë‰πüÂéªÈÅéÂ§ßÈò™„ÄÇ)"},
{"word": "splendor (n) (Â£ØÈ∫ó„ÄÅËºùÁÖå):", "example": "The palace is famous for its splendor. (ÈÄôÂ∫ßÂÆÆÊÆø‰ª•ÂÖ∂Â£ØÈ∫óËÅûÂêç„ÄÇ)"},
{"word": "feast one‚Äôs eyes on‚Ä¶ (phr.) (Áõ°ÊÉÖÊ¨£Ë≥û‚Ä¶):", "example": "Visitors can feast their eyes on the view. (ÈÅäÂÆ¢ÂèØ‰ª•Áõ°ÊÉÖÊ¨£Ë≥ûÁæéÊôØ„ÄÇ)"},
{"word": "previously (adv) (ÂÖàÂâç„ÄÅ‰ª•Ââç):", "example": "She had previously visited Kyoto. (Â•πÂÖàÂâçÂéªÈÅé‰∫¨ÈÉΩ„ÄÇ)"},
{"word": "capital (city) (n) (È¶ñÈÉΩ):", "example": "Tokyo is the capital of Japan. (Êù±‰∫¨ÊòØÊó•Êú¨ÁöÑÈ¶ñÈÉΩ„ÄÇ)"},
{"word": "boast (v) (1.Ë™áËÄÄ„ÄÅÂêπÂôì):", "example": "He always boasts about his success. (‰ªñÁ∏ΩÊòØË™áËÄÄËá™Â∑±ÁöÑÊàêÂäü„ÄÇ)"},
{"word": "boast (v) (2.ÊìÅÊúâ(ÂÄºÂæóËá™Ë±™ÁöÑÊù±Ë•ø)):", "example": "The temple boasts beautiful gardens. (ÈÄôÂ∫ßÂØ∫ÂªüÊìÅÊúâÁæéÈ∫óÁöÑÂ∫≠Âúí„ÄÇ)"},
{"word": "a large/small number of‚Ä¶ (phr.) (Ë®±Â§öÔºèÂ∞ëÊï∏ÁöÑ‚Ä¶):", "example": "A large number of tourists visit each year. (ÊØèÂπ¥ÈÉΩÊúâË®±Â§öÈÅäÂÆ¢ÈÄ†Ë®™„ÄÇ)"},
{"word": "historic (adj) (Ê≠∑Âè≤ÊÄßÁöÑ):", "example": "Kyoto is full of historic landmarks. (‰∫¨ÈÉΩÂÖÖÊªø‰∫ÜÊ≠∑Âè≤Âú∞Ê®ô„ÄÇ)"},
{"word": "shrine (n) (Á•ûÁ§æ):", "example": "They prayed at the ancient shrine. (‰ªñÂÄëÂú®Âè§ËÄÅÁöÑÁ•ûÁ§æÁ•àÁ¶±„ÄÇ)"},
{"word": "temple (n) (ÂØ∫Âªü):", "example": "This temple attracts many visitors. (ÈÄôÂ∫ßÂØ∫ÂªüÂê∏Âºï‰∫ÜË®±Â§öÈÅäÂÆ¢„ÄÇ)"},
{"word": "landmark (n) (Âú∞Ê®ô):", "example": "The Eiffel Tower is a famous landmark. (ËâæËè≤ÁàæÈêµÂ°îÊòØËëóÂêçÁöÑÂú∞Ê®ô„ÄÇ)"},
{"word": "pavilion (n) (Ê∂º‰∫≠„ÄÅ‰∫≠Èñ£):", "example": "The pavilion stands beside the pond. (Ê∂º‰∫≠ÂùêËêΩÂú®Ê±†Â°òÊóÅ„ÄÇ)"},
{"word": "main entrance (n phr.) (Ê≠£ÈñÄ):", "example": "We met at the main entrance of the museum. (ÊàëÂÄëÂú®ÂçöÁâ©È§®ÁöÑÊ≠£ÈñÄÁ¢∞Èù¢„ÄÇ)"},
{"word": "come into view (phr.) (Êò†ÂÖ•ÁúºÁ∞æ):", "example": "The temple came into view as we climbed the hill. (Áï∂ÊàëÂÄëÁà¨‰∏äÂ±±ÊôÇÔºåÂØ∫ÂªüÊò†ÂÖ•ÁúºÁ∞æ„ÄÇ)"},
{"word": "magnificent (adj) (Â£ØÈ∫óÁöÑ):", "example": "The magnificent palace impressed everyone. (ÈÄôÂ∫ßÂ£ØÈ∫óÁöÑÂÆÆÊÆøËÆìÂ§ßÂÆ∂Âç∞Ë±°Ê∑±Âàª„ÄÇ)"},
{"word": "a three-story building (n phr.) (‰∏âÂ±§Ê®ìÂª∫ÁØâ):", "example": "They live in a three-story building. (‰ªñÂÄë‰ΩèÂú®‰∏ÄÊ£ü‰∏âÂ±§Ê®ìÁöÑÂª∫ÁØâË£°„ÄÇ)"},
{"word": "rise up (phr.) (ËÅ≥Á´ã):", "example": "Tall towers rose up above the city. (È´òÂ°îËÅ≥Á´ãÂú®ÂüéÂ∏Ç‰∏äÊñπ„ÄÇ)"},
{"word": "crystal (n) (Ê∞¥Êô∂):", "example": "The chandelier was made of crystal. (ÈÇ£ÁõûÂêäÁáàÊòØÁî±Ê∞¥Êô∂Ë£ΩÊàêÁöÑ„ÄÇ)"},
{"word": "a crystal-clear pond (n phr.) (Ê∏ÖÊæàË¶ãÂ∫ïÁöÑÊ±†Â°ò):", "example": "Fish swam in the crystal-clear pond. (È≠öÂÖíÂú®Ê∏ÖÊæàË¶ãÂ∫ïÁöÑÊ±†Â°òË£°Ê∏∏Âãï„ÄÇ)"},
{"word": "be covered in‚Ä¶ (phr.) (Ë¶ÜËìãËëó‚Ä¶):", "example": "The mountains are covered in snow. (Áæ§Â±±Ë¶ÜËìãËëóÁôΩÈõ™„ÄÇ)"},
{"word": "be crowned with‚Ä¶ (phr.) (È†Ç‰∏äÊúâ‚Ä¶):", "example": "The tower was crowned with a golden statue. (Â°îÈ†Ç‰∏äÊúâ‰∏ÄÂ∫ßÈáëËâ≤ÈõïÂÉè„ÄÇ)"},
{"word": "bronze (n) (ÈùíÈäÖ):", "example": "The statue is made of bronze. (ÈÄôÂ∫ßÈõïÂÉèÊòØÈùíÈäÖË£ΩÊàêÁöÑ„ÄÇ)"},
{"word": "phoenix (n) (È≥≥Âá∞):", "example": "A bronze phoenix stood on the roof. (Â±ãÈ†Ç‰∏äÁ´ôËëó‰∏ÄÈöªÈùíÈäÖÈ≥≥Âá∞„ÄÇ)"},
{"word": "shimmer (v) (ÈñÉÁàç„ÄÅÈñÉÂÖâ):", "example": "The water shimmered in the sunlight. (Ê∞¥Èù¢Âú®ÈôΩÂÖâ‰∏ãÈñÉÈñÉÁôºÂÖâ„ÄÇ)"},
{"word": "the reflection of‚Ä¶ (n phr.) (‚Ä¶ÁöÑÂÄíÂΩ±):", "example": "We saw the reflection of the building in the pond. (ÊàëÂÄëÁúãÂà∞Âª∫ÁØâÁâ©Âú®Ê±†Â°ò‰∏≠ÁöÑÂÄíÂΩ±„ÄÇ)"},
{"word": "the glassy surface of the pond (n phr.) (Ê±†Â°òÂ¶ÇÈè°ÁöÑÊ∞¥Èù¢):", "example": "The moon shone on the glassy surface of the pond. (ÊúàÂÖâÁÖßËÄÄÂú®Ê±†Â°òÂ¶ÇÈè°ÁöÑÊ∞¥Èù¢‰∏ä„ÄÇ)"},
{"word": "a breathtaking sight (n phr.) (‰ª§‰∫∫Â±èÊÅØÁöÑÊôØË±°):", "example": "The sunrise over the mountain was a breathtaking sight. (Â±±‰∏äÁöÑÊó•Âá∫ÊôØË±°‰ª§‰∫∫Â±èÊÅØ„ÄÇ)"},
{"word": "take a leisurely walk (phr.) (ÊÇ†ÈñíÂú∞Êï£Ê≠•):", "example": "We took a leisurely walk through the garden. (ÊàëÂÄëÂú®Ëä±ÂúíË£°ÊÇ†ÈñíÂú∞Êï£Ê≠•„ÄÇ)"},
{"word": "surround (v) (Áí∞Áπû):", "example": "The temple is surrounded by trees. (ÂØ∫ÂªüË¢´Ê®πÊú®Áí∞Áπû„ÄÇ)"},
{"word": "stunning (adj) (Ê•µÁæéÁöÑ„ÄÅ‰ª§‰∫∫È©öËâ∑ÁöÑ):", "example": "She wore a stunning red dress. (Â•πÁ©øËëó‰∏Ä‰ª∂È©öËâ∑ÁöÑÁ¥ÖÊ¥ãË£ù„ÄÇ)"},
{"word": "structure (n) (Âª∫ÁØâÁâ©„ÄÅÊßãÈÄ†):", "example": "The ancient structure still stands today. (ÈÄôÂ∫ßÂè§ËÄÅÂª∫ÁØâËá≥‰ªä‰ªçÂ±πÁ´ã‰∏çÊêñ„ÄÇ)"}
]
},
{
"section": "‚óéParagraph 3",
"words": [
{"word": "unforgettable (adj) (Èõ£ÂøòÁöÑ):", "example": "It was an unforgettable experience. (ÈÇ£ÊòØ‰∏ÄÊÆµÈõ£ÂøòÁöÑÁ∂ìÊ≠∑„ÄÇ)"},
{"word": "involve (v) (Ê∂âÂèä„ÄÅÂåÖÂê´):", "example": "The job involves working with people. (ÈÄô‰ªΩÂ∑•‰ΩúÊ∂âÂèäËàá‰∫∫Âêà‰Ωú„ÄÇ)"},
{"word": "come face to face with‚Ä¶ (phr.) (Èù¢Â∞ç‚Ä¶):", "example": "We came face to face with a wild deer. (ÊàëÂÄëÊ≠£Èù¢ÈÅá‰∏ä‰∏ÄÈ†≠ÈáéÈπø„ÄÇ)"},
{"word": "delicate (adj) (Á≤æÁ∑ªÁöÑ„ÄÅÊüîÂº±ÁöÑ):", "example": "The artist painted delicate flowers. (ÈÇ£‰ΩçËóùË°ìÂÆ∂Áï´Âá∫‰∫ÜÁ≤æÁ∑ªÁöÑËä±Êúµ„ÄÇ)"},
{"word": "silk (n) (Áµ≤Á∂¢):", "example": "The kimono is made of silk. (ÈÄô‰ª∂ÂíåÊúçÊòØÁî®Áµ≤Á∂¢ÂÅöÁöÑ„ÄÇ)"},
{"word": "sleeve(s) (n) (Ë¢ñÂ≠ê):", "example": "Her long sleeves moved gracefully. (Â•πÁöÑÈï∑Ë¢ñÂÑ™ÈõÖÂú∞È£ÑÂãï„ÄÇ)"},
{"word": "distinctive (adj) (Áç®ÁâπÁöÑ):", "example": "She has a distinctive voice. (Â•πÊúâ‰∏ÄÂÄãÁç®ÁâπÁöÑËÅ≤Èü≥„ÄÇ)"},
{"word": "makeup (n) (ÂåñÂ¶ù):", "example": "She put on light makeup for the event. (Â•πÁÇ∫Ê¥ªÂãïÁï´‰∫ÜÊ∑°Â¶ù„ÄÇ)"},
{"word": "lipstick (n) (Âè£Á¥Ö):", "example": "She wore red lipstick. (Â•πÊì¶‰∫ÜÁ¥ÖËâ≤Âè£Á¥Ö„ÄÇ)"},
{"word": "elegant (adj) (ÂÑ™ÈõÖÁöÑ):", "example": "Her dress was simple but elegant. (Â•πÁöÑÊ¥ãË£ùÁ∞°ÂñÆÂçªÂÑ™ÈõÖ„ÄÇ)"},
{"word": "hairpin (n) (È´ÆÁ∞™):", "example": "The dancer wore a golden hairpin. (ÈÇ£‰ΩçËàûËÄÖÊà¥ËëóÈáëËâ≤È´ÆÁ∞™„ÄÇ)"},
{"word": "appearance (n) (Â§ñË≤å):", "example": "Her appearance attracted everyone‚Äôs attention. (Â•πÁöÑÂ§ñË≤åÂê∏Âºï‰∫ÜÂ§ßÂÆ∂ÁöÑÊ≥®ÊÑè„ÄÇ)"},
{"word": "stand out (from the crowd) (phr.) (ËÑ´Á©éËÄåÂá∫):", "example": "Her talent made her stand out from the crowd. (Â•πÁöÑÊâçËÉΩËÆìÂ•πËÑ´Á©éËÄåÂá∫„ÄÇ)"},
{"word": "highly skilled (adj) (ÊäÄËóùÈ´òË∂ÖÁöÑ):", "example": "He‚Äôs a highly skilled chef. (‰ªñÊòØ‰∏Ä‰ΩçÊäÄËóùÈ´òË∂ÖÁöÑÂªöÂ∏´„ÄÇ)"},
{"word": "entertainer (n) (Ë°®ÊºîËÄÖ):", "example": "She works as a professional entertainer. (Â•πÊòØ‰∏Ä‰ΩçËÅ∑Ê•≠Ë°®ÊºîËÄÖ„ÄÇ)"},
{"word": "master (v) (Á≤æÈÄö):", "example": "He mastered the piano after years of practice. (‰ªñÁ∂ìÈÅéÂ§öÂπ¥Á∑¥ÁøíÁ≤æÈÄö‰∫ÜÈãºÁê¥„ÄÇ)"},
{"word": "musical instrument (n phr.) (Ê®ÇÂô®):", "example": "The shamisen is a traditional Japanese musical instrument. (‰∏âÂë≥Á∑öÊòØ‰∏ÄÁ®ÆÊó•Êú¨ÂÇ≥Áµ±Ê®ÇÂô®„ÄÇ)"},
{"word": "literature (n) (ÊñáÂ≠∏):", "example": "She studied English literature at university. (Â•πÂú®Â§ßÂ≠∏Â≠∏ÁøíËã±ÂúãÊñáÂ≠∏„ÄÇ)"},
{"word": "perform (v) (Ë°®Êºî):", "example": "They performed on stage beautifully. (‰ªñÂÄëÂú®ËàûÂè∞‰∏äÊúâÁ≤æÂΩ©ÁöÑË°®Êºî„ÄÇ)"},
{"word": "ancient (adj) (Âè§ËÄÅÁöÑ):", "example": "Kyoto has many ancient temples. (‰∫¨ÈÉΩÊúâË®±Â§öÂè§ËÄÅÁöÑÂØ∫Âªü„ÄÇ)"},
{"word": "combine (v) (ÁµêÂêà):", "example": "This dance combines art and tradition. (ÈÄôÁ®ÆËàûËπàÁµêÂêà‰∫ÜËóùË°ìËàáÂÇ≥Áµ±„ÄÇ)"},
{"word": "deliberate movements (n phr.) (ÂÑ™ÈõÖËÄåÊÖéÈáçÁöÑÂãï‰Ωú):", "example": "Her deliberate movements showed grace and control. (Â•πÂÑ™ÈõÖËÄåÊÖéÈáçÁöÑÂãï‰ΩúÂ±ïÁèæ‰∫ÜÊéßÂà∂Âäõ„ÄÇ)"},
{"word": "express deep emotion (phr.) (Ë°®ÈÅîÊ∑±Â±§ÊÉÖÊÑü):", "example": "The performance expressed deep emotion. (ÈÇ£Â†¥Ë°®ÊºîË°®ÈÅî‰∫ÜÊ∑±Â±§ÁöÑÊÉÖÊÑü„ÄÇ)"}
]
},
{
"section": "‚óéParagraph 4",
"words": [
{"word": "flow (v) (ÊµÅÂãï):", "example": "The river flows through the city. (ÈÄôÊ¢ùÊ≤≥ÊµÅÁ∂ìÈÅéÂüéÂ∏Ç„ÄÇ)"},
{"word": "graceful motions (n phr.) (ÂÑ™ÈõÖÁöÑÂãï‰Ωú):", "example": "She danced with graceful motions. (Â•π‰ª•ÂÑ™ÈõÖÁöÑÂãï‰ΩúË∑≥Ëàû„ÄÇ)"},
{"word": "regardless of‚Ä¶ (phr.) (‰∏çË´ñ‚Ä¶):", "example": "Everyone is welcome, regardless of age. (‰∏çË´ñÂπ¥ÈΩ°Ôºå‰∫∫‰∫∫ÁöÜÂèØÂèÉÂä†„ÄÇ)"},
{"word": "a must-see destination (n phr.) (ÂøÖÈÅäÊôØÈªû):", "example": "Kyoto is a must-see destination for travelers. (‰∫¨ÈÉΩÊòØÊóÖÂÆ¢ÂøÖÈÅäÁöÑÊôØÈªû„ÄÇ)"},
{"word": "seek (v) (Â∞ãÊâæ„ÄÅËøΩÊ±Ç):", "example": "They seek peace and happiness. (‰ªñÂÄëËøΩÊ±ÇÂíåÂπ≥ËàáÂπ∏Á¶è„ÄÇ)"},
{"word": "authentic (adj) (ÈÅìÂú∞ÁöÑ„ÄÅÁúüÂØ¶ÁöÑ):", "example": "We tried authentic Japanese cuisine. (ÊàëÂÄëÂìÅÂöê‰∫ÜÈÅìÂú∞ÁöÑÊó•Êú¨ÊñôÁêÜ„ÄÇ)"},
{"word": "those who‚Ä¶ (phr.) (‚Ä¶ÁöÑ‰∫∫):", "example": "Those who love history will enjoy Kyoto. (ÂñúÊ≠°Ê≠∑Âè≤ÁöÑ‰∫∫ÊúÉÂñúÊ≠°‰∫¨ÈÉΩ„ÄÇ)"},
{"word": "be likely to‚Ä¶ (phr.) (ÂèØËÉΩÊúÉ‚Ä¶):", "example": "It‚Äôs likely to rain tomorrow. (ÊòéÂ§©ÂèØËÉΩÊúÉ‰∏ãÈõ®„ÄÇ)"},
{"word": "end up (+ V-ing) (phr.) (ÊúÄÁµÇ‚Ä¶):", "example": "We ended up staying longer than planned. (ÊàëÂÄëÊúÄÂæåÂæÖÂæóÊØîÈ†êÊúü‰πÖ„ÄÇ)"},
{"word": "fall in love with‚Ä¶ (phr.) (ÊÑõ‰∏ä‚Ä¶):", "example": "You‚Äôll fall in love with the city‚Äôs beauty. (‰Ω†ÊúÉÊÑõ‰∏äÈÄôÂ∫ßÂüéÂ∏ÇÁöÑÁæé„ÄÇ)"}
]
}

],
            'textbook3': [
  

],
            'maga1': [

  
],
            'maga2': [

 
],
            'maga3': [

 ],
            'maga4': [
  
],
            'core1': [


],
            'core2': [


],
            'core3': [

]

        }; // End of database

        // Partner configurations
        const partners = {
            1: { image: 'partner1.jpg', name: 'Shawn Mendes' },
            2: { image: 'partner2.jpg', name: 'Taylor Swift' },
            3: { image: 'partner3.jpg', name: 'Ros√©' },
            4: { image: 'partner4.jpg', name: 'Ï†ÑÏõêÏö∞' },
            5: { image: 'partner5.jpg', name: 'Í∞ïÌÉúÌòÑ' },
            6: { image: 'partner6.jpg', name: 'IU' },
            7: { image: 'partner7.jpg', name: 'Asa' },
            8: { image: 'partner8.jpg', name: 'ÈáëÂüéÊ≠¶' },
            9: { image: 'partner9.jpg', name: '‰ΩêËó§ ÂÅ•' },
            10: { image: 'partner10.jpg', name: 'ÂàùÈü≥„Éü„ÇØ' }
        };

        // Global state
        let currentLessonData = null;
        let currentPartner = null;
        let currentWordIndex = 0;
        let flatWordsList = [];
        let currentSpeech = null;
        let speechRate = 1.0;
        let voices = [];
        let isCompleted = false;
        let checkedSections = new Set();

        // Quiz state
        let quizWords = [];
        let currentQuizIndex = 0;
        let quizScore = 0;
        let hasAnswered = false;
        let correctAnswer = null;

        // Load voices
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            if (!voices.length) {
                const dummy = new SpeechSynthesisUtterance('');
                speechSynthesis.speak(dummy);
                voices = speechSynthesis.getVoices();
            }
        }

        // Get English voice
        function getEnglishVoice() {
            if (!voices.length) loadVoices();
            let voice = voices.find(v => v.name.includes('Samantha')) || 
                       voices.find(v => v.lang === 'en-US');
            return voice || null;
        }

        // Clean text for TTS
        function cleanTextForTTS(text) {
            return text.replace(/\*/g, '')
                      .replace(/\//g, '')
                      .replace(/\([^)]*\)/g, '')
                      .replace(/\[[^\]]*\]/g, '')
                      .replace(/\s+/g, ' ')
                      .trim();
        }

        // Speak text
        function speakText(text) {
            stopSpeech();
            const cleaned = cleanTextForTTS(text);
            if (!cleaned) return;

            const utterance = new SpeechSynthesisUtterance(cleaned);
            utterance.lang = 'en-US';
            utterance.rate = speechRate;

            const voice = getEnglishVoice();
            if (voice) utterance.voice = voice;

            utterance.onend = () => {
                currentSpeech = null;
            };

            currentSpeech = utterance;
            speechSynthesis.speak(utterance);
        }

        // Stop speech
        function stopSpeech() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            currentSpeech = null;
        }

        // Load vocabulary with checkboxes
        function loadVocabulary(lessonKey) {
            const tableBody = document.getElementById('vocabTableBody');
            const data = vocabDatabase[lessonKey];

            if (!data || data.length === 0) {
                tableBody.innerHTML = '<tr class="no-data"><td colspan="2">No data available. Please wait for updates. (Êö´ÁÑ°Ë≥áÊñôÔºåË´ãÁ≠âÂæÖÊõ¥Êñ∞)</td></tr>';
                return;
            }

            // Clear checked sections when loading new lesson
            checkedSections.clear();

            let html = '';
data.forEach((section, sectionIndex) => {
                html += `<tr>
                    <td colspan="2" class="section-header">${section.section}</td>
                </tr>`;
                
                section.words.forEach(item => {
                    const fullText = `${item.word}. ${item.example}`;
                    html += `<tr class="vocab-row">
                        <td class="audio-controls">
                            <button class="audio-btn play-btn" onclick="speakText('${fullText.replace(/'/g, "\\'")}')">üîä</button>
                            <button class="audio-btn stop-btn" onclick="stopSpeech()">‚èπ</button>
                        </td>
                        <td class="content-cell">
                            <div class="vocab-word">${item.word}</div>
                            <div class="example-sentence">${item.example}</div>
                        </td>
                    </tr>`;
                });
            });

tableBody.innerHTML = html;

            // Show section selector and populate it
            showSectionSelector(data, lessonKey);
        }

        // Flatten lesson data
        function flattenLessonData(lessonData) {
            const flattened = [];
            lessonData.forEach((section, sectionIndex) => {
                section.words.forEach((word, wordIndex) => {
                    flattened.push({
                        ...word,
                        sectionIndex,
                        sectionTitle: section.section,
                        wordIndex
                    });
                });
            });
            return flattened;
        }

// Show and populate section selector
        function showSectionSelector(lessonData, lessonKey) {
            const selectorArea = document.getElementById('sectionSelectorArea');
            const grid = document.getElementById('sectionCheckboxesGrid');
            
            grid.innerHTML = '';
            
            lessonData.forEach((section, sectionIndex) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'section-checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `section_${lessonKey}_${sectionIndex}`;
                checkbox.checked = checkedSections.has(sectionIndex);
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        checkedSections.add(sectionIndex);
                    } else {
                        checkedSections.delete(sectionIndex);
                    }
                });
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = section.section;
                
                itemDiv.appendChild(checkbox);
                itemDiv.appendChild(label);
                grid.appendChild(itemDiv);
            });
            
            selectorArea.style.display = 'block';
        }

        // Get words from checked sections only
        function getWordsFromCheckedSections(lessonData) {
            const allWords = [];
            lessonData.forEach((section, sectionIndex) => {
                if (checkedSections.has(sectionIndex)) {
                    section.words.forEach((word, wordIndex) => {
                        allWords.push({
                            ...word,
                            sectionIndex,
                            sectionTitle: section.section,
                            wordIndex
                        });
                    });
                }
            });
            return allWords;
        }

        // ============ LISTEN AND CHOOSE QUIZ FUNCTIONS ============

        // Extract Chinese translation from word
        function extractChineseTranslation(wordString) {
            const match = wordString.match(/\(([^)]+)\):/);
            return match ? match[1] : wordString;
        }

        // Extract English word/phrase only
        function extractEnglishWord(wordString) {
            const match = wordString.match(/^(.+?)\s*\([^)]+\):/);
            return match ? match[1].trim() : wordString.split('(')[0].trim();
        }

        // Extract example sentence without Chinese translation
        function extractExampleOnly(exampleString) {
            return exampleString.split('(')[0].trim();
        }

// Start quiz
        function startListenChooseQuiz() {
            const selectedLesson = document.querySelector('.vocab-btn.active')?.getAttribute('data-lesson');
            
            if (!selectedLesson || !vocabDatabase[selectedLesson] || vocabDatabase[selectedLesson].length === 0) {
                alert('Please select a lesson with vocabulary data first! (Ë´ãÂÖàÈÅ∏Êìá‰∏ÄÂÄãÂ∑≤ÂåØÂÖ•ÊïôÊùêÂÖßÂÆπÁöÑÂñÆÂÖÉ)');
                return;
            }

            // Get words from checked sections only
            const lessonData = vocabDatabase[selectedLesson];
            const allWords = getWordsFromCheckedSections(lessonData);
            
            if (allWords.length < 8) {
                alert('Please select sections with at least 8 words for the quiz. (Ë´ãÂãæÈÅ∏Ëá≥Â∞ëÂåÖÂê´8ÂÄãÂñÆÂ≠óÁöÑÂçÄÊÆµ)');
                return;
            }

            // Select 8 random words
            quizWords = shuffleArray([...allWords]).slice(0, 8);
            currentQuizIndex = 0;
            quizScore = 0;

            // Open modal and load first question
            document.getElementById('listenChooseModal').style.display = 'block';
            loadQuizQuestion();
        }

        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Load quiz question
        function loadQuizQuestion() {
            if (currentQuizIndex >= quizWords.length) {
                showQuizComplete();
                return;
            }

            hasAnswered = false;
            correctAnswer = quizWords[currentQuizIndex];

            // Reset UI
            document.getElementById('listenAnswerDisplay').textContent = 'Click the speaker to hear';
            document.getElementById('timerFeedback').textContent = '';
            document.getElementById('timerFeedback').className = 'timer-feedback';
            document.getElementById('listenNextBtn').disabled = true;
            document.getElementById('listenNextBtn').style.display = 'inline-block';

            // Generate all 8 choices (include all quiz words)
            displayChoices(shuffleArray([...quizWords]));
        }

        // Display choices - show only Chinese translation
        function displayChoices(choices) {
            const grid = document.getElementById('choicesGrid');
            grid.innerHTML = '';

            choices.forEach((choice) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = extractChineseTranslation(choice.word);
                btn.onclick = () => handleChoiceClick(choice, btn);
                grid.appendChild(btn);
            });
        }

        // Handle choice click
        function handleChoiceClick(selectedChoice, btn) {
            if (hasAnswered) return;

            hasAnswered = true;
            const allChoices = document.querySelectorAll('.choice-btn');
            const correctChinese = extractChineseTranslation(correctAnswer.word);
            
            if (extractChineseTranslation(selectedChoice.word) === correctChinese) {
                // Correct answer
                btn.classList.add('correct');
                document.getElementById('timerFeedback').textContent = '‚úì Correct!';
                document.getElementById('timerFeedback').className = 'timer-feedback correct';
                quizScore++;
            } else {
                // Wrong answer
                btn.classList.add('incorrect');
                document.getElementById('timerFeedback').textContent = '‚úó Wrong! Correct: ' + correctChinese;
                document.getElementById('timerFeedback').className = 'timer-feedback incorrect';
                
                // Highlight correct answer
                allChoices.forEach(choiceBtn => {
                    if (choiceBtn.textContent === correctChinese) {
                        choiceBtn.classList.add('correct');
                    }
                });
            }

            // Disable all buttons
            allChoices.forEach(choiceBtn => {
                choiceBtn.disabled = true;
            });

            // Show English word/phrase and example (without Chinese)
            const englishWord = extractEnglishWord(correctAnswer.word);
            const exampleOnly = extractExampleOnly(correctAnswer.example);
            document.getElementById('listenAnswerDisplay').innerHTML = 
                `<strong>${englishWord}</strong><br><span style="font-size: 14px;">${exampleOnly}</span>`;

            // Enable next button
            document.getElementById('listenNextBtn').disabled = false;
        }

        // Play quiz audio - play English word and example only
        function playQuizAudio() {
            if (correctAnswer) {
                const englishWord = extractEnglishWord(correctAnswer.word);
                const exampleOnly = extractExampleOnly(correctAnswer.example);
                const fullText = `${englishWord}. ${exampleOnly}`;
                speakText(fullText);
            }
        }

        // Next quiz question
        function nextQuizQuestion() {
            currentQuizIndex++;
            loadQuizQuestion();
        }

        // Show quiz complete
        function showQuizComplete() {
            const grid = document.getElementById('choicesGrid');
            const percentage = Math.round((quizScore / quizWords.length) * 100);
            
            grid.innerHTML = `
                <div class="quiz-complete">
                    <h3>üéâ Quiz Complete!</h3>
                    <div class="quiz-score">
                        Your Score: ${quizScore} / ${quizWords.length} (${percentage}%)
                    </div>
                    <button class="restart-quiz-btn" onclick="restartQuiz()">Try Again</button>
                </div>
            `;

            document.getElementById('listenAnswerDisplay').textContent = 'Great job!';
            document.getElementById('timerFeedback').textContent = '';
            document.getElementById('listenNextBtn').style.display = 'none';
        }

        // Restart quiz
        function restartQuiz() {
            document.getElementById('listenNextBtn').style.display = 'inline-block';
            startListenChooseQuiz();
        }

        // Close quiz modal
        function closeQuizModal() {
            document.getElementById('listenChooseModal').style.display = 'none';
            stopSpeech();
        }

        // ============ STUDY SESSION FUNCTIONS ============

        function updateStudySession() {
            if (!currentLessonData || !flatWordsList.length) {
                document.getElementById('currentWord').textContent = 'Select a lesson first!';
                document.getElementById('currentExample').textContent = 'Please choose a lesson from the main page before starting your study session.';
                document.getElementById('progressInfo').textContent = 'Ready to start!';
                return;
            }

            if (isCompleted) {
                restoreNormalInterface();
            }

            const currentItem = flatWordsList[currentWordIndex];
            if (!currentItem) return;

            document.getElementById('currentWord').textContent = currentItem.word;
            document.getElementById('currentExample').textContent = currentItem.example;

            const totalWords = flatWordsList.length;
            const progressText = `Word ${currentWordIndex + 1} of ${totalWords} ‚Ä¢ ${currentItem.sectionTitle}`;
            document.getElementById('progressInfo').textContent = progressText;

            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const backBtn = document.getElementById('backBtn');
            const nextBtn = document.getElementById('nextBtn');
            const nextSectionBtn = document.getElementById('nextSectionBtn');

            if (!flatWordsList.length) return;

            const totalWords = flatWordsList.length;
            const currentItem = flatWordsList[currentWordIndex];

            backBtn.disabled = currentWordIndex === 0;
            nextBtn.disabled = currentWordIndex === totalWords - 1;

            const isLastSection = currentItem && currentItem.sectionIndex === Math.max(...flatWordsList.map(item => item.sectionIndex));
            nextSectionBtn.disabled = isLastSection;
        }

        function restoreNormalInterface() {
            const speechBubble = document.getElementById('speechBubble');
            const currentItem = flatWordsList[currentWordIndex];

            if (currentItem) {
                speechBubble.innerHTML = `<div class="current-word" id="currentWord">${currentItem.word}</div>
                    <div class="current-example" id="currentExample">${currentItem.example}</div>
                    <div class="bubble-controls">
                        <button class="bubble-btn play-btn" id="speakCurrentBtn">üîä</button>
                        <button class="bubble-btn stop-btn" id="stopCurrentBtn">‚èπ</button>
                    </div>`;

                attachBubbleEventListeners();
            }

            isCompleted = false;
        }

        function attachBubbleEventListeners() {
            const speakBtn = document.getElementById('speakCurrentBtn');
            const stopBtn = document.getElementById('stopCurrentBtn');

            if (speakBtn) {
                speakBtn.addEventListener('click', handleSpeakCurrent);
            }
            if (stopBtn) {
                stopBtn.addEventListener('click', stopSpeech);
            }
        }

        function handleSpeakCurrent() {
            const currentItem = flatWordsList[currentWordIndex];
            if (currentItem) {
                const fullText = `${currentItem.word}. ${currentItem.example}`;
                speakText(fullText);
            }
        }

        function showCongratulations() {
            const partnerName = partners[currentPartner].name;
            const message = `Fantastic work! You've completed the entire vocabulary list! ${partnerName} is so proud of you!`;

            const speechBubble = document.getElementById('speechBubble');
            speechBubble.innerHTML = `<div class="congratulations">
                    <h3>Congratulations!</h3>
                    <p>${message}</p>
                </div>
                <div class="bubble-controls">
                    <button class="bubble-btn play-btn" id="congratsPlayBtn">üîä</button>
                    <button class="bubble-btn stop-btn" id="congratsStopBtn">‚èπ</button>
                    <button class="bubble-btn learn-again-btn" id="learnAgainBtn">üîÑ Learn Again</button>
                </div>`;

            document.getElementById('congratsPlayBtn').addEventListener('click', () => speakText(message));
            document.getElementById('congratsStopBtn').addEventListener('click', stopSpeech);
            document.getElementById('learnAgainBtn').addEventListener('click', restartLesson);

            setTimeout(() => speakText(message), 500);

            document.getElementById('progressInfo').textContent = 'Lesson Complete!';
            isCompleted = true;
            updateNavigationButtons();
        }

        function checkCompletion() {
            if (currentWordIndex >= flatWordsList.length && !isCompleted) {
                showCongratulations();
                currentWordIndex = flatWordsList.length - 1;
            }
        }

        function nextWord() {
            if (currentWordIndex < flatWordsList.length - 1) {
                currentWordIndex++;
                updateStudySession();
            } else if (currentWordIndex === flatWordsList.length - 1) {
                currentWordIndex++;
                checkCompletion();
            }
        }

        function previousWord() {
            if (currentWordIndex > 0) {
                currentWordIndex--;
                if (isCompleted) {
                    isCompleted = false;
                }
                updateStudySession();
            }
        }

        function nextSection() {
            const currentSectionIndex = flatWordsList[currentWordIndex].sectionIndex;
            const nextSectionFirstWord = flatWordsList.find(item => item.sectionIndex > currentSectionIndex);
            
            if (nextSectionFirstWord) {
                currentWordIndex = flatWordsList.indexOf(nextSectionFirstWord);
                updateStudySession();
                checkCompletion();
            }
        }

        function restartLesson() {
            currentWordIndex = 0;
            isCompleted = false;
            updateStudySession();
        }

        function startStudySession(partnerNumber) {
            const selectedLesson = document.querySelector('.vocab-btn.active')?.getAttribute('data-lesson');
            
            if (!selectedLesson || !vocabDatabase[selectedLesson] || vocabDatabase[selectedLesson].length === 0) {
                alert('Please select a lesson with vocabulary data first! (Ë´ãÂÖàÈÅ∏Êìá‰∏ÄÂÄãÂ∑≤ÂåØÂÖ•ÊïôÊùêÂÖßÂÆπÁöÑÂñÆÂÖÉ)');
                return;
            }

            currentPartner = partnerNumber;
            currentLessonData = vocabDatabase[selectedLesson];
            flatWordsList = flattenLessonData(currentLessonData);
            currentWordIndex = 0;
            isCompleted = false;

            const partnerInfo = partners[partnerNumber];
            const avatarElement = document.getElementById('currentPartnerAvatar');
            avatarElement.innerHTML = `<img src="${partnerInfo.image}" alt="partner ${partnerNumber}">`;

            document.getElementById('partnerModal').style.display = 'none';
            document.getElementById('studyModal').style.display = 'block';

            updateStudySession();
        }

        // ============ INITIALIZE EVENT LISTENERS ============

        function initializeEventListeners() {
            document.body.addEventListener('click', () => loadVoices(), { once: true });

            // Lesson buttons
            const lessonButtons = document.querySelectorAll('.vocab-btn');
            lessonButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    lessonButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const lessonKey = this.getAttribute('data-lesson');
                    loadVocabulary(lessonKey);
                });
            });

            // Speed buttons
            const speedButtons = document.querySelectorAll('.speed-btn');
            speedButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    speedButtons.forEach(b => b.classList.remove('active-speed'));
                    this.classList.add('active-speed');
                    speechRate = parseFloat(this.getAttribute('data-speed'));
                    stopSpeech();
                });
            });

            // Listen and Choose Quiz button
            document.getElementById('listenChooseBtn').addEventListener('click', startListenChooseQuiz);
            document.getElementById('listenSpeaker').addEventListener('click', playQuizAudio);
            document.getElementById('listenNextBtn').addEventListener('click', nextQuizQuestion);
            document.getElementById('listenCloseBtn').addEventListener('click', closeQuizModal);
            document.getElementById('closeListenChoose').addEventListener('click', closeQuizModal);

            // Partner modal
            const choosePartnerBtn = document.getElementById('choosePartnerBtn');
            const partnerModal = document.getElementById('partnerModal');
            const studyModal = document.getElementById('studyModal');

            choosePartnerBtn.addEventListener('click', () => {
                partnerModal.style.display = 'block';
            });

            document.getElementById('closePartnerModal').addEventListener('click', () => {
                partnerModal.style.display = 'none';
            });

            document.getElementById('closeStudyModal').addEventListener('click', () => {
                studyModal.style.display = 'none';
                stopSpeech();
            });

            const selectPartnerBtns = document.querySelectorAll('.select-partner-btn');
            selectPartnerBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const partnerNumber = parseInt(this.getAttribute('data-partner'));
                    startStudySession(partnerNumber);
                });
            });

            // Navigation buttons
            document.getElementById('nextBtn').addEventListener('click', nextWord);
            document.getElementById('backBtn').addEventListener('click', previousWord);
            document.getElementById('nextSectionBtn').addEventListener('click', nextSection);

            attachBubbleEventListeners();

            // Welcome modal
            document.getElementById('welcomeOkBtn').addEventListener('click', () => {
                document.getElementById('welcomeModal').style.display = 'none';
            });

            // Click outside modal to close
            window.addEventListener('click', (e) => {
                if (e.target === partnerModal) {
                    partnerModal.style.display = 'none';
                }
                if (e.target === studyModal) {
                    studyModal.style.display = 'none';
                    stopSpeech();
                }
                if (e.target === document.getElementById('listenChooseModal')) {
                    closeQuizModal();
                }
            });

            window.addEventListener('beforeunload', () => stopSpeech());
        }

        document.addEventListener('DOMContentLoaded', initializeEventListeners);
    </script>
</body>
</html>
