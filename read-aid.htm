<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Read Aid</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 2.5em;
        }

        .button-categories {
            margin-bottom: 30px;
        }

        .category {
            margin-bottom: 25px;
        }

        .category-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            display: inline-block;
        }

        .category-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .lesson-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .lesson-btn:hover {
            background-color: #2980b9;
        }

        .lesson-btn.active {
            background-color: #e74c3c;
        }

        .speed-control-section {
            margin: 30px 0;
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }

        .speed-label {
            font-weight: bold;
            color: #495057;
            margin-right: 15px;
            font-size: 16px;
        }

        .speed-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .speed-btn:hover {
            background-color: #5a6268;
        }

        .speed-btn.active-speed {
            background-color: #28a745;
        }

        .text-table-container {
            margin-top: 30px;
            overflow-x: auto;
        }

        .text-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
        }

        .section-header {
            background-color: #ecf0f1;
            font-weight: bold;
            padding: 15px;
            text-align: left;
            font-size: 1.5em;
            color: #2c3e50;
        }

        .text-row {
            border-bottom: 1px solid #ddd;
        }

        .audio-controls {
            width: 80px;
            text-align: center;
            padding: 15px 10px;
            vertical-align: top;
        }

        .content-cell {
            padding: 15px;
            vertical-align: top;
        }

        .english-text {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .chinese-translation {
            font-size: 1.5em;
            color: #555;
            line-height: 1.5;
        }

        .audio-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            margin: 2px;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
            display: block;
            width: 100%;
        }

        .audio-btn:hover {
            background-color: #f0f0f0;
        }

        .play-btn {
            color: #27ae60;
        }

        .stop-btn {
            color: #e74c3c;
        }

        .easy-btn {
            color: #f39c12;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: red;
            font-size: 25px;
        }

        /* Easy Version Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            position: relative;
        }

        .close {
            color: #aaa;
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
        }

        .close:hover {
            color: #000;
        }

        .easy-version-content {
            margin-top: 20px;
        }

        .easy-version-text {
            font-size: 1.8em;
            color: #2c3e50;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .easy-audio-controls {
            text-align: center;
            margin-top: 20px;
        }

        .easy-audio-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            margin: 0 10px;
            transition: background-color 0.3s;
        }

        .easy-audio-btn:hover {
            background-color: #2980b9;
        }

        .easy-audio-btn.stop {
            background-color: #e74c3c;
        }

        .easy-audio-btn.stop:hover {
            background-color: #c0392b;
        }

        /* Welcome Notice Modal */
        #welcomeModal .modal-content {
            max-width: 500px;
        }

        /* Floating Navigation Buttons */
        .floating-nav-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .floating-nav-btn {
            width: 60px;
            height: 60px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            transition: all 0.3s;
        }

        .floating-nav-btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .floating-nav-btn.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .next-section-btn {
            background-color: #27ae60;
        }

        .next-section-btn:hover {
            background-color: #229954;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }

            .category-title {
                font-size: 1.2em;
            }

            .lesson-btn {
                padding: 10px 15px;
                font-size: 13px;
            }

            .speed-control-section {
                padding: 10px;
            }

            .speed-label {
                display: block;
                margin-bottom: 10px;
                margin-right: 0;
            }

            .speed-btn {
                padding: 8px 12px;
                font-size: 13px;
                margin: 2px;
            }

            .section-header {
                font-size: 1.2em;
                padding: 12px;
            }

            .audio-controls {
                width: 60px;
                padding: 10px 5px;
            }

            .content-cell {
                padding: 12px;
            }

            .english-text {
                font-size: 1.5em;
            }

            .chinese-translation {
                font-size: 1.5em;
            }

            .modal-content {
                width: 95%;
                margin: 20px auto;
                padding: 20px;
            }

            .easy-version-text {
                font-size: 1.5em;
            }

            .floating-nav-buttons {
                bottom: 20px;
                right: 20px;
                gap: 8px;
            }
            
            .floating-nav-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating Navigation Buttons -->
    <div class="floating-nav-buttons">
        <button class="floating-nav-btn" id="backToTopBtn" title="Back to lesson buttons">üîù</button>
        <button class="floating-nav-btn next-section-btn" id="nextSectionBtn" title="Next section">‚¨áÔ∏è</button>
    </div>
    
    <div class="container">
        <h1>Read Aid (Âª∫Êßã‰∏≠1127)</h1>

        <div class="button-categories">
            <div class="category">
                <div class="category-title">Textbook: Book 3 (Ë™≤Êú¨Á¨¨‰∏âÂÜä)</div>
                <div class="category-buttons">
                    <button class="lesson-btn" data-lesson="text1">B3 L7 Ë™≤Êñá</button>
                    <button class="lesson-btn" data-lesson="text2">B3 L8 Ë™≤Êñá</button>
                    <button class="lesson-btn" data-lesson="text3">B3 L9 Ë™≤Êñá</button>
                </div>
            </div>

            <div class="category">
                <div class="category-title">Magazine: All+ December 2026</div>
                <div class="category-buttons">
                    <button class="lesson-btn" data-lesson="maga1">U2 Baseball</button>
                    <button class="lesson-btn" data-lesson="maga2">U4 Ban</button>
                    <button class="lesson-btn" data-lesson="maga3">U5 Viruses</button>
                    <button class="lesson-btn" data-lesson="maga4">U14 Study Approaches</button>
                </div>
            </div>

            <div class="category">
                <div class="category-title">Ê†∏ÂøÉÂ≠óÂΩô</div>
                <div class="category-buttons">
                    <button class="lesson-btn" data-lesson="core1">U7 Ballpoint Pen</button>
                    <button class="lesson-btn" data-lesson="core2">U8 Pancakes</button>
                    <button class="lesson-btn" data-lesson="core3">U9 Homeless</button>
                </div>
            </div>
        </div>

        <!-- Speed Control -->
        <div class="speed-control-section">
            <span class="speed-label">Speed (Ë™ûÈÄü):</span>
            <button class="speed-btn" data-speed="1.2">1.2x</button>
            <button class="speed-btn active-speed" data-speed="1.0">1x</button>
            <button class="speed-btn" data-speed="0.8">0.8x</button>
            <button class="speed-btn" data-speed="0.6">0.6x</button>
        </div>

        <!-- Table -->
        <div class="text-table-container">
            <table class="text-table" id="textTable">
                <tbody id="textTableBody">
                    <tr class="no-data">
                        <td colspan="2">Select a lesson to load content <br>(ÈÅ∏ÊìáÂñÆÂÖÉ‰ª•ËºâÂÖ•ÂÖßÂÆπ)</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Welcome Notice Modal -->
    <div id="welcomeModal" class="modal" style="display: block;">
        <div class="modal-content">
            <div style="text-align: center; padding: 10px;">
                <h2 style="color: #2c3e50; margin-bottom: 20px;">üì¢ Welcome to Read Aid</h2>
                <div style="text-align: left; font-size: 16px; line-height: 1.8; margin-bottom: 25px;">
                    <p style="margin-bottom: 15px;">This tool helps you improve reading and listening comprehension.</p>
                    <p style="margin-bottom: 15px;">Features:</p>
                    <ul style="margin-left: 20px;">
                        <li>Listen to English text with natural speech</li>
                        <li>See Chinese translations</li>
                        <li>Access simplified versions (üòä icon)</li>
                        <li>Adjust playback speed</li>
                    </ul>
                </div>
                <button id="welcomeOkBtn" style="background-color: #28a745; color: white; border: none; padding: 12px 40px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold;">
                    Get Started
                </button>
            </div>
        </div>
    </div>

    <!-- Easy Version Modal -->
    <div id="easyModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeEasyModal">&times;</span>
            <h2 style="color: #2c3e50; margin-bottom: 20px;">üòä Easy Version</h2>
            <div class="easy-version-content">
                <div class="easy-version-text" id="easyVersionText"></div>
                <div class="easy-audio-controls">
                    <button class="easy-audio-btn" id="playEasyBtn">üîä Play</button>
                    <button class="easy-audio-btn stop" id="stopEasyBtn" style="background-color: #e74c3c;">‚èπ Stop</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simplified text database - raw format
        const textDatabaseRaw = {
            'text1': `
‚óéParagraph 1
The theory that spoken words account for only about seven percent of communication involving emotions may surprise many people. This was first proposed by Dr. Albert Mehrabian, a famous psychology professor. ^Âè£Ë™ûÂú®ÊÉÖÁ∑íÊ∫ùÈÄö‰∏≠Âè™‰ΩîÁ¥ÑÁôæÂàÜ‰πã‰∏ÉÁöÑÁêÜË´ñÔºåÂèØËÉΩÊúÉËÆìË®±Â§ö‰∫∫ÊÑüÂà∞È©öË®ù„ÄÇÈÄôÊòØÁî±ËëóÂêçÁöÑÂøÉÁêÜÂ≠∏ÊïôÊéàËâæ‰ºØÁâπ„ÉªÊ¢ÖÂìàÊØîÂÆâÂçöÂ£´È¶ñÂÖàÊèêÂá∫ÁöÑ„ÄÇ^The idea that spoken words are only about seven percent of emotional communication may surprise people. A well-known psychology professor, Dr. Albert Mehrabian, first suggested this.

According to his studies, we achieve about 55% of our emotional communication with our bodies, for they typically demonstrate our true feelings and what we‚Äôre actually thinking. Therefore, understanding people‚Äôs body language is an important ability to help us better interpret others‚Äô messages. ^ Ê†πÊìö‰ªñÁöÑÁ†îÁ©∂ÔºåÊàëÂÄëÂ§ßÁ¥ÑÊúâÁôæÂàÜ‰πã‰∫îÂçÅ‰∫îÁöÑÊÉÖÁ∑íÊ∫ùÈÄöÊòØÈÄèÈÅéË∫´È´îÈÄ≤Ë°åÁöÑÔºåÂõ†ÁÇ∫Ë∫´È´îÈÄöÂ∏∏ÊúÉÂ±ïÁèæÊàëÂÄëÁúüÊ≠£ÁöÑÊÑüÂèóËàáÊÉ≥Ê≥ï„ÄÇÂõ†Ê≠§Ôºå‰∫ÜËß£‰ªñ‰∫∫ÁöÑËÇ¢È´îË™ûË®ÄÊòØÂπ´Âä©ÊàëÂÄëÊõ¥Ê∫ñÁ¢∫Ëß£ËÆÄË®äÊÅØÁöÑÈáçË¶ÅËÉΩÂäõ„ÄÇ^His research says about 55% of emotional communication comes from our body because it shows our real feelings. So understanding body language helps us know what others really mean.
‚óéParagraph 2
Being able to read body language well is helpful in determining whether or not someone is telling the truth. When people are lying, there are usually three telltale signs: making stiff body movements, touching or scratching themselves, and making eye movements. ^ ËÉΩÂ§†ËÆÄÊáÇËÇ¢È´îË™ûË®ÄÊúâÂä©ÊñºÂà§Êñ∑‰∏ÄÂÄã‰∫∫ÊòØÂê¶Âú®Ë™™ÁúüË©±„ÄÇÁï∂‰∫∫Ë™™Ë¨äÊôÇÔºåÈÄöÂ∏∏ÊúÉÊúâ‰∏âÂÄãÊòéÈ°ØÁâπÂæµÔºöÂãï‰ΩúÂÉµÁ°¨„ÄÅËß∏Á¢∞ÊàñÊêîÊäìËá™Â∑±Ôºå‰ª•ÂèäÁúºÁùõÁöÑÁï∞Â∏∏Âãï‰Ωú„ÄÇ^ Reading body language helps us know if someone is telling the truth. When people lie, they often show three signs: stiff movements, touching themselves, and unusual eye movements.

Typically, liars exhibit fewer arm and hand gestures. When they do make such gestures, their movements are usually stiff, and their hands tend to stay close to the body rather than move in an outward direction. Moreover, liars often can‚Äôt help but touch or scratch their faces, their necks, or behind their ears. They sometimes rub their eyes without being conscious of it as well. ^ ÈÄöÂ∏∏ÔºåË™™Ë¨äËÄÖÊúÉÊ∏õÂ∞ëÊâãËáÇÂíåÊâãÁöÑÂãï‰Ωú„ÄÇÂç≥‰ΩøÊúâÂãï‰ΩúÔºå‰ªñÂÄëÁöÑÂãï‰ΩúÈÄöÂ∏∏ÂæàÂÉµÁ°¨ÔºåÊâã‰πüÊúÉÈù†ËøëË∫´È´îÔºåËÄå‰∏çÊòØÂêëÂ§ñÊì∫Âãï„ÄÇÊ≠§Â§ñÔºåË™™Ë¨äËÄÖÂ∏∏ÊúÉÂøç‰∏ç‰ΩèËß∏Á¢∞ÊàñÊêîÊäìËáâÈÉ®„ÄÅËÑñÂ≠êÊàñËÄ≥Âæå„ÄÇ‰ªñÂÄëÊúâÊôÇ‰πüÊúÉ‰∏çËá™Ë¶∫Âú∞ÊèâÁúºÁùõ„ÄÇ^ Liars usually move their arms and hands less. If they do move, their movements are stiff and their hands stay close to their body. Liars also often touch or scratch their face, neck, or behind their ears. They sometimes rub their eyes without noticing.

Whether people are telling falsehoods or not can also be detected by observing how their eyes move as they speak. When right-handed people say true things, their eyes move to their left. In contrast, when they are lying or being ‚Äúcreative‚Äù with the truth, their eyes tend to drift toward their right. The reverse is true for left-handed people. ^ ÈÄèÈÅéËßÄÂØü‰∫∫ÂÄëË™™Ë©±ÊôÇÁúºÁùõÁöÑÁßªÂãïÔºå‰πüËÉΩÂà§Êñ∑‰ªñÂÄëÊòØÂê¶Ë™™Ë¨ä„ÄÇÂè≥ÊíáÂ≠êË™™ÁúüË©±ÊôÇÔºå‰ªñÂÄëÁöÑÁúºÁùõÊúÉÂæÄÂ∑¶Áßª„ÄÇÁõ∏ÂèçÂú∞ÔºåÁï∂‰ªñÂÄëË™™Ë¨äÊàñ„ÄåÂä†Â∑•„Äç‰∫ãÂØ¶ÊôÇÔºåÁúºÁùõÂâáÊúÉÂæÄÂè≥ÂÅè„ÄÇÂ∑¶ÊíáÂ≠êÁöÑÊÉÖÊ≥ÅÂâáÁõ∏Âèç„ÄÇ^ You can also tell if someone lies by watching their eye movements. When right-handed people tell the truth, their eyes move left. When they lie, their eyes usually move to the right. For left-handed people, it is the opposite.
‚óéParagraph 3
Another significant type of telling body language is connected to love. In the case of romantic feelings, people‚Äôs bodies subconsciously provide an indication for someone to whom they are attracted. ^ Âè¶‰∏ÄÁ®ÆÈáçË¶Å‰∏îÂÖ∑ÊúâÊåáÊ®ôÊÄßÁöÑËÇ¢È´îË™ûË®ÄËàáÊÑõÊÉÖÊúâÈóú„ÄÇÁï∂‰∫∫Áî¢ÁîüÊµ™Êº´ÊÉÖÊÑ´ÊôÇÔºå‰ªñÂÄëÁöÑË∫´È´îÊúÉ‰∏ãÊÑèË≠òÂú∞ÂêëÂøÉÂÑÄÁöÑÂ∞çË±°ÂÇ≥ÈÅîË®äËôü„ÄÇ^ Another important kind of body language is related to love. When someone likes another person, their body gives signals without them knowing.

Under the circumstances, their eyes do most of the ‚Äútalking.‚Äù Initially, they may glance at a person from a distance and for just slightly longer than normal. Afterward, they may look away and finally rest their eyes on him or her again for an even longer period. ^ Âú®ÈÄôÁ®ÆÊÉÖÊ≥Å‰∏ãÔºå‰ªñÂÄëÁöÑÁúºÁùõË≤†Ë≤¨Â§ßÈÉ®ÂàÜÁöÑ„ÄåÂ∞çË©±„Äç„ÄÇ‰∏ÄÈñãÂßãÔºå‰ªñÂÄëÂèØËÉΩÊúÉÂæûÈÅ†ËôïÁúãÂ∞çÊñπ‰∏ÄÁúºÔºå‰∏¶‰∏îÊØîÂπ≥Â∏∏Â§öÂÅúÁïô‰∏ÄÈªûÊôÇÈñì„ÄÇÊé•ËëóÔºå‰ªñÂÄëÂèØËÉΩÊúÉËΩâÈñãË¶ñÁ∑öÔºå‰πãÂæåÂèàÂÜçÂ∫¶ÁúãÂêëÂ∞çÊñπÔºå‰∏îÂÅúÁïôÊõ¥‰πÖ„ÄÇ^In this situation, their eyes send most of the signals. First, they may look at the person from far away for a little longer than usual. Then they look away and later look back again for even longer.

Furthermore, they automatically track or repeat his or her actions without even knowing it. If he or she sits back, they will follow suit. If that person takes a sip of water, they will probably do the same. ^ Ê≠§Â§ñÔºå‰ªñÂÄëÊúÉ‰∏çËá™Ë¶∫Âú∞Ë∑üÈö®ÊàñÊ®°‰ªøÂ∞çÊñπÁöÑÂãï‰Ωú„ÄÇÂ¶ÇÊûúÂ∞çÊñπÂæÄÂæåÈù†Ôºå‰ªñÂÄë‰πüÊúÉË∑üËëóÂÅö„ÄÇËã•Â∞çÊñπÂñù‰∏ÄÂè£Ê∞¥Ôºå‰ªñÂÄë‰πüÂæàÂèØËÉΩÊúÉÈÄôÈ∫ºÂÅö„ÄÇ^ Besides, they may copy the other person‚Äôs actions without knowing it. If the person sits back, they will too. If the person drinks water, they will likely do the same.

Aside from copying behavior, they often can‚Äôt help pointing their feet and shoulders toward the one they adore or standing closer to the object of their affection than to others. ^ Èô§‰∫ÜÊ®°‰ªøË°åÁÇ∫Â§ñÔºå‰ªñÂÄë‰πüÂ∏∏ÊúÉ‰∏çËá™Ë¶∫Â∞áËÖ≥ÂíåËÇ©ËÜÄÊúùÂêëÂøÉÂÑÄÂ∞çË±°ÔºåÊàñÁ´ôÂæóÊØîËµ∑‰ªñ‰∫∫Êõ¥Èù†ËøëÂ∞çÊñπ„ÄÇ^ Also, they point their feet and shoulders toward the person they like or stand closer to them.
‚óéParagraph 4
All of the previously mentioned points reveal the idea that one of the best methods for interpreting people‚Äôs thoughts and emotions is to pay attention to their body language. ^ ‰ª•‰∏äÁ®ÆÁ®ÆÈÉΩÈ°ØÁ§∫ÔºöÊÉ≥Ëß£ËÆÄ‰ªñ‰∫∫ÁöÑÊÉ≥Ê≥ïËàáÊÉÖÁ∑íÔºåÊúÄÂ•ΩÁöÑÊñπÊ≥ï‰πã‰∏ÄÂ∞±ÊòØÊ≥®ÊÑè‰ªñÂÄëÁöÑËÇ¢È´îË™ûË®Ä„ÄÇ^ All these points show that watching body language is one of the best ways to understand people.

By understanding the signals that people send out with their body language, we may interact in a more meaningful way with our fellow human beings. Best of all, we can do it without even saying a single word! ^ ÈÄèÈÅéÁêÜËß£‰ªñÂÄëÁöÑËÇ¢È´îË®äËôüÔºåÊàëÂÄëËÉΩËàá‰ªñ‰∫∫ÈÄ≤Ë°åÊõ¥ÊúâÊÑèÁæ©ÁöÑ‰∫íÂãï„ÄÇÊúÄÊ£íÁöÑÊòØÔºåÈÄô‰∏ÄÂàáÁîöËá≥‰∏çÈúÄË¶Å‰∏ÄÂè•Ë©±ÔºÅ^ By understanding these signals, we can interact with others in a better way. The best part is that we can do this without saying anything.

`,
            'text2': `

`,
            'text3': ``,
            'maga1': ``,
            'maga2': ``,
            'maga3': ``,
            'maga4': ``,
            'core1': ``,
            'core2': ``,
            'core3': ``
        };

        // Parse simplified database format
        function parseSimplifiedDatabase(text) {
            const sections = [];
            const lines = text.trim().split('\n');
            let currentSection = null;

            for (let line of lines) {
                line = line.trim();
                if (!line) continue;

                if (line.startsWith('‚óé')) {
                    // New section
                    if (currentSection) {
                        sections.push(currentSection);
                    }
                    currentSection = {
                        section: line,
                        items: []
                    };
                } else if (line.includes('^') && currentSection) {
                    // Text entry
                    const parts = line.split('^').map(s => s.trim());
                    if (parts.length === 3) {
                        currentSection.items.push({
                            english: parts[0],
                            chinese: parts[1],
                            easy: parts[2]
                        });
                    }
                }
            }

            if (currentSection) {
                sections.push(currentSection);
            }

            return sections;
        }

        // Convert raw database to parsed format
        const textDatabase = {};
        for (const [key, value] of Object.entries(textDatabaseRaw)) {
            textDatabase[key] = parseSimplifiedDatabase(value);
        }

        // Global state
        let currentSpeech = null;
        let speechRate = 1.0;
        let voices = [];
        let currentEasyText = '';

        // Load voices
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            if (!voices.length) {
                const dummy = new SpeechSynthesisUtterance('');
                speechSynthesis.speak(dummy);
                voices = speechSynthesis.getVoices();
            }
        }

        // Get English voice
        function getEnglishVoice() {
            if (!voices.length) loadVoices();
            let voice = voices.find(v => v.name.includes('Samantha')) || 
                       voices.find(v => v.lang === 'en-US');
            return voice || null;
        }

        // Clean text for TTS
        function cleanTextForTTS(text) {
            return text.replace(/\*/g, '')
                      .replace(/\//g, '')
                      .replace(/\([^)]*\)/g, '')
                      .replace(/\[[^\]]*\]/g, '')
                      .replace(/\s+/g, ' ')
                      .trim();
        }

        // Speak text
        function speakText(text) {
            stopSpeech();
            const cleaned = cleanTextForTTS(text);
            if (!cleaned) return;

            const utterance = new SpeechSynthesisUtterance(cleaned);
            utterance.lang = 'en-US';
            utterance.rate = speechRate;

            const voice = getEnglishVoice();
            if (voice) utterance.voice = voice;

            utterance.onend = () => {
                currentSpeech = null;
            };

            currentSpeech = utterance;
            speechSynthesis.speak(utterance);
        }

        // Stop speech
        function stopSpeech() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            currentSpeech = null;
        }

        // Load text content
        function loadTextContent(lessonKey) {
            const tableBody = document.getElementById('textTableBody');
            const data = textDatabase[lessonKey];

            if (!data || data.length === 0) {
                tableBody.innerHTML = '<tr class="no-data"><td colspan="2">No data available. <br>(Êö´ÁÑ°Ë≥áÊñô)</td></tr>';
                setTimeout(() => {
                    const textTable = document.getElementById('textTable');
                    if (textTable) {
                        textTable.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }
                }, 50);
                return;
            }

            let html = '';
            data.forEach((section) => {
                html += `<tr>
                    <td colspan="2" class="section-header">${section.section}</td>
                </tr>`;
                
                section.items.forEach((item) => {
                    html += `<tr class="text-row">
                        <td class="audio-controls">
                            <button class="audio-btn play-btn" onclick="speakText('${item.english.replace(/'/g, "\\'")}')">üîä</button>
                            <button class="audio-btn stop-btn" onclick="stopSpeech()">‚èπ</button>
                            <button class="audio-btn easy-btn" onclick="showEasyVersion('${item.easy.replace(/'/g, "\\'")}')">üòä</button>
                        </td>
                        <td class="content-cell">
                            <div class="english-text">${item.english}</div>
                            <div class="chinese-translation">${item.chinese}</div>
                        </td>
                    </tr>`;
                });
            });

            tableBody.innerHTML = html;
        }

        // Show easy version modal
        function showEasyVersion(easyText) {
            currentEasyText = easyText;
            document.getElementById('easyVersionText').textContent = easyText;
            document.getElementById('easyModal').style.display = 'block';
        }

        // Play easy version audio
        function playEasyAudio() {
            if (currentEasyText) {
                speakText(currentEasyText);
            }
        }

        // Close easy modal
        function closeEasyModal() {
            document.getElementById('easyModal').style.display = 'none';
            stopSpeech();
        }

        // Floating navigation functions
        function handleFloatingButtons() {
            const backToTopBtn = document.getElementById('backToTopBtn');
            const nextSectionBtn = document.getElementById('nextSectionBtn');
            const buttonCategories = document.querySelector('.button-categories');
            
            if (!backToTopBtn || !nextSectionBtn || !buttonCategories) return;
            
            const buttonCategoriesBottom = buttonCategories.offsetTop + buttonCategories.offsetHeight;
            
            if (window.scrollY > buttonCategoriesBottom + 100) {
                backToTopBtn.classList.add('show');
                nextSectionBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
                nextSectionBtn.classList.remove('show');
            }
        }

        function scrollToTop() {
            const buttonCategories = document.querySelector('.button-categories');
            if (buttonCategories) {
                buttonCategories.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            } else {
                window.scrollTo({ 
                    top: 0, 
                    behavior: 'smooth' 
                });
            }
        }

        function scrollToNextSection() {
            const sectionHeaders = document.querySelectorAll('.section-header');
            
            if (sectionHeaders.length === 0) return;
            
            const currentScrollPos = window.scrollY;
            
            for (let i = 0; i < sectionHeaders.length; i++) {
                const headerPos = sectionHeaders[i].offsetTop;
                
                if (headerPos > currentScrollPos + 100) {
                    sectionHeaders[i].scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    return;
                }
            }
            
            window.scrollTo({ 
                top: document.body.scrollHeight, 
                behavior: 'smooth' 
            });
        }

        // Initialize event listeners
        function initializeEventListeners() {
            document.body.addEventListener('click', () => loadVoices(), { once: true });

            // Lesson buttons
            const lessonButtons = document.querySelectorAll('.lesson-btn');
            lessonButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    lessonButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const lessonKey = this.getAttribute('data-lesson');
                    loadTextContent(lessonKey);
                });
            });

            // Speed buttons
            const speedButtons = document.querySelectorAll('.speed-btn');
            speedButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    speedButtons.forEach(b => b.classList.remove('active-speed'));
                    this.classList.add('active-speed');
                    speechRate = parseFloat(this.getAttribute('data-speed'));
                    stopSpeech();
                });
            });

            // Welcome modal
            document.getElementById('welcomeOkBtn').addEventListener('click', () => {
                document.getElementById('welcomeModal').style.display = 'none';
            });

            // Easy version modal
            document.getElementById('closeEasyModal').addEventListener('click', closeEasyModal);
            document.getElementById('playEasyBtn').addEventListener('click', playEasyAudio);
            document.getElementById('stopEasyBtn').addEventListener('click', stopSpeech);

            // Floating buttons
            document.getElementById('backToTopBtn').addEventListener('click', scrollToTop);
            document.getElementById('nextSectionBtn').addEventListener('click', scrollToNextSection);
            window.addEventListener('scroll', handleFloatingButtons);
            handleFloatingButtons();

            // Click outside modal to close
            window.addEventListener('click', (e) => {
                const easyModal = document.getElementById('easyModal');
                if (e.target === easyModal) {
                    closeEasyModal();
                }
            });

            window.addEventListener('beforeunload', () => stopSpeech());
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
        });
    </script>
</body>
</html>
