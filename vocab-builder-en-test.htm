<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Builder</title>
    <style>
        :root {
            --primary: #D33E43;
            --secondary: #F8B500;
            --accent1: #5D9CEC;
            --accent2: #77B28C;
            --accent3: #A06CD5;
--accent4: #51A8DD;
            --dark: #2D2D2A;
            --light: #F8F3E6;
            --mid: #888888;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.5;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .tts-system-selector {
            margin-top: 15px;
            font-size: 16px;
            color: var(--dark);
        }

        .tts-system-selector label {
            font-weight: bold;
            margin-right: 8px;
        }

        .tts-system-selector select {
            padding: 8px 12px;
            border: 2px solid var(--mid);
            border-radius: 6px;
            background-color: white;
            color: var(--dark);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .tts-system-selector select:hover {
            border-color: var(--accent1);
        }

        .tts-system-selector select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .left-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .text-import-btn {
            background-color: var(--secondary);
            color: black;
            padding: 12px 24px;
            font-size: 18px;
        }

        .english-to-chinese-btn {
            background-color: var(--accent3);
            color: white;
            padding: 16px 25px;
            font-size: 20px;
        }

        .listen-choose-btn {
            background-color: var(--accent2);
            color: white;
            padding: 16px 25px;
            font-size: 20px;
        }

        .start-btn {
            background-color: var(--primary);
            color: white;
            padding: 16px 25px;
            font-size: 20px;
        }

        .ai-support-btn {
            background-color: var(--accent1);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
        }

        .quiz-mode-selector {
            background-color: white;
            border: 2px solid var(--mid);
            border-radius: 10px;
            padding: 3px;
            margin: 3px 0;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .mode-options {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }

        .mode-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px 15px;
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .mode-option:hover {
            background-color: rgba(93, 156, 236, 0.1);
            border-color: var(--accent1);
        }

        .mode-option input[type="radio"] {
            margin: 0 8px 0 0;
            transform: scale(1.2);
        }

        .mode-option .option-text {
            font-weight: bold;
            font-size: 16px;
            color: var(--dark);
        }

        .mode-option input[type="radio"]:checked + .option-text {
            color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            clear: both;
            display: table;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--dark);
            color: var(--light);
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.03);
        }

        tr:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .speaker-icon {
            cursor: pointer;
            color: var(--secondary);
            margin-left: 8px;
            font-size: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--light);
            width: 90%;
            max-width: 500px;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .modal h2 {
            margin-top: 0;
            color: var(--primary);
            font-size: 1.8rem;
        }

        .prompt {
            font-size: 24px;
            margin: 20px 0;
            color: var(--dark);
            font-weight: bold;
        }

        .answer-input {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            margin-bottom: 15px;
            border: 2px solid var(--mid);
            border-radius: 6px;
            box-sizing: border-box;
        }

        .feedback {
            margin: 15px 0;
            font-size: 25px;
            font-weight: bold;
            min-height: 27px;
        }

        .correct {
            color: var(--accent2);
        }

        .incorrect {
            color: var(--primary);
        }

        .hint {
            color: var(--accent1);
            font-style: italic;
            font-size: 25px;
            margin: 10px 0;
            min-height: 24px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .submit-btn {
            background-color: var(--primary);
            color: white;
        }

        .speak-btn {
            background-color: var(--accent1);
            color: white;
        }

        .hint-btn {
            background-color: var(--secondary);
            color: var(--dark);
        }

        .answer-btn {
            background-color: var(--accent3);
            color: white;
        }

        .next-btn {
            background-color: var(--accent2);
            color: white;
        }

        .close-btn {
            background-color: var(--mid);
            color: white;
        }

        .monthly-btn {
    background-color: var(--accent4);
    color: white;
}

        .recording {
            background-color: var(--primary);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .hidden {
            display: none;
        }

        #file-input {
            display: none;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--mid);
                    }

        .tts-speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tts-speed-control select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid var(--mid);
            background-color: white;
            font-size: 14px;
        }

        .tts-speed-control label {
            font-weight: bold;
            color: white;
        }

        .reveal-answer {
            color: var(--primary);
            font-weight: bold;
            font-size: 30px;
            margin: 10px 0;
            min-height: 27px;
        }

        .section-header {
            background-color: var(--dark);
            color: var(--light);
            font-weight: bold;
            position: relative;
        }

        .section-header td {
            background-color: var(--dark);
            color: var(--light);
            padding: 10px 15px;
        }

        .collapse-btn {
            background: none;
            border: none;
            color: var(--light);
            font-size: 18px;
            cursor: pointer;
            padding: 0 8px 0 0;
            margin: 0;
            transition: transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 30px;
            box-shadow: none;
        }

        .collapse-btn:hover {
            transform: scale(1.1);
            box-shadow: none;
        }

        .section-collapsed .collapse-btn {
            transform: rotate(-90deg);
        }

        .section-row {
            display: table-row;
            transition: all 0.3s ease;
        }

        .section-row.section-collapsed {
            display: none;
        }

        .section-header .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-info {
            background-color: var(--accent1);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-section {
            opacity: 0.8;
            font-size: 14px;
        }

        #text-import-content {
            width: 100%;
            height: 100px;
            padding: 12px;
            margin: 15px 0;
            font-size: 16px;
            border: 2px solid var(--mid);
            border-radius: 6px;
            box-sizing: border-box;
            resize: vertical;
        }

        #text-import-modal .modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .button-set {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.02);
        }

        .button-set h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--dark);
        }

        .preset-btn {
            margin: 5px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            font-weight: normal;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .textbook-btn {
            background-color: var(--accent1);
            color: white;
        }

        .live-btn {
            background-color: var(--accent2);
            color: white;
        }

        .core-btn {
            background-color: var(--accent3);
            color: white;
        }

        .other-btn {
            background-color: var(--secondary);
            color: var(--dark);
        }

        #ai-support-modal .modal-content {
            max-width: 600px;
        }

        .ai-support-links {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .ai-support-link {
            background-color: var(--accent1);
            color: white;
            text-decoration: none;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-support-link:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        #listen-choose-modal .modal-content {
            max-width: 100%;
            width: 95%;
            max-height: 95vh;
            padding: 15px;
        }

        .listen-answer-section {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .listen-answer-display {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            min-height: 30px;
            padding: 10px 15px;
            border: 2px solid var(--mid);
            border-radius: 8px;
            background-color: white;
            flex-grow: 1;
            text-align: center;
        }

        .listen-speaker {
            cursor: pointer;
            color: var(--secondary);
            font-size: 28px;
            padding: 8px;
            border-radius: 50%;
            background-color: rgba(248, 181, 0, 0.1);
            transition: all 0.2s ease;
        }

        .listen-speaker:hover {
            background-color: rgba(248, 181, 0, 0.2);
            transform: scale(1.1);
        }

        .timer-feedback-section {
            margin-bottom: 25px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-feedback {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
            max-width: 100%;
        }

        .choice-button {
            padding: 15px 10px;
            border: 2px solid var(--mid);
            border-radius: 8px;
            background-color: white;
            color: var(--dark);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.3;
        }

        .choice-button:hover {
            background-color: var(--accent1);
            color: white;
            border-color: var(--accent1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .choice-button.correct {
            background-color: var(--accent2);
            color: white;
            border-color: var(--accent2);
        }

        .choice-button.incorrect {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .choice-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .listen-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .listen-next-btn {
            background-color: var(--accent2);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
        }

        .listen-close-btn {
            background-color: var(--mid);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
        }

        .date-info {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            font-size: 14px;
            line-height: 1.6;
            color: var(--dark);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-weight: bold;
            max-width: 90%;
            z-index: 10;
        }

        .date-info span {
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .date-info .emoji {
            margin-right: 8px;
            font-size: 16px;
        }

        .date-info .countdown {
            color: var(--primary);
            margin: 0 3px;
        }

        .visitor-counter {
            margin-top: 40px;
            text-align: center;
            padding: 15px;
            color: var(--dark);
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #visitor-count {
            font-weight: bold;
        }

        .popup-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .popup-layout {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .pikachu-image {
            width: 150px;
            flex-shrink: 0;
        }

        .pikachu-image img {
            width: 100%;
            height: auto;
        }

        .speech-bubble {
            position: relative;
            background-color: #FFFDE7;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 15px;
            margin-left: 15px;
        }

        .speech-bubble:before {
            content: "";
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 15px 15px 15px 0;
            border-style: solid;
            border-color: transparent var(--secondary) transparent transparent;
        }

        .speech-bubble:after {
            content: "";
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 12px 12px 12px 0;
            border-style: solid;
            border-color: transparent #FFFDE7 transparent transparent;
        }

        .english-text {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .chinese-text {
            font-size: 16px;
            color: var(--dark);
        }

        .close-reminder-btn {
            background-color: var(--accent1);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-reminder-btn:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

/* Monthly Learning Cycle Styles */
.week-section {
    background-color: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.week-section h3 {
    color: var(--primary);
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.item-count {
    font-size: 14px;
    color: var(--accent1);
    font-weight: normal;
}

.days-grid {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 12px;
}

.day-row {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    align-items: center;
}

.day-btn {
    background-color: var(--accent4);
    color: white;
    padding: 10px;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: left;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.day-btn:hover {
    background-color: var(--primary);
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

.day-btn.has-content {
    background-color: var(--accent2);
}

.edit-btn {
    background-color: var(--secondary);
    color: var(--dark);
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.edit-btn:hover {
    background-color: var(--accent3);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

.clear-week-btn {
    background-color: var(--mid);
    color: white;
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.clear-week-btn:hover {
    background-color: var(--primary);
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
    #monthly-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 15px;
    }
    
    .week-section {
        padding: 10px;
    }
    
    .week-section h3 {
        font-size: 15px;
    }
    
    .item-count {
        font-size: 12px;
    }
    
    .day-btn {
        font-size: 13px;
        padding: 8px 6px;
    }
    
    .edit-btn {
        padding: 8px 10px;
        font-size: 12px;
    }
    
    .day-row {
        gap: 6px;
    }
}

        @media (max-width: 768px) {
            .date-info {
                position: static;
                margin: 0 auto 15px auto;
                width: 100%;
                max-width: 100%;
                text-align: center;
                right: auto;
                top: auto;
            }

            .date-info span {
                justify-content: center;
            }

            header {
                display: flex;
                flex-direction: column;
            }
        }

        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            th, td {
                padding: 8px 10px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .left-controls {
                justify-content: space-between;
                width: 100%;
            }

            .right-controls {
                justify-content: space-between;
                width: 100%;
            }

            .choices-grid {
                gap: 10px;
            }

            .choice-button {
                padding: 12px 8px;
                font-size: 14px;
                min-height: 50px;
            }

            .listen-answer-display {
                font-size: 20px;
            }

            .listen-speaker {
                font-size: 24px;
            }

            .timer-feedback {
                font-size: 18px;
            }

            .mode-option {
                padding: 10px;
            }

            .preset-buttons {
                grid-template-columns: 1fr;
            }

            .ai-support-links {
                grid-template-columns: 1fr;
            }

            #listen-choose-modal .modal-content {
                width: 98%;
                padding: 10px;
            }

            .popup-layout {
                flex-direction: column;
            }

            .speech-bubble {
                margin-left: 0;
                margin-top: 15px;
            }

            .speech-bubble:before, .speech-bubble:after {
                left: 50%;
                top: -15px;
                transform: translateX(-50%) rotate(90deg);
            }

            .speech-bubble:after {
                top: -12px;
            }
        }
    </style>
</head>

<body>
    <header>
        <div id="date-info" class="date-info"></div>
        <h1>üéØ Vocabulary Builder (5.0)</h1>
        <div class="tts-system-selector">
            <label for="tts-system">System: </label>
            <select id="tts-system">
                <option value="android" selected>Android</option>
                <option value="ios">iOS</option>
            </select>
        </div>
    </header>

    <div class="controls">
        <div class="left-controls">
            <button class="text-import-btn" id="text-import-btn">üìù Load Vocab</button>
        </div>
        <button class="english-to-chinese-btn" id="english-to-chinese-btn" disabled>üëÄ ÁúãËã±ÊÉ≥‰∏≠</button>
        <button class="listen-choose-btn" id="listen-choose-btn" disabled>üéß ËÅΩËã±ÈÅ∏‰∏≠</button>
        <button class="start-btn" id="start-btn" disabled>üé§ Áúã‰∏≠Âî∏Ëã±</button>
        <button class="ai-support-btn" id="ai-support-btn">üí° AI Support</button>
    </div>

    <div class="quiz-mode-selector">
        <div class="mode-options">
            <label class="mode-option">
                <input type="radio" name="quiz-mode" value="sequential" checked>
                <span class="option-text">‚û°Ô∏è Sequential (ÊåâÈ†ÜÂ∫è)</span>
            </label>
            <label class="mode-option">
                <input type="radio" name="quiz-mode" value="random">
                <span class="option-text">üîÄ Random (Èö®Ê©ü)</span>
            </label>
        </div>
    </div>

    <table id="vocabulary-table">
        <thead>
            <tr>
                <th>
                    <div class="tts-speed-control">
                        <label for="tts-speed">Vocabulary</label>
                        <select id="tts-speed">
                            <option value="0.6">0.6x</option>
                            <option value="0.8" selected>0.8x</option>
                            <option value="1">1x</option>
                            <option value="1">1.2x</option>
                        </select>
                    </div>
                </th>
                <th>Translation</th>
                <th>
                    <label>
                        <input type="checkbox" id="select-all"> Select All
                    </label>
                </th>
            </tr>
        </thead>
        <tbody id="vocabulary-body">
            <tr>
                <td colspan="3" class="no-data">Load the vocabulary to get started (ËºâÂÖ•Â≠óÂΩô‰ª•ÈñãÂßãÂ≠∏Áøí)</td>
            </tr>
        </tbody>
    </table>

    <!-- Text Import Modal -->
    <div id="text-import-modal" class="modal">
        <div class="modal-content">
            <h2>üìù Load Vocabulary</h2>
            <div class="preset-buttons">
                <div class="button-set textbook-buttons">
                    <h3>üìó Textbook</h3>
                    <button class="preset-btn textbook-btn" data-preset="textbook1">B3 L4</button>
                    <button class="preset-btn textbook-btn" data-preset="textbook2">B3 L5</button>
                    <button class="preset-btn textbook-btn" data-preset="textbook3">B3 L6 (Ëá™Ë™≠)</button>
                </div>
                <div class="button-set live-buttons">
                    <h3>üì∞ Magazine</h3>
                    <button class="preset-btn live-btn" data-preset="maga1">U2</button>
                    <button class="preset-btn live-btn" data-preset="maga2">U7 (Ëá™Ë™≠)</button>
                    <button class="preset-btn live-btn" data-preset="maga3">U12</button>
                    <button class="preset-btn live-btn" data-preset="maga4">U13 (Ëá™Ë™≠)</button>
                </div>
                <div class="button-set core-buttons">
                    <h3>üìô Ê†∏ÂøÉÂ≠óÂΩô</h3>
                    <button class="preset-btn core-btn" data-preset="core1">P2 U4</button>
                    <button class="preset-btn core-btn" data-preset="core2">P2 U5</button>
                    <button class="preset-btn core-btn" data-preset="core3">P2 U6</button>
                </div>
                <div class="button-set other-buttons">
                    <h3>üåü ÂÆåÁæéÈ´îÈ©ó</h3>
<button class="preset-btn other-btn" data-preset="other1">Level 4</button>
                    <button class="preset-btn other-btn" data-preset="other2">Level 5</button>
                    <button class="preset-btn other-btn" data-preset="other3">Level 6</button>
                </div>
            </div>
            <textarea id="text-import-content" placeholder="Enter your vocabulary pairs here..."></textarea>
            <div class="button-group">
                <button id="text-import-submit-btn" class="submit-btn">üìÇ Load</button>
               <button id="text-import-monthly-btn" class="monthly-btn">üìÖ Monthly</button>
                <button id="text-import-clear-btn" class="hint-btn">üà≥ Clear</button>
                <button id="text-import-close-btn" class="close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- AI Support Modal -->
    <div id="ai-support-modal" class="modal">
        <div class="modal-content">
            <h2>üí° AI Support</h2>
            <div class="ai-support-links">
                <a href="https://chatgpt.com/share/68db5397-e390-800a-88d2-e323314c7e5c" class="ai-support-link" target="_blank">üÄÑ ÁîüÊàê‰∏≠Ë≠Ø</a>
                <a href="https://chatgpt.com/share/68de901e-41c8-800a-ae85-676758634593" class="ai-support-link" target="_blank">üåü ÁîüÊàê‰æãÂè•+‰∏≠Ë≠Ø+ÂÆöÁæ©+Â°´Á©∫</a>
                <a href="https://chatgpt.com/share/67da57c1-afa4-800a-956f-41b344ca587c" class="ai-support-link" target="_blank">üí¨ ‰∫íÂãïÂïèÁ≠î</a>
                <a href="https://chatgpt.com/share/67f896d4-e3a4-800a-9169-b0f385820e3e" class="ai-support-link" target="_blank">[Quiz] Â°´Á©∫È°å ‚úèÔ∏è</a>
                <a href="https://chatgpt.com/share/67f7329b-e008-800a-9c06-df50ec1bb977" class="ai-support-link" target="_blank">[Quiz] ‰∏≠Ë≠ØËã± (ÂÖ•ÈñÄ) üòÉ</a>
                <a href="https://chatgpt.com/share/67f619dd-d668-800a-af6e-696897e751e7" class="ai-support-link" target="_blank">[Quiz] ‰∏≠Ë≠ØËã± (Â≠∏Ê∏¨Èõ£Â∫¶) üòñ</a>
            </div>
            <div class="button-group">
                <button id="ai-support-close-btn" class="close-btn">Close</button>
            </div>
        </div>
    </div>

<!-- Monthly Learning Cycle Modal -->
<div id="monthly-modal" class="modal">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
        <h2>üìÖ Monthly Learning Cycle</h2>
        
        <div id="monthly-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <!-- Week 1 -->
            <div class="week-section">
                <h3>Week 1 <span id="week1-count" class="item-count">0 items</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="1">Day 1</button><button class="edit-btn" data-week="1" data-day="1">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="2">Day 2</button><button class="edit-btn" data-week="1" data-day="2">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="3">Day 3</button><button class="edit-btn" data-week="1" data-day="3">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="4">Day 4</button><button class="edit-btn" data-week="1" data-day="4">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="5">Day 5</button><button class="edit-btn" data-week="1" data-day="5">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="6">Day 6</button><button class="edit-btn" data-week="1" data-day="6">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="1" data-day="7">Review Day</button><button class="edit-btn" data-week="1" data-day="7">Edit</button></div>
                </div>
                <button class="clear-week-btn" data-week="1">Clear W1</button>
            </div>

            <!-- Week 2 -->
            <div class="week-section">
                <h3>Week 2 <span id="week2-count" class="item-count">0 items</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="1">Day 1</button><button class="edit-btn" data-week="2" data-day="1">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="2">Day 2</button><button class="edit-btn" data-week="2" data-day="2">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="3">Day 3</button><button class="edit-btn" data-week="2" data-day="3">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="4">Day 4</button><button class="edit-btn" data-week="2" data-day="4">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="5">Day 5</button><button class="edit-btn" data-week="2" data-day="5">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="6">Day 6</button><button class="edit-btn" data-week="2" data-day="6">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="2" data-day="7">Review Day</button><button class="edit-btn" data-week="2" data-day="7">Edit</button></div>
                </div>
                <button class="clear-week-btn" data-week="2">Clear W2</button>
            </div>

            <!-- Week 3 -->
            <div class="week-section">
                <h3>Week 3 <span id="week3-count" class="item-count">0 items</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="1">Day 1</button><button class="edit-btn" data-week="3" data-day="1">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="2">Day 2</button><button class="edit-btn" data-week="3" data-day="2">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="3">Day 3</button><button class="edit-btn" data-week="3" data-day="3">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="4">Day 4</button><button class="edit-btn" data-week="3" data-day="4">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="5">Day 5</button><button class="edit-btn" data-week="3" data-day="5">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="6">Day 6</button><button class="edit-btn" data-week="3" data-day="6">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="3" data-day="7">Review Day</button><button class="edit-btn" data-week="3" data-day="7">Edit</button></div>
                </div>
                <button class="clear-week-btn" data-week="3">Clear W3</button>
            </div>

            <!-- Week 4 -->
            <div class="week-section">
                <h3>Week 4 <span id="week4-count" class="item-count">0 items</span></h3>
                <div class="days-grid">
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="1">Day 1</button><button class="edit-btn" data-week="4" data-day="1">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="2">Day 2</button><button class="edit-btn" data-week="4" data-day="2">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="3">Day 3</button><button class="edit-btn" data-week="4" data-day="3">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="4">Day 4</button><button class="edit-btn" data-week="4" data-day="4">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="5">Day 5</button><button class="edit-btn" data-week="4" data-day="5">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="6">Day 6</button><button class="edit-btn" data-week="4" data-day="6">Edit</button></div>
                    <div class="day-row"><button class="day-btn" data-week="4" data-day="7">Review Day</button><button class="edit-btn" data-week="4" data-day="7">Edit</button></div>
                </div>
                <button class="clear-week-btn" data-week="4">Clear W4</button>
            </div>
        </div>

<!-- Backup Section (Full Width) -->
<div class="week-section" style="grid-column: span 2;">
    <h3>Backup <span id="backup-count" class="item-count">0 items</span></h3>
    <div class="days-grid">
                <div class="day-row"><button class="day-btn" data-week="backup" data-day="1">Backup 1</button><button class="edit-btn" data-week="backup" data-day="1">Edit</button></div>
                <div class="day-row"><button class="day-btn" data-week="backup" data-day="2">Backup 2</button><button class="edit-btn" data-week="backup" data-day="2">Edit</button></div>
                <div class="day-row"><button class="day-btn" data-week="backup" data-day="3">Backup 3</button><button class="edit-btn" data-week="backup" data-day="3">Edit</button></div>
                <div class="day-row"><button class="day-btn" data-week="backup" data-day="4">Backup 4</button><button class="edit-btn" data-week="backup" data-day="4">Edit</button></div>
                <div class="day-row"><button class="day-btn" data-week="backup" data-day="5">Backup 5</button><button class="edit-btn" data-week="backup" data-day="5">Edit</button></div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
<button id="monthly-clear-all-btn" class="hint-btn">üà≥ Clear All</button>
    <button id="monthly-close-btn" class="close-btn">Close</button>
    </div>
                </div>
            </div>

<!-- Edit Entry Modal -->
<div id="edit-entry-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
        <h2>‚úèÔ∏è Edit This Entry</h2>
        <p style="color: var(--mid); margin-bottom: 15px;">(Paste the words/phrases here and press Save)</p>
        <textarea id="edit-entry-content" style="width: 100%; height: 400px; padding: 15px; font-size: 16px; border: 2px solid var(--mid); border-radius: 6px; box-sizing: border-box; resize: vertical; font-family: monospace; line-height: 1.6;" placeholder="Enter vocabulary pairs..."></textarea>
        <div class="button-group" style="margin-top: 20px;">
            <button id="edit-save-btn" class="next-btn">üíæ Save</button>
            <button id="edit-ai-link-btn" class="speak-btn">üí° AI (‰∏≠+Âè•)</button>
            <button id="edit-clear-btn" class="hint-btn">üà≥ Clear</button>
            <button id="edit-cancel-btn" class="close-btn">üö´ Cancel</button>
        </div>
    </div>
</div>

    <!-- English to Chinese Quiz Modal -->
    <div id="english-to-chinese-modal" class="modal">
        <div class="modal-content">
            <div id="english-progress-info" class="progress-info" style="display: none;">
                <span id="english-progress-text"></span>
            </div>
            <div class="prompt">What does this mean?</div>
            <div style="font-size: 28px; font-weight: bold; color: var(--primary); margin: 20px 0; display: flex; align-items: center; justify-content: center; gap: 15px;">
                <span id="english-word-display"></span>
                <span class="speaker-icon" id="english-word-speaker" title="Listen" style="cursor: pointer; color: var(--secondary); font-size: 24px;">üîä</span>
            </div>
            <div id="chinese-answer-display" class="reveal-answer" style="display: none; font-size: 25px"></div>
            <div id="check-question" style="display: none; font-size: 23px; color: var(--accent1); margin-top: 10px;"><b>Did you get it right?</b></div>
            <div style="margin-top: 30px;">
                <button id="check-answer-btn" class="submit-btn" style="width: 100%; margin-bottom: 15px; padding: 15px;">Check Answer</button>
                <div class="button-group">
                    <button id="english-next-btn" class="next-btn">Next</button>
                    <button id="english-close-btn" class="close-btn">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Listen and Choose Modal -->
    <div id="listen-choose-modal" class="modal">
        <div class="modal-content">
            <h2>üéß Listen and Choose</h2>
            <div class="listen-answer-section">
                <div id="listen-answer-display" class="listen-answer-display">Click the speaker</div>
                <div class="listen-speaker" id="listen-speaker" title="Play Audio">üîä</div>
            </div>
            <div class="timer-feedback-section">
                <div id="timer-feedback" class="timer-feedback"></div>
            </div>
            <div id="choices-grid" class="choices-grid"></div>
            <div class="listen-controls">
                <button id="listen-next-btn" class="listen-next-btn">Next</button>
                <button id="listen-close-btn" class="listen-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <div id="prompt" class="prompt">Say "<span id="translation-prompt" style="color: var(--primary);"></span>" in English.</div>
            <input type="text" id="answer-input" class="answer-input" placeholder="Type your answer here...">
            <div id="feedback" class="feedback"></div>
            <div id="hint-text" class="hint"></div>
            <div id="reveal-answer" class="reveal-answer"></div>
            <div class="button-group">
                <button id="submit-btn" class="submit-btn">‚úÖ or ‚ùé</button>
                <button id="speak-btn" class="speak-btn">üé§ Speak</button>
                <button id="hint-btn" class="hint-btn">‚ùì Hint</button>
                <button id="answer-btn" class="answer-btn">üîë Answer</button>
                <button id="next-btn" class="next-btn">Next</button>
                <button id="close-btn" class="close-btn">Close</button>
            </div>
        </div>
    </div>

    <footer class="visitor-counter">
        <div id="visitor-count">üë• Loading visitor count...</div>
    </footer>

    <!-- Refresh Reminder Popup -->
    <div id="refresh-reminder-popup" class="popup-container">
        <div class="popup-content">
            <div class="popup-layout">
                <div class="pikachu-image">
                    <img src="dinotaeng_walking.png" alt="Image Not Found" width="150">
                </div>
                <div class="speech-bubble">
                    <p class="english-text">1. ÊØèÊ¨°‰ΩøÁî®Ë´ãÈªûÊìä„ÄåÈáçÊñ∞Êï¥ÁêÜ(refresh)üîÑ„Äç‰ª•Áç≤ÂèñÊõ¥Êñ∞ÔºÅ</p>
                    <p class="chinese-text">2. iPhoneÂèäiPad‰ΩøÁî®ËÄÖÈúÄÂ∞ásystem(Á≥ªÁµ±)ÂàáÊèõÊàêiOSÔºåüîäÊâçËÉΩÊ≠£Â∏∏ÈÅã‰ΩúÔºå‰∏îÂª∫Ë≠∞Â∞áË™ûÈÄüË™øÊàê 1x„ÄÇ</p>
                    <p class="chinese-text">3. ÊâãÊ©üÊúâÊôÇÊúÉÊõ¥Êñ∞„ÄåÊñáÂ≠óËΩâË™ûÈü≥„ÄçÂäüËÉΩÔºåÂ∞éËá¥üîäÁÑ°Ê≥ïÈÅã‰ΩúÔºåÈáçÈñãÊ©üÂç≥ÂèØËß£Ê±∫„ÄÇ</p>
                </div>
            </div>
            <button id="close-reminder-btn" class="close-reminder-btn">OK. I got it.</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ===== DOM ELEMENTS =====
        const englishToChineseBtn = document.getElementById('english-to-chinese-btn');
        const englishToChineseModal = document.getElementById('english-to-chinese-modal');
        const englishWordDisplay = document.getElementById('english-word-display');
        const englishWordSpeaker = document.getElementById('english-word-speaker');
        const chineseAnswerDisplay = document.getElementById('chinese-answer-display');
        const checkQuestion = document.getElementById('check-question');
        const checkAnswerBtn = document.getElementById('check-answer-btn');
        const englishNextBtn = document.getElementById('english-next-btn');
        const englishCloseBtn = document.getElementById('english-close-btn');
        const englishProgressInfo = document.getElementById('english-progress-info');
        const englishProgressText = document.getElementById('english-progress-text');

        const listenChooseBtn = document.getElementById('listen-choose-btn');
        const listenChooseModal = document.getElementById('listen-choose-modal');
        const listenAnswerDisplay = document.getElementById('listen-answer-display');
        const listenSpeaker = document.getElementById('listen-speaker');
        const timerFeedback = document.getElementById('timer-feedback');
        const choicesGrid = document.getElementById('choices-grid');
        const listenNextBtn = document.getElementById('listen-next-btn');
        const listenCloseBtn = document.getElementById('listen-close-btn');

        const textImportBtn = document.getElementById('text-import-btn');
        const startBtn = document.getElementById('start-btn');
        const aiSupportBtn = document.getElementById('ai-support-btn');
        const vocabularyTable = document.getElementById('vocabulary-table');
        const vocabularyBody = document.getElementById('vocabulary-body');
        const selectAllCheckbox = document.getElementById('select-all');
        const quizModal = document.getElementById('quiz-modal');
        const translationPrompt = document.getElementById('translation-prompt');
        const answerInput = document.getElementById('answer-input');
        const feedbackEl = document.getElementById('feedback');
        const hintTextEl = document.getElementById('hint-text');
        const revealAnswerEl = document.getElementById('reveal-answer');
        const submitBtn = document.getElementById('submit-btn');
        const speakBtn = document.getElementById('speak-btn');
        const hintBtn = document.getElementById('hint-btn');
        const answerBtn = document.getElementById('answer-btn');
        const nextBtn = document.getElementById('next-btn');
        const closeBtn = document.getElementById('close-btn');
        const ttsSpeedSelect = document.getElementById('tts-speed');
        const ttsSystemSelect = document.getElementById('tts-system');

        const textImportModal = document.getElementById('text-import-modal');
        const textImportContent = document.getElementById('text-import-content');
        const textImportSubmitBtn = document.getElementById('text-import-submit-btn');
        const textImportCloseBtn = document.getElementById('text-import-close-btn');
        const textImportClearBtn = document.getElementById('text-import-clear-btn');
        const textImportCopyBtn = document.getElementById('text-import-copy-btn');

        const aiSupportModal = document.getElementById('ai-support-modal');
        const aiSupportCloseBtn = document.getElementById('ai-support-close-btn');

// Monthly button event listener
const textImportMonthlyBtn = document.getElementById('text-import-monthly-btn');
const monthlyModal = document.getElementById('monthly-modal');
const monthlyCloseBtn = document.getElementById('monthly-close-btn');
const monthlyClearAllBtn = document.getElementById('monthly-clear-all-btn');
const editEntryModal = document.getElementById('edit-entry-modal');
const editEntryContent = document.getElementById('edit-entry-content');
const editSaveBtn = document.getElementById('edit-save-btn');
const editCancelBtn = document.getElementById('edit-cancel-btn');
const editClearBtn = document.getElementById('edit-clear-btn');

// AI Link button
const editAiLinkBtn = document.getElementById('edit-ai-link-btn');
editAiLinkBtn.addEventListener('click', () => {
    window.open('https://chatgpt.com/share/68d63d05-8f18-800a-a2b7-e1e8a6168bc6', '_blank');
});

        // ===== VARIABLES =====
        let isSpeaking = false;
        let vocabularyData = [];
        let currentQuizWords = [];
        let currentWordIndex = -1;
        let currentWord = null;
        let recognition = null;
        let speechRate = 0.8;
        let quizMode = 'sequential';
        let currentEnglishQuizWords = [];
        let currentEnglishWordIndex = -1;
        let currentEnglishWord = null;
        let sectionProgress = {};
        let sectionOrder = [];
        let currentListenQuizWords = [];
        let currentListenWordIndex = -1;
        let currentListenWord = null;
        let questionStartTime = null;
        let isAnswered = false;
let currentEditWeek = null;
let currentEditDay = null;
let monthlyDB = null;

        let voices = [];
        let voicesLoaded = false;
        let currentTTSSystem = 'android';

// Initialize IndexedDB
function initMonthlyDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open('MonthlyLearningDB', 1);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
            monthlyDB = request.result;
            resolve(monthlyDB);
        };
        
        request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('entries')) {
                db.createObjectStore('entries', { keyPath: 'id' });
            }
        };
    });
}

// Save entry to IndexedDB
function saveEntry(week, day, content) {
    return new Promise((resolve, reject) => {
        const transaction = monthlyDB.transaction(['entries'], 'readwrite');
        const store = transaction.objectStore('entries');
        const id = `week${week}_day${day}`;
        
        const request = store.put({ id: id, week: week, day: day, content: content });
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
    });
}

// Load entry from IndexedDB
function loadEntry(week, day) {
    return new Promise((resolve, reject) => {
        const transaction = monthlyDB.transaction(['entries'], 'readonly');
        const store = transaction.objectStore('entries');
        const id = `week${week}_day${day}`;
        
        const request = store.get(id);
        
        request.onsuccess = () => {
            resolve(request.result ? request.result.content : '');
        };
        request.onerror = () => reject(request.error);
    });
}

// Delete entry from IndexedDB
function deleteEntry(week, day) {
    return new Promise((resolve, reject) => {
        const transaction = monthlyDB.transaction(['entries'], 'readwrite');
        const store = transaction.objectStore('entries');
        const id = `week${week}_day${day}`;
        
        const request = store.delete(id);
        
        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
    });
}

// Count items in entry
function countItems(content) {
    if (!content || !content.trim()) return 0;
    const lines = content.split('\n').filter(line => {
        const trimmed = line.trim();
        return trimmed && trimmed.includes('=') && !trimmed.startsWith('‚óé') && !trimmed.startsWith('@');
    });
    return lines.length;
}

// Update week counters
async function updateWeekCounters() {
    const weeks = ['1', '2', '3', '4', 'backup'];
    
    for (const week of weeks) {
        let totalCount = 0;
        const dayCount = week === 'backup' ? 5 : 7;
        
        for (let day = 1; day <= dayCount; day++) {
            const content = await loadEntry(week, day);
            totalCount += countItems(content);
        }
        
        const countEl = document.getElementById(`week${week}-count`);
        if (countEl) {
            countEl.textContent = `${totalCount} items`;
        }
    }
}

// Update day button appearance
async function updateDayButtons() {
    const allDayButtons = document.querySelectorAll('.day-btn');
    
    for (const btn of allDayButtons) {
        const week = btn.dataset.week;
        const day = btn.dataset.day;
        const content = await loadEntry(week, day);
        
        if (content && content.trim()) {
            btn.classList.add('has-content');
        } else {
            btn.classList.remove('has-content');
        }
    }
}

// Clear week data
async function clearWeek(week) {
    const dayCount = week === 'backup' ? 5 : 7;
    
    for (let day = 1; day <= dayCount; day++) {
        await deleteEntry(week, day);
    }
    
    await updateWeekCounters();
    await updateDayButtons();
}

// Clear all data
async function clearAllData() {
    const weeks = ['1', '2', '3', '4', 'backup'];
    
    for (const week of weeks) {
        await clearWeek(week);
    }
}

        // ===== TTS FUNCTIONS =====
        function loadVoices() {
            return new Promise((resolve) => {
                voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    voicesLoaded = true;
                    console.log('Voices loaded:', voices.length);
                    resolve(voices);
                } else {
                    const utterance = new SpeechSynthesisUtterance('');
                    utterance.volume = 0;
                    speechSynthesis.speak(utterance);
                    setTimeout(() => {
                        voices = speechSynthesis.getVoices();
                        voicesLoaded = true;
                        console.log('Voices loaded after trigger:', voices.length);
                        resolve(voices);
                    }, 100);
                }
            });
        }

        function getEnglishVoice() {
            if (!voicesLoaded || voices.length === 0) return null;

            if (currentTTSSystem === 'ios') {
                const iosPreferredVoices = ['Samantha', 'Tom', 'Alex', 'Karen', 'Moira'];
                for (const voiceName of iosPreferredVoices) {
                    const voice = voices.find(v => v.name.includes(voiceName));
                    if (voice) {
                        console.log('Using iOS voice:', voice.name);
                        return voice;
                    }
                }
            } else {
                const androidPreferredVoices = [
                    'Google US English',
                    'English (United States)',
                    'en-US-language',
                    'English United States',
                    'Chrome OS US English'
                ];
                for (const voiceName of androidPreferredVoices) {
                    const voice = voices.find(v =>
                        v.name.includes(voiceName) ||
                        v.name.toLowerCase().includes(voiceName.toLowerCase())
                    );
                    if (voice) {
                        console.log('Using Android voice:', voice.name);
                        return voice;
                    }
                }
            }

            const englishVoice = voices.find(v =>
                v.lang === 'en-US' ||
                v.lang.startsWith('en-') ||
                v.name.toLowerCase().includes('english')
            );
            if (englishVoice) {
                console.log(`Using fallback English voice for ${currentTTSSystem}:`, englishVoice.name);
                return englishVoice;
            }

            console.log(`Using first available voice for ${currentTTSSystem}:`, voices[0]?.name);
            return voices[0] || null;
        }

        function speak(text) {
            console.log('Speak function called with:', text, 'System:', currentTTSSystem);
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                return;
            }

            const cleanText = text.replace(/[()[\\]*]/g, '').trim();
            if (!cleanText) return;

            speechSynthesis.cancel();

            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(cleanText);
                const preferredVoice = getEnglishVoice();
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }

                utterance.lang = 'en-US';
                utterance.pitch = 1.0;
                utterance.volume = 1.0;

                if (currentTTSSystem === 'ios') {
                    utterance.rate = Math.max(0.5, speechRate * 0.9);
                } else {
                    utterance.rate = speechRate;
                    utterance.pitch = 0.95;
                }

                utterance.onstart = function() {
                    console.log('Speech started successfully');
                };

                utterance.onend = function() {
                    console.log('Speech ended normally');
                    isSpeaking = false;
                };

                utterance.onerror = function(event) {
                    console.error('Speech error:', event.error);
                    isSpeaking = false;
                };

                try {
                    speechSynthesis.speak(utterance);
                } catch (error) {
                    console.error('Failed to start speech synthesis:', error);
                }
            }, 100);
        }

        async function initializeTTS() {
            console.log('Initializing TTS...');
            const testUtterance = new SpeechSynthesisUtterance('');
            testUtterance.volume = 0;
            speechSynthesis.speak(testUtterance);
            await new Promise(resolve => setTimeout(resolve, 200));
            await loadVoices();

            if (voices.length === 0) {
                console.log('No voices found, trying again...');
                await new Promise(resolve => setTimeout(resolve, 500));
                await loadVoices();
            }

            console.log('TTS initialization complete. Voices:', voices.length);
            speechSynthesis.addEventListener('voiceschanged', () => {
                console.log('Voices changed event fired');
                loadVoices();
            });
        }

        // ===== SPEECH RECOGNITION =====
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase().trim();
                answerInput.value = transcript;
                speakBtn.textContent = 'üé§ Speak';
                speakBtn.classList.remove('recording');
            };

            recognition.onend = function() {
                speakBtn.textContent = 'üé§ Speak';
                speakBtn.classList.remove('recording');
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                speakBtn.textContent = 'üé§ Speak';
                speakBtn.classList.remove('recording');
            };
        }

        // ===== EVENT LISTENERS =====
        ttsSpeedSelect.addEventListener('change', (e) => {
            speechRate = parseFloat(e.target.value);
        });

        ttsSystemSelect.addEventListener('change', (e) => {
            currentTTSSystem = e.target.value;
            console.log(`Switched to ${currentTTSSystem} TTS system`);
            loadVoices().then(() => {
                console.log(`Voice loading complete for ${currentTTSSystem}`);
            });
        });

        document.addEventListener('change', (e) => {
            if (e.target.name === 'quiz-mode') {
                quizMode = e.target.value;
                console.log(`Quiz mode changed to: ${quizMode}`);
            }
        });

        aiSupportBtn.addEventListener('click', () => {
            aiSupportModal.style.display = 'flex';
        });

        aiSupportCloseBtn.addEventListener('click', () => {
            aiSupportModal.style.display = 'none';
        });

        textImportBtn.addEventListener('click', () => {
            textImportModal.style.display = 'flex';
        });

        textImportCloseBtn.addEventListener('click', () => {
            textImportModal.style.display = 'none';
        });

textImportMonthlyBtn.addEventListener('click', async () => {
    await initMonthlyDB();
    await updateWeekCounters();
    await updateDayButtons();
    monthlyModal.style.display = 'flex';
});

monthlyCloseBtn.addEventListener('click', () => {
    monthlyModal.style.display = 'none';
});

monthlyClearAllBtn.addEventListener('click', async () => {
    if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
        await clearAllData();
    }
});

// Edit button event listeners
document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        currentEditWeek = btn.dataset.week;
        currentEditDay = btn.dataset.day;
        
        const content = await loadEntry(currentEditWeek, currentEditDay);
        editEntryContent.value = content;
        
        monthlyModal.style.display = 'none';
        editEntryModal.style.display = 'flex';
    });
});

// Clear week button event listeners
document.querySelectorAll('.clear-week-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const week = btn.dataset.week;
        if (confirm(`Are you sure you want to clear all data for Week ${week}?`)) {
            await clearWeek(week);
        }
    });
});

// Save button
editSaveBtn.addEventListener('click', async () => {
    const content = editEntryContent.value;
    await saveEntry(currentEditWeek, currentEditDay, content);
    await updateWeekCounters();
    await updateDayButtons();
    
    editEntryModal.style.display = 'none';
    monthlyModal.style.display = 'flex';
});

// Cancel button
editCancelBtn.addEventListener('click', () => {
    editEntryModal.style.display = 'none';
    monthlyModal.style.display = 'flex';
});

// Clear button
editClearBtn.addEventListener('click', async () => {
    if (confirm('Are you sure you want to clear this entry? This action cannot be undone.')) {
        await deleteEntry(currentEditWeek, currentEditDay);
        editEntryContent.value = '';
        await updateWeekCounters();
        await updateDayButtons();
        
        editEntryModal.style.display = 'none';
        monthlyModal.style.display = 'flex';
    }
});

// Day button click handlers (load content and return to main page)
document.querySelectorAll('.day-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const week = btn.dataset.week;
        const day = btn.dataset.day;
        const content = await loadEntry(week, day);
        
        if (content && content.trim()) {
            processTextImport(content);
            monthlyModal.style.display = 'none';
            textImportModal.style.display = 'none';
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.style.cssText = `
                position: fixed; top: 20px; right: 20px; background-color: var(--accent2);
                color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold;
                z-index: 1000; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            `;
            successMessage.textContent = `‚úÖ Content loaded successfully!`;
            document.body.appendChild(successMessage);
            
            setTimeout(() => {
                if (document.body.contains(successMessage)) {
                    document.body.removeChild(successMessage);
                }
            }, 2000);
        } else {
            alert('This entry is empty. Please edit it first to add content.');
        }
    });
});

        // ===== PRESET VOCABULARY DATA =====
        const presetVocabulary = {
            textbook1: `
‚óéVocabulary #1-#15
joyous (adj)	=Âø´Ê®ÇÁöÑ„ÄÅÂñúÊÇÖÁöÑ
keep someone company (n)	=Èô™‰º¥Êüê‰∫∫
enjoy someone‚Äôs company = ‰∫´ÂèóÊüê‰∫∫ÁöÑÈô™‰º¥
essential (adj)	=ÂøÖË¶ÅÁöÑ„ÄÅÊ•µÈáçË¶ÅÁöÑ
concept (n)	=Ê¶ÇÂøµ
mourn (v)	=ÂìÄÊÇº(v)
sorrow (n)	=ÊÇ≤ÂÇ∑(Ôºùgreat sadness)
occasion (n)	=Â†¥Âêà
reunion (n)	=ÂúòËÅö(n)
anticipate (v)	=1.È†êÊñô(Ôºù expect)
anticipate (v)	=2.ÊúüÂæÖ(Ôºùlook forward to‚Ä¶)
arrival (n)	=Âà∞‰æÜ(n)
decorate (v)	=Ë£ùÈ£æ(v)
preference (n)	=ÂÅèÂ•Ω(n)
reception (n)	=Êé•ÂæÖ„ÄÅËøéÊé•(n)
feast (n)	=ÁõõÂÆ¥
dawn (n)	=ÈªéÊòé„ÄÅÁ†¥Êõâ

‚óéVocabulary #16-#25
transform (v)	=ÊîπËÆä„ÄÅËΩâËÆä(v)
resemble (v)	=Ëàá‚Ä¶Áõ∏‰ºº
participate (v)	=ÂèÉÂä†(Ôºùtake part)
mock (v)	=Âò≤Á¨ë
recognize (v)	= 1.Ë™çÂá∫ 2.Ë™çÂèØ„ÄÅÊâøË™ç
inevitable (adj)	=ÁÑ°ÂèØÈÅøÂÖçÁöÑ(Ôºùunavoidable)
cycle (n)	=Âæ™Áí∞„ÄÅÈÄ±Êúü
annual (adj)	=ÊØèÂπ¥ÁöÑ
await (v)	=Á≠âÂæÖ(Ôºùwait for‚Ä¶)
escape (v)	=ÈÄÉËÑ´„ÄÅÈÄÉÈõ¢

‚ÄªË©ûÈ°ûËÆäÂåñË£úÂÖÖ
accompany (v)	=Èô™‰º¥
mournful (adj)	=ÂìÄÂÇ∑ÁöÑ(Ôºùvery sad)
sorrowful (adj)	=ÊÇ≤ÁóõÁöÑ(Ôºùvery sad)
occasional (adj)	=ÂÅ∂ÁàæÁöÑ
reunite (v)	=ÈáçËÅö(v)
anticipation (n)	= (n) 1.È†êÊñô 2.ÊúüÂæÖ
decoration (n)	=Ë£ùÈ£æ(ÂìÅ) (n)
prefer (v)	=ÂÅèÂ•Ω(v)
receptionist (n)	=Êé•ÂæÖÂì°
feast on...	=Áõ°ÊÉÖ‰∫´Áî®(ÁæéÈ£ü)
transformation (n)	=ËΩâËÆäÔºõËÆäÂåñ(n)
resemblance (n)	=Áõ∏‰ººÔºõÁõ∏ÂÉè(n)
participation (n)	=ÂèÉÂä†ÔºõÂèÉËàá(n)
mock (adj)	= Ê®°Êì¨ÁöÑÔºõÂÅáË£ùÁöÑ
recognition (n)	 = Ë™çÂèØ„ÄÅÊâøË™ç (n)

‚óéPhrases & Idioms 
scare someone to death	=ÂöáÊ≠ªÊüê‰∫∫
make someone‚Äôs hair stand on end	=ËÆìÊüê‰∫∫ÊØõÈ™®ÊÇöÁÑ∂
in honor of...	=ÁÇ∫‰∫ÜÁ¥ÄÂøµ‚Ä¶
in advance (of...)	=Âú®‚Ä¶‰πãÂâç
die out	=ÁµïË∑°ÔºõÊ∂àÂ§±

            `,
            textbook2: `

`,
            textbook3: `

 `,
            maga1: `

 `,
            maga2: `
‚óéWorld Religions (‰∏ñÁïå‰∏äÁöÑÂÆóÊïô)
religion (n) = ÂÆóÊïô
religious (adj) = ÂÆóÊïôÁöÑÔºõËôîË™†ÁöÑ
Buddhism (n) = ‰ΩõÊïô
Buddhist (n/adj) = ‰ΩõÊïôÂæíÔºõ‰ΩõÊïôÁöÑ
Taoism (n) = ÈÅìÊïô
Taoist (n/adj) = ÈÅìÂ£´ÔºõÈÅìÊïôÁöÑ
Christianity (n) = Âü∫Áù£Êïô
Christian (n/adj) = Âü∫Áù£ÂæíÔºõÂü∫Áù£ÊïôÁöÑ
Islam (n) = ‰ºäÊñØËò≠Êïô
Islamic (adj) = ‰ºäÊñØËò≠ÁöÑ
Muslim (n/adj) = Á©ÜÊñØÊûóÔºõÂõûÊïôÁöÑ
Judaism (n) = Áå∂Â§™Êïô
Hinduism (n) = Âç∞Â∫¶Êïô
Hindu (n/adj) = Âç∞Â∫¶ÊïôÂæíÔºõÂç∞Â∫¶ÊïôÁöÑ
‚óéNov. 13‚ÄîParagraph 1
taboo (n) = Á¶ÅÂøå
avoid (v) = ÈÅøÂÖç
certain (adj) = ÊüêÂÄãÔºõÊüê‰∫õ
garlic (n) = Â§ßËíú
onion (n) = Ê¥ãËî•
due to‚Ä¶ = Áî±Êñº‚Ä¶
religious (adj) = ÂÆóÊïôÁöÑ
shape (v) = Â°ëÈÄ†„ÄÅÂΩ±Èüø
diet (n) = 1.È£≤È£ü  2.ÁØÄÈ£ü
respectful (adj) = Â∞äÈáçÁöÑ
informed = ‰∫ÜËß£ÊÉÖÊ≥ÅÁöÑ„ÄÅË¶ãÂ§öË≠òÂª£ÁöÑ
global citizen (n) = ‰∏ñÁïåÂÖ¨Ê∞ë
‚óéNov. 13‚ÄîParagraph 2
Put simply, ‚Ä¶ (= To put it simply, ‚Ä¶) = Á∞°ÂñÆ‰æÜË™™Ôºå‚Ä¶
alcohol (n) = ÈÖíÁ≤æ
forbid, forbade, forbidden = Á¶ÅÊ≠¢
prohibit (v) = Á¶ÅÊ≠¢„ÄÅÈòªÊ≠¢„ÄÅÂ¶®Á§ô
shellfish (n) = Áî≤ÊÆºÈ°ûÊ∞¥ÁîüÂãïÁâ©ÔºåÂ¶ÇÔºöËù¶„ÄÅËüπ„ÄÅÁâ°Ë†£Á≠â
dairy (n) = ‰π≥Ë£ΩÂìÅ
principle (n) = ÂéüÂâá(vs. principal Ê†°Èï∑)
harm (v) = ÂÇ∑ÂÆ≥
encourage (v) = ÈºìÂãµ
vegetarian (n/adj) = Á¥†È£üËÄÖÔºõÁ¥†È£üÁöÑ
vegetarianism (n) = Á¥†È£ü‰∏ªÁæ©
common (adj) = ÊôÆÈÅçÁöÑ
lifelong (adj) = ÁµÇË∫´ÁöÑ
compulsory (adj) = Âº∑Âà∂ÁöÑ
temporary (adj) = Êö´ÊôÇÁöÑ
voluntary (adj) = Ëá™È°òÁöÑ
instance (n) = ‰æãÂ≠ê(Ôºùexample)
include (v) = ÂåÖÂê´
food item (n) = È£üÂìÅÈ†ÖÁõÆ
cosmetics (n) = ÂåñÂ¶ùÂìÅ(Ôºùmakeup / make-up)
contain (v) = Âê´Êúâ„ÄÅÂåÖÂê´„ÄÅÂÆπÁ¥ç
ingredient (n) = ÊàêÂàÜ
be derived from‚Ä¶ = Ê∫êËá™‚Ä¶
‚óéNov. 13‚ÄîParagraph 3
exist (v) = Â≠òÂú®
historically (adv) = Ê≠∑Âè≤‰∏ä„ÄÅÂæûÊ≠∑Âè≤‰∏äÁúã
come about (v) = [ÁâáË™û] (ÂïèÈ°å„ÄÅÊÉÖÊ≥ÅÁ≠â)Áî¢Áîü„ÄÅÁôºÁîü„ÄÅÂá∫Áèæ
protect (v) = ‰øùË≠∑
be seen as‚Ä¶ = Ë¢´Ë¶ñÁÇ∫‚Ä¶(Ôºùbe viewed as‚Ä¶)
sacred (adj) = Á•ûËÅñÁöÑ
spiritual (adj) = ÂøÉÈùàÁöÑÔºõÁ≤æÁ•ûÁöÑ
connect with‚Ä¶ = Ëàá‚Ä¶ÈÄ£Áµê
faith (n) = ‰ø°‰ª∞
self-control (n) = Ëá™Âà∂Âäõ
offer (v) = Êèê‰æõ
a way to do something = ÂÅöÊüê‰∫ãÁöÑÊñπÊ≥ï
show respect for‚Ä¶ = Ë°®Á§∫Â∞ç‚Ä¶ÁöÑÂ∞äÈáç
requirement (n) = Ë¶ÅÊ±ÇÔºõÂøÖË¶ÅÊ¢ù‰ª∂
part of‚Ä¶ = ‚Ä¶ÁöÑ‰∏ÄÈÉ®ÂàÜ
someone‚Äôs identity (n) = Êüê‰∫∫ÁöÑË∫´‰ªΩ
‚óéNov. 14‚ÄîParagraph 1
roughly (adv) = Â§ßÁ¥Ñ
population (n) = ‰∫∫Âè£
identify as‚Ä¶ = Ë™çÂêåËá™Â∑±ÊòØ‚Ä¶
vegetarian food (n) = Á¥†È£ü
widely available = Âª£Ê≥õÂèØÂæóÁöÑ
decade (n) = ÂçÅÂπ¥
strengthen (v) = Âä†Âº∑
relationship (n) = Èóú‰øÇ
nation (n) = ÂúãÂÆ∂(Ôºùcountry)
increase (v) = Â¢ûÂä†
tourist (n) = ËßÄÂÖâÂÆ¢
dietary (adj) = È£≤È£üÁöÑ
demand (n) = ÈúÄÊ±Ç
meet‚Ä¶ requirements = Á¨¶Âêà‚Ä¶Ë¶ÅÊ±Ç
challenging (adj) = ÂÖ∑ÊåëÊà∞ÊÄßÁöÑ
local businesses (n) = Áï∂Âú∞ÂïÜÂÆ∂
gradually (adv) = ÈÄêÊº∏Âú∞
adapt (to‚Ä¶) (v) = ÈÅ©Êáâ‚Ä¶
meet‚Ä¶ needs = ÊªøË∂≥‚Ä¶ÈúÄÊ±Ç
import (v) = ÈÄ≤Âè£
while (conj) = ËÄå‚Ä¶(Ë°®Á§∫„ÄåÂ∞çÊØî„ÄçÔºùwhereas)
slaughter (v) = Â±†ÂÆ∞
slaughterhouse (n) = Â±†ÂÆ∞Â†¥
employ (v) = ÈõáÁî®(Ôºùhire)
staff (n) = (ÂÖ®È´î)Âì°Â∑•
technique (n) = ÊäÄË°ì
select (v) = ÈÅ∏Êìá
select (adj) = Á≤æÈÅ∏ÁöÑ
location (n) = Âú∞Èªû
‚óéNov. 14‚ÄîParagraph 2
cosmopolitan (adj) = ÂúãÈöõÂåñÁöÑÔºõ‰∏ñÁïåÊÄßÁöÑ
increasingly (adv) = Êó•ÁõäÔºõÊÑà‰æÜÊÑà‚Ä¶
be likely to‚Ä¶ = ÂæàÂèØËÉΩÊúÉ‚Ä¶
colleague (n) = Âêå‰∫ã
be aware of‚Ä¶ = ÊÑèË≠òÂà∞‚Ä¶
awkward (adj) = Â∞∑Â∞¨ÁöÑ
situation (n) = ÊÉÖÊ≥Å
‚óéNov. 14‚ÄîParagraph 3
organize an event = Á±åËæ¶Ê¥ªÂãï
empathy (n) = ÂêåÁêÜÂøÉ
be considerate of‚Ä¶ = È´îË≤º‚Ä¶
dietary needs = È£≤È£üÈúÄÊ±Ç
inclusive (adj) = ÂÖ∑ÂåÖÂÆπÊÄßÁöÑ
globally aware (adj) = ÂÖ∑ÂÖ®ÁêÉÊÑèË≠òÁöÑ„ÄÅÊúâÂúãÈöõËßÄÁöÑ

 `,
            maga3: `
‚óéNov. 26‚ÄîParagraph 1
halo (n) = ÂÖâÁí∞
effect (n) = ÊïàÊûú„ÄÅÂΩ±Èüø
halo effect (n) = ÂÖâÁí∞ÊïàÊáâ
first impression (n) = Á¨¨‰∏ÄÂç∞Ë±°
misleading (adj) = ÂÖ∑Ë™§Â∞éÊÄßÁöÑ
imagine (v) = ÊÉ≥ÂÉè(v)
stylish (adj) = ÊôÇÂ∞öÁöÑ
confidently (adv) = Ëá™‰ø°Âú∞
instantly (adv) = Á´ãÂàª(Ôºùright away, immediately)
positive (adj) = Ê≠£Èù¢ÁöÑ„ÄÅÁ©çÊ•µÁöÑ(< > negativeË≤†Èù¢ÁöÑ„ÄÅÊ∂àÊ•µÁöÑ)
trait (n) = ÁâπË≥™
appearance (n) = Â§ñË°®
assume (v) = ÂÅáË®≠ÔºõË™çÁÇ∫
discover (v) = ÁôºÁèæ
psychologist (n) = ÂøÉÁêÜÂ≠∏ÂÆ∂
‚óéNov. 26‚ÄîParagraph 2
experiment (n) = ÂØ¶È©ó
military (n/adj) = ËªçÊñπÔºõËªç‰∫ãÁöÑ
rate (v) = ÊéíÂêç„ÄÅË©ïÂÉπ„ÄÅË©ïÊØî
leadership (n) = È†òÂ∞éËÉΩÂäõ
intelligence (n) = Êô∫Âäõ 
be good at‚Ä¶ = ÊìÖÈï∑‚Ä¶
be bad at‚Ä¶ = ‰∏çÊìÖÈï∑‚Ä¶
additionally (adv) = Ê≠§Â§ñ(Ôºùbesides Ôºùin addition)
once (conj.) = ‰∏ÄÊó¶
form an opinion (about‚Ä¶) = (Â∞ç‚Ä¶)ÂΩ¢ÊàêÁúãÊ≥ï
be likely to‚Ä¶ = ÂæàÂèØËÉΩÊúÉ‚Ä¶
be unlikely to‚Ä¶ = ‰∏çÂ§™ÂèØËÉΩÊúÉ‚Ä¶
change your mind = ÊîπËÆä‰Ω†ÁöÑÊÉ≥Ê≥ï
‚óéNov. 26‚ÄîParagraph 3
explanation (n) = Ëß£Èáã(n)
evolve (v) = ÊºîÂåñ(v)
efficiency (n) = ÊïàÁéá
rely on‚Ä¶ = ‰æùÈù†‚Ä¶
blank (n) = Á©∫ÁôΩ
fill in the blanks = Â°´Á©∫
inclination (n) = ÂÇæÂêë(n)
lead to‚Ä¶ = Â∞éËá¥‚Ä¶(Ôºùcause Ôºùresult in‚Ä¶)
error (n) = ÈåØË™§(vs. mistake)
judgment (n) = Âà§Êñ∑(n)
attractive (adj) = ÊúâÂê∏ÂºïÂäõÁöÑ
be seen as‚Ä¶ = Ë¢´Ë¶ñÁÇ∫‚Ä¶(Ôºù be viewed as‚Ä¶)
capable (adj) = ÊúâËÉΩÂäõÁöÑ
even if‚Ä¶ = Âç≥‰Ωø‚Ä¶
average (adj) = 1.Âπ≥ÂùáÁöÑ  2.ÊôÆÈÄöÁöÑ„ÄÅ‰∏ÄËà¨ÁöÑ
generally (adv) = ‰∏ÄËà¨‰æÜË¨õ„ÄÅÈÄöÂ∏∏
favor (v) = ÂÅèÂ•Ω„ÄÅË¥äÂêå„ÄÅÊîØÊåÅ
consistency (n) = ‰∏ÄËá¥ÊÄß
notice (v) = Ê≥®ÊÑèÂà∞
quality (n) = ÂìÅË≥™ÔºõÁâπÊÄß
tend to do something = ÂÇæÂêëÊñºÂÅöÊüê‰∫ã
the rest (of‚Ä¶) = ÂÖ∂È§òÁöÑ‚Ä¶
match (v) = ÈÖçÂ∞çÔºõËàá‚Ä¶Áõ∏Á¨¶
‚óéNov. 27‚ÄîParagraph 1
pop up (v) = ÂÜíÂá∫ÔºõÁ™ÅÁÑ∂Âá∫Áèæ
get better treatment from someone = ÂèóÂà∞Êüê‰∫∫ËºÉÂ•ΩÁöÑÂ∞çÂæÖ
stand out (v) = ËÑ´Á©éËÄåÂá∫
advertising (n) = Âª£ÂëäÊ•≠
celebrity (n) = Âêç‰∫∫
promote (v) = Êé®Âª£„ÄÅÂÆ£ÂÇ≥(n)
product (n) = Áî¢ÂìÅ
transfer‚Ä¶ to‚Ä¶ (v) = Â∞á‚Ä¶ËΩâÁßªÂà∞‚Ä¶
positive image (n) = Ê≠£Èù¢ÂΩ¢Ë±°
sales (n) = Èä∑ÂîÆÈáè
social media (n) = Á§æÁæ§Â™íÈ´î
a viral post (n) = ‰∏ÄÂâáÁàÜÁ¥ÖÁöÑË≤ºÊñá
single (adj) = 1.ÂñÆ‰∏ÄÁöÑ  2.Êú™Â©öÁöÑ
expert (n) = Â∞àÂÆ∂
influence (v) = ÂΩ±Èüø(n) (Ôºùeffect, impact)
judge (v) = Âà§Êñ∑(v)
‚óéNov. 27‚ÄîParagraph 2
be susceptible to‚Ä¶ = ÂÆπÊòìÂèóÂà∞‚Ä¶ÂΩ±Èüø
lessen (v) = Ê∏õËºï
question (v) = Ë≥™Áñë
influencer (n) = ÂΩ±ÈüøËÄÖÔºõÁ∂≤Á¥Ö
reduce (v) = Ê∏õÂ∞ë
bias (n) = ÂÅèË¶ã
‚óéNov. 27‚ÄîParagraph 3
in conclusion = Á∏Ω‰πã
avoid (v) = ÈÅøÂÖç
be misled by‚Ä¶ = Ë¢´‚Ä¶Ë™§Â∞é
remain (+ adj) (v) = ‰øùÊåÅ‚Ä¶ÁöÑÁãÄÊÖã
alert (adj) = Ë≠¶Ë¶∫ÁöÑ
thoughtful (adj) = Ê∑±ÊÄùÁöÑÔºõÈ´îË≤ºÁöÑ
make judgments = ÂÅöÂá∫Âà§Êñ∑
strive to do something = Âä™ÂäõÂéªÂÅöÊüê‰∫ã
base‚Ä¶ on‚Ä¶ = ‰ª•‚Ä¶ÁÇ∫Âü∫Á§é
merit (n) = ÂÑ™ÈªûÔºõÈï∑Ëôï
treat someone fairly = ÂÖ¨Âπ≥Â∞çÂæÖÊüê‰∫∫
hopefully (adv) = ‰ΩÜÈ°ò
do the same = ÂÅöÂêåÊ®£ÁöÑ‰∫ã

 `,
            maga4: `

 `,
            core1: `
‚óéWords/Phrases
dominant (adj) = ‰∏ªË¶ÅÁöÑÔºõ‰ΩîÂÑ™Âã¢ÁöÑ
rank (n) = ÊéíÂêçÔºõÈöéÁ¥ö
figure (n) = 1.Êï∏Â≠ó
figure (n) = 2.(ÈÅ†ËôïorÁúã‰∏çÊ∏ÖÊ•öÁöÑ)‰∫∫ÁöÑË∫´ÂΩ±
a leading/key/central figure = ÈáçË¶Å‰∫∫Áâ©
suffer (v) = ÈÅ≠ÂèóÔºõÂèóËã¶
scarcity (n) = Áº∫‰πèÔºõÁ®ÄÂ∞ë
remedy (n) = ÁôÇÊ≥ï„ÄÅË£úÊïëÊñπÊ≥ï
remedy (v) = ÊîπÂñÑÔºõË£úÊïë
strike (v) = ÊâìÊìäÔºõÊìä‰∏≠
(disaster/disease) strike (v) = ÔºàÁÅΩÂÆ≥„ÄÅÁñæÁóÖÁ≠âÔºâË•≤ÊìäÔºõ‰æµË•≤
devil (n) = ÊÉ°È≠î
advantage (n) = ÂÑ™Âã¢ÔºõÂ•ΩËôï
cope with‚Ä¶ = Êáâ‰ªòÔºõËôïÁêÜ
struggle (v) = ÊéôÊâé„ÄÅËâ±Èõ£Âú∞ÂÅöÊüê‰∫ã
physical (adj) = Ë∫´È´îÁöÑÔºàvs.ÂøÉÁêÜÁöÑ mentalÔºâ
be aware of‚Ä¶ = ÊÑèË≠òÂà∞‚Ä¶
confidence (n) = Ëá™‰ø°Ôºõ‰ø°ÂøÉ
sympathetic (adj) = ÊúâÂêåÊÉÖÂøÉÁöÑÔºõÊúâÂêåÁêÜÂøÉÁöÑ
gear (n) = Ë£ùÂÇôÔºõË®≠ÂÇô
capable (adj) = ÊúâËÉΩÂäõÁöÑÔºõËÉΩÂππÁöÑ
be capable of (doing something) = ÊúâËÉΩÂäõÂÅö‚Ä¶
accomplishment (n) = ÊàêÂ∞±ÔºõÂÆåÊàêÁöÑ‰∫ã
‚óéExample Sentences
Lions are the dominant animals in this area. = ÁçÖÂ≠êÊòØÈÄôÂú∞ÂçÄÁöÑÂÑ™Âã¢ÂãïÁâ©„ÄÇ
He reached the top rank in the army. = ‰ªñÂú®Ëªç‰∏≠ÈÅîÂà∞ÊúÄÈ´òÈöéÁ¥ö„ÄÇ
That company reported a high sales figure. = ÈÇ£ÂÆ∂ÂÖ¨Âè∏Â†±Âëä‰∫Ü‰∏ÄÂÄãÈ´òÈä∑ÂîÆÊï∏Â≠ó„ÄÇ
I saw a tall figure walking in the fog. = ÊàëÁúãÂà∞‰∏ÄÂÄãÈ´òÂ§ßÁöÑ‰∫∫ÂΩ±Ëµ∞Âú®Èúß‰∏≠„ÄÇ
She is a key figure in the fashion industry. = Â•πÊòØÊôÇÂ∞öÁïåÁöÑÈáçË¶Å‰∫∫Áâ©„ÄÇ
Many people suffer from stress at work. = Ë®±Â§ö‰∫∫Âú®Â∑•‰Ωú‰∏≠È£ΩÂèóÂ£ìÂäõ„ÄÇ
There is a scarcity of food after the storm. = Êö¥È¢®Èõ®ÈÅéÂæåÈ£üÁâ©Áü≠Áº∫„ÄÇ
This cream is a good remedy for dry skin. = ÈÄôÊ¨æ‰π≥ÈúúÊòØ‰πæÁá•ËÇåËÜöÁöÑËâØÊñπ„ÄÇ
We must remedy the problem quickly. = ÊàëÂÄëÂøÖÈ†àËøÖÈÄüÊîπÂñÑÈÄôÂÄãÂïèÈ°å„ÄÇ
He will strike the ball with great power. = ‰ªñÊúÉÁî®ÂäõÊìäÁêÉ„ÄÇ
A serious disease may strike the village. = Âö¥ÈáçÁñæÁóÖÂèØËÉΩ‰æµË•≤ÈÄôÂÄãÊùëËéä„ÄÇ
The story tells about a fight between an angel and a devil. = ÈÄôÊïÖ‰∫ãË¨õËø∞Â§©‰ΩøËàáÊÉ°È≠î‰πãÈñìÁöÑÊà∞È¨•„ÄÇ
Having experience is a big advantage in finding a job. = ÊúâÁ∂ìÈ©óÂú®ÊâæÂ∑•‰ΩúÊôÇÊòØ‰∏ÄÂ§ßÂÑ™Âã¢„ÄÇ
She can cope with difficult situations calmly. = Â•πËÉΩÂÜ∑ÈùúÂú∞Êáâ‰ªòÂõ∞Èõ£ÊÉÖÊ≥Å„ÄÇ
He struggled to lift the heavy box. = ‰ªñÂ•ÆÂäõÊê¨Ëµ∑ÈÇ£ÂÄãÈáçÁÆ±Â≠ê„ÄÇ
Running improves your physical health. = Ë∑ëÊ≠•ËÉΩÊîπÂñÑ‰Ω†ÁöÑË∫´È´îÂÅ•Â∫∑„ÄÇ
The old man is not aware of his health problems. = ÈÄôÂÄãËÄÅ‰∫∫Ê≤íÊúâÊÑèË≠òÂà∞Ëá™Â∑±ÁöÑÂÅ•Â∫∑ÂïèÈ°å„ÄÇ
He has confidence in his speaking skills. = ‰ªñÂ∞çËá™Â∑±ÁöÑÂè£Ë™™ËÉΩÂäõÊúâ‰ø°ÂøÉ„ÄÇ
She was very sympathetic to my situation. = Â•πÂ∞çÊàëÁöÑÊÉÖÊ≥ÅÊÑüÂà∞ÂêåÊÉÖ„ÄÇ
You need the right gear for camping. = Èú≤ÁáüÈúÄË¶ÅÂêàÈÅ©ÁöÑË£ùÂÇô„ÄÇ
She is capable and hardworking. = Â•πÂæàËÉΩÂππÂèàÂã§Âãû„ÄÇ
He is capable of solving complex problems. = ‰ªñÊúâËÉΩÂäõËß£Ê±∫Ë§áÈõúÂïèÈ°å„ÄÇ
Becoming an NBA champion is a great accomplishment. = ÊàêÁÇ∫NBAÂÜ†ËªçÊòØ‰∏ÄÈ†ÖÂæàÂ§ßÁöÑÊàêÂ∞±„ÄÇ

 `,
            core2: `
‚óéWords/Phrases
serve (food) (v) =Êèê‰æõÔºàÈ§êÈªûÔºâ
fare (n) = 1.‰∫§ÈÄöË≤ª
fare (n) = 2.ÁâπÂÆöÈ§êÂª≥ÊàñÂ†¥ÂêàÊèê‰æõÁöÑÈ£üÁâ©
cultural (adj) = ÊñáÂåñÁöÑ
particularly (adv) = ÁâπÂà•Âú∞ÔºõÂ∞§ÂÖ∂
pride oneself on‚Ä¶ = ‰ª•‚Ä¶ÁÇ∫ÂÇ≤
for instance = ‰æãÂ¶Ç(Ôºù for example)
boast (v) = 1.Ë™áËÄÄÔºõÂêπÂôì
boast (v) = 2.‰ª•ÊìÅÊúâ‚Ä¶ËÄåËá™Ë±™
regional (adj) = Âú∞ÂçÄÁöÑÔºõÂú∞ÊñπÊÄßÁöÑ
exist (v) = Â≠òÂú®
distinguished (adj) = ÂçìË∂äÁöÑÔºõÂÇëÂá∫ÁöÑ
include (v) = ÂåÖÂê´
method (n) = ÊñπÊ≥ï
result in‚Ä¶ (v) = Â∞éËá¥‚Ä¶ÔºõÈÄ†Êàê‚Ä¶
genuine (adj) = 1.ÁúüÊ≠£ÁöÑ(Ôºùreal vs. fake)
genuine (adj, sincere) = 2.ÁúüË™†ÁöÑ(Ôºùsincere)
toss (v) = ÊããÔºõÊâîÔºõÊî™Êãå
constantly (adv) = ‰∏çÊñ∑Âú∞ÔºõÊåÅÁ∫åÂú∞
apply (v) = ÊáâÁî®
apply (v) = Áî≥Ë´ã
apply (v) = Â°óÊäπ
(rule) apply to‚Ä¶ = ÔºàË¶èÂâáÁ≠âÔºâÈÅ©Áî®Êñº‚Ä¶
season (v) = Ë™øÂë≥
diner (n) = Áî®È§êËÄÖ
diner (n) = Ë∑ØÈÇäÁöÑÂ∞èÈ§êÈ§®
frequently (adv) = È†ªÁπÅÂú∞ÔºõÁ∂ìÂ∏∏
additional (adj) = È°çÂ§ñÁöÑÔºõÈôÑÂä†ÁöÑ
consume (v) = 1.ÂêÉ or Âñù
consume (v) = 2.Ê∂àËÄóÔºõËÄóË≤ª(ËÉΩÊ∫ê„ÄÅÊôÇÈñì„ÄÅÂïÜÂìÅÁ≠â)
consist of‚Ä¶= Áî±‚Ä¶ÁµÑÊàê(Ôºù be made up of‚Ä¶)
traditionally (adv) = ÂÇ≥Áµ±‰∏ä
‚óéExample Sentences
They serve breakfast until ten o‚Äôclock. = ‰ªñÂÄë‰æõÊáâÊó©È§êÂà∞ÂçÅÈªû„ÄÇ
The bus fare is five dollars. = ÂÖ¨ËªäË≤ªÊòØ‰∫îÁæéÂÖÉ„ÄÇ
The restaurant offers Italian fare. = ÈÄôÂÆ∂È§êÂª≥Êèê‰æõÁæ©Â§ßÂà©Ëèú„ÄÇ
Cultural events bring people together. = ÊñáÂåñÊ¥ªÂãïËÆì‰∫∫ÂÄëËÅöÂú®‰∏ÄËµ∑„ÄÇ
She particularly likes Japanese food. = Â•πÁâπÂà•ÂñúÊ≠°Êó•Êú¨ÊñôÁêÜ„ÄÇ
He prides himself on his cooking skills. = ‰ªñ‰ª•Ëá™Â∑±ÁöÑÂªöËóùÁÇ∫ÂÇ≤„ÄÇ
For instance, apples grow well in cold areas. = ‰æãÂ¶ÇÔºåËòãÊûúÂú®ÂØíÂÜ∑Âú∞ÂçÄÈï∑ÂæóÂ•Ω„ÄÇ
He always boasts about his success. = ‰ªñÁ∏ΩÊòØË™áËÄÄËá™Â∑±ÁöÑÊàêÂäü„ÄÇ
The city boasts many beautiful parks. = ÈÄôÂ∫ßÂüéÂ∏Ç‰ª•ÊìÅÊúâË®±Â§öÁæéÈ∫óÂÖ¨ÂúíËÄåËá™Ë±™„ÄÇ
This dish is popular in regional markets. = ÈÄôÈÅìËèúÂú®Âú∞ÊñπÂ∏ÇÂ†¥ÂæàÂèóÊ≠°Ëøé„ÄÇ
Dinosaurs no longer exist today. = ÊÅêÈæçÂ¶Ç‰ªäÂ∑≤‰∏çÂ≠òÂú®„ÄÇ
She is a distinguished writer. = Â•πÊòØ‰∏Ä‰ΩçÂÇëÂá∫ÁöÑ‰ΩúÂÆ∂„ÄÇ
The set menu includes a drink and dessert. = Â•óÈ§êÂåÖÂê´È£≤ÊñôÂíåÁîúÈªû„ÄÇ
He used a new method to solve the problem. = ‰ªñÁî®Êñ∞ÊñπÊ≥ïËß£Ê±∫ÂïèÈ°å„ÄÇ
Too much sugar can result in health problems. = Â§™Â§öÁ≥ñÊúÉÂ∞éËá¥ÂÅ•Â∫∑ÂïèÈ°å„ÄÇ
This is a genuine diamond ring. = ÈÄôÊòØ‰∏ÄÊûöÁúüÊ≠£ÁöÑÈëΩÊàí„ÄÇ
He showed genuine interest in my story. = ‰ªñÂ∞çÊàëÁöÑÊïÖ‰∫ãË°®ÁèæÂá∫ÁúüË™†ÁöÑËààË∂£„ÄÇ
I tossed the paper into the garbage can. = ÊàëÊääÁ¥ôÊâîÈÄ≤ÂûÉÂúæÊ°∂„ÄÇ
She constantly checks her phone. = Â•π‰∏çÊñ∑Êü•ÁúãÊâãÊ©ü„ÄÇ
You can apply this rule to all cases. = ‰Ω†ÂèØ‰ª•Â∞áÊ≠§Ë¶èÂâáÊáâÁî®ÊñºÊâÄÊúâÊÉÖÊ≥Å„ÄÇ
He applied for a new job yesterday. = ‰ªñÊò®Â§©Áî≥Ë´ã‰∫Ü‰∏Ä‰ªΩÊñ∞Â∑•‰Ωú„ÄÇ
Apply cream to your hands every night. = ÊØèÊôöÂú®Êâã‰∏äÂ°ó‰π≥Èúú„ÄÇ
This rule applies to every student. = ÈÄôÊ¢ùË¶èÂâáÈÅ©Áî®ÊñºÊØèÂÄãÂ≠∏Áîü„ÄÇ
Season the soup with salt and pepper. = Áî®ÈπΩÂíåËÉ°Ê§íÁµ¶ÊπØË™øÂë≥„ÄÇ
Each diner enjoyed the meal happily. = ÊØè‰ΩçÁî®È§êËÄÖÈÉΩÊÑâÂø´Âú∞‰∫´Áî®È§êÈªû„ÄÇ
We stopped at a small diner for lunch. = ÊàëÂÄëÂú®‰∏ÄÂÆ∂Â∞èÈ§êÈ§®ÂÅú‰∏ãÂêÉÂçàÈ§ê„ÄÇ
He frequently visits his grandparents. = ‰ªñÁ∂ìÂ∏∏ÂéªÁúãÁ•ñÁà∂ÊØç„ÄÇ
We need additional chairs for the guests. = ÊàëÂÄëÈúÄË¶ÅÈ°çÂ§ñÁöÑÊ§ÖÂ≠êÁµ¶ÂÆ¢‰∫∫„ÄÇ
Kids should not consume too much sugar. = Â∞èÂ≠©‰∏çË©≤ÂêÉÂ§™Â§öÁ≥ñ„ÄÇ
This car consumes too much fuel. = ÈÄôËºõËªäËÄóÊ≤πÂ§™Â§ö„ÄÇ
A basketball team consists of 12 players. = ‰∏ÄÂÄãÁ±ÉÁêÉÈöäÁî±ÂçÅ‰∫åÂÄãÈöäÂì°ÁµÑÊàê„ÄÇ
Traditionally, people eat mooncakes during the festival. = ÂÇ≥Áµ±‰∏äÔºå‰∫∫ÂÄëÂú®ÁØÄÊó•ÊúüÈñìÂêÉÊúàÈ§Ö„ÄÇ

 `,
            core3: `
‚óéWords/Phrases
debate (n/v) = ËæØË´ñÔºõÁà≠Ë´ñ
be superior to‚Ä¶ = ÊØî‚Ä¶ÂÑ™Ë∂ä
be inferior to‚Ä¶ = ÊØî‚Ä¶Â∑Æ
intelligent (adj) = ËÅ∞ÊòéÁöÑÔºõÊúâÊô∫ÊÖßÁöÑ
feature (v) = ‰ª•‚Ä¶ÁÇ∫ÁâπËâ≤
graduate (v) = Áï¢Ê•≠
a college graduate (n) = Â§ßÂ≠∏Áï¢Ê•≠Áîü
graduate school (n) = Á†îÁ©∂ÊâÄ(Ôºùgrad school)
professor (n) = ÊïôÊéà
sample (n) = Ê®£Êú¨ÔºõÊ®£ÂìÅ
measure (v) = Ê∏¨ÈáèÔºõË°°Èáè
indicate (v) = Ë°®Á§∫ÔºõÈ°ØÁ§∫
emotional (adj) = ÊÉÖÁ∑íÁöÑÔºõÊøÄÂãïÁöÑ
admit (v) = ÊâøË™ç
limited (adj) = ÊúâÈôêÁöÑ
laboratory (n) = ÂØ¶È©óÂÆ§(Ôºùlab)
familiar (adj) = ÁÜüÊÇâÁöÑ
match (v) = ÈÖçÂ∞çÔºõËàá‚Ä¶Áõ∏ÈÖç
match (n) = 1.ÊØîË≥Ω(Ôºùcompetition)
match (n) = 2.ÂØ¶ÂäõÁõ∏Áï∂ÁöÑÂ∞çÊâã
light a match (v phr) = ÈªûÁáÉÁÅ´Êü¥
corresponding (adj) = Áõ∏ÊáâÁöÑÔºõÂ∞çÊáâÁöÑ
facial (adj) = ËáâÈÉ®ÁöÑ
expression (n) = Ë°®ÈÅîÊñπÂºèÔºõÊé™Ëæ≠
(facial) expression (n) = Ë°®ÊÉÖ
interact with someone (v phr) = ËàáÊüê‰∫∫‰∫íÂãï
avoid (v) = ÈÅøÂÖç
upset (adj) = Èõ£ÈÅéÁöÑÔºõÂøÉÁÖ©ÁöÑ
upset (v) = ‰ΩøÂøÉÁÖ©Ôºõ‰ΩøÈõ£ÈÅé
complex  (adj) = Ë§áÈõúÁöÑ(Ôºù complicated vs. simple)
prefer (v) = ÂÅèÂ•ΩÔºõÊõ¥ÂñúÊ≠°
‚óéExample Sentences
They had a debate about school rules. = ‰ªñÂÄëÂ∞±Ê†°Ë¶èÈÄ≤Ë°åËæØË´ñ„ÄÇ
This phone is superior to the old model. = ÈÄôÊîØÊâãÊ©üÊØîËàäÊ¨æÊõ¥Â•Ω„ÄÇ
His English is inferior to his math. = ‰ªñÁöÑËã±ÊñáÊØîÊï∏Â≠∏Â∑Æ„ÄÇ
She is an intelligent student. = Â•πÊòØÂÄãËÅ∞ÊòéÁöÑÂ≠∏Áîü„ÄÇ
Daxi features tofu products. = Â§ßÊ∫™ÁöÑÁâπËâ≤ÊòØË±ÜËÖêË£ΩÂìÅ„ÄÇ
He will graduate from college this year. = ‰ªñ‰ªäÂπ¥Â∞áÂæûÂ§ßÂ≠∏Áï¢Ê•≠„ÄÇ
She is a college graduate from Taiwan. = Â•πÊòØ‰∏Ä‰Ωç‰æÜËá™Âè∞ÁÅ£ÁöÑÂ§ßÂ≠∏Áï¢Ê•≠Áîü„ÄÇ
He plans to go to graduate school next year. = ‰ªñÊâìÁÆóÊòéÂπ¥ÂøµÁ†îÁ©∂ÊâÄ„ÄÇ
The professor gave a lecture on history. = ÊïôÊéàË¨õÊéà‰∫Ü‰∏ÄÂ†ÇÊ≠∑Âè≤Ë™≤„ÄÇ
The scientist tested the water sample. = ÁßëÂ≠∏ÂÆ∂Ê™¢Ê∏¨‰∫ÜÊ∞¥Ê®£Êú¨„ÄÇ
We measure our weight with a scale. = ÊàëÂÄëÁî®Áß§Ê∏¨ÈáèÈ´îÈáç„ÄÇ
The results indicate that the plan works. = ÁµêÊûúÈ°ØÁ§∫ÈÄôÂÄãË®àÁï´ÊúâÊïà„ÄÇ
She became emotional during the speech. = Â•πÂú®ÊºîË¨õ‰∏≠ËÆäÂæóÊÉÖÁ∑íÊøÄÂãï„ÄÇ
He admitted his mistake honestly. = ‰ªñË™†ÂØ¶Âú∞ÊâøË™çÈåØË™§„ÄÇ
There is limited space in this room. = ÈÄôÊàøÈñìÁöÑÁ©∫ÈñìÊúâÈôê„ÄÇ
The experiment was done in a lab. = ÂØ¶È©óÊòØÂú®ÂØ¶È©óÂÆ§Ë£°ÈÄ≤Ë°åÁöÑ„ÄÇ
I am familiar with that song. = ÊàëÂ∞çÈÇ£È¶ñÊ≠åÂæàÁÜüÊÇâ„ÄÇ
This color matches your shoes. = ÈÄôÈ°èËâ≤Âíå‰Ω†ÁöÑÈûãÂ≠êÂæàÊê≠„ÄÇ
They won the soccer match easily. = ‰ªñÂÄëËºïÈ¨ÜË¥èÂæóË∂≥ÁêÉÊØîË≥Ω„ÄÇ
She finally met her match in the game. = Â•πÁµÇÊñºÂú®ÊØîË≥Ω‰∏≠ÈÅáÂà∞ÂØ¶ÂäõÁõ∏Áï∂ÁöÑÂ∞çÊâã„ÄÇ
He used a stick to light a match. = ‰ªñÁî®Êú®Ê£íÈªûÁáÉÁÅ´Êü¥„ÄÇ
Each worker got corresponding pay. = ÊØè‰ΩçÂ∑•‰∫∫ÊãøÂà∞Â∞çÊáâÁöÑËñ™Ê∞¥„ÄÇ
She has clear facial features. = Â•πÁöÑËáâÈÉ®ÁâπÂæµÂæàÊòéÈ°Ø„ÄÇ
That expression is common in daily English. = ÈÇ£ÂÄãÁî®Ë™ûÂú®Êó•Â∏∏Ëã±Êñá‰∏≠ÂæàÂ∏∏Ë¶ã„ÄÇ
Her facial expression showed surprise. = Â•πÁöÑË°®ÊÉÖÈ°ØÁ§∫Âá∫È©öË®ù„ÄÇ
Children need to interact with others often. = Â≠©Â≠êÈúÄË¶ÅÁ∂ìÂ∏∏Ëàá‰ªñ‰∫∫‰∫íÂãï„ÄÇ
Try to avoid making the same mistake. = Ë©¶ËëóÈÅøÂÖçÁäØÁõ∏ÂêåÁöÑÈåØË™§„ÄÇ
She felt upset after hearing the news. = ËÅΩÂà∞Ê∂àÊÅØÂæåÂ•πÂæàÈõ£ÈÅé„ÄÇ
The loud noise upset the baby. = Â∑®Â§ßÁöÑÂô™Èü≥ËÆìÂ¨∞ÂÖíÂèóÈ©öÂì≠È¨ß„ÄÇ
The math problem is too complex for me. = ÈÄôÊï∏Â≠∏È°åÂ∞çÊàë‰æÜË™™Â§™Ë§áÈõú„ÄÇ
I prefer tea to coffee. = ÊàëÊØîËµ∑ÂíñÂï°Êõ¥ÂñúÊ≠°Ëå∂„ÄÇ

 `,

            other1: `
‚óéStep 1: Guess meaning from context (for üëÄ üéß üé§)
The soldier took off his uniform and became a *civilian* again. = ÈÇ£‰ΩçÂ£´ÂÖµËÑ´‰∏ãËªçË£ùÔºåÂÜçÊ¨°ÊàêÁÇ∫Âπ≥Ê∞ë„ÄÇ
The teacher made an *analysis* of the test results for the class. = ËÄÅÂ∏´ÁÇ∫Áè≠Á¥öÂÅö‰∫ÜÊ∏¨È©óÁµêÊûúÁöÑÂàÜÊûê„ÄÇ
The bus came to a sudden *halt* in the middle of the street. = ÂÖ¨ËªäÁ™ÅÁÑ∂Âú®È¶¨Ë∑Ø‰∏≠ÈñìÂÅú‰∏ã‰æÜ„ÄÇ
Be careful with that vase, it is very *delicate* and can break easily. = Â∞èÂøÉÈÇ£ÂÄãËä±Áì∂ÔºåÂÆÉÈùûÂ∏∏ËÑÜÂº±ÔºåÂæàÂÆπÊòìÁ†¥Êéâ„ÄÇ
She felt *ashamed* after telling a lie to her best friend. = Â•πÂ∞çÊúÄÂ•ΩÁöÑÊúãÂèãË™™Ë¨äÂæåÊÑüÂà∞ÁæûÊÑß„ÄÇ
The job *applicant* showed his documents and waited for the interview. = Ê±ÇËÅ∑ËÄÖÂá∫Á§∫Êñá‰ª∂‰∏¶Á≠âÂæÖÈù¢Ë©¶„ÄÇ
You need a password to get *access* to this online class. = ‰Ω†ÈúÄË¶ÅÂØÜÁ¢ºÊâçËÉΩÈÄ≤ÂÖ•ÈÄôÂÄãÁ∑ö‰∏äË™≤Á®ã„ÄÇ
He wore special climbing *gear* to stay safe on the mountain. = ‰ªñÁ©øËëóÁâπÂà•ÁöÑÁôªÂ±±Ë£ùÂÇô‰ª•‰øùÊåÅÂÆâÂÖ®„ÄÇ
He is very smart, but *after all*, he is still only a child. = ‰ªñÂæàËÅ∞ÊòéÔºå‰ΩÜÁï¢Á´üÈÇÑÂè™ÊòØÂÄãÂ≠©Â≠ê„ÄÇ
Take an umbrella *in case* it rains later today. = Â∏∂ÊääÈõ®ÂÇòÔºå‰ª•Èò≤‰ªäÂ§©Êôö‰∫õÊôÇÂÄô‰∏ãÈõ®„ÄÇ

---

‚óéStep 2: Focus on the vocab  (for üëÄ üéß üé§)
civilian (n.) = Âπ≥Ê∞ë
analysis (n.) = ÂàÜÊûê
halt (n./v.) = ÂÅúÊ≠¢
delicate (adj.) = ËÑÜÂº±ÁöÑÔºõÁ≤æÁ∑ªÁöÑ
ashamed (adj.) = ÁæûÊÑßÁöÑ
applicant (n.) = Áî≥Ë´ã‰∫∫
access (n./v.) = ‰ΩøÁî®Ê¨äÔºõÈÄ≤ÂÖ•
gear (n.) = Ë£ùÂÇôÔºõÂ∑•ÂÖ∑
after all = 1.Áï¢Á´ü  2.ÁµÇÁ©∂
in case = ‰ª•Èò≤(Êüê‰∫ãÁôºÁîü)

---

‚óéStep 3: English definition  (for üëÄ üéß)
a person who is not in the military = civilian
a careful study of something = analysis
a stop or to stop = halt
easily broken or needing care = delicate
feeling bad because of doing something wrong = ashamed
a person who asks for a job or place = applicant
the chance to enter or use something = access
special clothes or tools for an activity = gear
used to explain something that is still true = after all
used to say ‚Äúif something happens‚Äù = in case

---

‚óéStep 4: Blank filling quiz  (for üé§)
civilian = The area is safe, and every _____ can walk there without fear.
analysis = The doctor gave an _____ of the test to explain the sickness.
halt = The police told the car to _____ at the corner for checking.
delicate = The baby‚Äôs skin is very _____, so use soft clothes for him.
ashamed = He felt _____ because he forgot his mother‚Äôs birthday.
applicant = Each _____ must write their name clearly on the form.
access = Only teachers have _____ to the office after school.
gear = Don‚Äôt forget to bring your camping _____ for the trip tomorrow.
after all = She was late, but _____ she still arrived at the party safely.
in case = Take some money _____ you need to buy food on the way.

`,
            other2: `
            ‚óéStep 1: Guess meaning from context (for üëÄ üéß üé§)
Small plants can **thrive** in good soil with plenty of water. = Â∞èÊ§çÁâ©Âú®ËÇ•Ê≤ÉÂèàÊúâË∂≥Â§†Ê∞¥ÁöÑÂúüÂ£§‰∏≠ËÉΩËåÅÂ£ØÊàêÈï∑„ÄÇ
The old building began to **decline** after many years without care. = ÈÄôÊ£üËÄÅÊàøÂ≠êÂ§öÂπ¥Êú™Á∂≠Ë≠∑ÈñãÂßãË°∞ÈÄÄ„ÄÇ
The country suffered from **corruption** in the government. = ÈÄôÂÄãÂúãÂÆ∂ÂèóÊîøÂ∫úË≤™ËÖêÊâÄÂÆ≥„ÄÇ
Her grandmother‚Äôs kindness is her **legacy** to the family. = Â•πÁ•ñÊØçÁöÑÂñÑËâØÊòØÁïôÁµ¶ÂÆ∂‰∫∫ÁöÑÈÅ∫Áî¢„ÄÇ
Soldiers had to **combat** enemies during the war. = Â£´ÂÖµÂú®Êà∞Áà≠‰∏≠ÂøÖÈ†àÂ∞çÊäóÊïµ‰∫∫„ÄÇ
The child would **cling** to his mother when scared. = ÈÄôÂ≠©Â≠êÂÆ≥ÊÄïÊôÇÊúÉÁ∑äÁ∑äÊä±ËëóÂ™ΩÂ™Ω„ÄÇ
People voted for their leader using a **ballot**. = ‰∫∫ÂÄëÁî®ÈÅ∏Á•®ÈÅ∏Âá∫‰ªñÂÄëÁöÑÈ†òÂ∞é‰∫∫„ÄÇ
The company‚Äôs secret deal caused a big **scandal**. = ÈÄôÂÆ∂ÂÖ¨Âè∏ÁßòÂØÜ‰∫§ÊòìÂºïÁôºÂ§ßÈÜúËÅû„ÄÇ
The car crash left him with deep **trauma**. = ÈÇ£Â†¥ËªäÁ¶çËÆì‰ªñÁïô‰∏ãÊ∑±Ê∑±ÁöÑÂâµÂÇ∑„ÄÇ
Teachers work to **facilitate** learning in the classroom. = ËÄÅÂ∏´Âä™Âäõ‰øÉÈÄ≤Ë™≤Â†Ç‰∏≠ÁöÑÂ≠∏Áøí„ÄÇ

---

‚óéStep 2: Focus on the vocab (for üëÄ üéß üé§)
thrive (v.) = ËåÅÂ£ØÊàêÈï∑ÔºõÁπÅÊ¶Æ
decline (v.) = Ë°∞ÈÄÄÔºõ‰∏ãÈôç
corruption (n.) = Ë≤™ËÖêÔºõËÖêÊïó
legacy (n.) = ÈÅ∫Áî¢ÔºõÁïôÁµ¶Âæå‰∫∫ÁöÑÊù±Ë•ø
combat (v.) = Â∞çÊäóÔºõÊà∞È¨•
cling (v.) = Á∑äÊäìÔºõ‰æùÈôÑ
ballot (n.) = ÈÅ∏Á•®
scandal (n.) = ÈÜúËÅû
trauma (n.) = ÂâµÂÇ∑
facilitate (v.) = ‰øÉÈÄ≤Ôºõ‰ΩøÂÆπÊòì

---

‚óéStep 3: English definition (for üëÄ üéß)
to grow well and be successful = thrive
to become weaker or worse = decline
dishonest or illegal behavior by powerful people = corruption
something handed down from the past = legacy
to fight against or try to stop something = combat
to hold tightly or stay very close = cling
a piece of paper used to vote = ballot
an event that causes public shame or anger = scandal
a very painful experience or injury = trauma
to make something easier or help it happen = facilitate

---

‚óéStep 4: Blanking filling quiz (for üé§)
thrive = The flowers will _____ with enough sunlight and water.
decline = His health began to _____ after the long illness.
corruption = Many people protested against the government‚Äôs _____.
legacy = Her book became a lasting _____ for future readers.
combat = The new medicine helps _____ the spread of disease.
cling = The baby will _____ to her father‚Äôs hand.
ballot = Each voter must place a _____ in the box.
scandal = The movie star faced a _____ that shocked the fans.
trauma = The soldier carried the _____ of war for years.
facilitate = Computers can _____ faster communication in business.
            
            `,
            other3: `
            ‚óéStep 1: Guess meaning from context (for üëÄ üéß üé§)
The earth makes one full **rotation** every 24 hours. = Âú∞ÁêÉÊØè 24 Â∞èÊôÇËá™ËΩâ‰∏ÄÂúà„ÄÇ
She read a short **excerpt** from her favorite book in class. = Â•πÂú®Ë™≤Â†Ç‰∏äËÆÄ‰∫Ü‰∏ÄÂ∞èÊÆµÊúÄÂñúÊ≠°ÁöÑÊõ∏„ÄÇ
If you don‚Äôt choose a setting, the computer uses the **default**. = Â¶ÇÊûú‰Ω†‰∏çÈÅ∏Ë®≠ÂÆöÔºåÈõªËÖ¶ÊúÉÁî®È†êË®≠ÂÄº„ÄÇ
Several parties formed a **coalition** to win the election. = ÂπæÂÄãÊîøÈª®ÁµÑÊàêËÅØÁõü‰ª•Ë¥èÂæóÈÅ∏Ëàâ„ÄÇ
He practices **meditation** to feel calm every morning. = ‰ªñÊØèÂ§©Êó©Êô®ÊâìÂùêÂÜ•ÊÉ≥ËÆìËá™Â∑±Âπ≥Èùú„ÄÇ
They took a short **stroll** in the park after dinner. = ‰ªñÂÄëÊôöÈ§êÂæåÂú®ÂÖ¨ÂúíË£°Êï£Ê≠•„ÄÇ
The bird found a safe **perch** on the tree branch. = ÈÇ£ÈöªÈ≥•Âú®Ê®πÊûù‰∏äÊâæÂà∞ÂÆâÂÖ®ÁöÑÊ£≤ÊÅØËôï„ÄÇ
The king held a great **banquet** in the palace. = ÂúãÁéãÂú®ÂÆÆÊÆøËàâËæ¶ÁõõÂ§ßÂÆ¥ÊúÉ„ÄÇ
Her diploma is a **qualification** for the new job. = Â•πÁöÑÊñáÊÜëÊòØÈÄô‰ªΩÊñ∞Â∑•‰ΩúÁöÑË≥áÊ†º„ÄÇ
The crowd began to **applaud** after the show ended. = ÊºîÂá∫ÁµêÊùüÂæåËßÄÁúæÈñãÂßãÈºìÊéå„ÄÇ

---

‚óéStep 2: Focus on the vocab (for üëÄ üéß üé§)
rotation (n.) = ÊóãËΩâÔºõËá™ËΩâ
excerpt (n.) = ÁØÄÈåÑÔºõÊëòÈåÑ
default (n.) = È†êË®≠ÂÄº
coalition (n.) = ËÅØÁõü
meditation (n.) = ÂÜ•ÊÉ≥
stroll (n./v.) = Êï£Ê≠•ÔºõÈñíÈÄõ
perch (n.) = Ê£≤ÊÅØËôïÔºõÈ´òËôïÂ∫ß‰Ωç
banquet (n.) = ÂÆ¥ÊúÉ
qualification (n.) = Ë≥áÊ†ºÔºõË≥áÊ†ºÊ¢ù‰ª∂
applaud (v.) = ÈºìÊéåÔºõÁ®±ËÆö

---

‚óéStep 3: English definition (for üëÄ üéß)
the act of turning around in a circle = rotation
a short part taken from a longer text = excerpt
a basic setting used when nothing is chosen = default
a group joined for a common goal = coalition
quiet thinking to relax the mind = meditation
a slow and relaxed walk = stroll
a safe place for a bird to sit high up = perch
a large formal meal or party = banquet
a skill, degree, or proof needed for a job = qualification
to clap hands to show approval = applaud

---

‚óéStep 4: Blanking filling quiz (for üé§)
rotation = The wheels make a full _____ every second.
excerpt = The teacher asked her to read an _____ from the story.
default = The phone will return to the _____ settings if reset.
coalition = The small groups formed a _____ to push for change.
meditation = Daily _____ helps him reduce stress.
stroll = They enjoyed a quiet _____ by the river.
perch = The cat sat on a high _____ watching the room.
banquet = Hundreds of guests came to the royal _____.
qualification = Good communication is an important _____ for the position.
applaud = The audience will _____ the singer after her last song.            

            `
        };

        function isContentEmpty(content) {
            const cleaned = content.replace(/\s+/g, '').replace(/[‚óé=]/g, '');
            return cleaned.length === 0;
        }

        function showNoContentMessage() {
            const messageOverlay = document.createElement('div');
            messageOverlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0, 0, 0, 0.8); display: flex;
                justify-content: center; align-items: center; z-index: 1000;
            `;

            const messageBox = document.createElement('div');
            messageBox.style.cssText = `
                background-color: white; padding: 30px; border-radius: 15px;
                text-align: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                max-width: 400px; margin: 0 20px;
            `;

            messageBox.innerHTML = `
                <h3 style="color: var(--primary); margin-bottom: 15px;">‚ö†Ô∏è No Content Available</h3>
                <p style="font-size: 18px; margin-bottom: 10px;">Please wait for updates.</p>
                <p style="font-size: 16px; color: var(--mid); margin-bottom: 20px;">ÁõÆÂâçÊö´ÁÑ°ÂÖßÂÆπ,Ë´ãÁ≠âÂæÖÊõ¥Êñ∞</p>
                <button id="close-no-content-msg" style="
                    background-color: var(--accent1); color: white; padding: 10px 20px;
                    border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">OK</button>
            `;

            messageOverlay.appendChild(messageBox);
            document.body.appendChild(messageOverlay);

            document.getElementById('close-no-content-msg').addEventListener('click', () => {
                document.body.removeChild(messageOverlay);
            });

            messageOverlay.addEventListener('click', (e) => {
                if (e.target === messageOverlay) {
                    document.body.removeChild(messageOverlay);
                }
            });
        }

        document.querySelectorAll('.preset-btn').forEach(button => {
            button.addEventListener('click', () => {
                const presetKey = button.dataset.preset;
                if (presetVocabulary[presetKey]) {
                    const content = presetVocabulary[presetKey];
                    if (isContentEmpty(content)) {
                        showNoContentMessage();
                        return;
                    }

                    processTextImport(content);
                    textImportModal.style.display = 'none';

                    const successMessage = document.createElement('div');
                    successMessage.style.cssText = `
                        position: fixed; top: 20px; right: 20px; background-color: var(--accent2);
                        color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold;
                        z-index: 1000; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                    `;
                    successMessage.textContent = `‚úÖ ${button.textContent} loaded successfully!`;
                    document.body.appendChild(successMessage);

                    setTimeout(() => {
                        if (document.body.contains(successMessage)) {
                            document.body.removeChild(successMessage);
                        }
                    }, 3000);
                }
            });
        });

        textImportSubmitBtn.addEventListener('click', () => {
            const text = textImportContent.value.trim();
            if (!text) {
                alert('Please choose a lesson or enter vocabulary pairs. (Ë´ãÈÅ∏ÊìáÂñÆÂÖÉÊàñËº∏ÂÖ•"English vocabulary = ‰∏≠ÊñáÁøªË≠Ø")');
                return;
            }
            processTextImport(text);
            textImportModal.style.display = 'none';
        });

        textImportClearBtn.addEventListener('click', () => {
            textImportContent.value = '';
        });

       

        // ===== TEXT IMPORT AND TABLE RENDERING =====
        function processTextImport(text) {
            vocabularyData = [];
            sectionOrder = [];
            const lines = text.split('\n');
            let currentSection = "Default";

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                if (line.includes('‚óé') || line.includes('@') || line.startsWith('‚Äª')) {
                    currentSection = line.replace('‚óé', '').replace('@', '').replace('‚Äª', '').trim();
                    if (!sectionOrder.includes(currentSection)) {
                        sectionOrder.push(currentSection);
                    }
                    continue;
                }

                const parts = line.split('=');
                if (parts.length < 2) continue;

                const vocabulary = parts[0].trim();
                const translation = parts[1].trim();

                if (vocabulary && translation) {
                    vocabularyData.push({
                        vocabulary: vocabulary,
                        translation: translation,
                        selected: false,
                        section: currentSection
                    });
                }
            }

            renderVocabularyTable();
            if (vocabularyData.length > 0) {
                startBtn.disabled = false;
                englishToChineseBtn.disabled = false;
                listenChooseBtn.disabled = false;
            }
        }

        function toggleSection(sectionName) {
            const sectionRows = document.querySelectorAll(`.section-row[data-section="${sectionName}"]`);
            const collapseBtn = document.querySelector(`[data-section-toggle="${sectionName}"]`);

            if (!collapseBtn) return;

            const isCollapsed = collapseBtn.textContent === 'üîΩ';

            if (isCollapsed) {
                sectionRows.forEach(row => row.style.display = 'table-row');
                collapseBtn.textContent = 'üîº';
                collapseBtn.title = 'Collapse (Êî∂Ëµ∑)';
            } else {
                sectionRows.forEach(row => row.style.display = 'none');
                collapseBtn.textContent = 'üîΩ';
                collapseBtn.title = 'Expand (Â±ïÈñã)';
            }
        }

        function renderVocabularyTable() {
            if (vocabularyData.length === 0) {
                vocabularyBody.innerHTML = '<tr><td colspan="3" class="no-data">Import your vocabulary list to get started</td></tr>';
                return;
            }

            vocabularyBody.innerHTML = '';
            const sectionMap = {};

            vocabularyData.forEach(item => {
                if (!sectionMap[item.section]) {
                    sectionMap[item.section] = [];
                }
                sectionMap[item.section].push(item);
            });

            Object.keys(sectionMap).forEach(sectionName => {
                const sectionItems = sectionMap[sectionName];

                const sectionRow = document.createElement('tr');
                sectionRow.className = 'section-header';
                const sectionCell = document.createElement('td');
                sectionCell.colSpan = 2;

                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';

                const collapseBtn = document.createElement('button');
                collapseBtn.className = 'collapse-btn';
                collapseBtn.textContent = 'üîº';
                collapseBtn.title = 'Collapse (Êî∂Ëµ∑)';
                collapseBtn.setAttribute('data-section-toggle', sectionName);
                collapseBtn.addEventListener('click', () => toggleSection(sectionName));

                const titleText = document.createElement('span');
                titleText.textContent = sectionName;

                sectionTitle.appendChild(collapseBtn);
                sectionTitle.appendChild(titleText);
                sectionCell.appendChild(sectionTitle);

                const sectionCheckCell = document.createElement('td');
                const sectionCheckbox = document.createElement('input');
                sectionCheckbox.type = 'checkbox';
                sectionCheckbox.checked = sectionItems.every(item => item.selected);
                sectionCheckbox.dataset.section = sectionName;

                sectionCheckbox.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    const section = e.target.dataset.section;

                    vocabularyData.forEach((item, index) => {
                        if (item.section === section) {
                            item.selected = isChecked;
                            const checkbox = document.querySelector(`input[data-index="${index}"]`);
                            if (checkbox) checkbox.checked = isChecked;
                        }
                    });

                    updateSelectAllCheckbox();
                });

                sectionCheckCell.appendChild(sectionCheckbox);
                sectionRow.appendChild(sectionCell);
                sectionRow.appendChild(sectionCheckCell);
                vocabularyBody.appendChild(sectionRow);

                sectionItems.forEach((item, localIndex) => {
                    const index = vocabularyData.findIndex(vItem =>
                        vItem.vocabulary === item.vocabulary &&
                        vItem.translation === item.translation);

                    const row = document.createElement('tr');
                    row.className = 'section-row';
                    row.setAttribute('data-section', sectionName);

                    const wordCell = document.createElement('td');
                    const cleanWord = item.vocabulary.replace(/\(.*\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
                    wordCell.innerHTML = `
                        ${item.vocabulary}
                        <span class="speaker-icon" title="Listen" data-word="${cleanWord}">üîä</span>
                    `;

                    const translationCell = document.createElement('td');
                    translationCell.textContent = item.translation;

                    const checkboxCell = document.createElement('td');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.selected;
                    checkbox.dataset.index = index;
                    checkbox.dataset.section = item.section;

                    checkbox.addEventListener('change', (e) => {
                        vocabularyData[index].selected = e.target.checked;
                        updateSectionCheckbox(item.section);
                        updateSelectAllCheckbox();
                    });

                    checkboxCell.appendChild(checkbox);
                    row.appendChild(wordCell);
                    row.appendChild(translationCell);
                    row.appendChild(checkboxCell);
                    vocabularyBody.appendChild(row);
                });
            });

            document.querySelectorAll('.speaker-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    const word = e.target.dataset.word;
                    speak(word);
                });
            });

            updateSelectAllCheckbox();
        }

        function updateSectionCheckbox(sectionName) {
            const sectionItems = vocabularyData.filter(item => item.section === sectionName);
            const allSelected = sectionItems.every(item => item.selected);
            const noneSelected = sectionItems.every(item => !item.selected);
            const sectionCheckbox = document.querySelector(`input[data-section="${sectionName}"]`);

            if (sectionCheckbox) {
                sectionCheckbox.checked = allSelected;
                sectionCheckbox.indeterminate = !allSelected && !noneSelected;
            }
        }

        function updateSelectAllCheckbox() {
            if (vocabularyData.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
                return;
            }

            const selectedCount = vocabularyData.filter(item => item.selected).length;
            if (selectedCount === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (selectedCount === vocabularyData.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        selectAllCheckbox.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            vocabularyData.forEach(item => {
                item.selected = isChecked;
            });

            document.querySelectorAll('#vocabulary-body input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = isChecked;
                if (checkbox.dataset.section) {
                    checkbox.indeterminate = false;
                }
            });
        });

        // ===== PROGRESS TRACKING =====
        function initializeSectionProgress() {
            sectionProgress = {};
            const sectionMap = {};

            vocabularyData.forEach(item => {
                if (!sectionMap[item.section]) {
                    sectionMap[item.section] = [];
                }
                sectionMap[item.section].push(item);
            });

            Object.keys(sectionMap).forEach(sectionName => {
                const sectionItems = sectionMap[sectionName].filter(item => item.selected);
                if (sectionItems.length > 0) {
                    sectionProgress[sectionName] = {
                        currentIndex: -1,
                        totalCount: sectionItems.length,
                        items: sectionItems
                    };
                }
            });
        }

        function getCurrentProgressInfo() {
            if (quizMode !== 'sequential' || !currentEnglishWord) {
                return null;
            }

            const currentSection = currentEnglishWord.section;
            if (!sectionProgress[currentSection]) {
                return null;
            }

            const progress = sectionProgress[currentSection];
            const currentPosition = progress.currentIndex + 1;
            const totalInSection = progress.totalCount;

            return {
                current: currentPosition,
                total: totalInSection,
                section: currentSection
            };
        }

        function updateProgressDisplay() {
            if (quizMode !== 'sequential') {
                englishProgressInfo.style.display = 'none';
                return;
            }

            const progressInfo = getCurrentProgressInfo();
            if (!progressInfo) {
                englishProgressInfo.style.display = 'none';
                return;
            }

            englishProgressText.textContent = `${progressInfo.current} of ${progressInfo.total} (${progressInfo.section})`;
            englishProgressInfo.style.display = 'block';
        }

        // ===== LISTEN AND CHOOSE QUIZ =====
        function startListenAndChooseQuiz() {
            currentListenQuizWords = vocabularyData.filter(item => item.selected);

            if (currentListenQuizWords.length === 0) {
                alert('Please select at least 8 vocabulary words for this quiz. (Ë´ãÈÅ∏ÊìáËá≥Â∞ë8ÂÄãÂñÆÂ≠ó‰ª•ÈÄ≤Ë°åÊ≠§Ê∏¨È©ó)');
                return;
            }

            if (currentListenQuizWords.length < 8) {
                alert('Please select at least 8 vocabulary words for this quiz. (Ë´ãÈÅ∏ÊìáËá≥Â∞ë8ÂÄãÂñÆÂ≠ó‰ª•ÈÄ≤Ë°åÊ≠§Ê∏¨È©ó)');
                return;
            }

            resetListenAndChooseQuiz();
            listenChooseModal.style.display = 'flex';
            nextListenQuestion();
        }

        function resetListenAndChooseQuiz() {
            currentListenWordIndex = -1;
            currentListenWord = null;
            questionStartTime = null;
            isAnswered = false;
            listenAnswerDisplay.textContent = 'Click the speaker';
            timerFeedback.textContent = '';
        }

        function nextListenQuestion() {
            isAnswered = false;
            questionStartTime = null;
            listenAnswerDisplay.textContent = 'Click the speaker';
            timerFeedback.textContent = '';

            if (quizMode === 'sequential') {
                currentListenWordIndex = (currentListenWordIndex + 1) % currentListenQuizWords.length;
            } else {
                const previousIndex = currentListenWordIndex;
                if (currentListenQuizWords.length === 1) {
                    currentListenWordIndex = 0;
                } else {
                    do {
                        currentListenWordIndex = Math.floor(Math.random() * currentListenQuizWords.length);
                    } while (currentListenWordIndex === previousIndex && currentListenQuizWords.length > 1);
                }
            }

            currentListenWord = currentListenQuizWords[currentListenWordIndex];
            generateChoices();
        }

        function generateChoices() {
            if (!currentListenWord) return;

            const otherTranslations = currentListenQuizWords
                .filter(item => item.translation !== currentListenWord.translation)
                .map(item => item.translation);

            const shuffled = otherTranslations.sort(() => 0.5 - Math.random());
            const selectedChoices = shuffled.slice(0, 7);
            const allChoices = [...selectedChoices, currentListenWord.translation];
            const finalChoices = allChoices.sort(() => 0.5 - Math.random());

            choicesGrid.innerHTML = '';
            finalChoices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice;
                button.addEventListener('click', () => handleChoiceClick(button, choice));
                choicesGrid.appendChild(button);
            });
        }

        function handleChoiceClick(button, selectedChoice) {
            if (isAnswered) return;

            isAnswered = true;
            const responseTime = questionStartTime ? (Date.now() - questionStartTime) / 1000 : 0;

            document.querySelectorAll('.choice-button').forEach(btn => {
                btn.disabled = true;
            });

            const isCorrect = selectedChoice === currentListenWord.translation;

            if (isCorrect) {
                button.classList.add('correct');
                listenAnswerDisplay.textContent = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();

                let feedbackMessage = '';
                if (responseTime < 2) {
                    feedbackMessage = 'Perfect! ‚ö°';
                    speak('Perfect!');
                } else if (responseTime < 3.5) {
                    feedbackMessage = 'Good! üëç';
                    speak('Good!');
                } else if (responseTime < 6) {
                    feedbackMessage = 'Faster! ‚è∞';
                    speak('Faster!');
                } else {
                    feedbackMessage = 'Too late... üò¥';
                    speak('Too late...');
                }

                timerFeedback.textContent = `${feedbackMessage} (It took you ${responseTime.toFixed(1)} seconds.)`;
                timerFeedback.className = 'timer-feedback correct';
            } else {
                button.classList.add('incorrect');
                document.querySelectorAll('.choice-button').forEach(btn => {
                    if (btn.textContent === currentListenWord.translation) {
                        btn.classList.add('correct');
                    }
                });

                timerFeedback.textContent = 'You missed! üòì‚ùå';
                timerFeedback.className = 'timer-feedback incorrect';
                speak('You missed!');
                listenAnswerDisplay.textContent = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
            }
        }

        listenChooseBtn.addEventListener('click', startListenAndChooseQuiz);

        listenSpeaker.addEventListener('click', () => {
            if (currentListenWord && !isAnswered) {
                const cleanWord = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
                speak(cleanWord);
                if (!questionStartTime) {
                    questionStartTime = Date.now();
                }
            }
        });

        listenNextBtn.addEventListener('click', nextListenQuestion);

        listenCloseBtn.addEventListener('click', () => {
            listenChooseModal.style.display = 'none';
        });

        // ===== ENGLISH TO CHINESE QUIZ =====
        englishToChineseBtn.addEventListener('click', () => {
            currentEnglishQuizWords = vocabularyData.filter(item => item.selected);
            if (currentEnglishQuizWords.length === 0) {
                alert('Please select at least one vocabulary word to start the quiz. (Ë´ãÈÅ∏ÊìáËá≥Â∞ë‰∏ÄÂÄãÂñÆÂ≠ó‰ª•ÈÄ≤Ë°åÊ∏¨È©ó)');
                return;
            }
            startEnglishToChineseQuiz();
        });

        checkAnswerBtn.addEventListener('click', showChineseAnswer);
        englishNextBtn.addEventListener('click', nextEnglishQuestion);

        englishCloseBtn.addEventListener('click', () => {
            englishToChineseModal.style.display = 'none';
        });

        englishWordSpeaker.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();

            if (isSpeaking) {
                console.log('Already speaking, ignoring click');
                return;
            }

            if (currentEnglishWord) {
                isSpeaking = true;
                const cleanWord = currentEnglishWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
                console.log('About to speak:', cleanWord);
                speak(cleanWord);

                setTimeout(() => {
                    isSpeaking = false;
                }, 3000);
            }
        });

        function startEnglishToChineseQuiz() {
            console.log('Starting English to Chinese quiz');
            console.log('Voices loaded:', voicesLoaded, 'Voice count:', voices.length);

            if (!voicesLoaded || voices.length === 0) {
                console.log('Loading voices before starting quiz...');
                loadVoices().then(() => {
                    console.log('Voices loaded, starting quiz');
                    resetEnglishToChineseQuiz();
                    englishToChineseModal.style.display = 'flex';
                    nextEnglishQuestion();
                });
            } else {
                resetEnglishToChineseQuiz();
                englishToChineseModal.style.display = 'flex';
                nextEnglishQuestion();
            }
        }

        function resetEnglishToChineseQuiz() {
            currentEnglishWordIndex = -1;
            currentEnglishWord = null;
            chineseAnswerDisplay.style.display = 'none';
            checkQuestion.style.display = 'none';
            checkAnswerBtn.style.display = 'block';

            if (quizMode === 'sequential') {
                initializeSectionProgress();
            }
        }

        function nextEnglishQuestion() {
            chineseAnswerDisplay.style.display = 'none';
            checkQuestion.style.display = 'none';
            checkAnswerBtn.style.display = 'block';

            if (quizMode === 'sequential') {
                if (currentEnglishWordIndex === -1) {
                    const firstSection = sectionOrder.find(section =>
                        sectionProgress[section] && sectionProgress[section].totalCount > 0
                    );
                    if (firstSection) {
                        sectionProgress[firstSection].currentIndex = 0;
                        currentEnglishWord = sectionProgress[firstSection].items[0];
                        currentEnglishWordIndex = 0;
                    } else {
                        currentEnglishWordIndex = 0;
                        currentEnglishWord = currentEnglishQuizWords[0];
                    }
                } else {
                    const currentSection = currentEnglishWord.section;
                    const sectionData = sectionProgress[currentSection];

                    if (sectionData && sectionData.currentIndex + 1 < sectionData.totalCount) {
                        sectionData.currentIndex++;
                        currentEnglishWord = sectionData.items[sectionData.currentIndex];
                    } else {
                        const currentSectionIndex = sectionOrder.indexOf(currentSection);
                        let nextSectionIndex = currentSectionIndex + 1;

                        while (nextSectionIndex < sectionOrder.length) {
                            const nextSection = sectionOrder[nextSectionIndex];
                            if (sectionProgress[nextSection] && sectionProgress[nextSection].totalCount > 0) {
                                sectionProgress[nextSection].currentIndex = 0;
                                currentEnglishWord = sectionProgress[nextSection].items[0];
                                break;
                            }
                            nextSectionIndex++;
                        }

                        if (nextSectionIndex >= sectionOrder.length) {
                            const firstSection = sectionOrder.find(section =>
                                sectionProgress[section] && sectionProgress[section].totalCount > 0
                            );
                            if (firstSection) {
                                sectionProgress[firstSection].currentIndex = 0;
                                currentEnglishWord = sectionProgress[firstSection].items[0];
                            }
                        }
                    }

                    currentEnglishWordIndex = currentEnglishQuizWords.findIndex(item =>
                        item.vocabulary === currentEnglishWord.vocabulary &&
                        item.translation === currentEnglishWord.translation
                    );
                }
            } else {
                const previousIndex = currentEnglishWordIndex;
                if (currentEnglishQuizWords.length === 1) {
                    currentEnglishWordIndex = 0;
                } else {
                    do {
                        currentEnglishWordIndex = Math.floor(Math.random() * currentEnglishQuizWords.length);
                    } while (currentEnglishWordIndex === previousIndex && currentEnglishQuizWords.length > 1);
                }
                currentEnglishWord = currentEnglishQuizWords[currentEnglishWordIndex];
            }

            const cleanWord = currentEnglishWord.vocabulary.replace(/\(.*?\)/g, '').trim();
            englishWordDisplay.textContent = cleanWord;
            updateProgressDisplay();
        }

        function showChineseAnswer() {
            if (!currentEnglishWord) return;

            chineseAnswerDisplay.textContent = currentEnglishWord.translation;
            chineseAnswerDisplay.style.display = 'block';
            checkQuestion.style.display = 'block';
            checkAnswerBtn.style.display = 'none';
        }

        // ===== MAIN QUIZ =====
        startBtn.addEventListener('click', () => {
            currentQuizWords = vocabularyData.filter(item => item.selected);
            if (currentQuizWords.length === 0) {
                alert('Please select at least one vocabulary word to start the quiz. (Ë´ãÈÅ∏ÊìáËá≥Â∞ë‰∏ÄÂÄãÂñÆÂ≠ó‰ª•ÈÄ≤Ë°åÊ∏¨È©ó)');
                return;
            }
            startQuiz();
        });

        function startQuiz() {
            resetQuiz();
            quizModal.style.display = 'flex';
            nextQuestion();
        }

        function resetQuiz() {
            currentWordIndex = -1;
            currentWord = null;
            answerInput.value = '';
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';
            hintTextEl.textContent = '';
            revealAnswerEl.textContent = '';
        }

        function nextQuestion() {
            answerInput.value = '';
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';
            hintTextEl.textContent = '';
            revealAnswerEl.textContent = '';

            if (quizMode === 'sequential') {
                currentWordIndex = (currentWordIndex + 1) % currentQuizWords.length;
            } else {
                const previousIndex = currentWordIndex;
                if (currentQuizWords.length === 1) {
                    currentWordIndex = 0;
                } else {
                    do {
                        currentWordIndex = Math.floor(Math.random() * currentQuizWords.length);
                    } while (currentWordIndex === previousIndex && currentQuizWords.length > 1);
                }
            }

            currentWord = currentQuizWords[currentWordIndex];
            translationPrompt.textContent = currentWord.translation;
        }

        function submitAnswer() {
            if (!currentWord) return;

            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswers = currentWord.vocabulary
                .split('/')
                .map(ans => ans.replace(/\(.*?\)/g, '').trim().toLowerCase());

            const normalizedUserAnswer = userAnswer.replace(/[.,?'''.../‚Ä¶#!$%\^&\*;:{}=\-_`~()]/g, "");

            const isCorrect = correctAnswers.some(answer => {
                const normalizedAnswer = answer.replace(/[.,?'''.../‚Ä¶#!$%\^&\*;:{}=\-_`~()]/g, "");
                return normalizedUserAnswer === normalizedAnswer;
            });

            if (isCorrect) {
                feedbackEl.textContent = 'Well done! üèÜüòäüëç';
                feedbackEl.className = 'feedback correct';
                speak('Well done!');
            } else {
                feedbackEl.textContent = 'Try again! üî•üî•üî•';
                feedbackEl.className = 'feedback incorrect';
                speak('Try again!');
            }
        }

        function showHint() {
            if (!currentWord) return;
            const correctAnswer = currentWord.vocabulary.replace(/\(.*?\)/g, '').trim();
            const firstLetter = correctAnswer.charAt(0).toUpperCase();
            hintTextEl.textContent = `It starts with the letter ${firstLetter}.`;
        }

        function showAnswer() {
            if (!currentWord) return;
            const correctAnswer = currentWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
            revealAnswerEl.textContent = `${correctAnswer}`;
            speak(correctAnswer);
        }

        submitBtn.addEventListener('click', submitAnswer);

        answerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitAnswer();
            }
        });

        speakBtn.addEventListener('click', () => {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            try {
                if (speakBtn.textContent === 'üé§ Speak') {
                    recognition.start();
                    speakBtn.textContent = 'Recording';
                    speakBtn.classList.add('recording');
                } else {
                    recognition.stop();
                    speakBtn.textContent = 'üé§ Speak';
                    speakBtn.classList.remove('recording');
                }
            } catch (error) {
                console.error('Speech recognition error:', error);
                speakBtn.textContent = 'üé§ Speak';
                speakBtn.classList.remove('recording');
            }
        });

        hintBtn.addEventListener('click', showHint);
        answerBtn.addEventListener('click', showAnswer);
        nextBtn.addEventListener('click', nextQuestion);

        closeBtn.addEventListener('click', () => {
            quizModal.style.display = 'none';
            if (recognition) {
                recognition.stop();
            }
        });

        // ===== DATE INFORMATION =====
        function updateDateInfo() {
            const dateInfoEl = document.getElementById('date-info');
            const options = {
                timeZone: 'Asia/Taipei',
                weekday: 'long',
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            };

            const today = new Date();
            const taiwanDate = today.toLocaleDateString('en-US', options);

            const examDate = new Date('December 1, 2025');
            examDate.setHours(0, 0, 0, 0);
            const todayNoTime = new Date(today);
            todayNoTime.setHours(0, 0, 0, 0);
            const daysUntilExam = Math.ceil((examDate - todayNoTime) / (1000 * 60 * 60 * 24));

            const collegeExamDate = new Date('January 16, 2026');
            collegeExamDate.setHours(0, 0, 0, 0);
            const daysUntilCollegeExam = Math.ceil((collegeExamDate - todayNoTime) / (1000 * 60 * 60 * 24));

            dateInfoEl.innerHTML = `
                <span><span class="emoji">üìÖ</span>${taiwanDate}</span>
                <span><span class="emoji">‚è∞</span><span class="countdown">${daysUntilExam}</span> days until ÊÆµËÄÉ</span>
                <span><span class="emoji">üìö</span><span class="countdown">${daysUntilCollegeExam}</span> days until 115Âπ¥Â≠∏Ê∏¨</span>
            `;
        }

        updateDateInfo();
        setInterval(updateDateInfo, 60000);

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            initializeTTS();
 initMonthlyDB();

            const refreshReminderPopup = document.getElementById('refresh-reminder-popup');
            setTimeout(() => {
                refreshReminderPopup.style.display = 'flex';
            }, 1000);

            const closeReminderBtn = document.getElementById('close-reminder-btn');
            closeReminderBtn.addEventListener('click', () => {
                refreshReminderPopup.style.display = 'none';
            });
        });

        document.addEventListener('click', function initOnFirstClick() {
            initializeTTS();
            document.removeEventListener('click', initOnFirstClick);
        }, { once: true });

        // ===== FIREBASE VISITOR COUNTER =====
        function initVisitorCounter() {
            const firebaseConfig = {
                apiKey: "AIzaSyBFhmaAZmBtsM5DKoxgy1G-RouRKsrjYsA",
                authDomain: "vocab-builder-visitor-counter.firebaseapp.co",
                databaseURL: "https://vocab-builder-visitor-counter-default-rtdb.asia-southeast1.firebasedatabase.app/",
                projectId: "vocab-builder-visitor-counter",
                storageBucket: "vocab-builder-visitor-counter.firebasestorage.app",
                messagingSenderId: "648587683861",
                appId: "1:648587683861:web:dcb777160dabb4cbf8c61c"
            };

            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            const today = new Date();
            const taiwanDate = new Date(today.toLocaleString('en-US', { timeZone: 'Asia/Taipei' }));
            const dateStr = taiwanDate.getFullYear() + '-' +
                (taiwanDate.getMonth() + 1).toString().padStart(2, '0') + '-' +
                taiwanDate.getDate().toString().padStart(2, '0');

            const visitorCountRef = database.ref('visitorCount/' + dateStr);

            function updateVisitorDisplay(count) {
                const visitorCountEl = document.getElementById('visitor-count');
                if (count === 1) {
                    visitorCountEl.innerHTML = `üëã ${count} person has visited this website today.`;
                } else {
                    visitorCountEl.innerHTML = `üëã ${count} people have visited this website today.`;
                }
            }

            const hasVisitedToday = localStorage.getItem('visited_' + dateStr);

            if (!hasVisitedToday) {
                visitorCountRef.transaction((currentCount) => {
                    return (currentCount || 0) + 1;
                }, (error, committed, snapshot) => {
                    if (error) {
                        console.error('Transaction failed:', error);
                    } else if (committed) {
                        localStorage.setItem('visited_' + dateStr, 'true');
                        updateVisitorDisplay(snapshot.val());
                    }
                });
            } else {
                visitorCountRef.once('value', (snapshot) => {
                    const count = snapshot.val() || 0;
                    updateVisitorDisplay(count);
                });
            }

            visitorCountRef.on('value', (snapshot) => {
                const count = snapshot.val() || 0;
                updateVisitorDisplay(count);
            });
        }

        try {
            initVisitorCounter();
        } catch (e) {
            console.error("Error initializing visitor counter:", e);
            document.getElementById('visitor-count').innerHTML = "üòÖ Visitor count unavailable";
        }
    </script>
</body>
</html>
