<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Builder</title>
    <style>
        :root {
            --primary: #D33E43;
            --secondary: #F8B500;
            --accent1: #5D9CEC;
            --accent2: #77B28C;
            --accent3: #A06CD5;
            --dark: #2D2D2A;
            --light: #F8F3E6;
            --mid: #888888;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.5;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .tts-system-selector {
            margin-top: 15px;
            font-size: 16px;
            color: var(--dark);
        }

        .tts-system-selector label {
            font-weight: bold;
            margin-right: 8px;
        }

        .tts-system-selector select {
            padding: 8px 12px;
            border: 2px solid var(--mid);
            border-radius: 6px;
            background-color: white;
            color: var(--dark);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .tts-system-selector select:hover {
            border-color: var(--accent1);
        }

        .tts-system-selector select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .left-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .text-import-btn {
            background-color: var(--secondary);
            color: black;
        }

        .english-to-chinese-btn {
            background-color: var(--accent3);
            color: white;
            padding: 16px 25px;
            font-size: 20px;
        }

        .listen-choose-btn {
            background-color: var(--accent2);
            color: white;
            padding: 16px 25px;
            font-size: 20px;
        }

        .start-btn {
            background-color: var(--primary);
            color: white;
            padding: 16px 25px;
            font-size: 20px;
        }

        .ai-support-btn {
            background-color: var(--accent1);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
        }

        .quiz-mode-selector {
            background-color: white;
            border: 2px solid var(--mid);
            border-radius: 10px;
            padding: 3px;
            margin: 3px 0;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .mode-options {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }

        .mode-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px 15px;
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
        }

        .mode-option:hover {
            background-color: rgba(93, 156, 236, 0.1);
            border-color: var(--accent1);
        }

        .mode-option input[type="radio"] {
            margin: 0 8px 0 0;
            transform: scale(1.2);
        }

        .mode-option .option-text {
            font-weight: bold;
            font-size: 16px;
            color: var(--dark);
        }

        .mode-option input[type="radio"]:checked + .option-text {
            color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            clear: both;
            display: table;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--dark);
            color: var(--light);
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.03);
        }

        tr:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .speaker-icon {
            cursor: pointer;
            color: var(--secondary);
            margin-left: 8px;
            font-size: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--light);
            width: 90%;
            max-width: 500px;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .modal h2 {
            margin-top: 0;
            color: var(--primary);
            font-size: 1.8rem;
        }

        .prompt {
            font-size: 24px;
            margin: 20px 0;
            color: var(--dark);
            font-weight: bold;
        }

        .answer-input {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            margin-bottom: 15px;
            border: 2px solid var(--mid);
            border-radius: 6px;
            box-sizing: border-box;
        }

        .feedback {
            margin: 15px 0;
            font-size: 25px;
            font-weight: bold;
            min-height: 27px;
        }

        .correct {
            color: var(--accent2);
        }

        .incorrect {
            color: var(--primary);
        }

        .hint {
            color: var(--accent1);
            font-style: italic;
            font-size: 25px;
            margin: 10px 0;
            min-height: 24px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .submit-btn {
            background-color: var(--primary);
            color: white;
        }

        .speak-btn {
            background-color: var(--accent1);
            color: white;
        }

        .hint-btn {
            background-color: var(--secondary);
            color: var(--dark);
        }

        .answer-btn {
            background-color: var(--accent3);
            color: white;
        }

        .next-btn {
            background-color: var(--accent2);
            color: white;
        }

        .close-btn {
            background-color: var(--mid);
            color: white;
        }

        .copy-btn {
            background-color: var(--accent3);
            color: white;
        }

        .recording {
            background-color: var(--primary);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .hidden {
            display: none;
        }

        #file-input {
            display: none;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--mid);
                    }

        .tts-speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tts-speed-control select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid var(--mid);
            background-color: white;
            font-size: 14px;
        }

        .tts-speed-control label {
            font-weight: bold;
            color: white;
        }

        .reveal-answer {
            color: var(--primary);
            font-weight: bold;
            font-size: 30px;
            margin: 10px 0;
            min-height: 27px;
        }

        .section-header {
            background-color: var(--dark);
            color: var(--light);
            font-weight: bold;
            position: relative;
        }

        .section-header td {
            background-color: var(--dark);
            color: var(--light);
            padding: 10px 15px;
        }

        .collapse-btn {
            background: none;
            border: none;
            color: var(--light);
            font-size: 18px;
            cursor: pointer;
            padding: 0 8px 0 0;
            margin: 0;
            transition: transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 30px;
            box-shadow: none;
        }

        .collapse-btn:hover {
            transform: scale(1.1);
            box-shadow: none;
        }

        .section-collapsed .collapse-btn {
            transform: rotate(-90deg);
        }

        .section-row {
            display: table-row;
            transition: all 0.3s ease;
        }

        .section-row.section-collapsed {
            display: none;
        }

        .section-header .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-info {
            background-color: var(--accent1);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-section {
            opacity: 0.8;
            font-size: 14px;
        }

        #text-import-content {
            width: 100%;
            height: 100px;
            padding: 12px;
            margin: 15px 0;
            font-size: 16px;
            border: 2px solid var(--mid);
            border-radius: 6px;
            box-sizing: border-box;
            resize: vertical;
        }

        #text-import-modal .modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .button-set {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.02);
        }

        .button-set h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--dark);
        }

        .preset-btn {
            margin: 5px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            font-weight: normal;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .textbook-btn {
            background-color: var(--accent1);
            color: white;
        }

        .live-btn {
            background-color: var(--accent2);
            color: white;
        }

        .core-btn {
            background-color: var(--accent3);
            color: white;
        }

        .other-btn {
            background-color: var(--secondary);
            color: var(--dark);
        }

        #ai-support-modal .modal-content {
            max-width: 600px;
        }

        .ai-support-links {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .ai-support-link {
            background-color: var(--accent1);
            color: white;
            text-decoration: none;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-support-link:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        #listen-choose-modal .modal-content {
            max-width: 100%;
            width: 95%;
            max-height: 95vh;
            padding: 15px;
        }

        .listen-answer-section {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .listen-answer-display {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            min-height: 30px;
            padding: 10px 15px;
            border: 2px solid var(--mid);
            border-radius: 8px;
            background-color: white;
            flex-grow: 1;
            text-align: center;
        }

        .listen-speaker {
            cursor: pointer;
            color: var(--secondary);
            font-size: 28px;
            padding: 8px;
            border-radius: 50%;
            background-color: rgba(248, 181, 0, 0.1);
            transition: all 0.2s ease;
        }

        .listen-speaker:hover {
            background-color: rgba(248, 181, 0, 0.2);
            transform: scale(1.1);
        }

        .timer-feedback-section {
            margin-bottom: 25px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-feedback {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
            max-width: 100%;
        }

        .choice-button {
            padding: 15px 10px;
            border: 2px solid var(--mid);
            border-radius: 8px;
            background-color: white;
            color: var(--dark);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.3;
        }

        .choice-button:hover {
            background-color: var(--accent1);
            color: white;
            border-color: var(--accent1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .choice-button.correct {
            background-color: var(--accent2);
            color: white;
            border-color: var(--accent2);
        }

        .choice-button.incorrect {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .choice-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .listen-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .listen-next-btn {
            background-color: var(--accent2);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
        }

        .listen-close-btn {
            background-color: var(--mid);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
        }

        .date-info {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            font-size: 14px;
            line-height: 1.6;
            color: var(--dark);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-weight: bold;
            max-width: 90%;
            z-index: 10;
        }

        .date-info span {
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .date-info .emoji {
            margin-right: 8px;
            font-size: 16px;
        }

        .date-info .countdown {
            color: var(--primary);
            margin: 0 3px;
        }

        .visitor-counter {
            margin-top: 40px;
            text-align: center;
            padding: 15px;
            color: var(--dark);
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #visitor-count {
            font-weight: bold;
        }

        .popup-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .popup-layout {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .pikachu-image {
            width: 150px;
            flex-shrink: 0;
        }

        .pikachu-image img {
            width: 100%;
            height: auto;
        }

        .speech-bubble {
            position: relative;
            background-color: #FFFDE7;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 15px;
            margin-left: 15px;
        }

        .speech-bubble:before {
            content: "";
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 15px 15px 15px 0;
            border-style: solid;
            border-color: transparent var(--secondary) transparent transparent;
        }

        .speech-bubble:after {
            content: "";
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 12px 12px 12px 0;
            border-style: solid;
            border-color: transparent #FFFDE7 transparent transparent;
        }

        .english-text {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .chinese-text {
            font-size: 16px;
            color: var(--dark);
        }

        .close-reminder-btn {
            background-color: var(--accent1);
            color: white;
            padding: 12px 24px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-reminder-btn:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 768px) {
            .date-info {
                position: static;
                margin: 0 auto 15px auto;
                width: 100%;
                max-width: 100%;
                text-align: center;
                right: auto;
                top: auto;
            }

            .date-info span {
                justify-content: center;
            }

            header {
                display: flex;
                flex-direction: column;
            }
        }

        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            th, td {
                padding: 8px 10px;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .left-controls {
                justify-content: space-between;
                width: 100%;
            }

            .right-controls {
                justify-content: space-between;
                width: 100%;
            }

            .choices-grid {
                gap: 10px;
            }

            .choice-button {
                padding: 12px 8px;
                font-size: 14px;
                min-height: 50px;
            }

            .listen-answer-display {
                font-size: 20px;
            }

            .listen-speaker {
                font-size: 24px;
            }

            .timer-feedback {
                font-size: 18px;
            }

            .mode-option {
                padding: 10px;
            }

            .preset-buttons {
                grid-template-columns: 1fr;
            }

            .ai-support-links {
                grid-template-columns: 1fr;
            }

            #listen-choose-modal .modal-content {
                width: 98%;
                padding: 10px;
            }

            .popup-layout {
                flex-direction: column;
            }

            .speech-bubble {
                margin-left: 0;
                margin-top: 15px;
            }

            .speech-bubble:before, .speech-bubble:after {
                left: 50%;
                top: -15px;
                transform: translateX(-50%) rotate(90deg);
            }

            .speech-bubble:after {
                top: -12px;
            }
        }
    </style>
</head>

<body>
    <header>
        <div id="date-info" class="date-info"></div>
        <h1>ğŸ¯ Vocabulary Builder (3.9)</h1>
        <div class="tts-system-selector">
            <label for="tts-system">System: </label>
            <select id="tts-system">
                <option value="android" selected>Android</option>
                <option value="ios">iOS</option>
            </select>
        </div>
    </header>

    <div class="controls">
        <div class="left-controls">
            <button class="text-import-btn" id="text-import-btn">ğŸ“ Load Vocab</button>
        </div>
        <button class="english-to-chinese-btn" id="english-to-chinese-btn" disabled>ğŸ‘€ çœ‹è‹±æƒ³ä¸­</button>
        <button class="listen-choose-btn" id="listen-choose-btn" disabled>ğŸ§ è½è‹±é¸ä¸­</button>
        <button class="start-btn" id="start-btn" disabled>ğŸ¤ çœ‹ä¸­å”¸è‹±</button>
        <button class="ai-support-btn" id="ai-support-btn">ğŸ’¡ AI Support</button>
    </div>

    <div class="quiz-mode-selector">
        <div class="mode-options">
            <label class="mode-option">
                <input type="radio" name="quiz-mode" value="sequential" checked>
                <span class="option-text">â¡ï¸ Sequential (æŒ‰é †åº)</span>
            </label>
            <label class="mode-option">
                <input type="radio" name="quiz-mode" value="random">
                <span class="option-text">ğŸ”€ Random (éš¨æ©Ÿ)</span>
            </label>
        </div>
    </div>

    <table id="vocabulary-table">
        <thead>
            <tr>
                <th>
                    <div class="tts-speed-control">
                        <label for="tts-speed">Vocabulary</label>
                        <select id="tts-speed">
                            <option value="0.6">0.6x</option>
                            <option value="0.8" selected>0.8x</option>
                            <option value="1">1x</option>
                        </select>
                    </div>
                </th>
                <th>Translation</th>
                <th>
                    <label>
                        <input type="checkbox" id="select-all"> Select All
                    </label>
                </th>
            </tr>
        </thead>
        <tbody id="vocabulary-body">
            <tr>
                <td colspan="3" class="no-data">Load the vocabulary to get started (è¼‰å…¥å­—å½™ä»¥é–‹å§‹å­¸ç¿’)</td>
            </tr>
        </tbody>
    </table>

    <!-- Text Import Modal -->
    <div id="text-import-modal" class="modal">
        <div class="modal-content">
            <h2>Load Vocabulary</h2>
            <div class="preset-buttons">
                <div class="button-set textbook-buttons">
                    <h3>Textbook</h3>
                    <button class="preset-btn textbook-btn" data-preset="b3l1">B3 L1 (è‡ªèª­)</button>
                    <button class="preset-btn textbook-btn" data-preset="b3l2">B3 L2</button>
                    <button class="preset-btn textbook-btn" data-preset="b3l3">B3 L3</button>
                </div>
                <div class="button-set live-buttons">
                    <h3>Magazine</h3>
                    <button class="preset-btn live-btn" data-preset="maga1">U9</button>
                    <button class="preset-btn live-btn" data-preset="maga2">U11</button>
                    <button class="preset-btn live-btn" data-preset="maga3">U4 (è‡ªèª­)</button>
                    <button class="preset-btn live-btn" data-preset="maga4">U13 (è‡ªèª­)</button>
                </div>
                <div class="button-set core-buttons">
                    <h3>æ ¸å¿ƒå­—å½™</h3>
                    <button class="preset-btn core-btn" data-preset="coreP2U1">P2 U1</button>
                    <button class="preset-btn core-btn" data-preset="coreP2U2">P2 U2</button>
                    <button class="preset-btn core-btn" data-preset="coreP2U3">P2 U3</button>
                </div>
                <div class="button-set other-buttons">
                    <h3>Other</h3>
                    <button class="preset-btn other-btn" data-preset="other1">other 1</button>
                    <button class="preset-btn other-btn" data-preset="other2">other 2</button>
                </div>
            </div>
            <textarea id="text-import-content" placeholder="Enter your vocabulary pairs here..."></textarea>
            <div class="button-group">
                <button id="text-import-submit-btn" class="submit-btn">ğŸ“‚ Load</button>
                <button id="text-import-copy-btn" class="copy-btn">ğŸ“‹ Copy</button>
                <button id="text-import-clear-btn" class="hint-btn">ğŸˆ³ Clear</button>
                <button id="text-import-close-btn" class="close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- AI Support Modal -->
    <div id="ai-support-modal" class="modal">
        <div class="modal-content">
            <h2>ğŸ’¡ AI Support</h2>
            <div class="ai-support-links">
                <a href="https://chatgpt.com/share/68db5397-e390-800a-88d2-e323314c7e5c" class="ai-support-link" target="_blank">ğŸ€„ ç”Ÿæˆä¸­è­¯</a>
                <a href="https://chatgpt.com/share/68d63d05-8f18-800a-a2b7-e1e8a6168bc6" class="ai-support-link" target="_blank">ğŸŒŸ ç”Ÿæˆä¾‹å¥+ä¸­è­¯</a>
                <a href="https://chatgpt.com/share/67da57c1-afa4-800a-956f-41b344ca587c" class="ai-support-link" target="_blank">ğŸ’¬ äº’å‹•å•ç­”</a>
                <a href="https://chatgpt.com/share/67f896d4-e3a4-800a-9169-b0f385820e3e" class="ai-support-link" target="_blank">[Quiz] å¡«ç©ºé¡Œ âœï¸</a>
                <a href="https://chatgpt.com/share/67f7329b-e008-800a-9c06-df50ec1bb977" class="ai-support-link" target="_blank">[Quiz] ä¸­è­¯è‹± (å…¥é–€) ğŸ˜ƒ</a>
                <a href="https://chatgpt.com/share/67f619dd-d668-800a-af6e-696897e751e7" class="ai-support-link" target="_blank">[Quiz] ä¸­è­¯è‹± (å­¸æ¸¬é›£åº¦) ğŸ˜–</a>
            </div>
            <div class="button-group">
                <button id="ai-support-close-btn" class="close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- English to Chinese Quiz Modal -->
    <div id="english-to-chinese-modal" class="modal">
        <div class="modal-content">
            <div id="english-progress-info" class="progress-info" style="display: none;">
                <span id="english-progress-text"></span>
            </div>
            <div class="prompt">What does this mean in Chinese?</div>
            <div style="font-size: 28px; font-weight: bold; color: var(--primary); margin: 20px 0; display: flex; align-items: center; justify-content: center; gap: 15px;">
                <span id="english-word-display"></span>
                <span class="speaker-icon" id="english-word-speaker" title="Listen" style="cursor: pointer; color: var(--secondary); font-size: 24px;">ğŸ”Š</span>
            </div>
            <div id="chinese-answer-display" class="reveal-answer" style="display: none;"></div>
            <div id="check-question" style="display: none; font-size: 23px; color: var(--accent1); margin-top: 10px;"><b>Did you get it right?</b></div>
            <div style="margin-top: 30px;">
                <button id="check-answer-btn" class="submit-btn" style="width: 100%; margin-bottom: 15px; padding: 15px;">Check Answer</button>
                <div class="button-group">
                    <button id="english-next-btn" class="next-btn">Next</button>
                    <button id="english-close-btn" class="close-btn">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Listen and Choose Modal -->
    <div id="listen-choose-modal" class="modal">
        <div class="modal-content">
            <h2>ğŸ§ Listen and Choose</h2>
            <div class="listen-answer-section">
                <div id="listen-answer-display" class="listen-answer-display">Click the speaker</div>
                <div class="listen-speaker" id="listen-speaker" title="Play Audio">ğŸ”Š</div>
            </div>
            <div class="timer-feedback-section">
                <div id="timer-feedback" class="timer-feedback"></div>
            </div>
            <div id="choices-grid" class="choices-grid"></div>
            <div class="listen-controls">
                <button id="listen-next-btn" class="listen-next-btn">Next</button>
                <button id="listen-close-btn" class="listen-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <div id="prompt" class="prompt">Say "<span id="translation-prompt"></span>" in English.</div>
            <input type="text" id="answer-input" class="answer-input" placeholder="Type your answer here...">
            <div id="feedback" class="feedback"></div>
            <div id="hint-text" class="hint"></div>
            <div id="reveal-answer" class="reveal-answer"></div>
            <div class="button-group">
                <button id="submit-btn" class="submit-btn">âœ… or â</button>
                <button id="speak-btn" class="speak-btn">ğŸ¤ Speak</button>
                <button id="hint-btn" class="hint-btn">â“ Hint</button>
                <button id="answer-btn" class="answer-btn">ğŸ”‘ Answer</button>
                <button id="next-btn" class="next-btn">Next</button>
                <button id="close-btn" class="close-btn">Close</button>
            </div>
        </div>
    </div>

    <footer class="visitor-counter">
        <div id="visitor-count">ğŸ‘¥ Loading visitor count...</div>
    </footer>

    <!-- Refresh Reminder Popup -->
    <div id="refresh-reminder-popup" class="popup-container">
        <div class="popup-content">
            <div class="popup-layout">
                <div class="pikachu-image">
                    <img src="dinotaeng_walking.png" alt="Image Not Found" width="150">
                </div>
                <div class="speech-bubble">
                    <p class="english-text">1.æ¯æ¬¡ä½¿ç”¨è«‹é»æ“Šã€Œé‡æ–°æ•´ç†(refresh)ğŸ”„ã€ä»¥ç²å–æ›´æ–°ï¼</p>
                    <p class="chinese-text">2.iPhoneåŠiPadä½¿ç”¨è€…éœ€å°‡system(ç³»çµ±)åˆ‡æ›æˆiOSï¼ŒğŸ”Šæ‰èƒ½æ­£å¸¸é‹ä½œã€‚</p>
                    <p class="chinese-text">3.æ‰‹æ©Ÿæœ‰æ™‚æœƒæ›´æ–°ã€Œæ–‡å­—è½‰èªéŸ³ã€åŠŸèƒ½ï¼Œå°è‡´ğŸ”Šç„¡æ³•é‹ä½œï¼Œé‡é–‹æ©Ÿå³å¯è§£æ±ºã€‚</p>
                </div>
            </div>
            <button id="close-reminder-btn" class="close-reminder-btn">OK. I got it.</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ===== DOM ELEMENTS =====
        const englishToChineseBtn = document.getElementById('english-to-chinese-btn');
        const englishToChineseModal = document.getElementById('english-to-chinese-modal');
        const englishWordDisplay = document.getElementById('english-word-display');
        const englishWordSpeaker = document.getElementById('english-word-speaker');
        const chineseAnswerDisplay = document.getElementById('chinese-answer-display');
        const checkQuestion = document.getElementById('check-question');
        const checkAnswerBtn = document.getElementById('check-answer-btn');
        const englishNextBtn = document.getElementById('english-next-btn');
        const englishCloseBtn = document.getElementById('english-close-btn');
        const englishProgressInfo = document.getElementById('english-progress-info');
        const englishProgressText = document.getElementById('english-progress-text');

        const listenChooseBtn = document.getElementById('listen-choose-btn');
        const listenChooseModal = document.getElementById('listen-choose-modal');
        const listenAnswerDisplay = document.getElementById('listen-answer-display');
        const listenSpeaker = document.getElementById('listen-speaker');
        const timerFeedback = document.getElementById('timer-feedback');
        const choicesGrid = document.getElementById('choices-grid');
        const listenNextBtn = document.getElementById('listen-next-btn');
        const listenCloseBtn = document.getElementById('listen-close-btn');

        const textImportBtn = document.getElementById('text-import-btn');
        const startBtn = document.getElementById('start-btn');
        const aiSupportBtn = document.getElementById('ai-support-btn');
        const vocabularyTable = document.getElementById('vocabulary-table');
        const vocabularyBody = document.getElementById('vocabulary-body');
        const selectAllCheckbox = document.getElementById('select-all');
        const quizModal = document.getElementById('quiz-modal');
        const translationPrompt = document.getElementById('translation-prompt');
        const answerInput = document.getElementById('answer-input');
        const feedbackEl = document.getElementById('feedback');
        const hintTextEl = document.getElementById('hint-text');
        const revealAnswerEl = document.getElementById('reveal-answer');
        const submitBtn = document.getElementById('submit-btn');
        const speakBtn = document.getElementById('speak-btn');
        const hintBtn = document.getElementById('hint-btn');
        const answerBtn = document.getElementById('answer-btn');
        const nextBtn = document.getElementById('next-btn');
        const closeBtn = document.getElementById('close-btn');
        const ttsSpeedSelect = document.getElementById('tts-speed');
        const ttsSystemSelect = document.getElementById('tts-system');

        const textImportModal = document.getElementById('text-import-modal');
        const textImportContent = document.getElementById('text-import-content');
        const textImportSubmitBtn = document.getElementById('text-import-submit-btn');
        const textImportCloseBtn = document.getElementById('text-import-close-btn');
        const textImportClearBtn = document.getElementById('text-import-clear-btn');
        const textImportCopyBtn = document.getElementById('text-import-copy-btn');

        const aiSupportModal = document.getElementById('ai-support-modal');
        const aiSupportCloseBtn = document.getElementById('ai-support-close-btn');

        // ===== VARIABLES =====
        let isSpeaking = false;
        let vocabularyData = [];
        let currentQuizWords = [];
        let currentWordIndex = -1;
        let currentWord = null;
        let recognition = null;
        let speechRate = 0.8;
        let quizMode = 'sequential';
        let currentEnglishQuizWords = [];
        let currentEnglishWordIndex = -1;
        let currentEnglishWord = null;
        let sectionProgress = {};
        let sectionOrder = [];
        let currentListenQuizWords = [];
        let currentListenWordIndex = -1;
        let currentListenWord = null;
        let questionStartTime = null;
        let isAnswered = false;

        let voices = [];
        let voicesLoaded = false;
        let currentTTSSystem = 'android';

        // ===== TTS FUNCTIONS =====
        function loadVoices() {
            return new Promise((resolve) => {
                voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    voicesLoaded = true;
                    console.log('Voices loaded:', voices.length);
                    resolve(voices);
                } else {
                    const utterance = new SpeechSynthesisUtterance('');
                    utterance.volume = 0;
                    speechSynthesis.speak(utterance);
                    setTimeout(() => {
                        voices = speechSynthesis.getVoices();
                        voicesLoaded = true;
                        console.log('Voices loaded after trigger:', voices.length);
                        resolve(voices);
                    }, 100);
                }
            });
        }

        function getEnglishVoice() {
            if (!voicesLoaded || voices.length === 0) return null;

            if (currentTTSSystem === 'ios') {
                const iosPreferredVoices = ['Samantha', 'Tom', 'Alex', 'Karen', 'Moira'];
                for (const voiceName of iosPreferredVoices) {
                    const voice = voices.find(v => v.name.includes(voiceName));
                    if (voice) {
                        console.log('Using iOS voice:', voice.name);
                        return voice;
                    }
                }
            } else {
                const androidPreferredVoices = [
                    'Google US English',
                    'English (United States)',
                    'en-US-language',
                    'English United States',
                    'Chrome OS US English'
                ];
                for (const voiceName of androidPreferredVoices) {
                    const voice = voices.find(v =>
                        v.name.includes(voiceName) ||
                        v.name.toLowerCase().includes(voiceName.toLowerCase())
                    );
                    if (voice) {
                        console.log('Using Android voice:', voice.name);
                        return voice;
                    }
                }
            }

            const englishVoice = voices.find(v =>
                v.lang === 'en-US' ||
                v.lang.startsWith('en-') ||
                v.name.toLowerCase().includes('english')
            );
            if (englishVoice) {
                console.log(`Using fallback English voice for ${currentTTSSystem}:`, englishVoice.name);
                return englishVoice;
            }

            console.log(`Using first available voice for ${currentTTSSystem}:`, voices[0]?.name);
            return voices[0] || null;
        }

        function speak(text) {
            console.log('Speak function called with:', text, 'System:', currentTTSSystem);
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                return;
            }

            const cleanText = text.replace(/[()[\\]*]/g, '').trim();
            if (!cleanText) return;

            speechSynthesis.cancel();

            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(cleanText);
                const preferredVoice = getEnglishVoice();
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }

                utterance.lang = 'en-US';
                utterance.pitch = 1.0;
                utterance.volume = 1.0;

                if (currentTTSSystem === 'ios') {
                    utterance.rate = Math.max(0.5, speechRate * 0.9);
                } else {
                    utterance.rate = speechRate;
                    utterance.pitch = 0.95;
                }

                utterance.onstart = function() {
                    console.log('Speech started successfully');
                };

                utterance.onend = function() {
                    console.log('Speech ended normally');
                    isSpeaking = false;
                };

                utterance.onerror = function(event) {
                    console.error('Speech error:', event.error);
                    isSpeaking = false;
                };

                try {
                    speechSynthesis.speak(utterance);
                } catch (error) {
                    console.error('Failed to start speech synthesis:', error);
                }
            }, 100);
        }

        async function initializeTTS() {
            console.log('Initializing TTS...');
            const testUtterance = new SpeechSynthesisUtterance('');
            testUtterance.volume = 0;
            speechSynthesis.speak(testUtterance);
            await new Promise(resolve => setTimeout(resolve, 200));
            await loadVoices();

            if (voices.length === 0) {
                console.log('No voices found, trying again...');
                await new Promise(resolve => setTimeout(resolve, 500));
                await loadVoices();
            }

            console.log('TTS initialization complete. Voices:', voices.length);
            speechSynthesis.addEventListener('voiceschanged', () => {
                console.log('Voices changed event fired');
                loadVoices();
            });
        }

        // ===== SPEECH RECOGNITION =====
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase().trim();
                answerInput.value = transcript;
                speakBtn.textContent = 'ğŸ¤ Speak';
                speakBtn.classList.remove('recording');
            };

            recognition.onend = function() {
                speakBtn.textContent = 'ğŸ¤ Speak';
                speakBtn.classList.remove('recording');
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                speakBtn.textContent = 'ğŸ¤ Speak';
                speakBtn.classList.remove('recording');
            };
        }

        // ===== EVENT LISTENERS =====
        ttsSpeedSelect.addEventListener('change', (e) => {
            speechRate = parseFloat(e.target.value);
        });

        ttsSystemSelect.addEventListener('change', (e) => {
            currentTTSSystem = e.target.value;
            console.log(`Switched to ${currentTTSSystem} TTS system`);
            loadVoices().then(() => {
                console.log(`Voice loading complete for ${currentTTSSystem}`);
            });
        });

        document.addEventListener('change', (e) => {
            if (e.target.name === 'quiz-mode') {
                quizMode = e.target.value;
                console.log(`Quiz mode changed to: ${quizMode}`);
            }
        });

        aiSupportBtn.addEventListener('click', () => {
            aiSupportModal.style.display = 'flex';
        });

        aiSupportCloseBtn.addEventListener('click', () => {
            aiSupportModal.style.display = 'none';
        });

        textImportBtn.addEventListener('click', () => {
            textImportModal.style.display = 'flex';
        });

        textImportCloseBtn.addEventListener('click', () => {
            textImportModal.style.display = 'none';
        });

        // ===== PRESET VOCABULARY DATA =====
        const presetVocabulary = {
            b3l1: ` `,
            b3l2: `
â—Vocabulary---First Half (#1-#11)
innovate (v) =å‰µæ–°(v)
promise (v) =æ‰¿è«¾(v)
material (n) =ææ–™ã€åŸæ–™
mention (v) =æåˆ°ã€èªªåˆ°(v)
structure (n) =çµæ§‹
â—Vocabulary--Second Half (#12-#20)
rank (v) =æ’å(v)
unique (adj) =ç¨ç‰¹çš„
adjust (v) =èª¿æ•´(v)
rely (v) =ä¾é 
feedback (n) =å›é¥‹ã€æ„è¦‹
`,
            b3l3: `
â—Paragraph 1
champion (n) = 1.å† è»  2.æè¡›è€…
universe (n) = å®‡å®™
be known asâ€¦ = è¢«ç¨±ç‚ºâ€¦
create (v) = å‰µé€ 
human being (n) = äººé¡(ï¼human, humankind)
clay (n) = é»åœŸ
living creature (n) = æœƒå‹•çš„ç”Ÿç‰©ã€å‹•ç‰©(ä¸åŒ…æ‹¬æ¤ç‰©ï¼)
on earth = åœ¨åœ°çƒä¸Š
quality (n) = å“è³ª
speed (n) = é€Ÿåº¦
strength (n) = åŠ›é‡
fur (n) = æ¯›çš®
wing (n) = ç¿…è†€
by the timeâ€¦ = åˆ°äº†â€¦çš„æ™‚å€™
get toâ€¦= åˆ°é”â€¦(ï¼ arrive atâ€¦)
run out ofâ€¦ = [ç‰‡èª] ç”¨å®Œâ€¦
make up forâ€¦ = [ç‰‡èª] å½Œè£œâ€¦
weak (adj) = è™›å¼±çš„
state (n) = ç‹€æ…‹
enable (v) = ä½¿èƒ½å¤ 
stand upright = ç›´ç«‹ç«™ç«‹
not onlyâ€¦but alsoâ€¦ = ä¸åƒ…â€¦è€Œä¸”â€¦
generous (adj) = æ…·æ…¨çš„
so thatâ€¦ = ä»¥ä¾¿â€¦
tool (n) = å·¥å…·
â—Paragraph 2
conflict (n) = è¡çª(n)
Olympian gods (n) = å¥§æ—åŒ¹æ–¯çœ¾ç¥
distribution (n) = åˆ†é…(n)
make sacrifices = åšå‡ºçŠ§ç‰²
a sacrifice to God = ç»çµ¦ç¥çš„ç¥­å“
trick someone (into doing something) = æ¬ºé¨™æŸäººï¼ˆå»åšæŸäº‹ï¼‰
benefit (n) = å¥½è™•
slaughter (v) = å± æ®º
an offering to God = çµ¦ç¥çš„ä¾›å“
accept someoneâ€™s offer = æ¥å—æŸäººçš„æè­°
turn down someoneâ€™s offer = æ‹’çµ•æŸäººçš„æè­°
special offer = ç‰¹åˆ¥å„ªæƒ 
a pile ofâ€¦ = ä¸€å †â€¦
bone (n) = éª¨é ­
shiny fat (n) = ç™¼äº®çš„è„‚è‚ª
underneath = åœ¨â€¦ä¸‹é¢(ï¼under)
instead = åè€Œï¼›ä½œç‚ºæ›¿ä»£
end up = [ç‰‡èª] çµæœè®Šæˆâ€¦
nothing butâ€¦ = åªæœ‰â€¦ï¼›ä¸éæ˜¯â€¦
as a result = [ç‰‡èª] çµæœã€å› æ­¤
from now on = å¾ç¾åœ¨èµ·
from that day on = å¾é‚£å¤©èµ·
â—Paragraph 3
be angry aboutâ€¦ = å°â€¦ç”Ÿæ°£
starve (v) = æŒ¨é¤“
freeze (v) = å‡åƒµ
be able toâ€¦ = æœ‰èƒ½åŠ›(åšæŸäº‹)
be unable toâ€¦ = ç„¡æ³•(åšæŸäº‹)
weapon (n) = æ­¦å™¨
to live in a cave = ä½åœ¨æ´ç©´è£¡
fall victim toâ€¦ = [ç‰‡èª] æˆç‚ºâ€¦çš„å—å®³è€…
wild (adj) = é‡ç”Ÿçš„
beast (n) = é‡ç¸
miserable (adj) = æ‚²æ…˜çš„
the stalk or stem of a flower (n) = èŠ±æ¢—æˆ–è–
light a match = é»ç‡ƒç«æŸ´
hollow (adj) = ä¸­ç©ºçš„
â—Paragraph 4
be furious aboutâ€¦ = å°â€¦æ¥µåº¦æ†¤æ€’(> be angry aboutâ€¦)
theft (n) = ç«Šç›œ
punish (v) = æ‡²ç½°
banish (v) = æ”¾é€
be chained to a tree = è¢«é–éˆæ‹´åœ¨æ¨¹ä¸Š
feed onâ€¦ = [ç‰‡èª] ä»¥â€¦ç‚ºé£Ÿ
liver (n) = è‚è‡Ÿ
gnaw (v) = å•ƒå’¬
torture (v) = æŠ˜ç£¨
until the end of time = ç›´åˆ°æ™‚é–“çš„ç›¡é ­
set the stage forâ€¦ = [ç‰‡èª] ç‚ºâ€¦å‰µé€ æ¢ä»¶ã€ä¿ƒæˆ
civilization (n) = æ–‡æ˜
 `,
            maga1: `
â—Sept. 16â€”Paragraph 1
run (n) = æ—…ç¨‹(ï¼ journey)
zombie (n) = æ®­å±
salmon (n) = é®­é­š
chaos (n) = æ··äº‚
term (n) = ç”¨èªï¼›è¡“èª
bring to mind = [ç‰‡èª] ä½¿äººæƒ³èµ·
chain (n) = é–éˆ
chain store (n) = é€£é–åº—
food chain (n) = é£Ÿç‰©éˆ
take place = [ç‰‡èª] (äº‹æƒ…)ç™¼ç”Ÿã€(æ´»å‹•)èˆ‰è¡Œ
thousands ofâ€¦ = ä¸Šåƒçš„â€¦
surge (v) = æ¿€å¢
swim upstream = æº¯æµè€Œä¸Š
spawn (v) = (é­šã€é’è›™ç­‰å¤§é‡)ç”¢åµ
lay eggs = (é³¥ã€é›ç­‰)ä¸‹è›‹
journey (n) = æ—…ç¨‹
be known asâ€¦ = è¢«ç¨±ç‚ºâ€¦
chapter (n) = ç« ç¯€
fascinating (adj) = è¿·äººçš„
life cycle (n) = ç”Ÿå‘½é€±æœŸ
a Korean drama (n) = éŸ“åŠ‡
dramatic (adj) = æˆ²åŠ‡æ€§çš„
virus (n) = ç—…æ¯’
go viral (on the internet) = åœ¨ç¶²è·¯ä¸Šçˆ†ç´…
promotion (n) = å®£å‚³ï¼›æ¨å»£
â—Sept. 16â€”Paragraph 2
freshwater fish (n) = æ·¡æ°´é­š
saltwater fish (n) = æµ·æ°´é­š
ocean (n) = æµ·æ´‹
a couple ofâ€¦ = å¹¾å€‹â€¦
stream (< river) (n) = æºªæµ(< æ²³å·)
start asâ€¦ = ä»¥â€¦é–‹å§‹
lay eggs (v) = ä¸‹è›‹
gravel (n) = ç¤«çŸ³
nest (n) = å·¢ç©´
go throughâ€¦= [ç‰‡èª] ç¶“æ­·â€¦(ï¼ experience)
stage (n) = éšæ®µ
on oneâ€™s way toâ€¦ =  [ç‰‡èª] åœ¨å‰å¾€â€¦çš„é€”ä¸­
journey (v) = æ—…è¡Œ
swim downstream = é †æµè€Œä¸‹
gather (v) = èšé›†
estuary (n) = æ²³å£
adapt toâ€¦ (v) = é©æ‡‰â€¦
concentration (n) = å°ˆæ³¨ï¼›é›†ä¸­
high salt concentration = é«˜é¹½æ¿ƒåº¦
grow scales = é•·å‡ºé±—ç‰‡
silvery (adj) = éŠ€ç™½è‰²çš„
protect someone fromâ€¦ = ä¿è­·æŸäººå…æ–¼â€¦
predator (n) = æ•é£Ÿè€…
â—Sept. 16â€”Paragraph 3
adult (n) =æˆäºº
mature (v) = æˆç†Ÿ
return toâ€¦ = å›åˆ°â€¦
(fishing/huntingâ€¦) ground (n) = (æ•é­š/ç‹©çµç­‰æœ‰ç‰¹æ®Šç”¨é€”çš„)å€åŸŸã€å ´åœ°
experience (v) = ç¶“æ­·
extreme (adj) = æ¥µç«¯çš„
physical (adj) = èº«é«”çš„ã€ç”Ÿç†çš„
exhausting (adj) = ä»¤äººç­‹ç–²åŠ›ç«­çš„(> tiring)
guide (v) = å¼•å°
instinct (n) = æœ¬èƒ½
current (n) = æ°´æµã€æ°£æµã€é›»æµ
swim against the current = é€†æµè€Œä¸Š
leap (v) = è·³èº(ï¼jump)
waterfall (n) = ç€‘å¸ƒ
reach (a place) = æŠµé”(æŸè™•)(ï¼ arrive atâ€¦)
place of birth (n) = å‡ºç”Ÿåœ°
restart  (v) = é‡æ–°é–‹å§‹(ï¼ start again)
rot (v) = è…çˆ›
earn money = è³ºéŒ¢
earn friendship/respectâ€¦ = è´å¾—å‹èª¼ï¼å°Šæ•¬â€¦
earn someone something = ç‚ºæŸäººè´å¾—æŸç‰©
nickname (n) = ç¶½è™Ÿ
â—Sept. 17â€”Paragraph 1
species (n) = ç‰©ç¨®
as a keystone species = ä½œç‚ºé—œéµç‰©ç¨®
play a central role inâ€¦ =  [ç‰‡èª] åœ¨â€¦ä¸­æ‰®æ¼”æ ¸å¿ƒè§’è‰²
ecosystem (n) = ç”Ÿæ…‹ç³»
nutrient (n) = é¤Šåˆ†
sustain (v) = ç¶­æŒ
feed (v) = é¤µé¤Šï¼›ä¾›çµ¦é£Ÿç‰©
insect (n) = æ˜†èŸ²
benefit (fromâ€¦) (v) = å—ç›Š(æ–¼â€¦)
woods (n) = æ¨¹æ—
fertilize (v) = æ–½è‚¥
soil (n) = åœŸå£¤
in addition toâ€¦ =  [ç‰‡èª] é™¤äº†â€¦ä¹‹å¤–(ï¼besidesâ€¦)
ecological (adj) = ç”Ÿæ…‹çš„
value (n) = åƒ¹å€¼
throughout (+ place) = éåŠ(æŸè™•)ã€(æŸè™•)åˆ°è™•éƒ½æ˜¯
throughout (+ time) = æ•´å€‹â€¦æœŸé–“
range (n) = ç¯„åœ
community (n) = ç¤¾ç¾¤ï¼›ç¾¤é«”
rely onâ€¦ (v) = ä¾é â€¦
valuable (adj) = æœ‰åƒ¹å€¼çš„
source of food (n) = é£Ÿç‰©ä¾†æº
the basis ofâ€¦ = â€¦çš„åŸºç¤
economy (n) = ç¶“æ¿Ÿ
â—Sept. 17â€”Paragraph 2
despiteâ€¦ = å„˜ç®¡â€¦(ï¼ in spite ofâ€¦)
environmental (adj) = ç’°å¢ƒçš„
economic (adj) = ç¶“æ¿Ÿçš„
face (v) = é¢å°
growing threats = æ—¥ç›Šå¢åŠ çš„å¨è„…
on several fronts = åœ¨å¹¾å€‹æ–¹é¢
climate change (n) = æ°£å€™è®Šé·
waters (n) = æ°´åŸŸ(water + S)
affect (v) = å½±éŸ¿(ï¼influence)
migration (n) = é·å¾™
pattern (n) = æ¨¡å¼
while = è€Œâ€¦(è¡¨ç¤ºã€Œå°æ¯”ã€)
dam (n) = æ°´å£©
pollution (n) = æ±¡æŸ“
degrade (v) = ä½¿æƒ¡åŒ–
habitat (n) = æ£²æ¯åœ°
further (adv) = 1.æ›´é  2.æ›´é€²ä¸€æ­¥
reduce (v) =ä½¿æ¸›å°‘(vs. increase)
shrink (v) = ç¸®å°(vs. expand)
population (n) = äººå£ï¼›æ—ç¾¤æ•¸é‡
deal withâ€¦ =  [ç‰‡èª] è™•ç†â€¦
require (v) = éœ€è¦(ï¼need)
government (n) = æ”¿åºœ
responsibility (n) = è²¬ä»»
ultimately (adv) = æœ€çµ‚ã€çµ‚ç©¶
(responsibility) lie with someone =  [ç‰‡èª]ï¼ˆè²¬ä»»ï¼‰åœ¨æ–¼æŸäºº
â—Sept. 17â€”Paragraph 3
support (v) = æ”¯æŒ
reduce plastic use = æ¸›å°‘å¡‘è† ä½¿ç”¨
push forâ€¦ = åŠªåŠ›çˆ­å–ã€åè¦†è¦æ±‚
protective (adj) = ä¿è­·æ€§çš„
policy (n) = æ”¿ç­–
individual (n) = å€‹äºº
take action = æ¡å–è¡Œå‹•
future generations (n) = æœªä¾†ä¸–ä»£ã€å¾Œä»£å­å­«
deserve (v) = å€¼å¾—æ“æœ‰ã€ç†æ‡‰å¾—åˆ°
thriving (adj) = ç¹æ¦®çš„ã€èˆˆç››çš„
natural world (n) = è‡ªç„¶ç•Œ

 `,
            maga2: `

â—Sept. 22â€”Paragraph 1
refrigerator / fridge (n) = å†°ç®±
have something in common = [ç‰‡èª] æœ‰å…±åŒé»
rely onâ€¦ (v) = ä¾é â€¦
tiny (adj) = å¾®å°çš„
a piece of technology (n) = ä¸€é …ç§‘æŠ€ç”¢å“
(be made withâ€¦) This cake is made with eggs and flour. = [ç”±â€¦è£½æˆ] é€™å€‹è›‹ç³•æ˜¯ç”¨è›‹å’Œéºµç²‰åšçš„ã€‚(ä½¿ç”¨æŸç‰©ä½œç‚ºé›¶ä»¶æˆ–åŸæ–™ä¹‹ä¸€ vs. be made fromâ€¦ & be made ofâ€¦)
semi- = ä¸€åŠçš„ã€åŠâ€¦ (å¦‚ï¼šsemifinalåŠæ±ºè³½ï¼Œå³å››å¼·è³½)
semiconductor (n) = åŠå°é«”
in fact = äº‹å¯¦ä¸Š
rarely (adv) = å¾ˆå°‘åœ°
device (n) = è£ç½®
simply (adv) = ç°¡å–®åœ°
function (v) = é‹ä½œï¼›èµ·ä½œç”¨
â—Sept. 22â€”Paragraph 2
exactly (adv) = æ­£ç¢ºåœ°ï¼›å®Œå…¨åœ°
in simple terms = ç°¡å–®ä¾†èªª
material (n) = ææ–™
the flow ofâ€¦ = â€¦çš„æµå‹•
electricity (n) = é›»
metal (n) = é‡‘å±¬
conduct electricity or heat = å‚³å° é›»æˆ–ç†±
adjust (v) = èª¿æ•´
block (v) = é˜»æ“‹
to aâ€¦ degree = åœ¨æŸç¨®ç¨‹åº¦ä¸Š
various (adj) = å„ç¨®çš„
in other words = [ç‰‡èª] æ›å¥è©±èªª
act likeâ€¦ = åšå‡ºåƒâ€¦çš„è¡Œç‚º
miniature (adj) = å¾®å‹çš„
be well suited forâ€¦ = å¾ˆé©åˆæ–¼â€¦
electronic device (n) = é›»å­è£ç½®
micro- = å¾®å°çš„ã€å¾®â€¦ (å¦‚ï¼šmicrowaveå¾®æ³¢ã€Microsoftå¾®è»Ÿ)
microchip (n) = å¾®æ™¶ç‰‡
in turn  = 1.è¼ªæµåœ°(ï¼one after another)
in turn = 2.å› æ­¤ï¼›ä½œç‚ºçµæœ(ï¼as a result of something)
fundamental (adj) = åŸºæœ¬çš„
component (n) = å…ƒä»¶
â—Sept. 22â€”Paragraph 3
utterly (adv) = å®Œå…¨åœ°
transform (v) = æ”¹è®Š
shrink (v) = ç¸®å°(vs. expandæ“´å¤§)
dramatically (adv) = æˆ²åŠ‡æ€§åœ°ï¼›å¤§å¹…åº¦åœ°
increasingly (+ adj.) = è¶Šä¾†è¶Šâ€¦
enable (v) = ä½¿èƒ½å¤ 
(be made fromâ€¦) Paper is made from trees. = [ç”±â€¦è£½æˆ] ç´™æ˜¯æ¨¹åšçš„ã€‚(çœ‹ä¸å‡ºåŸæ–™)
(be made ofâ€¦) This table is made of wood. = [ç”±â€¦è£½æˆ] é€™å¼µæ¡Œå­æ˜¯æœ¨é ­åšçš„ã€‚(çœ‹å¾—å‡ºåŸæ–™)
silicon (n) = çŸ½
common (adj) = å¸¸è¦‹çš„
element (n) = å…ƒç´ 
modify (v) = ä¿®æ”¹
act asâ€¦ = 1.è‡¨æ™‚æ“”ä»»ã€å……ç•¶  2.æœ‰â€¦æ•ˆæœã€èµ·â€¦ä½œç”¨
an on-off switch (n) = é–‹é—œ
electric signal (n) = é›»å­ä¿¡è™Ÿ
form (v) = å½¢æˆ
laptop (computer) (n) = ç­†è¨˜å‹é›»è…¦
billions ofâ€¦ = æ•¸åå„„çš„â€¦
â—Sept. 23â€”Paragraph 1
be found inâ€¦ = å­˜åœ¨æ–¼â€¦
electronics (n) = é›»å­ç”¢å“
desktop (computer) (n) = æ¡Œä¸Šå‹é›»è…¦
tablet (computer) (n) = å¹³æ¿é›»è…¦
gaming console (n) = éŠæˆ²æ©Ÿ
contain (v) = å«æœ‰
process (v) = è™•ç†
processor (n) = è™•ç†å™¨
memory chip (n) = è¨˜æ†¶æ™¶ç‰‡
communication system (n) = é€šè¨Šç³»çµ±
power (v) = ç‚ºâ€¦ä¾›é›»
data (n) = æ•¸æ“š
store (v) = å„²å­˜
information (n) = è³‡è¨Š
website (n) = ç¶²ç«™
be full ofâ€¦ = å……æ»¿â€¦
server (n) = ä¼ºæœå™¨
run onâ€¦ = ä»¥â€¦é‹ä½œ
advanced (adj) = å…ˆé€²çš„
video streaming (n) = å½±éŸ³ä¸²æµ
social media (n) = ç¤¾ç¾¤åª’é«”
â—Sept. 23â€”Paragraph 2
play a key role inâ€¦ = [ç‰‡èª] åœ¨â€¦æ‰®æ¼”é—œéµè§’è‰²
get around = å››è™•èµ°å‹•ï¼›ç§»å‹•
electric car (n) = é›»å‹•è»Š
manage (v) = ç®¡ç†
battery power (n) = é›»æ± é›»åŠ›
maintain (v) = ç¶­æŒ
efficiency (n) = æ•ˆç‡
feature (n) = ç‰¹é»ã€ç‰¹è‰²
navigation (n) = å°èˆª
run (v) = é‹è¡Œ
appliance (n) = å®¶é›»
temperature (n) = æº«åº¦
automate cycles (v) = è‡ªå‹•åŒ–å¾ªç’°
track (v) = è¿½è¹¤
expire (v) = åˆ°æœŸ(å¤±æ•ˆã€ç„¡æ³•ä½¿ç”¨ã€é£Ÿç‰©éæœŸ)
expiration date (n) = (åˆç´„ã€ç°½è­‰ã€ä¿¡ç”¨å¡ã€é£Ÿç‰©ç­‰åœ°)æœ‰æ•ˆæœŸé™
recipe (n) = (æŸé“èœçš„)é£Ÿè­œ(vs. cookbookä¸€æœ¬é£Ÿè­œ)
thanks toâ€¦ = [ç‰‡èª] å¤šè™§â€¦ã€ç”±æ–¼â€¦(ï¼because ofâ€¦, due toâ€¦)
â—Sept. 23â€”Paragraph 3
crucial (adj) = é—œéµçš„
behind the scenes = [ç‰‡èª] å¹•å¾Œã€ä¸ç‚ºäººçŸ¥åœ°
digital (adj) = æ•¸ä½çš„
keep something running = è®“æŸç‰©æŒçºŒé‹ä½œ
oneâ€¦ at a time = ä¸€æ¬¡ä¸€å€‹â€¦
â—Review: technical terms (å°ˆæœ‰åè©)
conduct electricity or heat = å‚³å°é›»æˆ–ç†±
semiconductor (n) = åŠå°é«”
microchip (n) = å¾®æ™¶ç‰‡
memory chip (n) = è¨˜æ†¶æ™¶ç‰‡
silicon (n) = çŸ½
electric signal (n) = é›»å­ä¿¡è™Ÿ
laptop (computer) (n) = ç­†è¨˜å‹é›»è…¦
desktop (computer) (n) = æ¡Œä¸Šå‹é›»è…¦
tablet (computer) (n) = å¹³æ¿é›»è…¦
processor (n) = è™•ç†å™¨
server (ä¼ºæœå™¨) (n) = ä¼ºæœå™¨
communication system (n) = é€šè¨Šç³»çµ±
automate cycles (v) = è‡ªå‹•åŒ–å¾ªç’°




 `,
            maga3: `
@Paragraph 1
import (n) = é€²å£
take root = æ‰æ ¹
kingdom (n) = ç‹åœ‹
yet = ç„¶è€Œ(but, however) vs. not yet (é‚„æ²’ã€å°šæœª)
be native toâ€¦ = åŸç”¢æ–¼â€¦
island (n) = å³¶å¶¼
in fact = [ç‰‡èª] äº‹å¯¦ä¸Š
variety (n) = å“ç¨®ï¼›å¤šæ¨£æ€§
introduce (v) = 1.ä»‹ç´¹  2.é¦–æ¬¡æ¨è¡Œï¼›æ¡ç”¨ï¼›å¼•é€²
Dutch (n/adj) = è·è˜­äººï¼›è·è˜­çš„
century (n) = ä¸–ç´€
colonial rule (n) = æ®–æ°‘çµ±æ²»
influence (v) = å½±éŸ¿(ï¼affect)
shape (v) = å½¢å¡‘ã€å¡‘é€ 
agriculture (n) = è¾²æ¥­
to this day = [ç‰‡èª] ç›´åˆ°ä»Šæ—¥
@Paragraph 2
guava (n) = èŠ­æ¨‚
sugar apple (n) = é‡‹è¿¦
wax apple (n) = è“®éœ§
originally (adv) = åŸæœ¬ã€èµ·åˆ
tropical (adj) = ç†±å¸¶çš„
bring something in (v) = [ç‰‡èª] å¼•é€²æŸç‰©
establish (v) = å»ºç«‹
profitable (adj) = æœ‰åˆ©å¯åœ–çš„
crops (n) = è¾²ä½œç‰©
trade (n) = è²¿æ˜“
agricultural (adj) = è¾²æ¥­çš„
landscape (n) = æŸåœ°å€çš„æ™¯è‰²ã€é¢¨æ™¯
varied (adj) = å¤šæ¨£åŒ–çš„
major (adj) = ä¸»è¦çš„
producer (n) = ç”Ÿç”¢è€…
@Paragraph 3
a period of time (n) = ä¸€æ®µæ™‚é–“
certainly (adv) = ç¢ºå¯¦ã€å¿…ç„¶
negative (adj) = è² é¢çš„
have a positive impact onâ€¦ = å°â€¦æœ‰æ­£é¢å½±éŸ¿
fruit cultivation (n) = æ°´æœæ ½åŸ¹
improve (v) = æ”¹å–„
local (adj) = ç•¶åœ°çš„
farming (n) = è¾²è€•
play a vital role inâ€¦ = åœ¨â€¦ä¸­æ‰®æ¼”é‡è¦è§’è‰²
industry (n) = 1.å·¥æ¥­  2.ç”¢æ¥­
@Paragraph 4
once (adv) = æ›¾ç¶“
be deeply rooted inâ€¦ = æ·±æ¤æ–¼â€¦
serve asâ€¦ (v) = å……ç•¶ï¼›ç•¶ä½œâ€¦ä½¿ç”¨
remind (v) = æé†’ï¼›ä½¿æƒ³èµ·â€¦
reminder (n) = æé†’çš„é€šçŸ¥ç­‰
historical (adj) = æ­·å²çš„
exchange (n) = äº¤æµï¼›äº¤æ›
complex (adj) = è¤‡é›œçš„
yield (v) = ç”¢ç”Ÿï¼›å‡ºç”¢
enduring (adj) = æŒä¹…çš„
fruitful (adj) = æœ‰æˆæœçš„ï¼›è±ç¢©çš„
result (n) = çµæœ

 `,
            maga4: `
â—Sept. 26â€”Paragraph 1
the long and short of it = ç¸½è€Œè¨€ä¹‹
constantly (adv) = ä¸æ–·åœ°
century (n) = ä¸–ç´€
significantly (adv) = é¡¯è‘—åœ°
length (n) = é•·åº¦
trend (n) = è¶¨å‹¢
reveal (v) = æ­éœ²
â—Sept. 26â€”Paragraph 2
economist (n) = ç¶“æ¿Ÿå­¸å®¶
index (n) = æŒ‡æ•¸
theory (n) = ç†è«–
reflect (v) = åæ˜ 
economy (n) = ç¶“æ¿Ÿ
according toâ€¦ = æ ¹æ“šâ€¦
supporter (n) = æ”¯æŒè€…
point toâ€¦ = æŒ‡å‡ºâ€¦
booming (adj) = è“¬å‹ƒç™¼å±•çš„
depression (n) = 1.æ†‚é¬±  2.ç¶“æ¿Ÿä¸æ™¯æ°£
the Great Depression (n) =ç¶“æ¿Ÿå¤§è•­æ¢(1929å¹´~1933å¹´)
symbol (n) = è±¡å¾µ(n)
decade (n) = åå¹´
in contrast = ç›¸è¼ƒä¹‹ä¸‹
be marked byâ€¦ = ä»¥â€¦ç‚ºç‰¹å¾µ
various (adj) = å„ç¨®çš„
financial (adj) = é‡‘èçš„ï¼›è²¡å‹™çš„
increase (v) = å¢åŠ (v)
popularity (n) = æ™®åŠï¼›å—æ­¡è¿ç¨‹åº¦
flow (n) = æµå‹•(n)
(theory) hold up = ï¼ˆç†è«–ï¼‰ç¶“å¾—èµ·è€ƒé©—
remain (v) = ç¶­æŒ(æŸç‹€æ…‹)
crisis (n) = å±æ©Ÿ
be tied toâ€¦ = èˆ‡â€¦æœ‰é—œ(ï¼be related toâ€¦)
the stock market (n) = è‚¡å¸‚
â—Sept. 26â€”Paragraph 3
in fact = äº‹å¯¦ä¸Š
cultural and social changes (n) = æ–‡åŒ–èˆ‡ç¤¾æœƒè®Šé·
role (n) = è§’è‰²
gain (v) = ç²å¾—
the right (to do something) = (åšæŸäº‹çš„)æ¬Šåˆ©
vote (v) = æŠ•ç¥¨
â—Sept. 29â€”Paragraph 1
fascinating (adj) = è¿·äººçš„
thousands ofâ€¦ = æˆåƒä¸Šè¬çš„â€¦
be made fromâ€¦ = ç”±â€¦è£½æˆ(vs. be made ofâ€¦)
leather (n) = çš®é©
ancient (adj) = å¤ä»£çš„
Egypt (n) = åŸƒåŠ
Greece (n) = å¸Œè‡˜
wrap (v) = åŒ…èµ·ä¾†(v)
medieval (adj) = ä¸­ä¸–ç´€çš„
favor (v) = åæ„›
shift (v/n) = è½‰è®Š(ï¼change)
slim (adj) = è‹—æ¢çš„
emerge (v) = å‡ºç¾ã€æµ®ç¾
â—Sept. 29â€”Paragraphs 2 & 3
gender (n) = æ€§åˆ¥
attitude towardâ€¦ = å°â€¦çš„æ…‹åº¦
indeed (adv) = çš„ç¢º
avoidâ€¦ altogether = å®Œå…¨é¿å…â€¦
assert (v) = ä¸»å¼µï¼›æ–·è¨€
independence (n) = ç¨ç«‹
recently (adv) = æœ€è¿‘
airline (n) = èˆªç©ºå…¬å¸
announce (v) = å®£å¸ƒ
staff (n) = (å…¨é«”)å“¡å·¥
on duty = å€¼å‹¤ä¸­
celebrity (n) = åäºº
challenge (v) = æŒ‘æˆ°
norm (n) = å¸¸è¦ï¼›è¦ç¯„
somewhere in between = ä»‹æ–¼å…©è€…ä¹‹é–“
for sure = ç¢ºå®šåœ°
 `,
            coreP2U1: `
â—Words/Phrases
dependent (adj) = ä¾è³´çš„
imagine (v) = æƒ³åƒ
electronics (n) = 1.é›»å­å­¸  2.é›»å­è¨­å‚™
advanced (adj) = å…ˆé€²çš„ï¼›é«˜ç´šçš„
commercial (adj) = å•†æ¥­çš„ï¼›ç‡Ÿåˆ©çš„
TV commercial = é›»è¦–å»£å‘Š
technically (adv) = æŠ€è¡“ä¸Šï¼›åš´æ ¼ä¾†èªª
assistant (n) = åŠ©æ‰‹
device (n) = è£ç½®ï¼›è¨­å‚™
imitate (v) = æ¨¡ä»¿
invent (v) = ç™¼æ˜
further (v) = ä¿ƒé€²ï¼›æ¨é€²
further (adj/adv) = æ›´å¤šçš„ã€æ›´é€²ä¸€æ­¥çš„
research (n/v) = ç ”ç©¶
combination (n) = çµ„åˆ
practical (adj) = å¯¦ç”¨çš„
fashionable (adj) = æ™‚å°šçš„ï¼›æµè¡Œçš„
in addition toâ€¦ = é™¤äº†â€¦ä¹‹å¤–(ï¼besidesâ€¦)
educate (v) = æ•™è‚²ï¼›åŸ¹é¤Š
entertain (v) = å¨›æ¨‚ï¼›æ‹›å¾…
growth (n) = æˆé•·ï¼›ç™¼å±•
promote (v) = ä¿ƒé€²ï¼›æ¨å»£
â—Example Sentences
Children are dependent on their parents for food. = å­©å­åœ¨é£Ÿç‰©ä¸Šä¾è³´çˆ¶æ¯ã€‚
I canâ€™t imagine a world without phones. = æˆ‘ç„¡æ³•æƒ³åƒä¸€å€‹æ²’æœ‰æ‰‹æ©Ÿçš„ä¸–ç•Œã€‚
Electronics are part of modern life. = é›»å­è¨­å‚™æ˜¯ç¾ä»£ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ã€‚
This is an advanced computer program. = é€™æ˜¯ä¸€å€‹å…ˆé€²çš„é›»è…¦ç¨‹å¼ã€‚
Many companies make commercial products. = è¨±å¤šå…¬å¸ç”Ÿç”¢å•†æ¥­ç”¢å“ã€‚
I saw a funny TV commercial yesterday. = æˆ‘æ˜¨å¤©çœ‹åˆ°ä¸€å€‹æœ‰è¶£çš„é›»è¦–å»£å‘Šã€‚
Technically, he didnâ€™t break the rules. = æŠ€è¡“ä¸Šä¾†èªªï¼Œä»–ä¸¦æ²’æœ‰é•è¦ã€‚
She works as an assistant in the office. = å¥¹åœ¨è¾¦å…¬å®¤ç•¶åŠ©æ‰‹ã€‚
A smartphone is a useful device. = æ™ºæ…§å‹æ‰‹æ©Ÿæ˜¯ä¸€å€‹æœ‰ç”¨çš„è£ç½®ã€‚
Children often imitate their parents. = å­©å­å¸¸æ¨¡ä»¿çˆ¶æ¯ã€‚
He can invent new tools easily. = ä»–èƒ½è¼•æ˜“ç™¼æ˜æ–°å·¥å…·ã€‚
We need to further our knowledge. = æˆ‘å€‘éœ€è¦ä¿ƒé€²æˆ‘å€‘çš„çŸ¥è­˜ã€‚
He offered further advice on the topic. = ä»–å°é€™å€‹ä¸»é¡Œæä¾›æ›´å¤šå»ºè­°ã€‚
We need to further check the results. =æˆ‘å€‘éœ€è¦æ›´é€²ä¸€æ­¥ç¢ºèªçµæœã€‚
Scientists do research on climate change. = ç§‘å­¸å®¶ç ”ç©¶æ°£å€™è®ŠåŒ–ã€‚
A combination of colors makes the painting beautiful. = é¡è‰²çš„çµ„åˆè®“ç•«ä½œå¾ˆæ¼‚äº®ã€‚
This bag is very practical for travel. = é€™å€‹åŒ…å°æ—…è¡Œå¾ˆå¯¦ç”¨ã€‚
She always wears fashionable clothes. = å¥¹ç¸½æ˜¯ç©¿æ™‚å°šçš„è¡£æœã€‚
In addition to English, she speaks French. = é™¤äº†è‹±æ–‡ï¼Œå¥¹é‚„æœƒèªªæ³•æ–‡ã€‚
Teachers educate students in many subjects. = è€å¸«æ•™è‚²å­¸ç”Ÿå¾ˆå¤šç§‘ç›®ã€‚
Movies entertain people in their free time. = é›»å½±åœ¨ä¼‘é–’æ™‚é–“å¨›æ¨‚äººå€‘ã€‚
The growth of trees is slow in winter. = æ¨¹æœ¨åœ¨å†¬å¤©ç”Ÿé•·ç·©æ…¢ã€‚
We should promote healthy eating habits. = æˆ‘å€‘æ‡‰è©²æ¨å»£å¥åº·é£²é£Ÿç¿’æ…£ã€‚

 `,
            coreP2U2: `
â—Words/Phrases
handy (adj) = æ–¹ä¾¿çš„ï¼›æœ‰ç”¨çš„
come in handy = [ç‰‡èª] æ´¾ä¸Šç”¨å ´
microwave (oven) = å¾®æ³¢çˆ
extra (n/adj) = é¡å¤–çš„ï¼›é¡å¤–çš„æ±è¥¿
typically (adv) = é€šå¸¸ï¼›å…¸å‹åœ°
design (v/n) = è¨­è¨ˆï¼›åœ–æ¡ˆ
motivate (v) = æ¿€å‹µ
ideal (adj/n) = ç†æƒ³çš„ï¼›ç†æƒ³çš„äºº/äº‹/ç‰©
task (n) = ä»»å‹™ï¼›å·¥ä½œ
drag (v) = æ‹–å‹•ï¼›æ‹‰
especially (adv) = å°¤å…¶
sticky (adj) = é»çš„
dust (n) = ç°å¡µ
keyboard (n) = éµç›¤
polish (v) = æ“¦äº®ï¼›æ½¤è‰²
polish (n) = äº®å…‰åŠ‘(å¦‚ï¼šshoe polishé‹æ²¹ã€nail polishæŒ‡ç”²æ²¹)
tellâ€¦ apart = åˆ†è¾¨â€¦
distribute (v) = åˆ†é…ï¼›æ•£ç™¼
combine (v) = çµåˆã€çµ„åˆ
handle (v) = è™•ç†
(a piece of) baggage (n) = (ä¸€ä»¶)è¡Œæ (ï¼luggage)
â—Example Sentences
This small tool is very handy. = é€™å€‹å°å·¥å…·å¾ˆæ–¹ä¾¿ã€‚
This pen will come in handy later. = é€™æ”¯ç­†ä»¥å¾Œæœƒæ´¾ä¸Šç”¨å ´ã€‚
We heat food in the microwave. = æˆ‘å€‘ç”¨å¾®æ³¢çˆåŠ ç†±é£Ÿç‰©ã€‚
He bought an extra ticket for his friend. = ä»–è²·äº†ä¸€å¼µé¡å¤–çš„ç¥¨çµ¦æœ‹å‹ã€‚
She typically wakes up at seven. = å¥¹é€šå¸¸ä¸ƒé»èµ·åºŠã€‚
The company will design a new logo. = å…¬å¸æœƒè¨­è¨ˆä¸€å€‹æ–°æ¨™èªŒã€‚
Good teachers motivate students to learn. = å¥½è€å¸«æ¿€å‹µå­¸ç”Ÿå­¸ç¿’ã€‚
This is an ideal place for a picnic. = é€™æ˜¯é‡é¤çš„ç†æƒ³åœ°é»ã€‚
Completing the task took two hours. = å®Œæˆé€™é …ä»»å‹™èŠ±äº†å…©å°æ™‚ã€‚
Please drag the file to the folder. = è«‹æŠŠæª”æ¡ˆæ‹–åˆ°è³‡æ–™å¤¾ã€‚
I like all fruits, especially apples. = æˆ‘å–œæ­¡æ‰€æœ‰æ°´æœï¼Œå°¤å…¶æ˜¯è˜‹æœã€‚
The candy is sticky and sweet. = é€™ç³–æœåˆé»åˆç”œã€‚
There is dust on the shelf. = æ¶å­ä¸Šæœ‰ç°å¡µã€‚
Type your password on the keyboard. = åœ¨éµç›¤ä¸Šè¼¸å…¥ä½ çš„å¯†ç¢¼ã€‚
Polish the shoes before the party. = æ´¾å°å‰æŠŠé‹æ“¦äº®ã€‚
This polish makes the table shiny. = é€™ç¨®äº®å…‰åŠ‘è®“æ¡Œå­æœ‰å…‰æ¾¤ã€‚
Itâ€™s hard to tell the twins apart. = åˆ†è¾¨é€™å°é›™èƒèƒå¾ˆå›°é›£ã€‚
The teacher will distribute the books to students. = è€å¸«æœƒæŠŠæ›¸åˆ†ç™¼çµ¦å­¸ç”Ÿã€‚
I combined black tea and milk to make milk tea. = æˆ‘æŠŠç´…èŒ¶å’Œç‰›å¥¶çµ„åˆèµ·ä¾†åšæˆå¥¶èŒ¶ã€‚
She can handle difficult situations well. = å¥¹èƒ½å¾ˆå¥½åœ°è™•ç†å›°é›£æƒ…æ³ã€‚
We packed our baggage for the trip. = æˆ‘å€‘ç‚ºæ—…è¡Œæ‰“åŒ…è¡Œæã€‚

 `,
            coreP2U3: `
â—Vocabulary #1-#10
invention (n) = ç™¼æ˜
brilliant (adj) = å‚‘å‡ºçš„ï¼›è°ç©çš„
complete (adj) = å®Œæ•´çš„ï¼›å®Œå…¨çš„
complete (v) = å®Œæˆ
accident (n) = æ„å¤–ï¼›äº‹æ•…
material (n) = ææ–™ï¼›ç‰©è³ª
explode (v) = çˆ†ç‚¸
control (v) = æ§åˆ¶
control (n) = æ§åˆ¶ï¼›ç®¡ç†
in aâ€¦ manner = ä»¥â€¦æ–¹å¼
â—Example sentences #1-#10
The telephone was an important invention. = é›»è©±æ˜¯ä¸€é …é‡è¦çš„ç™¼æ˜ã€‚
She had a brilliant idea. = å¥¹æœ‰ä¸€å€‹è°æ˜çš„é»å­ã€‚
The puzzle is complete. = é€™å€‹æ‹¼åœ–å·²ç¶“å®Œæ•´äº†ã€‚
I will complete my homework tonight. = æˆ‘ä»Šæ™šæœƒå®Œæˆä½œæ¥­ã€‚
He had an accident on his way to school. = ä»–ä¸Šå­¸çš„è·¯ä¸Šç™¼ç”Ÿäº†æ„å¤–ã€‚
We need more material for the project. = æˆ‘å€‘çš„å°ˆæ¡ˆéœ€è¦æ›´å¤šææ–™ã€‚
The fireworks will explode at midnight. = ç…™ç«æœƒåœ¨åˆå¤œçˆ†ç‚¸ã€‚
I need to control my anger. = æˆ‘éœ€è¦æ§åˆ¶æˆ‘çš„æ†¤æ€’ã€‚
The control of the machine is easy. = æ“ä½œé€™å°æ©Ÿå™¨å¾ˆç°¡å–®ã€‚
She spoke in a polite manner. = å¥¹ä»¥ç¦®è²Œçš„æ–¹å¼èªªè©±ã€‚
â—Vocabulary #11-#20
manners (n) = ç¦®è²Œï¼›èˆ‰æ­¢
amateur (adj) = æ¥­é¤˜çš„
amateur (n) = æ¥­é¤˜æ„›å¥½è€…
burst (v) = ç ´è£‚ï¼›çˆ†ç‚¸
burst into laughter = çªç„¶å¤§ç¬‘
burst into tears = çªç„¶å¤§å“­
flame (n) = ç«ç„°
prosper (v) = ç¹æ¦®ï¼›èˆˆæ—º
universally (adv) = æ™®éåœ°ï¼›å…¨é«”åœ°
ray (n) = å…‰ç·š
â—Example sentences #11-#20
Good manners are important at the table. = é¤æ¡Œä¸Šçš„ç¦®è²Œå¾ˆé‡è¦ã€‚
She is an amateur painter. = å¥¹æ˜¯ä¸€ä½æ¥­é¤˜ç•«å®¶ã€‚
He is an amateur at tennis. = ä»–æ˜¯ä¸€å€‹ç¶²çƒæ¥­é¤˜æ„›å¥½è€…ã€‚
The balloon will burst soon. = æ°£çƒå¾ˆå¿«å°±æœƒçˆ†è£‚ã€‚
The children burst into laughter. = å­©å­å€‘çªç„¶å¤§ç¬‘èµ·ä¾†ã€‚
She burst into tears after hearing the news. = è½åˆ°é€™å€‹æ¶ˆæ¯å¾Œï¼Œå¥¹çªç„¶å¤§å“­ã€‚
The candle has a small flame. = è Ÿç‡­æœ‰ä¸€å€‹å°ç«ç„°ã€‚
The business began to prosper. = ç”Ÿæ„é–‹å§‹ç¹æ¦®ã€‚
This idea is universally accepted. = é€™å€‹æƒ³æ³•è¢«æ™®éæ¥å—ã€‚
A ray of light shone through the window. = ä¸€é“å…‰ç·šé€éçª—æˆ¶ç…§é€²ä¾†ã€‚
â—Vocabulary #21-#31
a ray of hope = ä¸€ç·šå¸Œæœ›
object (n) = ç‰©é«”ï¼›ç›®æ¨™
to object toâ€¦ = åå°â€¦
contribution (n) = è²¢ç»ï¼›æç»
medal (n) = çç‰Œ
earnings (n) = æ”¶å…¥ï¼›æ”¶ç›Š
deserted (adj) = è’å»¢çš„ï¼›ç©ºç„¡ä¸€äººçš„
a culture of cells = ç´°èƒåŸ¹é¤Š
apparently (adv) = é¡¯ç„¶åœ°ï¼›è¡¨é¢ä¸Š
modestly (adv) = è¬™è™›åœ°ï¼›é©åº¦åœ°
clumsy (adj) = ç¬¨æ‹™çš„ï¼›ä¸éˆå·§çš„

â—Example sentences #21-#31
There is a ray of hope for the sick child. = å°é‚£å€‹ç”Ÿç—…çš„å­©å­æœ‰ä¸€ç·šå¸Œæœ›ã€‚
The object on the table is a vase. = æ¡Œä¸Šçš„ç‰©é«”æ˜¯ä¸€å€‹èŠ±ç“¶ã€‚
I object to this plan. = æˆ‘åå°é€™å€‹è¨ˆç•«ã€‚
Her contribution helped the team succeed. = å¥¹çš„è²¢ç»å¹«åŠ©åœ˜éšŠæˆåŠŸã€‚
He won a gold medal. = ä»–è´å¾—äº†ä¸€æšé‡‘ç‰Œã€‚
His earnings are higher this year. = ä»–çš„æ”¶å…¥ä»Šå¹´æ›´é«˜ã€‚
The village was deserted after the storm. = æš´é¢¨é›¨å¾Œï¼Œæ‘èŠè®Šå¾—è’å»¢ã€‚
The scientists grew a culture of cells. = ç§‘å­¸å®¶åŸ¹é¤Šäº†ä¸€å€‹ç´°èƒåŸ¹é¤Šç‰©ã€‚
Apparently, she is very busy today. = é¡¯ç„¶ï¼Œå¥¹ä»Šå¤©éå¸¸å¿™ã€‚
He modestly accepted the praise. = ä»–è¬™è™›åœ°æ¥å—äº†è®šç¾ã€‚
He is clumsy and often drops things. = ä»–å¾ˆç¬¨æ‹™ï¼Œç¶“å¸¸æ‰æ±è¥¿ã€‚
 `,
            other1: ` `,
            other2: ` `
        };

        function isContentEmpty(content) {
            const cleaned = content.replace(/\s+/g, '').replace(/[â—=]/g, '');
            return cleaned.length === 0;
        }

        function showNoContentMessage() {
            const messageOverlay = document.createElement('div');
            messageOverlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0, 0, 0, 0.8); display: flex;
                justify-content: center; align-items: center; z-index: 1000;
            `;

            const messageBox = document.createElement('div');
            messageBox.style.cssText = `
                background-color: white; padding: 30px; border-radius: 15px;
                text-align: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                max-width: 400px; margin: 0 20px;
            `;

            messageBox.innerHTML = `
                <h3 style="color: var(--primary); margin-bottom: 15px;">âš ï¸ No Content Available</h3>
                <p style="font-size: 18px; margin-bottom: 10px;">Please wait for updates.</p>
                <p style="font-size: 16px; color: var(--mid); margin-bottom: 20px;">ç›®å‰æš«ç„¡å…§å®¹,è«‹ç­‰å¾…æ›´æ–°</p>
                <button id="close-no-content-msg" style="
                    background-color: var(--accent1); color: white; padding: 10px 20px;
                    border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">OK</button>
            `;

            messageOverlay.appendChild(messageBox);
            document.body.appendChild(messageOverlay);

            document.getElementById('close-no-content-msg').addEventListener('click', () => {
                document.body.removeChild(messageOverlay);
            });

            messageOverlay.addEventListener('click', (e) => {
                if (e.target === messageOverlay) {
                    document.body.removeChild(messageOverlay);
                }
            });
        }

        document.querySelectorAll('.preset-btn').forEach(button => {
            button.addEventListener('click', () => {
                const presetKey = button.dataset.preset;
                if (presetVocabulary[presetKey]) {
                    const content = presetVocabulary[presetKey];
                    if (isContentEmpty(content)) {
                        showNoContentMessage();
                        return;
                    }

                    processTextImport(content);
                    textImportModal.style.display = 'none';

                    const successMessage = document.createElement('div');
                    successMessage.style.cssText = `
                        position: fixed; top: 20px; right: 20px; background-color: var(--accent2);
                        color: white; padding: 15px 20px; border-radius: 8px; font-weight: bold;
                        z-index: 1000; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                    `;
                    successMessage.textContent = `âœ… ${button.textContent} loaded successfully!`;
                    document.body.appendChild(successMessage);

                    setTimeout(() => {
                        if (document.body.contains(successMessage)) {
                            document.body.removeChild(successMessage);
                        }
                    }, 3000);
                }
            });
        });

        textImportSubmitBtn.addEventListener('click', () => {
            const text = textImportContent.value.trim();
            if (!text) {
                alert('Please choose a lesson or enter vocabulary pairs. (è«‹é¸æ“‡å–®å…ƒæˆ–è¼¸å…¥"English vocabulary = ä¸­æ–‡ç¿»è­¯")');
                return;
            }
            processTextImport(text);
            textImportModal.style.display = 'none';
        });

        textImportClearBtn.addEventListener('click', () => {
            textImportContent.value = '';
        });

        textImportCopyBtn.addEventListener('click', () => {
            const textToCopy = textImportContent.value;
            if (!textToCopy) {
                alert('No text to copy.');
                return;
            }

            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    const originalText = textImportCopyBtn.textContent;
                    textImportCopyBtn.textContent = 'Copied!';
                    setTimeout(() => {
                        textImportCopyBtn.textContent = originalText;
                    }, 1500);
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('Failed to copy text. Please try again.');
                });
        });

        // ===== TEXT IMPORT AND TABLE RENDERING =====
        function processTextImport(text) {
            vocabularyData = [];
            sectionOrder = [];
            const lines = text.split('\n');
            let currentSection = "Default";

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                if (line.includes('â—') || line.includes('@') || line.startsWith('â€»')) {
                    currentSection = line.replace('â—', '').replace('@', '').replace('â€»', '').trim();
                    if (!sectionOrder.includes(currentSection)) {
                        sectionOrder.push(currentSection);
                    }
                    continue;
                }

                const parts = line.split('=');
                if (parts.length < 2) continue;

                const vocabulary = parts[0].trim();
                const translation = parts[1].trim();

                if (vocabulary && translation) {
                    vocabularyData.push({
                        vocabulary: vocabulary,
                        translation: translation,
                        selected: true,
                        section: currentSection
                    });
                }
            }

            renderVocabularyTable();
            if (vocabularyData.length > 0) {
                startBtn.disabled = false;
                englishToChineseBtn.disabled = false;
                listenChooseBtn.disabled = false;
            }
        }

        function toggleSection(sectionName) {
            const sectionRows = document.querySelectorAll(`.section-row[data-section="${sectionName}"]`);
            const collapseBtn = document.querySelector(`[data-section-toggle="${sectionName}"]`);

            if (!collapseBtn) return;

            const isCollapsed = collapseBtn.textContent === 'ğŸ”½';

            if (isCollapsed) {
                sectionRows.forEach(row => row.style.display = 'table-row');
                collapseBtn.textContent = 'ğŸ”¼';
                collapseBtn.title = 'Collapse (æ”¶èµ·)';
            } else {
                sectionRows.forEach(row => row.style.display = 'none');
                collapseBtn.textContent = 'ğŸ”½';
                collapseBtn.title = 'Expand (å±•é–‹)';
            }
        }

        function renderVocabularyTable() {
            if (vocabularyData.length === 0) {
                vocabularyBody.innerHTML = '<tr><td colspan="3" class="no-data">Import your vocabulary list to get started</td></tr>';
                return;
            }

            vocabularyBody.innerHTML = '';
            const sectionMap = {};

            vocabularyData.forEach(item => {
                if (!sectionMap[item.section]) {
                    sectionMap[item.section] = [];
                }
                sectionMap[item.section].push(item);
            });

            Object.keys(sectionMap).forEach(sectionName => {
                const sectionItems = sectionMap[sectionName];

                const sectionRow = document.createElement('tr');
                sectionRow.className = 'section-header';
                const sectionCell = document.createElement('td');
                sectionCell.colSpan = 2;

                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';

                const collapseBtn = document.createElement('button');
                collapseBtn.className = 'collapse-btn';
                collapseBtn.textContent = 'ğŸ”¼';
                collapseBtn.title = 'Collapse (æ”¶èµ·)';
                collapseBtn.setAttribute('data-section-toggle', sectionName);
                collapseBtn.addEventListener('click', () => toggleSection(sectionName));

                const titleText = document.createElement('span');
                titleText.textContent = sectionName;

                sectionTitle.appendChild(collapseBtn);
                sectionTitle.appendChild(titleText);
                sectionCell.appendChild(sectionTitle);

                const sectionCheckCell = document.createElement('td');
                const sectionCheckbox = document.createElement('input');
                sectionCheckbox.type = 'checkbox';
                sectionCheckbox.checked = sectionItems.every(item => item.selected);
                sectionCheckbox.dataset.section = sectionName;

                sectionCheckbox.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;
                    const section = e.target.dataset.section;

                    vocabularyData.forEach((item, index) => {
                        if (item.section === section) {
                            item.selected = isChecked;
                            const checkbox = document.querySelector(`input[data-index="${index}"]`);
                            if (checkbox) checkbox.checked = isChecked;
                        }
                    });

                    updateSelectAllCheckbox();
                });

                sectionCheckCell.appendChild(sectionCheckbox);
                sectionRow.appendChild(sectionCell);
                sectionRow.appendChild(sectionCheckCell);
                vocabularyBody.appendChild(sectionRow);

                sectionItems.forEach((item, localIndex) => {
                    const index = vocabularyData.findIndex(vItem =>
                        vItem.vocabulary === item.vocabulary &&
                        vItem.translation === item.translation);

                    const row = document.createElement('tr');
                    row.className = 'section-row';
                    row.setAttribute('data-section', sectionName);

                    const wordCell = document.createElement('td');
                    const cleanWord = item.vocabulary.replace(/\(.*\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
                    wordCell.innerHTML = `
                        ${item.vocabulary}
                        <span class="speaker-icon" title="Listen" data-word="${cleanWord}">ğŸ”Š</span>
                    `;

                    const translationCell = document.createElement('td');
                    translationCell.textContent = item.translation;

                    const checkboxCell = document.createElement('td');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.selected;
                    checkbox.dataset.index = index;
                    checkbox.dataset.section = item.section;

                    checkbox.addEventListener('change', (e) => {
                        vocabularyData[index].selected = e.target.checked;
                        updateSectionCheckbox(item.section);
                        updateSelectAllCheckbox();
                    });

                    checkboxCell.appendChild(checkbox);
                    row.appendChild(wordCell);
                    row.appendChild(translationCell);
                    row.appendChild(checkboxCell);
                    vocabularyBody.appendChild(row);
                });
            });

            document.querySelectorAll('.speaker-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    const word = e.target.dataset.word;
                    speak(word);
                });
            });

            updateSelectAllCheckbox();
        }

        function updateSectionCheckbox(sectionName) {
            const sectionItems = vocabularyData.filter(item => item.section === sectionName);
            const allSelected = sectionItems.every(item => item.selected);
            const noneSelected = sectionItems.every(item => !item.selected);
            const sectionCheckbox = document.querySelector(`input[data-section="${sectionName}"]`);

            if (sectionCheckbox) {
                sectionCheckbox.checked = allSelected;
                sectionCheckbox.indeterminate = !allSelected && !noneSelected;
            }
        }

        function updateSelectAllCheckbox() {
            if (vocabularyData.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
                return;
            }

            const selectedCount = vocabularyData.filter(item => item.selected).length;
            if (selectedCount === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (selectedCount === vocabularyData.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        selectAllCheckbox.addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            vocabularyData.forEach(item => {
                item.selected = isChecked;
            });

            document.querySelectorAll('#vocabulary-body input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = isChecked;
                if (checkbox.dataset.section) {
                    checkbox.indeterminate = false;
                }
            });
        });

        // ===== PROGRESS TRACKING =====
        function initializeSectionProgress() {
            sectionProgress = {};
            const sectionMap = {};

            vocabularyData.forEach(item => {
                if (!sectionMap[item.section]) {
                    sectionMap[item.section] = [];
                }
                sectionMap[item.section].push(item);
            });

            Object.keys(sectionMap).forEach(sectionName => {
                const sectionItems = sectionMap[sectionName].filter(item => item.selected);
                if (sectionItems.length > 0) {
                    sectionProgress[sectionName] = {
                        currentIndex: -1,
                        totalCount: sectionItems.length,
                        items: sectionItems
                    };
                }
            });
        }

        function getCurrentProgressInfo() {
            if (quizMode !== 'sequential' || !currentEnglishWord) {
                return null;
            }

            const currentSection = currentEnglishWord.section;
            if (!sectionProgress[currentSection]) {
                return null;
            }

            const progress = sectionProgress[currentSection];
            const currentPosition = progress.currentIndex + 1;
            const totalInSection = progress.totalCount;

            return {
                current: currentPosition,
                total: totalInSection,
                section: currentSection
            };
        }

        function updateProgressDisplay() {
            if (quizMode !== 'sequential') {
                englishProgressInfo.style.display = 'none';
                return;
            }

            const progressInfo = getCurrentProgressInfo();
            if (!progressInfo) {
                englishProgressInfo.style.display = 'none';
                return;
            }

            englishProgressText.textContent = `${progressInfo.current} of ${progressInfo.total} (${progressInfo.section})`;
            englishProgressInfo.style.display = 'block';
        }

        // ===== LISTEN AND CHOOSE QUIZ =====
        function startListenAndChooseQuiz() {
            currentListenQuizWords = vocabularyData.filter(item => item.selected);

            if (currentListenQuizWords.length === 0) {
                alert('Please select at least 8 vocabulary words for this quiz. (è«‹é¸æ“‡è‡³å°‘8å€‹å–®å­—ä»¥é€²è¡Œæ­¤æ¸¬é©—)');
                return;
            }

            if (currentListenQuizWords.length < 8) {
                alert('Please select at least 8 vocabulary words for this quiz. (è«‹é¸æ“‡è‡³å°‘8å€‹å–®å­—ä»¥é€²è¡Œæ­¤æ¸¬é©—)');
                return;
            }

            resetListenAndChooseQuiz();
            listenChooseModal.style.display = 'flex';
            nextListenQuestion();
        }

        function resetListenAndChooseQuiz() {
            currentListenWordIndex = -1;
            currentListenWord = null;
            questionStartTime = null;
            isAnswered = false;
            listenAnswerDisplay.textContent = 'Click the speaker';
            timerFeedback.textContent = '';
        }

        function nextListenQuestion() {
            isAnswered = false;
            questionStartTime = null;
            listenAnswerDisplay.textContent = 'Click the speaker';
            timerFeedback.textContent = '';

            if (quizMode === 'sequential') {
                currentListenWordIndex = (currentListenWordIndex + 1) % currentListenQuizWords.length;
            } else {
                const previousIndex = currentListenWordIndex;
                if (currentListenQuizWords.length === 1) {
                    currentListenWordIndex = 0;
                } else {
                    do {
                        currentListenWordIndex = Math.floor(Math.random() * currentListenQuizWords.length);
                    } while (currentListenWordIndex === previousIndex && currentListenQuizWords.length > 1);
                }
            }

            currentListenWord = currentListenQuizWords[currentListenWordIndex];
            generateChoices();
        }

        function generateChoices() {
            if (!currentListenWord) return;

            const otherTranslations = currentListenQuizWords
                .filter(item => item.translation !== currentListenWord.translation)
                .map(item => item.translation);

            const shuffled = otherTranslations.sort(() => 0.5 - Math.random());
            const selectedChoices = shuffled.slice(0, 7);
            const allChoices = [...selectedChoices, currentListenWord.translation];
            const finalChoices = allChoices.sort(() => 0.5 - Math.random());

            choicesGrid.innerHTML = '';
            finalChoices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice;
                button.addEventListener('click', () => handleChoiceClick(button, choice));
                choicesGrid.appendChild(button);
            });
        }

        function handleChoiceClick(button, selectedChoice) {
            if (isAnswered) return;

            isAnswered = true;
            const responseTime = questionStartTime ? (Date.now() - questionStartTime) / 1000 : 0;

            document.querySelectorAll('.choice-button').forEach(btn => {
                btn.disabled = true;
            });

            const isCorrect = selectedChoice === currentListenWord.translation;

            if (isCorrect) {
                button.classList.add('correct');
                listenAnswerDisplay.textContent = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();

                let feedbackMessage = '';
                if (responseTime < 2) {
                    feedbackMessage = 'Perfect! âš¡';
                    speak('Perfect!');
                } else if (responseTime < 3.5) {
                    feedbackMessage = 'Good! ğŸ‘';
                    speak('Good!');
                } else if (responseTime < 6) {
                    feedbackMessage = 'Faster! â°';
                    speak('Faster!');
                } else {
                    feedbackMessage = 'Too late... ğŸ˜´';
                    speak('Too late...');
                }

                timerFeedback.textContent = `${feedbackMessage} (It took you ${responseTime.toFixed(1)} seconds.)`;
                timerFeedback.className = 'timer-feedback correct';
            } else {
                button.classList.add('incorrect');
                document.querySelectorAll('.choice-button').forEach(btn => {
                    if (btn.textContent === currentListenWord.translation) {
                        btn.classList.add('correct');
                    }
                });

                timerFeedback.textContent = 'You missed! ğŸ˜“âŒ';
                timerFeedback.className = 'timer-feedback incorrect';
                speak('You missed!');
                listenAnswerDisplay.textContent = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
            }
        }

        listenChooseBtn.addEventListener('click', startListenAndChooseQuiz);

        listenSpeaker.addEventListener('click', () => {
            if (currentListenWord && !isAnswered) {
                const cleanWord = currentListenWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
                speak(cleanWord);
                if (!questionStartTime) {
                    questionStartTime = Date.now();
                }
            }
        });

        listenNextBtn.addEventListener('click', nextListenQuestion);

        listenCloseBtn.addEventListener('click', () => {
            listenChooseModal.style.display = 'none';
        });

        // ===== ENGLISH TO CHINESE QUIZ =====
        englishToChineseBtn.addEventListener('click', () => {
            currentEnglishQuizWords = vocabularyData.filter(item => item.selected);
            if (currentEnglishQuizWords.length === 0) {
                alert('Please select at least one vocabulary word to start the quiz. (è«‹é¸æ“‡è‡³å°‘ä¸€å€‹å–®å­—ä»¥é€²è¡Œæ¸¬é©—)');
                return;
            }
            startEnglishToChineseQuiz();
        });

        checkAnswerBtn.addEventListener('click', showChineseAnswer);
        englishNextBtn.addEventListener('click', nextEnglishQuestion);

        englishCloseBtn.addEventListener('click', () => {
            englishToChineseModal.style.display = 'none';
        });

        englishWordSpeaker.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();

            if (isSpeaking) {
                console.log('Already speaking, ignoring click');
                return;
            }

            if (currentEnglishWord) {
                isSpeaking = true;
                const cleanWord = currentEnglishWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
                console.log('About to speak:', cleanWord);
                speak(cleanWord);

                setTimeout(() => {
                    isSpeaking = false;
                }, 3000);
            }
        });

        function startEnglishToChineseQuiz() {
            console.log('Starting English to Chinese quiz');
            console.log('Voices loaded:', voicesLoaded, 'Voice count:', voices.length);

            if (!voicesLoaded || voices.length === 0) {
                console.log('Loading voices before starting quiz...');
                loadVoices().then(() => {
                    console.log('Voices loaded, starting quiz');
                    resetEnglishToChineseQuiz();
                    englishToChineseModal.style.display = 'flex';
                    nextEnglishQuestion();
                });
            } else {
                resetEnglishToChineseQuiz();
                englishToChineseModal.style.display = 'flex';
                nextEnglishQuestion();
            }
        }

        function resetEnglishToChineseQuiz() {
            currentEnglishWordIndex = -1;
            currentEnglishWord = null;
            chineseAnswerDisplay.style.display = 'none';
            checkQuestion.style.display = 'none';
            checkAnswerBtn.style.display = 'block';

            if (quizMode === 'sequential') {
                initializeSectionProgress();
            }
        }

        function nextEnglishQuestion() {
            chineseAnswerDisplay.style.display = 'none';
            checkQuestion.style.display = 'none';
            checkAnswerBtn.style.display = 'block';

            if (quizMode === 'sequential') {
                if (currentEnglishWordIndex === -1) {
                    const firstSection = sectionOrder.find(section =>
                        sectionProgress[section] && sectionProgress[section].totalCount > 0
                    );
                    if (firstSection) {
                        sectionProgress[firstSection].currentIndex = 0;
                        currentEnglishWord = sectionProgress[firstSection].items[0];
                        currentEnglishWordIndex = 0;
                    } else {
                        currentEnglishWordIndex = 0;
                        currentEnglishWord = currentEnglishQuizWords[0];
                    }
                } else {
                    const currentSection = currentEnglishWord.section;
                    const sectionData = sectionProgress[currentSection];

                    if (sectionData && sectionData.currentIndex + 1 < sectionData.totalCount) {
                        sectionData.currentIndex++;
                        currentEnglishWord = sectionData.items[sectionData.currentIndex];
                    } else {
                        const currentSectionIndex = sectionOrder.indexOf(currentSection);
                        let nextSectionIndex = currentSectionIndex + 1;

                        while (nextSectionIndex < sectionOrder.length) {
                            const nextSection = sectionOrder[nextSectionIndex];
                            if (sectionProgress[nextSection] && sectionProgress[nextSection].totalCount > 0) {
                                sectionProgress[nextSection].currentIndex = 0;
                                currentEnglishWord = sectionProgress[nextSection].items[0];
                                break;
                            }
                            nextSectionIndex++;
                        }

                        if (nextSectionIndex >= sectionOrder.length) {
                            const firstSection = sectionOrder.find(section =>
                                sectionProgress[section] && sectionProgress[section].totalCount > 0
                            );
                            if (firstSection) {
                                sectionProgress[firstSection].currentIndex = 0;
                                currentEnglishWord = sectionProgress[firstSection].items[0];
                            }
                        }
                    }

                    currentEnglishWordIndex = currentEnglishQuizWords.findIndex(item =>
                        item.vocabulary === currentEnglishWord.vocabulary &&
                        item.translation === currentEnglishWord.translation
                    );
                }
            } else {
                const previousIndex = currentEnglishWordIndex;
                if (currentEnglishQuizWords.length === 1) {
                    currentEnglishWordIndex = 0;
                } else {
                    do {
                        currentEnglishWordIndex = Math.floor(Math.random() * currentEnglishQuizWords.length);
                    } while (currentEnglishWordIndex === previousIndex && currentEnglishQuizWords.length > 1);
                }
                currentEnglishWord = currentEnglishQuizWords[currentEnglishWordIndex];
            }

            const cleanWord = currentEnglishWord.vocabulary.replace(/\(.*?\)/g, '').trim();
            englishWordDisplay.textContent = cleanWord;
            updateProgressDisplay();
        }

        function showChineseAnswer() {
            if (!currentEnglishWord) return;

            chineseAnswerDisplay.textContent = currentEnglishWord.translation;
            chineseAnswerDisplay.style.display = 'block';
            checkQuestion.style.display = 'block';
            checkAnswerBtn.style.display = 'none';
        }

        // ===== MAIN QUIZ =====
        startBtn.addEventListener('click', () => {
            currentQuizWords = vocabularyData.filter(item => item.selected);
            if (currentQuizWords.length === 0) {
                alert('Please select at least one vocabulary word to start the quiz. (è«‹é¸æ“‡è‡³å°‘ä¸€å€‹å–®å­—ä»¥é€²è¡Œæ¸¬é©—)');
                return;
            }
            startQuiz();
        });

        function startQuiz() {
            resetQuiz();
            quizModal.style.display = 'flex';
            nextQuestion();
        }

        function resetQuiz() {
            currentWordIndex = -1;
            currentWord = null;
            answerInput.value = '';
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';
            hintTextEl.textContent = '';
            revealAnswerEl.textContent = '';
        }

        function nextQuestion() {
            answerInput.value = '';
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';
            hintTextEl.textContent = '';
            revealAnswerEl.textContent = '';

            if (quizMode === 'sequential') {
                currentWordIndex = (currentWordIndex + 1) % currentQuizWords.length;
            } else {
                const previousIndex = currentWordIndex;
                if (currentQuizWords.length === 1) {
                    currentWordIndex = 0;
                } else {
                    do {
                        currentWordIndex = Math.floor(Math.random() * currentQuizWords.length);
                    } while (currentWordIndex === previousIndex && currentQuizWords.length > 1);
                }
            }

            currentWord = currentQuizWords[currentWordIndex];
            translationPrompt.textContent = currentWord.translation;
        }

        function submitAnswer() {
            if (!currentWord) return;

            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswers = currentWord.vocabulary
                .split('/')
                .map(ans => ans.replace(/\(.*?\)/g, '').trim().toLowerCase());

            const normalizedUserAnswer = userAnswer.replace(/[.,?'''.../#!$%\^&\*;:{}=\-_`~()]/g, "");

            const isCorrect = correctAnswers.some(answer => {
                const normalizedAnswer = answer.replace(/[.,?'''.../#!$%\^&\*;:{}=\-_`~()]/g, "");
                return normalizedUserAnswer === normalizedAnswer;
            });

            if (isCorrect) {
                feedbackEl.textContent = 'Well done! ğŸ†ğŸ˜ŠğŸ‘';
                feedbackEl.className = 'feedback correct';
                speak('Well done!');
            } else {
                feedbackEl.textContent = 'Try again! ğŸ”¥ğŸ”¥ğŸ”¥';
                feedbackEl.className = 'feedback incorrect';
                speak('Try again!');
            }
        }

        function showHint() {
            if (!currentWord) return;
            const correctAnswer = currentWord.vocabulary.replace(/\(.*?\)/g, '').trim();
            const firstLetter = correctAnswer.charAt(0).toUpperCase();
            hintTextEl.textContent = `It starts with the letter ${firstLetter}.`;
        }

        function showAnswer() {
            if (!currentWord) return;
            const correctAnswer = currentWord.vocabulary.replace(/\(.*?\)/g, '').replace(/\*/g, '').replace(/\[.*?\]/g, '').trim();
            revealAnswerEl.textContent = `${correctAnswer}`;
            speak(correctAnswer);
        }

        submitBtn.addEventListener('click', submitAnswer);

        answerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitAnswer();
            }
        });

        speakBtn.addEventListener('click', () => {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            try {
                if (speakBtn.textContent === 'ğŸ¤ Speak') {
                    recognition.start();
                    speakBtn.textContent = 'Recording';
                    speakBtn.classList.add('recording');
                } else {
                    recognition.stop();
                    speakBtn.textContent = 'ğŸ¤ Speak';
                    speakBtn.classList.remove('recording');
                }
            } catch (error) {
                console.error('Speech recognition error:', error);
                speakBtn.textContent = 'ğŸ¤ Speak';
                speakBtn.classList.remove('recording');
            }
        });

        hintBtn.addEventListener('click', showHint);
        answerBtn.addEventListener('click', showAnswer);
        nextBtn.addEventListener('click', nextQuestion);

        closeBtn.addEventListener('click', () => {
            quizModal.style.display = 'none';
            if (recognition) {
                recognition.stop();
            }
        });

        // ===== DATE INFORMATION =====
        function updateDateInfo() {
            const dateInfoEl = document.getElementById('date-info');
            const options = {
                timeZone: 'Asia/Taipei',
                weekday: 'long',
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            };

            const today = new Date();
            const taiwanDate = today.toLocaleDateString('en-US', options);

            const examDate = new Date('October 14, 2025');
            examDate.setHours(0, 0, 0, 0);
            const todayNoTime = new Date(today);
            todayNoTime.setHours(0, 0, 0, 0);
            const daysUntilExam = Math.ceil((examDate - todayNoTime) / (1000 * 60 * 60 * 24));

            const collegeExamDate = new Date('January 16, 2026');
            collegeExamDate.setHours(0, 0, 0, 0);
            const daysUntilCollegeExam = Math.ceil((collegeExamDate - todayNoTime) / (1000 * 60 * 60 * 24));

            dateInfoEl.innerHTML = `
                <span><span class="emoji">ğŸ“…</span>${taiwanDate}</span><br>
                <span><span class="emoji">â°</span><span class="countdown">${daysUntilExam}</span> days until æ®µè€ƒ</span>
                <span><span class="emoji">ğŸ“š</span><span class="countdown">${daysUntilCollegeExam}</span> days until 115å¹´å­¸æ¸¬</span>
            `;
        }

        updateDateInfo();
        setInterval(updateDateInfo, 60000);

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            initializeTTS();

            const refreshReminderPopup = document.getElementById('refresh-reminder-popup');
            setTimeout(() => {
                refreshReminderPopup.style.display = 'flex';
            }, 1000);

            const closeReminderBtn = document.getElementById('close-reminder-btn');
            closeReminderBtn.addEventListener('click', () => {
                refreshReminderPopup.style.display = 'none';
            });
        });

        document.addEventListener('click', function initOnFirstClick() {
            initializeTTS();
            document.removeEventListener('click', initOnFirstClick);
        }, { once: true });

        // ===== FIREBASE VISITOR COUNTER =====
        function initVisitorCounter() {
            const firebaseConfig = {
                apiKey: "AIzaSyBFhmaAZmBtsM5DKoxgy1G-RouRKsrjYsA",
                authDomain: "vocab-builder-visitor-counter.firebaseapp.co",
                databaseURL: "https://vocab-builder-visitor-counter-default-rtdb.asia-southeast1.firebasedatabase.app/",
                projectId: "vocab-builder-visitor-counter",
                storageBucket: "vocab-builder-visitor-counter.firebasestorage.app",
                messagingSenderId: "648587683861",
                appId: "1:648587683861:web:dcb777160dabb4cbf8c61c"
            };

            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            const today = new Date();
            const taiwanDate = new Date(today.toLocaleString('en-US', { timeZone: 'Asia/Taipei' }));
            const dateStr = taiwanDate.getFullYear() + '-' +
                (taiwanDate.getMonth() + 1).toString().padStart(2, '0') + '-' +
                taiwanDate.getDate().toString().padStart(2, '0');

            const visitorCountRef = database.ref('visitorCount/' + dateStr);

            function updateVisitorDisplay(count) {
                const visitorCountEl = document.getElementById('visitor-count');
                if (count === 1) {
                    visitorCountEl.innerHTML = `ğŸ‘‹ ${count} person has visited this website today.`;
                } else {
                    visitorCountEl.innerHTML = `ğŸ‘‹ ${count} people have visited this website today.`;
                }
            }

            const hasVisitedToday = localStorage.getItem('visited_' + dateStr);

            if (!hasVisitedToday) {
                visitorCountRef.transaction((currentCount) => {
                    return (currentCount || 0) + 1;
                }, (error, committed, snapshot) => {
                    if (error) {
                        console.error('Transaction failed:', error);
                    } else if (committed) {
                        localStorage.setItem('visited_' + dateStr, 'true');
                        updateVisitorDisplay(snapshot.val());
                    }
                });
            } else {
                visitorCountRef.once('value', (snapshot) => {
                    const count = snapshot.val() || 0;
                    updateVisitorDisplay(count);
                });
            }

            visitorCountRef.on('value', (snapshot) => {
                const count = snapshot.val() || 0;
                updateVisitorDisplay(count);
            });
        }

        try {
            initVisitorCounter();
        } catch (e) {
            console.error("Error initializing visitor counter:", e);
            document.getElementById('visitor-count').innerHTML = "ğŸ˜… Visitor count unavailable";
        }
    </script>
</body>
</html>
